<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                23è®²MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/ea/86/eadffbfed6b55a60bd42347a579c4e86.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="23è®²MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="23è®²MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¼šç»§ç»­å’Œä½ ä»‹ç»åœ¨ä¸šåŠ¡é«˜å³°æœŸä¸´æ—¶æå‡æ€§èƒ½çš„æ–¹æ³•ã€‚ä»æ–‡ç« æ ‡é¢˜â€œMySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸ä¸¢çš„ï¼Ÿâ€ï¼Œä½ å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œä»Šå¤©æˆ‘å’Œä½ ä»‹ç»çš„æ–¹æ³•ï¼Œè·Ÿæ•°æ®çš„å¯é æ€§æœ‰å…³ã€‚</p><p>åœ¨ä¸“æ å‰é¢æ–‡ç« å’Œç­”ç–‘ç¯‡ä¸­ï¼Œæˆ‘éƒ½ç€é‡ä»‹ç»äº†WALæœºåˆ¶ï¼ˆä½ å¯ä»¥å†å›é¡¾ä¸‹<a href="https://time.geekbang.org/column/article/68633">ç¬¬2ç¯‡</a>ã€<a href="https://time.geekbang.org/column/article/70848">ç¬¬9ç¯‡</a>ã€<a href="https://time.geekbang.org/column/article/71806">ç¬¬12ç¯‡</a>å’Œ<a href="https://time.geekbang.org/column/article/73161">ç¬¬15ç¯‡</a>æ–‡ç« ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ï¼Œå¾—åˆ°çš„ç»“è®ºæ˜¯ï¼šåªè¦redo logå’Œbinlogä¿è¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå°±èƒ½ç¡®ä¿MySQLå¼‚å¸¸é‡å¯åï¼Œæ•°æ®å¯ä»¥æ¢å¤ã€‚</p><p>è¯„è®ºåŒºæœ‰åŒå­¦åˆç»§ç»­è¿½é—®ï¼Œredo logçš„å†™å…¥æµç¨‹æ˜¯æ€ä¹ˆæ ·çš„ï¼Œå¦‚ä½•ä¿è¯redo logçœŸå®åœ°å†™å…¥äº†ç£ç›˜ã€‚é‚£ä¹ˆä»Šå¤©ï¼Œæˆ‘ä»¬å°±å†ä¸€èµ·çœ‹çœ‹MySQLå†™å…¥binlogå’Œredo logçš„æµç¨‹ã€‚</p><h1>binlogçš„å†™å…¥æœºåˆ¶</h1><p>å…¶å®ï¼Œbinlogçš„å†™å…¥é€»è¾‘æ¯”è¾ƒç®€å•ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆæŠŠæ—¥å¿—å†™åˆ°binlog cacheï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå†æŠŠbinlog cacheå†™åˆ°binlogæ–‡ä»¶ä¸­ã€‚</p><p>ä¸€ä¸ªäº‹åŠ¡çš„binlogæ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œå› æ­¤ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ï¼Œä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥ã€‚è¿™å°±æ¶‰åŠåˆ°äº†binlog cacheçš„ä¿å­˜é—®é¢˜ã€‚</p><p>ç³»ç»Ÿç»™binlog cacheåˆ†é…äº†ä¸€ç‰‡å†…å­˜ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªï¼Œå‚æ•° binlog_cache_sizeç”¨äºæ§åˆ¶å•ä¸ªçº¿ç¨‹å†…binlog cacheæ‰€å å†…å­˜çš„å¤§å°ã€‚å¦‚æœè¶…è¿‡äº†è¿™ä¸ªå‚æ•°è§„å®šçš„å¤§å°ï¼Œå°±è¦æš‚å­˜åˆ°ç£ç›˜ã€‚</p><!-- [[[read_end]]] --><p>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæ‰§è¡Œå™¨æŠŠbinlog cacheé‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ°binlogä¸­ï¼Œå¹¶æ¸…ç©ºbinlog cacheã€‚çŠ¶æ€å¦‚å›¾1æ‰€ç¤ºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/9e/3e/9ed86644d5f39efb0efec595abb92e3e.png" alt=""></p><center><span class="reference">å›¾1 binlogå†™ç›˜çŠ¶æ€</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±binlog cacheï¼Œä½†æ˜¯å…±ç”¨åŒä¸€ä»½binlogæ–‡ä»¶ã€‚</p><ul>
<li>å›¾ä¸­çš„writeï¼ŒæŒ‡çš„å°±æ˜¯æŒ‡æŠŠæ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œå¹¶æ²¡æœ‰æŠŠæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ‰€ä»¥é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚</li>
<li>å›¾ä¸­çš„fsyncï¼Œæ‰æ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜çš„æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¤ä¸ºfsyncæ‰å ç£ç›˜çš„IOPSã€‚</li>
</ul><p>write å’Œfsyncçš„æ—¶æœºï¼Œæ˜¯ç”±å‚æ•°sync_binlogæ§åˆ¶çš„ï¼š</p><ol>
<li>
<p>sync_binlog=0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åªwriteï¼Œä¸fsyncï¼›</p>
</li>
<li>
<p>sync_binlog=1çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œfsyncï¼›</p>
</li>
<li>
<p>sync_binlog=N(N&gt;1)çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½writeï¼Œä½†ç´¯ç§¯Nä¸ªäº‹åŠ¡åæ‰fsyncã€‚</p>
</li>
</ol><p>å› æ­¤ï¼Œåœ¨å‡ºç°IOç“¶é¢ˆçš„åœºæ™¯é‡Œï¼Œå°†sync_binlogè®¾ç½®æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè€ƒè™‘åˆ°ä¸¢å¤±æ—¥å¿—é‡çš„å¯æ§æ€§ï¼Œä¸€èˆ¬ä¸å»ºè®®å°†è¿™ä¸ªå‚æ•°è®¾æˆ0ï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯å°†å…¶è®¾ç½®ä¸º100~1000ä¸­çš„æŸä¸ªæ•°å€¼ã€‚</p><p>ä½†æ˜¯ï¼Œå°†sync_binlogè®¾ç½®ä¸ºNï¼Œå¯¹åº”çš„é£é™©æ˜¯ï¼šå¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘Nä¸ªäº‹åŠ¡çš„binlogæ—¥å¿—ã€‚</p><h1>redo logçš„å†™å…¥æœºåˆ¶</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†è¯´è¯´redo logçš„å†™å…¥æœºåˆ¶ã€‚</p><p>åœ¨ä¸“æ çš„<a href="https://time.geekbang.org/column/article/73161">ç¬¬15ç¯‡ç­”ç–‘æ–‡ç« </a>ä¸­ï¼Œæˆ‘ç»™ä½ ä»‹ç»äº†redo log bufferã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆçš„redo logæ˜¯è¦å…ˆå†™åˆ°redo log bufferçš„ã€‚</p><p>ç„¶åå°±æœ‰åŒå­¦é—®äº†ï¼Œredo log bufferé‡Œé¢çš„å†…å®¹ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡ç”Ÿæˆåéƒ½è¦ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œä¸éœ€è¦ã€‚</p><p>å¦‚æœäº‹åŠ¡æ‰§è¡ŒæœŸé—´MySQLå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œé‚£è¿™éƒ¨åˆ†æ—¥å¿—å°±ä¸¢äº†ã€‚ç”±äºäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™æ—¶æ—¥å¿—ä¸¢äº†ä¹Ÿä¸ä¼šæœ‰æŸå¤±ã€‚</p><p>é‚£ä¹ˆï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œäº‹åŠ¡è¿˜æ²¡æäº¤çš„æ—¶å€™ï¼Œredo log bufferä¸­çš„éƒ¨åˆ†æ—¥å¿—æœ‰æ²¡æœ‰å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œç¡®å®ä¼šæœ‰ã€‚</p><p>è¿™ä¸ªé—®é¢˜ï¼Œè¦ä»redo logå¯èƒ½å­˜åœ¨çš„ä¸‰ç§çŠ¶æ€è¯´èµ·ã€‚è¿™ä¸‰ç§çŠ¶æ€ï¼Œå¯¹åº”çš„å°±æ˜¯å›¾2 ä¸­çš„ä¸‰ä¸ªé¢œè‰²å—ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/9d/d4/9d057f61d3962407f413deebc80526d4.png" alt=""></p><center><span class="reference">å›¾2 MySQL redo logå­˜å‚¨çŠ¶æ€</span></center><p>è¿™ä¸‰ç§çŠ¶æ€åˆ†åˆ«æ˜¯ï¼š</p><ol>
<li>
<p>å­˜åœ¨redo log bufferä¸­ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨MySQLè¿›ç¨‹å†…å­˜ä¸­ï¼Œå°±æ˜¯å›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼›</p>
</li>
<li>
<p>å†™åˆ°ç£ç›˜(write)ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–ï¼ˆfsync)ï¼Œç‰©ç†ä¸Šæ˜¯åœ¨æ–‡ä»¶ç³»ç»Ÿçš„page cacheé‡Œé¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„é»„è‰²éƒ¨åˆ†ï¼›</p>
</li>
<li>
<p>æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå¯¹åº”çš„æ˜¯hard diskï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç»¿è‰²éƒ¨åˆ†ã€‚</p>
</li>
</ol><p>æ—¥å¿—å†™åˆ°redo log bufferæ˜¯å¾ˆå¿«çš„ï¼Œwirteåˆ°page cacheä¹Ÿå·®ä¸å¤šï¼Œä½†æ˜¯æŒä¹…åŒ–åˆ°ç£ç›˜çš„é€Ÿåº¦å°±æ…¢å¤šäº†ã€‚</p><p>ä¸ºäº†æ§åˆ¶redo logçš„å†™å…¥ç­–ç•¥ï¼ŒInnoDBæä¾›äº†innodb_flush_log_at_trx_commitå‚æ•°ï¼Œå®ƒæœ‰ä¸‰ç§å¯èƒ½å–å€¼ï¼š</p><ol>
<li>
<p>è®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠredo logç•™åœ¨redo log bufferä¸­;</p>
</li>
<li>
<p>è®¾ç½®ä¸º1çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½å°†redo logç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</p>
</li>
<li>
<p>è®¾ç½®ä¸º2çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡æäº¤æ—¶éƒ½åªæ˜¯æŠŠredo logå†™åˆ°page cacheã€‚</p>
</li>
</ol><p>InnoDBæœ‰ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¯éš”1ç§’ï¼Œå°±ä¼šæŠŠredo log bufferä¸­çš„æ—¥å¿—ï¼Œè°ƒç”¨writeå†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheï¼Œç„¶åè°ƒç”¨fsyncæŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p><p>æ³¨æ„ï¼Œäº‹åŠ¡æ‰§è¡Œä¸­é—´è¿‡ç¨‹çš„redo logä¹Ÿæ˜¯ç›´æ¥å†™åœ¨redo log bufferä¸­çš„ï¼Œè¿™äº›redo logä¹Ÿä¼šè¢«åå°çº¿ç¨‹ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„redo logï¼Œä¹Ÿæ˜¯å¯èƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜çš„ã€‚</p><p>å®é™…ä¸Šï¼Œé™¤äº†åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢æ“ä½œå¤–ï¼Œè¿˜æœ‰ä¸¤ç§åœºæ™¯ä¼šè®©ä¸€ä¸ªæ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„redo logå†™å…¥åˆ°ç£ç›˜ä¸­ã€‚</p><ol>
<li>
<p><strong>ä¸€ç§æ˜¯ï¼Œredo log bufferå ç”¨çš„ç©ºé—´å³å°†è¾¾åˆ° innodb_log_buffer_sizeä¸€åŠçš„æ—¶å€™ï¼Œåå°çº¿ç¨‹ä¼šä¸»åŠ¨å†™ç›˜ã€‚</strong>æ³¨æ„ï¼Œç”±äºè¿™ä¸ªäº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è¿™ä¸ªå†™ç›˜åŠ¨ä½œåªæ˜¯writeï¼Œè€Œæ²¡æœ‰è°ƒç”¨fsyncï¼Œä¹Ÿå°±æ˜¯åªç•™åœ¨äº†æ–‡ä»¶ç³»ç»Ÿçš„page cacheã€‚</p>
</li>
<li>
<p><strong>å¦ä¸€ç§æ˜¯ï¼Œå¹¶è¡Œçš„äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œé¡ºå¸¦å°†è¿™ä¸ªäº‹åŠ¡çš„redo log bufferæŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</strong>å‡è®¾ä¸€ä¸ªäº‹åŠ¡Aæ‰§è¡Œåˆ°ä¸€åŠï¼Œå·²ç»å†™äº†ä¸€äº›redo logåˆ°bufferä¸­ï¼Œè¿™æ—¶å€™æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡Bæäº¤ï¼Œå¦‚æœinnodb_flush_log_at_trx_commitè®¾ç½®çš„æ˜¯1ï¼Œé‚£ä¹ˆæŒ‰ç…§è¿™ä¸ªå‚æ•°çš„é€»è¾‘ï¼Œäº‹åŠ¡Bè¦æŠŠredo log bufferé‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ—¶å€™ï¼Œå°±ä¼šå¸¦ä¸Šäº‹åŠ¡Aåœ¨redo log bufferé‡Œçš„æ—¥å¿—ä¸€èµ·æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚</p>
</li>
</ol><p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬ä»‹ç»ä¸¤é˜¶æ®µæäº¤çš„æ—¶å€™è¯´è¿‡ï¼Œæ—¶åºä¸Šredo logå…ˆprepareï¼Œ å†å†™binlogï¼Œæœ€åå†æŠŠredo log commitã€‚</p><p>å¦‚æœæŠŠinnodb_flush_log_at_trx_commitè®¾ç½®æˆ1ï¼Œé‚£ä¹ˆredo logåœ¨prepareé˜¶æ®µå°±è¦æŒä¹…åŒ–ä¸€æ¬¡ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå´©æºƒæ¢å¤é€»è¾‘æ˜¯è¦ä¾èµ–äºprepare çš„redo logï¼Œå†åŠ ä¸Šbinlogæ¥æ¢å¤çš„ã€‚ï¼ˆå¦‚æœä½ å°è±¡æœ‰ç‚¹å„¿æ¨¡ç³Šäº†ï¼Œå¯ä»¥å†å›é¡¾ä¸‹<a href="https://time.geekbang.org/column/article/73161">ç¬¬15ç¯‡æ–‡ç« </a>ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ã€‚</p><p>æ¯ç§’ä¸€æ¬¡åå°è½®è¯¢åˆ·ç›˜ï¼Œå†åŠ ä¸Šå´©æºƒæ¢å¤è¿™ä¸ªé€»è¾‘ï¼ŒInnoDBå°±è®¤ä¸ºredo logåœ¨commitçš„æ—¶å€™å°±ä¸éœ€è¦fsyncäº†ï¼Œåªä¼šwriteåˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheä¸­å°±å¤Ÿäº†ã€‚</p><p>é€šå¸¸æˆ‘ä»¬è¯´MySQLçš„â€œåŒ1â€é…ç½®ï¼ŒæŒ‡çš„å°±æ˜¯sync_binlogå’Œinnodb_flush_log_at_trx_commitéƒ½è®¾ç½®æˆ 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªäº‹åŠ¡å®Œæ•´æäº¤å‰ï¼Œéœ€è¦ç­‰å¾…ä¸¤æ¬¡åˆ·ç›˜ï¼Œä¸€æ¬¡æ˜¯redo logï¼ˆprepare é˜¶æ®µï¼‰ï¼Œä¸€æ¬¡æ˜¯binlogã€‚</p><p>è¿™æ—¶å€™ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªç–‘é—®ï¼Œè¿™æ„å‘³ç€æˆ‘ä»MySQLçœ‹åˆ°çš„TPSæ˜¯æ¯ç§’ä¸¤ä¸‡çš„è¯ï¼Œæ¯ç§’å°±ä¼šå†™å››ä¸‡æ¬¡ç£ç›˜ã€‚ä½†æ˜¯ï¼Œæˆ‘ç”¨å·¥å…·æµ‹è¯•å‡ºæ¥ï¼Œç£ç›˜èƒ½åŠ›ä¹Ÿå°±ä¸¤ä¸‡å·¦å³ï¼Œæ€ä¹ˆèƒ½å®ç°ä¸¤ä¸‡çš„TPSï¼Ÿ</p><p>è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼Œå°±è¦ç”¨åˆ°ç»„æäº¤ï¼ˆgroup commitï¼‰æœºåˆ¶äº†ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘éœ€è¦å…ˆå’Œä½ ä»‹ç»æ—¥å¿—é€»è¾‘åºåˆ—å·ï¼ˆlog sequence numberï¼ŒLSNï¼‰çš„æ¦‚å¿µã€‚LSNæ˜¯å•è°ƒé€’å¢çš„ï¼Œç”¨æ¥å¯¹åº”redo logçš„ä¸€ä¸ªä¸ªå†™å…¥ç‚¹ã€‚æ¯æ¬¡å†™å…¥é•¿åº¦ä¸ºlengthçš„redo logï¼Œ LSNçš„å€¼å°±ä¼šåŠ ä¸Šlengthã€‚</p><p>LSNä¹Ÿä¼šå†™åˆ°InnoDBçš„æ•°æ®é¡µä¸­ï¼Œæ¥ç¡®ä¿æ•°æ®é¡µä¸ä¼šè¢«å¤šæ¬¡æ‰§è¡Œé‡å¤çš„redo logã€‚å…³äºLSNå’Œredo logã€checkpointçš„å…³ç³»ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­è¯¦ç»†å±•å¼€ã€‚</p><p>å¦‚å›¾3æ‰€ç¤ºï¼Œæ˜¯ä¸‰ä¸ªå¹¶å‘äº‹åŠ¡(trx1, trx2, trx3)åœ¨prepare é˜¶æ®µï¼Œéƒ½å†™å®Œredo log bufferï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜çš„è¿‡ç¨‹ï¼Œå¯¹åº”çš„LSNåˆ†åˆ«æ˜¯50ã€120 å’Œ160ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/93/cc/933fdc052c6339de2aa3bf3f65b188cc.png" alt=""></p><center><span class="reference">å›¾3 redo log ç»„æäº¤</span></center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ</p><ol>
<li>
<p>trx1æ˜¯ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„ï¼Œä¼šè¢«é€‰ä¸ºè¿™ç»„çš„ leaderï¼›</p>
</li>
<li>
<p>ç­‰trx1è¦å¼€å§‹å†™ç›˜çš„æ—¶å€™ï¼Œè¿™ä¸ªç»„é‡Œé¢å·²ç»æœ‰äº†ä¸‰ä¸ªäº‹åŠ¡ï¼Œè¿™æ—¶å€™LSNä¹Ÿå˜æˆäº†160ï¼›</p>
</li>
<li>
<p>trx1å»å†™ç›˜çš„æ—¶å€™ï¼Œå¸¦çš„å°±æ˜¯LSN=160ï¼Œå› æ­¤ç­‰trx1è¿”å›æ—¶ï¼Œæ‰€æœ‰LSNå°äºç­‰äº160çš„redo logï¼Œéƒ½å·²ç»è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼›</p>
</li>
<li>
<p>è¿™æ—¶å€™trx2å’Œtrx3å°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚</p>
</li>
</ol><p>æ‰€ä»¥ï¼Œä¸€æ¬¡ç»„æäº¤é‡Œé¢ï¼Œç»„å‘˜è¶Šå¤šï¼ŒèŠ‚çº¦ç£ç›˜IOPSçš„æ•ˆæœè¶Šå¥½ã€‚ä½†å¦‚æœåªæœ‰å•çº¿ç¨‹å‹æµ‹ï¼Œé‚£å°±åªèƒ½è€è€å®å®åœ°ä¸€ä¸ªäº‹åŠ¡å¯¹åº”ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œäº†ã€‚</p><p>åœ¨å¹¶å‘æ›´æ–°åœºæ™¯ä¸‹ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å†™å®Œredo log bufferä»¥åï¼Œæ¥ä¸‹æ¥è¿™ä¸ªfsyncè¶Šæ™šè°ƒç”¨ï¼Œç»„å‘˜å¯èƒ½è¶Šå¤šï¼ŒèŠ‚çº¦IOPSçš„æ•ˆæœå°±è¶Šå¥½ã€‚</p><p>ä¸ºäº†è®©ä¸€æ¬¡fsyncå¸¦çš„ç»„å‘˜æ›´å¤šï¼ŒMySQLæœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ä¼˜åŒ–ï¼šæ‹–æ—¶é—´ã€‚åœ¨ä»‹ç»ä¸¤é˜¶æ®µæäº¤çš„æ—¶å€™ï¼Œæˆ‘æ›¾ç»ç»™ä½ ç”»äº†ä¸€ä¸ªå›¾ï¼Œç°åœ¨æˆ‘æŠŠå®ƒæˆªè¿‡æ¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/98/51/98b3b4ff7b36d6d72e38029b86870551.png" alt=""></p><center><span class="reference">å›¾4 ä¸¤é˜¶æ®µæäº¤</span></center><p>å›¾ä¸­ï¼Œæˆ‘æŠŠâ€œå†™binlogâ€å½“æˆä¸€ä¸ªåŠ¨ä½œã€‚ä½†å®é™…ä¸Šï¼Œå†™binlogæ˜¯åˆ†æˆä¸¤æ­¥çš„ï¼š</p><ol>
<li>
<p>å…ˆæŠŠbinlogä»binlog cacheä¸­å†™åˆ°ç£ç›˜ä¸Šçš„binlogæ–‡ä»¶ï¼›</p>
</li>
<li>
<p>è°ƒç”¨fsyncæŒä¹…åŒ–ã€‚</p>
</li>
</ol><p>MySQLä¸ºäº†è®©ç»„æäº¤çš„æ•ˆæœæ›´å¥½ï¼ŒæŠŠredo logåšfsyncçš„æ—¶é—´æ‹–åˆ°äº†æ­¥éª¤1ä¹‹åã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„å›¾å˜æˆäº†è¿™æ ·ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/5a/28/5ae7d074c34bc5bd55c82781de670c28.png" alt=""></p><center><span class="reference">å›¾5 ä¸¤é˜¶æ®µæäº¤ç»†åŒ–</span></center><p>è¿™ä¹ˆä¸€æ¥ï¼Œbinlogä¹Ÿå¯ä»¥ç»„æäº¤äº†ã€‚åœ¨æ‰§è¡Œå›¾5ä¸­ç¬¬4æ­¥æŠŠbinlog fsyncåˆ°ç£ç›˜æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªäº‹åŠ¡çš„binlogå·²ç»å†™å®Œäº†ï¼Œä¹Ÿæ˜¯ä¸€èµ·æŒä¹…åŒ–çš„ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘IOPSçš„æ¶ˆè€—ã€‚</p><p>ä¸è¿‡é€šå¸¸æƒ…å†µä¸‹ç¬¬3æ­¥æ‰§è¡Œå¾—ä¼šå¾ˆå¿«ï¼Œæ‰€ä»¥binlogçš„writeå’Œfsyncé—´çš„é—´éš”æ—¶é—´çŸ­ï¼Œå¯¼è‡´èƒ½é›†åˆåˆ°ä¸€èµ·æŒä¹…åŒ–çš„binlogæ¯”è¾ƒå°‘ï¼Œå› æ­¤binlogçš„ç»„æäº¤çš„æ•ˆæœé€šå¸¸ä¸å¦‚redo logçš„æ•ˆæœé‚£ä¹ˆå¥½ã€‚</p><p>å¦‚æœä½ æƒ³æå‡binlogç»„æäº¤çš„æ•ˆæœï¼Œå¯ä»¥é€šè¿‡è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_countæ¥å®ç°ã€‚</p><ol>
<li>
<p>binlog_group_commit_sync_delayå‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨fsync;</p>
</li>
<li>
<p>binlog_group_commit_sync_no_delay_countå‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨fsyncã€‚</p>
</li>
</ol><p>è¿™ä¸¤ä¸ªæ¡ä»¶æ˜¯æˆ–çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶å°±ä¼šè°ƒç”¨fsyncã€‚</p><p>æ‰€ä»¥ï¼Œå½“binlog_group_commit_sync_delayè®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œbinlog_group_commit_sync_no_delay_countä¹Ÿæ— æ•ˆäº†ã€‚</p><p>ä¹‹å‰æœ‰åŒå­¦åœ¨è¯„è®ºåŒºé—®åˆ°ï¼ŒWALæœºåˆ¶æ˜¯å‡å°‘ç£ç›˜å†™ï¼Œå¯æ˜¯æ¯æ¬¡æäº¤äº‹åŠ¡éƒ½è¦å†™redo logå’Œbinlogï¼Œè¿™ç£ç›˜è¯»å†™æ¬¡æ•°ä¹Ÿæ²¡å˜å°‘å‘€ï¼Ÿ</p><p>ç°åœ¨ä½ å°±èƒ½ç†è§£äº†ï¼ŒWALæœºåˆ¶ä¸»è¦å¾—ç›Šäºä¸¤ä¸ªæ–¹é¢ï¼š</p><ol>
<li>
<p>redo log å’Œ binlogéƒ½æ˜¯é¡ºåºå†™ï¼Œç£ç›˜çš„é¡ºåºå†™æ¯”éšæœºå†™é€Ÿåº¦è¦å¿«ï¼›</p>
</li>
<li>
<p>ç»„æäº¤æœºåˆ¶ï¼Œå¯ä»¥å¤§å¹…åº¦é™ä½ç£ç›˜çš„IOPSæ¶ˆè€—ã€‚</p>
</li>
</ol><p>åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼š<strong>å¦‚æœä½ çš„MySQLç°åœ¨å‡ºç°äº†æ€§èƒ½ç“¶é¢ˆï¼Œè€Œä¸”ç“¶é¢ˆåœ¨IOä¸Šï¼Œå¯ä»¥é€šè¿‡å“ªäº›æ–¹æ³•æ¥æå‡æ€§èƒ½å‘¢ï¼Ÿ</strong></p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p><ol>
<li>
<p>è®¾ç½® binlog_group_commit_sync_delay å’Œ binlog_group_commit_sync_no_delay_countå‚æ•°ï¼Œå‡å°‘binlogçš„å†™ç›˜æ¬¡æ•°ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åŸºäºâ€œé¢å¤–çš„æ•…æ„ç­‰å¾…â€æ¥å®ç°çš„ï¼Œå› æ­¤å¯èƒ½ä¼šå¢åŠ è¯­å¥çš„å“åº”æ—¶é—´ï¼Œä½†æ²¡æœ‰ä¸¢å¤±æ•°æ®çš„é£é™©ã€‚</p>
</li>
<li>
<p>å°†sync_binlog è®¾ç½®ä¸ºå¤§äº1çš„å€¼ï¼ˆæ¯”è¾ƒå¸¸è§æ˜¯100~1000ï¼‰ã€‚è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µæ—¶ä¼šä¸¢binlogæ—¥å¿—ã€‚</p>
</li>
<li>
<p>å°†innodb_flush_log_at_trx_commitè®¾ç½®ä¸º2ã€‚è¿™æ ·åšçš„é£é™©æ˜¯ï¼Œä¸»æœºæ‰ç”µçš„æ—¶å€™ä¼šä¸¢æ•°æ®ã€‚</p>
</li>
</ol><p>æˆ‘ä¸å»ºè®®ä½ æŠŠinnodb_flush_log_at_trx_commit è®¾ç½®æˆ0ã€‚å› ä¸ºæŠŠè¿™ä¸ªå‚æ•°è®¾ç½®æˆ0ï¼Œè¡¨ç¤ºredo logåªä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·çš„è¯MySQLæœ¬èº«å¼‚å¸¸é‡å¯ä¹Ÿä¼šä¸¢æ•°æ®ï¼Œé£é™©å¤ªå¤§ã€‚è€Œredo logå†™åˆ°æ–‡ä»¶ç³»ç»Ÿçš„page cacheçš„é€Ÿåº¦ä¹Ÿæ˜¯å¾ˆå¿«çš„ï¼Œæ‰€ä»¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®æˆ2è·Ÿè®¾ç½®æˆ0å…¶å®æ€§èƒ½å·®ä¸å¤šï¼Œä½†è¿™æ ·åšMySQLå¼‚å¸¸é‡å¯æ—¶å°±ä¸ä¼šä¸¢æ•°æ®äº†ï¼Œç›¸æ¯”ä¹‹ä¸‹é£é™©ä¼šæ›´å°ã€‚</p><h1>å°ç»“</h1><p>åœ¨ä¸“æ çš„<a href="https://time.geekbang.org/column/article/68633">ç¬¬2ç¯‡</a>å’Œ<a href="https://time.geekbang.org/column/article/73161">ç¬¬15ç¯‡</a>æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ åˆ†æäº†ï¼Œå¦‚æœredo logå’Œbinlogæ˜¯å®Œæ•´çš„ï¼ŒMySQLæ˜¯å¦‚ä½•ä¿è¯crash-safeçš„ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç€é‡å’Œä½ ä»‹ç»çš„æ˜¯MySQLæ˜¯â€œæ€ä¹ˆä¿è¯redo logå’Œbinlogæ˜¯å®Œæ•´çš„â€ã€‚</p><p>å¸Œæœ›è¿™ä¸‰ç¯‡æ–‡ç« ä¸²èµ·æ¥çš„å†…å®¹ï¼Œèƒ½å¤Ÿè®©ä½ å¯¹crash-safeè¿™ä¸ªæ¦‚å¿µæœ‰æ›´æ¸…æ™°çš„ç†è§£ã€‚</p><p>ä¹‹å‰çš„ç¬¬15ç¯‡ç­”ç–‘æ–‡ç« å‘å¸ƒä¹‹åï¼Œæœ‰åŒå­¦ç»§ç»­ç•™è¨€é—®åˆ°äº†ä¸€äº›è·Ÿæ—¥å¿—ç›¸å…³çš„é—®é¢˜ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ä½ å›é¡¾ã€å­¦ä¹ ï¼Œæˆ‘å†é›†ä¸­å›ç­”ä¸€æ¬¡è¿™äº›é—®é¢˜ã€‚</p><p><strong>é—®é¢˜1ï¼š</strong>æ‰§è¡Œä¸€ä¸ªupdateè¯­å¥ä»¥åï¼Œæˆ‘å†å»æ‰§è¡Œhexdumpå‘½ä»¤ç›´æ¥æŸ¥çœ‹ibdæ–‡ä»¶å†…å®¹ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°æ•°æ®æœ‰æ”¹å˜å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šè¿™å¯èƒ½æ˜¯å› ä¸ºWALæœºåˆ¶çš„åŸå› ã€‚updateè¯­å¥æ‰§è¡Œå®Œæˆåï¼ŒInnoDBåªä¿è¯å†™å®Œäº†redo logã€å†…å­˜ï¼Œå¯èƒ½è¿˜æ²¡æ¥å¾—åŠå°†æ•°æ®å†™åˆ°ç£ç›˜ã€‚</p><p><strong>é—®é¢˜2ï¼š</strong>ä¸ºä»€ä¹ˆbinlog cacheæ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œredo log bufferæ˜¯å…¨å±€å…±ç”¨çš„ï¼Ÿ</p><p>å›ç­”ï¼šMySQLè¿™ä¹ˆè®¾è®¡çš„ä¸»è¦åŸå› æ˜¯ï¼Œbinlogæ˜¯ä¸èƒ½â€œè¢«æ‰“æ–­çš„â€ã€‚ä¸€ä¸ªäº‹åŠ¡çš„binlogå¿…é¡»è¿ç»­å†™ï¼Œå› æ­¤è¦æ•´ä¸ªäº‹åŠ¡å®Œæˆåï¼Œå†ä¸€èµ·å†™åˆ°æ–‡ä»¶é‡Œã€‚</p><p>è€Œredo logå¹¶æ²¡æœ‰è¿™ä¸ªè¦æ±‚ï¼Œä¸­é—´æœ‰ç”Ÿæˆçš„æ—¥å¿—å¯ä»¥å†™åˆ°redo log bufferä¸­ã€‚redo log bufferä¸­çš„å†…å®¹è¿˜èƒ½â€œæ­ä¾¿è½¦â€ï¼Œå…¶ä»–äº‹åŠ¡æäº¤çš„æ—¶å€™å¯ä»¥è¢«ä¸€èµ·å†™åˆ°ç£ç›˜ä¸­ã€‚</p><p><strong>é—®é¢˜3ï¼š</strong>äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œè¿˜æ²¡åˆ°æäº¤é˜¶æ®µï¼Œå¦‚æœå‘ç”Ÿcrashçš„è¯ï¼Œredo logè‚¯å®šä¸¢äº†ï¼Œè¿™ä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šä¸ä¼šã€‚å› ä¸ºè¿™æ—¶å€™binlog ä¹Ÿè¿˜åœ¨binlog cacheé‡Œï¼Œæ²¡å‘ç»™å¤‡åº“ã€‚crashä»¥åredo logå’Œbinlogéƒ½æ²¡æœ‰äº†ï¼Œä»ä¸šåŠ¡è§’åº¦çœ‹è¿™ä¸ªäº‹åŠ¡ä¹Ÿæ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><p><strong>é—®é¢˜4ï¼š</strong>å¦‚æœbinlogå†™å®Œç›˜ä»¥åå‘ç”Ÿcrashï¼Œè¿™æ—¶å€™è¿˜æ²¡ç»™å®¢æˆ·ç«¯ç­”å¤å°±é‡å¯äº†ã€‚ç­‰å®¢æˆ·ç«¯å†é‡è¿è¿›æ¥ï¼Œå‘ç°äº‹åŠ¡å·²ç»æäº¤æˆåŠŸäº†ï¼Œè¿™æ˜¯ä¸æ˜¯bugï¼Ÿ</p><p>å›ç­”ï¼šä¸æ˜¯ã€‚</p><p>ä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹æ›´æç«¯çš„æƒ…å†µï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½æäº¤æˆåŠŸäº†ï¼Œredo log commitå®Œæˆäº†ï¼Œå¤‡åº“ä¹Ÿæ”¶åˆ°binlogå¹¶æ‰§è¡Œäº†ã€‚ä½†æ˜¯ä¸»åº“å’Œå®¢æˆ·ç«¯ç½‘ç»œæ–­å¼€äº†ï¼Œå¯¼è‡´äº‹åŠ¡æˆåŠŸçš„åŒ…è¿”å›ä¸å›å»ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ä¹Ÿä¼šæ”¶åˆ°â€œç½‘ç»œæ–­å¼€â€çš„å¼‚å¸¸ã€‚è¿™ç§ä¹Ÿåªèƒ½ç®—æ˜¯äº‹åŠ¡æˆåŠŸçš„ï¼Œä¸èƒ½è®¤ä¸ºæ˜¯bugã€‚</p><p>å®é™…ä¸Šæ•°æ®åº“çš„crash-safeä¿è¯çš„æ˜¯ï¼š</p><ol>
<li>
<p>å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡æˆåŠŸçš„æ¶ˆæ¯ï¼Œäº‹åŠ¡å°±ä¸€å®šæŒä¹…åŒ–äº†ï¼›</p>
</li>
<li>
<p>å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°äº‹åŠ¡å¤±è´¥ï¼ˆæ¯”å¦‚ä¸»é”®å†²çªã€å›æ»šç­‰ï¼‰çš„æ¶ˆæ¯ï¼Œäº‹åŠ¡å°±ä¸€å®šå¤±è´¥äº†ï¼›</p>
</li>
<li>
<p>å¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°â€œæ‰§è¡Œå¼‚å¸¸â€çš„æ¶ˆæ¯ï¼Œåº”ç”¨éœ€è¦é‡è¿åé€šè¿‡æŸ¥è¯¢å½“å‰çŠ¶æ€æ¥ç»§ç»­åç»­çš„é€»è¾‘ã€‚æ­¤æ—¶æ•°æ®åº“åªéœ€è¦ä¿è¯å†…éƒ¨ï¼ˆæ•°æ®å’Œæ—¥å¿—ä¹‹é—´ï¼Œä¸»åº“å’Œå¤‡åº“ä¹‹é—´ï¼‰ä¸€è‡´å°±å¯ä»¥äº†ã€‚</p>
</li>
</ol><p>æœ€åï¼Œåˆåˆ°äº†è¯¾åé—®é¢˜æ—¶é—´ã€‚</p><p>ä»Šå¤©æˆ‘ç•™ç»™ä½ çš„æ€è€ƒé¢˜æ˜¯ï¼šä½ çš„ç”Ÿäº§åº“è®¾ç½®çš„æ˜¯â€œåŒ1â€å—ï¼Ÿ å¦‚æœå¹³æ—¶æ˜¯çš„è¯ï¼Œä½ æœ‰åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹æ”¹æˆè¿‡â€œéåŒ1â€å—ï¼Ÿä½ çš„è¿™ä¸ªæ“ä½œåˆæ˜¯åŸºäºä»€ä¹ˆå†³å®šçš„ï¼Ÿ</p><p>å¦å¤–ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¿™äº›è®¾ç½®å¯èƒ½æœ‰æŸï¼Œå¦‚æœå‘ç”Ÿäº†å¼‚å¸¸ï¼Œä½ çš„æ­¢æŸæ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç†è§£æˆ–è€…ç»éªŒå†™åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾é€‰å–æœ‰è¶£çš„è¯„è®ºå’Œä½ ä¸€èµ·åˆ†äº«å’Œåˆ†æã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« æœ€åï¼Œæƒ³è¦ä½ åˆ†äº«çš„æ˜¯çº¿ä¸Šâ€œæ•‘ç«â€çš„ç»éªŒã€‚</p><p>@Long åŒå­¦ï¼Œåœ¨ç•™è¨€ä¸­æåˆ°äº†å‡ ä¸ªå¾ˆå¥½çš„åœºæ™¯ã€‚</p><ul>
<li>
<p>å…¶ä¸­ç¬¬3ä¸ªé—®é¢˜ï¼Œâ€œå¦‚æœä¸€ä¸ªæ•°æ®åº“æ˜¯è¢«å®¢æˆ·ç«¯çš„å‹åŠ›æ‰“æ»¡å¯¼è‡´æ— æ³•å“åº”çš„ï¼Œé‡å¯æ•°æ®åº“æ˜¯æ²¡ç”¨çš„ã€‚â€ï¼Œè¯´æ˜ä»–å¾ˆå¥½åœ°æ€è€ƒäº†ã€‚<br>
è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºé‡å¯ä¹‹åï¼Œä¸šåŠ¡è¯·æ±‚è¿˜ä¼šå†å‘ã€‚è€Œä¸”ç”±äºæ˜¯é‡å¯ï¼Œbuffer poolè¢«æ¸…ç©ºï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯­å¥æ‰§è¡Œå¾—æ›´æ…¢ã€‚</p>
</li>
<li>
<p>ä»–æåˆ°çš„ç¬¬4ä¸ªé—®é¢˜ä¹Ÿå¾ˆå…¸å‹ã€‚æœ‰æ—¶å€™ä¸€ä¸ªè¡¨ä¸Šä¼šå‡ºç°å¤šä¸ªå•å­—æ®µç´¢å¼•ï¼ˆè€Œä¸”å¾€å¾€è¿™æ˜¯å› ä¸ºè¿ç»´å·¥ç¨‹å¸ˆå¯¹ç´¢å¼•åŸç†ä¸å¤Ÿæ¸…æ™°åšçš„è®¾è®¡ï¼‰ï¼Œè¿™æ ·å°±å¯èƒ½å‡ºç°ä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•åˆå¹¶ç®—æ³•çš„ç°è±¡ã€‚ä½†å®é™…ä¸Šï¼Œç´¢å¼•åˆå¹¶ç®—æ³•çš„æ•ˆç‡å¹¶ä¸å¥½ã€‚è€Œé€šè¿‡å°†å…¶ä¸­çš„ä¸€ä¸ªç´¢å¼•æ”¹æˆè”åˆç´¢å¼•çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åº”å¯¹æ–¹æ¡ˆã€‚</p>
</li>
</ul><p>è¿˜æœ‰å…¶ä»–å‡ ä¸ªåŒå­¦æåˆ°çš„é—®é¢˜åœºæ™¯ï¼Œä¹Ÿå¾ˆå¥½ï¼Œå¾ˆå€¼å¾—ä½ ä¸€çœ‹ã€‚</p><blockquote>
<p>@Max åŒå­¦æåˆ°ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼šå®¢æˆ·ç«¯ç¨‹åºçš„è¿æ¥å™¨ï¼Œè¿æ¥å®Œæˆåä¼šåšä¸€äº›è¯¸å¦‚show columnsçš„æ“ä½œï¼Œåœ¨çŸ­è¿æ¥æ¨¡å¼ä¸‹è¿™ä¸ªå½±å“å°±éå¸¸å¤§äº†ã€‚<br>
è¿™ä¸ªæé†’æˆ‘ä»¬ï¼Œåœ¨reviewé¡¹ç›®çš„æ—¶å€™ï¼Œä¸æ­¢è¦reviewæˆ‘ä»¬è‡ªå·±ä¸šåŠ¡çš„ä»£ç ï¼Œä¹Ÿè¦reviewè¿æ¥å™¨çš„è¡Œä¸ºã€‚ä¸€èˆ¬åšæ³•å°±æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒï¼ŒæŠŠgeneral_logæ‰“å¼€ï¼Œç”¨ä¸šåŠ¡è¡Œä¸ºè§¦å‘è¿æ¥ï¼Œç„¶åé€šè¿‡general logåˆ†æè¿æ¥å™¨çš„è¡Œä¸ºã€‚</p>
</blockquote><blockquote>
<p>@Manjusaka åŒå­¦çš„ç•™è¨€ä¸­ï¼Œç¬¬äºŒç‚¹æå¾—éå¸¸å¥½ï¼šå¦‚æœä½ çš„æ•°æ®åº“è¯·æ±‚æ¨¡å¼ç›´æ¥å¯¹åº”äºå®¢æˆ·è¯·æ±‚ï¼Œè¿™å¾€å¾€æ˜¯ä¸€ä¸ªå±é™©çš„è®¾è®¡ã€‚å› ä¸ºå®¢æˆ·è¡Œä¸ºä¸å¯æ§ï¼Œå¯èƒ½çªç„¶å› ä¸ºä½ ä»¬å…¬å¸çš„ä¸€ä¸ªè¿è¥æ¨å¹¿ï¼Œå‹åŠ›æš´å¢ï¼Œè¿™æ ·å¾ˆå®¹æ˜“æŠŠæ•°æ®åº“æ‰“æŒ‚ã€‚<br>
åœ¨è®¾è®¡æ¨¡å‹é‡Œé¢è®¾è®¡ä¸€å±‚ï¼Œä¸“é—¨è´Ÿè´£ç®¡ç†è¯·æ±‚å’Œæ•°æ®åº“æœåŠ¡èµ„æºï¼Œå¯¹äºæ¯”è¾ƒé‡è¦å’Œå¤§æµé‡çš„ä¸šåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡æ–¹å‘ã€‚</p>
</blockquote><blockquote>
<p>@Vincent åŒå­¦æäº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œç”¨æ–‡ä¸­æåˆ°çš„DDLæ–¹æ¡ˆï¼Œä¼šå¯¼è‡´binlogé‡Œé¢å°‘äº†è¿™ä¸ªDDLè¯­å¥ï¼Œåç»­å½±å“å¤‡ä»½æ¢å¤çš„åŠŸèƒ½ã€‚ç”±äºéœ€è¦å¦ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ˆä¸»å¤‡åŒæ­¥åè®®ï¼‰ï¼Œæˆ‘æ”¾åœ¨åé¢çš„æ–‡ç« ä¸­è¯´æ˜ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/30/28/6e019a7a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é”…å­</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œæœ‰ä¸€ä¸ªç–‘é—®ï¼šå½“è®¾ç½®sync_binlog=0æ—¶ï¼Œæ¯æ¬¡commitéƒ½åªæ—¶writeåˆ°page cacheï¼Œå¹¶ä¸ä¼šfsyncã€‚ä½†æ˜¯åšå®éªŒæ—¶binlogæ–‡ä»¶ä¸­è¿˜æ˜¯ä¼šæœ‰è®°å½•ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åå°çº¿ç¨‹æ¯ç§’ä¸€æ¬¡çš„è½®è¯¢ä¹Ÿä¼šå°†binlog cacheæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Ÿè¿˜æ˜¯æœ‰å…¶ä»–çš„å‚æ•°æ§åˆ¶å‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-04 11:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ çœ‹åˆ°çš„â€œbinlogçš„è®°å½•â€ï¼Œä¹Ÿæ˜¯ä»page cacheè¯»çš„å“¦ã€‚<br>Page cacheæ˜¯æ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ğŸ˜„<br><br>å¥½é—®é¢˜</p>
                                <p class="reply-time">2019-01-04 11:41</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/00/f0/08409e78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¸€å¤§åªğŸ˜´</span>
                            </div>
                            <div class="bd">ä½ æ˜¯æ€ä¹ˆéªŒè¯çš„ï¼Ÿç­‰äº0çš„æ—¶å€™è™½ç„¶æœ‰èµ°è¿™ä¸ªé€»è¾‘ï¼Œä½†æ˜¯æœ€åè°ƒç”¨fsyncä¹‹å‰åˆ¤æ–­æ˜¯0ï¼Œå°±å•¥ä¹Ÿæ²¡åšå°±èµ°äº†<br>å›å¤è€å¸ˆ:<br>       è€å¸ˆï¼Œæˆ‘è¯´çš„sync_binlog=0æˆ–=1æ•ˆæœä¸€æ ·ï¼Œå°±æ˜¯çœ‹è¯­å¥å®é™…æ‰§è¡Œçš„æ•ˆæœï¼Œå‚æ•°binlog_group_commit_sync_delayæˆ‘è®¾ç½®æˆäº†500000å¾®ç§’ï¼Œåœ¨=1æˆ–=0æ—¶ï¼Œå¯¹è¡¨è¿›è¡ŒInsertï¼Œç„¶åéƒ½ä¼šæœ‰0.5ç§’çš„ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæ—¶é—´éƒ½æ˜¯0.51 secï¼Œå…³é—­binlog_group_commit_sync_delayï¼Œinsertæ‰§è¡Œä¼šé£å¿«ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸º=1æˆ–=0éƒ½æ˜¯å—ç»„æäº¤å‚æ•°çš„å½±å“çš„ã€‚ <br></div>
                            <span class="time">2019-01-05 17:49</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿<br>éå¸¸å¥½<br><br>ç„¶åå†è¡¥ä¸Šæˆ‘å›ç­”çš„è¿™ä¸ªé€»è¾‘ï¼Œå°±å®Œå¤‡äº†<br><br></p>
                                <p class="reply-time">2019-01-05 18:35</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å€ªå¤§äºº</span>
                            </div>
                            <div class="bd">è€å¸ˆæ±‚è§£sync_binlogå’Œbinlog_group_commit_sync_no_delay_countè¿™ä¸¤ä¸ªå‚æ•°åŒºåˆ«<br><br>å¦‚æœ<br>       sync_binlog = N<br>       binlog_group_commit_sync_no_delay_count = M<br>       binlog_group_commit_sync_delay = å¾ˆå¤§å€¼<br>è¿™ç§æƒ…å†µfsyncä»€ä¹ˆæ—¶å€™å‘ç”Ÿå‘€ï¼Œmin(N,M)å—ï¼Ÿ<br>æ„Ÿè§‰sync_binlogæ­é…binlog_group_commit_sync_delayä¹Ÿå¯ä»¥å®ç°ç»„æäº¤ï¼Ÿ<br><br>å¦‚æœ<br>        sync_binlog = 0<br>         binlog_group_commit_sync_no_delay_count = 10<br>è¿™ç§æƒ…å†µä¸‹æ˜¯ç´¯è®¡10ä¸ªäº‹åŠ¡fsyncä¸€æ¬¡ï¼Ÿ <br></div>
                            <span class="time">2019-01-04 11:14</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ä¹Ÿä¸ºäº†è¿™ä¸ªé—®é¢˜å»ç¿»äº†ä»£ç ï¼Œæ˜¯è¿™æ ·çš„ï¼š<br>è¾¾åˆ°Næ¬¡ä»¥åï¼Œå¯ä»¥åˆ·ç›˜äº†ï¼Œç„¶åå†è¿›å…¥(sync_delayå’Œno_delay_count)è¿™ä¸ªé€»è¾‘ï¼›<br><br>Sync_delayå¦‚æœå¾ˆå¤§ï¼Œå°±è¾¾åˆ°no_delay_countæ‰åˆ·ï¼›<br><br>åªè¦sync_binlog=0,ä¹Ÿä¼šæœ‰å‰é¢çš„ç­‰å¾…é€»è¾‘ï¼Œä½†æ˜¯ç­‰å®Œåè¿˜æ˜¯ä¸è°ƒfsyncğŸ˜„</p>
                                <p class="reply-time">2019-01-06 16:14</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJA7cBw5Kr6VCpOGILF50XWRGjubkKzrnia34W9Dv07Ma0JfT02ZlZqzINKhMScLaP8MxwQlVRpTXA/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WilliamX</span>
                            </div>
                            <div class="bd">ä¸ºä»€ä¹ˆ binlog cache æ˜¯æ¯ä¸ªçº¿ç¨‹è‡ªå·±ç»´æŠ¤çš„ï¼Œè€Œ redo log buffer æ˜¯å…¨å±€å…±ç”¨çš„ï¼Ÿ<br>è¿™ä¸ªé—®é¢˜ï¼Œæ„Ÿè§‰è¿˜æœ‰ä¸€ç‚¹ï¼Œbinlogå­˜å‚¨æ˜¯ä»¥statementæˆ–è€…rowæ ¼å¼å­˜å‚¨çš„ï¼Œè€Œredo logæ˜¯ä»¥pageé¡µæ ¼å¼å­˜å‚¨çš„ã€‚pageæ ¼å¼ï¼Œå¤©ç”Ÿå°±æ˜¯å…±æœ‰çš„ï¼Œè€Œrowæ ¼å¼ï¼Œåªè·Ÿå½“å‰äº‹åŠ¡ç›¸å…³ <br></div>
                            <span class="time">2019-01-04 10:50</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯ï¼Œè¿™ä¸ªè§£é‡Šä¹Ÿå¾ˆå¥½ã€‚ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2019-01-04 11:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ°¸æ’è®°å¿†</span>
                            </div>
                            <div class="bd">ä¸»ä»æ¨¡å¼ä¸‹ï¼Œå†…ç½‘ä»åº“å¦‚æœè®¾ç½®åŒ1ï¼Œåˆšè¿˜åŸçš„æ•°æ®å‘ç°æ ¹æœ¬è¿½ä¸ä¸Šä¸»åº“ï¼Œæ‰€ä»¥ä»åº“è®¾ç½®äº†0ï¼Œè€å¸ˆåé¢ç« èŠ‚ä¼šè®²å…³äºmysqlåŒ…æ‹¬ä¸»ä»ç›‘æ§è¿™å—çš„å†…å®¹å—ã€‚ <br></div>
                            <span class="time">2019-01-04 09:31</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¼šè®²åˆ°</p>
                                <p class="reply-time">2019-01-04 10:26</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶</span>
                            </div>
                            <div class="bd">redolog é‡Œé¢æœ‰å·²ç»æäº¤äº‹ç‰©æ—¥å¿—ï¼Œè¿˜æœ‰æœªæäº¤äº‹ç‰©æ—¥å¿—éƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ­¤æ—¶å¼‚å¸¸é‡å¯ï¼Œbinlog é‡Œé¢ä¸æ˜¯å¤šä½™è®°å½•çš„æœªæäº¤äº‹ç‰©ï¼Œå¹²å˜›ä¸è®¾è®¡ä¸æ·»åŠ æœªæäº¤äº‹ç‰©ä¸æ›´å¥½ <br></div>
                            <span class="time">2019-01-04 09:14</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLkhgYnYZBdhdwKnXQibey04cy9N9ria3DadH7iagoKukaWK1FJwjfCoh0He4p7b2icSYVzHH71l8ZXiaQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çŒªå“¥å“¥</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½, èƒ½è¯´ä¸‹innodb_log_buffer_sizeå‚æ•°çš„ä½œç”¨å— <br></div>
                            <span class="time">2019-01-10 17:14</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/db/80/6b7629d7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">roaming</span>
                            </div>
                            <div class="bd">çœ‹äº†å‡ éï¼Œç»ˆäºçœ‹æ˜ç™½äº† <br></div>
                            <span class="time">2019-01-10 17:03</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘</p>
                                <p class="reply-time">2019-01-10 23:35</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLkhgYnYZBdhdwKnXQibey04cy9N9ria3DadH7iagoKukaWK1FJwjfCoh0He4p7b2icSYVzHH71l8ZXiaQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çŒªå“¥å“¥</span>
                            </div>
                            <div class="bd">è€å¸ˆ æˆ‘æƒ³é—®ä¸‹æ–‡ä»¶ç³»ç»Ÿçš„page cacheè¿˜æ˜¯ä¸æ˜¯å†…å­˜, æ˜¯ä¸æ˜¯æ–‡ä»¶ç³»ç»Ÿå‘å†…æ ¸ç”³è¯·çš„ä¸€å—çš„å†…å­˜? <br></div>
                            <span class="time">2019-01-10 16:20</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ ç†è§£çš„æ˜¯å¯¹çš„</p>
                                <p class="reply-time">2019-01-10 23:35</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e0/3c/ae0f6f57.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">xiaoyou</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œæ–‡ç« è¯´innodbçš„ redo log åœ¨commitçš„æ—¶å€™ä¸è¿›è¡Œfsyncï¼Œåªä¼šwrite åˆ°page cacheä¸­ã€‚å½“sync_binlog&gt;1,å¦‚æœredo log å®Œæˆäº†prepareæŒä¹…åŒ–è½ç›˜ï¼Œbinlogåªæ˜¯write page cacheï¼Œæ­¤æ—¶commitæ ‡è¯†å®Œæˆwrite ä½†æ²¡æœ‰è½ç›˜ï¼Œè€Œclientæ”¶åˆ°commitæˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™ä¸»æœºæ‰ç”µï¼Œå¯åŠ¨çš„æ—¶å€™åšå´©æºƒæ¢å¤ï¼Œæ²¡æœ‰commitæ ‡è¯†å’Œbinglogï¼Œäº‹åŠ¡ä¼šå›æ»šã€‚æˆ‘çœ‹æ–‡ç« è¯´sync_binlogè®¾ç½®ä¸ºå¤§äº1çš„å€¼ï¼Œä¼šä¸¢binlogæ—¥å¿—,æ­¤æ—¶æ•°æ®ä¹Ÿä¼šä¸¢å¤±å§ï¼Ÿ <br></div>
                            <span class="time">2019-01-09 17:40</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ è¯´çš„å¯¹ï¼Œåˆ†æå¾—å¾ˆå¥½</p>
                                <p class="reply-time">2019-01-09 22:19</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/16/77/73bd9d18.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åŒ¿åçš„æœ‹å‹</span>
                            </div>
                            <div class="bd">ä¸å¥‡è€å¸ˆä½ å¥½ï¼Œå¯¹äºundoå’Œredoæ—¥å¿—ï¼Œæœ‰ä¸ªç–‘é—®ï¼ŒmysqlæœåŠ¡å±‚è°ƒç”¨å¼•æ“å±‚å»è·å–æ•°æ®ï¼Œæ¯”æ–¹è¯´æ˜¯innodbå¼•æ“ï¼Œinnodbå¼•æ“æ˜¯ä¸æ˜¯å¯ä»¥è·å–åˆ°è¿™ä¸ªå®ä¾‹é‡Œè¾¹æ‰€æœ‰ä»¥innodbä½œä¸ºå¼•æ“çš„è¡¨ï¼Œ<br>  è¿˜æœ‰å°±æ˜¯äº‹åŠ¡å¤„ç†æ—¶ä¼šæ¶‰åŠåˆ°undoå’Œredoæ—¥å¿—æ–‡ä»¶ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰ä»¥innodbä¸ºå¼•æ“çš„æ•°æ®è¡¨å…±ç”¨undoå’Œredoæ—¥å¿—æ–‡ä»¶å‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-09 12:59</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. ä¸ç”¨å»æ‰¾â€œæ‰€æœ‰innodbè¡¨â€ï¼Œç”¨åˆ°å†æ‰“å¼€<br><br>2. å¤§å®¶å…±ç”¨çš„<br></p>
                                <p class="reply-time">2019-01-09 14:48</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/bd/be/53350286.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Geek_527020</span>
                            </div>
                            <div class="bd">äº‹åŠ¡è¿˜æœªç»“æŸï¼Œbinlogå’Œredo logå°±å†™åˆ°ç£ç›˜ä¸­äº†ï¼Œå¦‚æœå‡ºç°äº†äº‹åŠ¡å›æ»šï¼Œå†™åˆ°ç£ç›˜çš„æ•°æ®è¦åˆ é™¤å—ï¼Œå¦‚æœä¸åˆ é™¤ï¼ŒMYSQLå¥”æºƒé‡å¯ï¼Œå²‚ä¸æ˜¯å¤šäº†æ“ä½œï¼Œè¯·è€å¸ˆè§£ç­”ä¸‹ç–‘æƒ‘ <br></div>
                            <span class="time">2019-01-08 17:21</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ²¡äº‹ï¼Œè¿™äº›æ“ä½œæ²¡æäº¤ï¼Œå´©æºƒæ¢å¤çš„æ—¶å€™å°±å›æ»šäº†</p>
                                <p class="reply-time">2019-01-08 20:22</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼š<br>è¿™ä¸€èŠ‚çš„ç–‘æƒ‘æ¯”è¾ƒå¤šï¼Œå˜»å˜»<br>è¿˜æƒ³åœ¨ç¡®è®¤ä¸€ä¸ªé—®é¢˜ï¼š<br>æˆ‘è®¤ä¸ºredologçš„ç»„æäº¤ æ˜¯ä»writeå¼€å§‹çš„ç»„æäº¤ã€‚ä¸ªäººè®¤ä¸ºwriteåˆ°pagecacheçš„æ—¶å€™æ˜¯ä¸éœ€è¦åŠ é”çš„ã€‚<br>è€Œbinlogçš„ç»„æäº¤ï¼Œåœ¨writeé˜¶æ®µï¼Œéƒ½æ˜¯å•çº¿ç¨‹å¯¹è‡ªå·±çš„binlog cache writeåˆ°pagecacheã€‚è¿™ä¸ªæ—¶å€™å¿…é¡»åŠ é”ã€‚è™½ç„¶syncé˜¶æ®µï¼Œä¸¤è€…éƒ½æ˜¯æ‰¹é‡è¿›è¡Œçš„ã€‚ä½†æ˜¯ä»writeé˜¶æ®µæ¥çœ‹ï¼Œbinlogå¹¶æ²¡æœ‰å®ç°çœŸæ­£æ„ä¹‰ä¸Šå®ç°ç»„æäº¤ï¼Œæ²¡æ³•è§£å†³ä¸Šé”é—®é¢˜ã€‚ï¼ˆåœ¨ç½‘ä¸Šçœ‹åˆ°ï¼ŒbinlogçœŸæ­£çš„ç»„æäº¤ï¼Œåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ç§å®ç°å¥½åƒæ˜¯æ¯”è¾ƒæ–°çš„mysqlç‰ˆæœ¬æ‰ä½¿ç”¨çš„ï¼‰<br><br>æˆ‘è¿™ä¹ˆç†è§£å¯¹å—ï¼Ÿ <br></div>
                            <span class="time">2019-01-08 12:16</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å†™binlogå¯ä»¥å¹¶å‘å†™çš„ï¼Œå¤§å®¶çº¦å¥½ç£ç›˜è‡ªå·±å†™è‡ªå·±çš„å°±è¡Œ^_^</p>
                                <p class="reply-time">2019-01-10 19:12</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œçœ‹äº†@å€ªå¤§äººçš„é—®é¢˜ï¼Œä¸ªäººè®¤ä¸ºï¼š<br>sync_binlogå’Œbinlog_group_commit_sync_no_delay_countçš„æœ€å¤§åŒºåˆ«ä¸»è¦åœ¨äºï¼Œæ•°æ®çš„ä¸¢å¤±ä¸å¦å§ï¼Ÿ<br><br>sync_binlog = Nï¼šæ¯ä¸ªäº‹åŠ¡writeåå°±å“åº”å®¢æˆ·ç«¯äº†ã€‚åˆ·ç›˜æ˜¯Næ¬¡äº‹åŠ¡ååˆ·ç›˜ã€‚Næ¬¡äº‹åŠ¡ä¹‹é—´å®•æœºï¼Œæ•°æ®ä¸¢å¤±ã€‚<br><br>binlog_group_commit_sync_no_delay_count=Nï¼š å¿…é¡»ç­‰åˆ°Nä¸ªåæ‰èƒ½æäº¤ã€‚æ¢è¨€ä¹‹ï¼Œä¼šå¢åŠ å“åº”å®¢æˆ·ç«¯çš„æ—¶é—´ã€‚ä½†æ˜¯ä¸€æ—¦å“åº”äº†ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸€å®šæŒä¹…åŒ–äº†ã€‚å®•æœºçš„è¯ï¼Œæ•°æ®æ˜¯ä¸ä¼šä¸¢å¤±çš„ã€‚<br><br>ä¸çŸ¥é“æˆ‘è¿™ä¹ˆç†è§£å¯¹ä¸å¯¹ï¼Ÿ<br> <br></div>
                            <span class="time">2019-01-08 12:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ çš„ç†è§£å¾ˆåˆ°ä½</p>
                                <p class="reply-time">2019-01-10 19:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œå…³äºç»„æäº¤è¿˜æ˜¯æœ‰å‡ ä¸ªç–‘æƒ‘ï¼š<br>æˆ‘ç†è§£çš„ï¼Œç»„æäº¤åˆ†ä¸ºbinlogå’Œredologã€‚<br>binlogå¦‚æœæ²¡æœ‰ç»„æäº¤çš„è¯ï¼Œæ˜¯ä¸æ˜¯æ¶‰åŠåˆ° å†™binlogçš„é¡ºåºä¸å†™redologçš„é¡ºåºä¸ä¸€è‡´çš„é—®é¢˜ï¼Ÿè¿™ä¸ªé¡ºåºé—®é¢˜éœ€è¦åŠ é”æ¥è§£å†³ï¼Œäº‹åŠ¡ä¹‹é—´ä¸²è¡Œæ‰§è¡Œprepareåˆ°commitçš„è¿‡ç¨‹ã€‚<br>è€Œbinlogæœ‰äº†ç»„æäº¤ï¼Œå†…éƒ¨å®é™…ä¸Šé€šè¿‡é˜Ÿåˆ—çš„æœºåˆ¶ï¼Œæ—¢ä¿è¯äº†ç»„æäº¤å‡å°‘IOPSæ¶ˆè€—ï¼ŒåŒæ—¶é˜Ÿåˆ—çš„æœºåˆ¶ä¿è¯äº†binlogå’Œredologå†™å…¥çš„é¡ºåºæ€§ã€‚<br><br>ä¸Šè¿°è¿™ä¹ˆç†è§£æ­£ç¡®å—ï¼Ÿ<br><br>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å›¾5ä¸¤é˜¶æ®µæäº¤ç»†åŒ–çš„è¿‡ç¨‹ï¼š<br>binlogçš„write åˆ° syncä¹‹é—´æ’å…¥äº† redologçš„ syncã€‚å›¾ä¸Šçš„é¡ºåºè¡¨ç¤ºbinlogçš„syncå¿…é¡»ç­‰åˆ°redologçš„syncæ‰§è¡Œåæ‰èƒ½æ‰§è¡Œï¼Ÿ redologåœ¨å¼•æ“å†…éƒ¨ï¼Œbinlogåœ¨serverç«¯ï¼Œè¿™ä¸ªä¸²è¡Œæ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿï¼Ÿï¼ˆå› ä¸ºæˆ‘è®¤ä¸ºserverä¸innodbåªä¼šäº¤äº’ä¸¤æ¬¡å‘€ï¼Œç¬¬ä¸€æ¬¡æ˜¯prepareè¯·æ±‚ï¼Œç¬¬äºŒæ¬¡æ˜¯æœ€åçš„commitè¯·æ±‚ï¼Œbinlogæ€ä¹ˆåšåˆ°ç­‰å¾…redolog syncå®Œåå†syncï¼Ÿï¼‰ <br></div>
                            <span class="time">2019-01-08 10:25</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. é»˜è®¤è¡Œä¸ºæ˜¯opt_binlog_order_commits=ONï¼Œæ˜¯ä¿è¯é¡ºåºçš„ï¼›<br><br>2. å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æŒ‰é¡ºåºä¸€ä¸ªé˜¶æ®µä¸€ä¸ªé˜¶æ®µåœ°è°ƒç”¨ä¸‹æ¥ï¼Œè¿™ä¹ˆä¿è¯é¡ºåºçš„</p>
                                <p class="reply-time">2019-01-10 19:03</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0bvalmQic0PAVeoA8GEfoefV4xfmWY4UErdhxxxxNicibOK12icb7iaS07J3WoJGY1oMAKKDvT4w31nQ7buLdeoP8w/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æœˆç¼º</span>
                            </div>
                            <div class="bd">äº‹åŠ¡è¿˜æ²¡æäº¤çš„æ—¶å€™ï¼Œredo log buffer ä¸­çš„éƒ¨åˆ†æ—¥å¿—æœ‰å¯èƒ½è¢«æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œè¿™å—æ˜¯8.0é‡æ„redologåçš„æ— é”åŒ–æ‰æœ‰çš„æ–°ç‰¹æ€§å˜›ï¼Œçœ‹æºç ä¹‹å‰æ˜¯æœ‰ä¸ªprepare commit mutexé”çš„ <br></div>
                            <span class="time">2019-01-08 09:17</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸æ˜¯ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯æœ€æ—©çš„ç­–ç•¥ä¹‹ä¸€äº†</p>
                                <p class="reply-time">2019-01-08 11:16</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLE4LYb3jrH63ZV98Zpc8DompwDgb1O3nffMoZCmiaibauRyEFv6NDNsST9RWxZExvMLMWb50zaanoQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ…§é‘«coming</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œè¯·é—®binlog_group_commit_sync_no_delay_countå’Œsync_binlogå‚æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå‰è€…è®¾ç½®ä¸º10åè€…è®¾ç½®ä¸º5ï¼Œé‚£æ˜¯å‡ æ¬¡write page_cacheæ‰å†™ç›˜ä¸€æ¬¡ï¼Ÿ <br></div>
                            <span class="time">2019-01-07 09:26</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™æ ·å°±æ˜¯æ¯10æ¬¡fsyncä¸€ä¸‹(sync_no_delay_count &gt;sync_binlog)</p>
                                <p class="reply-time">2019-01-07 10:21</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/a6/60/ebda8d95.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">52rock</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œwindowsç³»ç»Ÿä¸‹MySQLå¶å°”æœ‰ååº“çš„æƒ…å†µï¼Œæ¢å¤æ•°æ®æ¯”è¾ƒéº»çƒ¦ï¼Œæœ‰ä»€ä¹ˆé…ç½®å¯ä»¥ä¼˜åŒ–<br>1.æŸä¸ªè¡¨æç¤ºæ‰“ä¸å¼€ï¼Œä¹Ÿæ— æ³•é‡å»ºè¡¨<br>2.mysqlæ— æ³•å¯åŠ¨ 1067<br>3.binlogæ—¥å¿—æ–‡ä»¶æ— æ³•å†™å…¥ï¼Œåˆ äº†logæ–‡ä»¶åæ­£å¸¸ã€‚<br><br>my.inié…ç½®å¦‚ä¸‹<br>[mysqld]<br># use 5.6.20<br>[mysqld]<br>bind-address = 0.0.0.0<br>character-set-server=utf8<br>log-bin=my.bin<br>binlog_format=statement<br>server-id=1<br><br>#ä¸éœ€è¦åŒæ­¥çš„åº“<br>binlog-ignore-db=information_schema<br>binlog-ignore-db=performance_schema<br>binlog-ignore-db=mysql<br><br>max_connect_errors = 3000<br>wait_timeout=2880000<br>interactive_timeout=2880000<br><br>query_cache_size = 0<br>query_cache_type = 0<br><br>sql-mode=NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION<br><br>max_allowed_packet =256MB<br>read_buffer_size = 8M<br>read_rnd_buffer_size = 16M<br>lower_case_table_names = 1<br>key_buffer_size = 15M<br><br>table_open_cache = 400<br>table_definition_cache = 400<br>table_open_cache_instances = 64<br>metadata_locks_hash_instances=64<br><br>sort_buffer_size = 16M<br>join_buffer_size = 16M<br>thread_cache_size = 768<br>query_cache_size = 0<br>query_cache_type = 0<br>tmp_table_size = 96M<br>performance_schema=OFF<br>open_files_limit = 65535<br>back_log = 1024<br><br>innodb_buffer_pool_size=800MB<br># 4MB-8MB ok<br>innodb_file_per_table = 1                                               <br>external-locking = FALSE<br>#skip-external-locking<br>expire_logs_days=45<br>max_binlog_size=200M<br>skip-name-resolve=OFF<br>transaction-isolation=repeatable-read<br>log_warnings=0 <br></div>
                            <span class="time">2019-01-06 21:54</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åˆ é™¤äº†ä»€ä¹ˆlogåæ­£å¸¸çš„ï¼Ÿ<br></p>
                                <p class="reply-time">2019-01-07 02:07</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ»”æ»”</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œæƒ³ä»ä¸€ä¸ªæœ‰è‡ªå¢ä¸»é”®(id)çš„è¡¨ä¸­å–å‡ºä¸»é”®å€¼æœ€å¤§çš„næ¡è®°å½•ï¼Œæ€æ ·æ“ä½œæ•ˆç‡æœ€é«˜å‘¢ï¼Ÿä½¿ç”¨order by id limit næ˜¯æœ€å¿«çš„æ–¹å¼å—ï¼ŸğŸ¤” <br></div>
                            <span class="time">2019-01-06 21:39</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯ï¼Œè¿™æ ·å¾ˆå¿«çš„</p>
                                <p class="reply-time">2019-01-07 02:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">æœ‰è°ƒåˆ°éåŒ1çš„æ—¶å€™,åœ¨å¤§ä¿ƒæ—¶éæ ¸å¿ƒåº“å’Œä»åº“å»¶è¿Ÿè¾ƒå¤šçš„æƒ…å†µã€‚<br>è®¾ç½®çš„æ˜¯sync_binlog=0å’Œinnodb_flush_log_at_trx_commit=2<br>é’ˆå¯¹0å’Œ2,åœ¨mysql crashæ—¶ä¸ä¼šå‡ºç°å¼‚å¸¸,åœ¨ä¸»æœºæŒ‚äº†æ—¶ï¼Œä¼šæœ‰å‡ ç§é£é™©:<br>1.å¦‚æœäº‹åŠ¡çš„binlogå’Œredo logéƒ½è¿˜æœªfsync,åˆ™è¯¥äº‹åŠ¡æ•°æ®ä¸¢å¤±<br>2.å¦‚æœäº‹åŠ¡binlog fsyncæˆåŠŸ,redo logæœªfsync,åˆ™è¯¥äº‹åŠ¡æ•°æ®ä¸¢å¤±ã€‚<br>è™½ç„¶binlogè½ç›˜æˆåŠŸ,ä½†æ˜¯binlogæ²¡æœ‰æ¢å¤redo logçš„èƒ½åŠ›,æ‰€ä»¥redo logä¸èƒ½æ¢å¤.<br>ä¸è¿‡åç»­å¯ä»¥è§£æbinlogæ¥æ¢å¤è¿™éƒ¨åˆ†æ•°æ®<br>3.å¦‚æœäº‹åŠ¡binlog fsyncæœªæˆåŠŸ,redo logæˆåŠŸã€‚<br>ç”±äºredo logæ¢å¤æ•°æ®æ˜¯åœ¨å¼•æ“å±‚,æ‰€ä»¥é‡æ–°å¯åŠ¨æ•°æ®åº“,redo logèƒ½æ¢å¤æ•°æ®,ä½†æ˜¯ä¸èƒ½æ¢å¤serverå±‚çš„binlog,åˆ™binlogä¸¢å¤±ã€‚<br>å¦‚æœè¯¥äº‹åŠ¡è¿˜æœªä»FS page cacheé‡Œå‘é€ç»™ä»åº“,é‚£ä¹ˆä¸»ä»å°±ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µ<br>4.å¦‚æœbinlogå’Œredo logéƒ½æˆåŠŸfsync,é‚£ä¹ˆçš†å¤§æ¬¢å–œã€‚<br><br>è€å¸ˆæˆ‘æœ‰å‡ ä¸ªé—®é¢˜:<br>1.å› ä¸ºbinlogä¸èƒ½è¢«æ‰“æ–­,é‚£ä¹ˆbinlogåšfsyncæ˜¯å•çº¿ç¨‹å§?<br>å¦‚æœæ˜¯çš„è¯,é‚£ä¹ˆbinlogçš„writeåˆ°fsyncçš„æ—¶é—´,å°±åº”è¯¥æ˜¯redo log fsync+ä¸Šä¸€ä¸ªäº‹åŠ¡çš„binlog fsyncæ—¶é—´ã€‚<br>ä½†æ˜¯æµ‹è¯•åˆ°çš„ç°è±¡,ä¸€ä¸ªè¶…å¤§äº‹åŠ¡åšfsyncæ—¶,å¯¹å…¶å®ƒäº‹åŠ¡çš„æäº¤å½±å“ä¹Ÿä¸å¤§ã€‚<br>å¦‚æœæ˜¯å¤šçº¿ç¨‹åšfsync,æ€ä¹ˆä¿è¯çš„ä¸€ä¸ªäº‹åŠ¡binlogåœ¨ç£ç›˜ä¸Šçš„è¿ç»­æ€§ï¼Ÿ<br>2.  5.7çš„å¹¶è¡Œå¤åˆ¶æ˜¯åŸºäºbinlogç»„æˆå‘˜å¹¶è¡Œçš„,ä¸ºä»€ä¹ˆå¾ˆå¤šæ–‡ç« è¯´æ˜¯è¡¨çº§åˆ«çš„å¹¶è¡Œå¤åˆ¶ï¼Ÿ <br></div>
                            <span class="time">2019-01-06 20:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. Writeçš„æ—¶å€™åªè¦å†™è¿›å»äº†ï¼Œfsyncå…¶å®å¾ˆå¿«çš„ã€‚è¿ç»­æ€§æ˜¯writeçš„æ—¶å€™åšçš„ï¼ˆå†™çš„æ—¶å€™ä¿è¯äº†è¿ç»­ï¼‰<br><br>2. ä½ çš„ç†è§£åº”è¯¥æ˜¯å¯¹çš„ã€‚ä¸æ˜¯è¡¨çº§</p>
                                <p class="reply-time">2019-01-06 21:27</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>