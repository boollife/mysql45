<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                08è®²äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/89/69/89a920f1feb00925fb5a94610af89569.jpg">

                <div>
                  <audio controls="controls" height="100" width="100">
                    <source src="08è®²äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„.mp3" type="audio/mp3" />
                    <embed height="100" width="100" src="08è®²äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„.mp3" />
                  </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>æˆ‘åœ¨ç¬¬3ç¯‡æ–‡ç« å’Œä½ è®²äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ—¶å€™æåˆ°è¿‡ï¼Œå¦‚æœæ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡Tå¯åŠ¨çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾read-viewï¼Œä¹‹åäº‹åŠ¡Tæ‰§è¡ŒæœŸé—´ï¼Œå³ä½¿æœ‰å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œäº‹åŠ¡Tçœ‹åˆ°çš„ä»ç„¶è·Ÿåœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„ä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡Œçš„äº‹åŠ¡ï¼Œå¥½åƒä¸ä¸–æ— äº‰ï¼Œä¸å—å¤–ç•Œå½±å“ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå’Œä½ åˆ†äº«è¡Œé”çš„æ—¶å€™åˆæåˆ°ï¼Œä¸€ä¸ªäº‹åŠ¡è¦æ›´æ–°ä¸€è¡Œï¼Œå¦‚æœåˆšå¥½æœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ‹¥æœ‰è¿™ä¸€è¡Œçš„è¡Œé”ï¼Œå®ƒåˆä¸èƒ½è¿™ä¹ˆè¶…ç„¶äº†ï¼Œä¼šè¢«é”ä½ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚é—®é¢˜æ˜¯ï¼Œæ—¢ç„¶è¿›å…¥äº†ç­‰å¾…çŠ¶æ€ï¼Œé‚£ä¹ˆç­‰åˆ°è¿™ä¸ªäº‹åŠ¡è‡ªå·±è·å–åˆ°è¡Œé”è¦æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒè¯»åˆ°çš„å€¼åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ç»™ä½ ä¸¾ä¸€ä¸ªä¾‹å­å§ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåªæœ‰ä¸¤è¡Œçš„è¡¨çš„åˆå§‹åŒ–è¯­å¥ã€‚</p><pre><code>mysql&gt; CREATE TABLE `t` (
  `id` int(11) NOT NULL,
  `k` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;
insert into t(id, k) values(1,1),(2,2);
</code></pre><p><img src="https://static001.geekbang.org/resource/image/82/d6/823acf76e53c0bdba7beab45e72e90d6.png" alt=""></p><center>å›¾1 äº‹åŠ¡Aã€Bã€Cçš„æ‰§è¡Œæµç¨‹</center><p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯äº‹åŠ¡çš„å¯åŠ¨æ—¶æœºã€‚</p><p>begin/start transaction å‘½ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡çš„èµ·ç‚¹ï¼Œåœ¨æ‰§è¡Œåˆ°å®ƒä»¬ä¹‹åçš„ç¬¬ä¸€ä¸ªæ“ä½œInnoDBè¡¨çš„è¯­å¥ï¼ˆç¬¬ä¸€ä¸ªå¿«ç…§è¯»è¯­å¥ï¼‰ï¼Œäº‹åŠ¡æ‰çœŸæ­£å¯åŠ¨ã€‚å¦‚æœä½ æƒ³è¦é©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨start transaction with consistent snapshot è¿™ä¸ªå‘½ä»¤ã€‚</p><p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ•´ä¸ªä¸“æ é‡Œé¢ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œéƒ½æ˜¯é»˜è®¤autocommit=1ã€‚</p><!-- [[[read_end]]] --><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œäº‹åŠ¡Cæ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨begin/commitï¼Œè¡¨ç¤ºè¿™ä¸ªupdateè¯­å¥æœ¬èº«å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯­å¥å®Œæˆçš„æ—¶å€™ä¼šè‡ªåŠ¨æäº¤ã€‚äº‹åŠ¡Båœ¨æ›´æ–°äº†è¡Œä¹‹åæŸ¥è¯¢; äº‹åŠ¡Aåœ¨ä¸€ä¸ªåªè¯»äº‹åŠ¡ä¸­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ—¶é—´é¡ºåºä¸Šæ˜¯åœ¨äº‹åŠ¡Bçš„æŸ¥è¯¢ä¹‹åã€‚</p><p>è¿™æ—¶ï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½ äº‹åŠ¡BæŸ¥åˆ°çš„kçš„å€¼æ˜¯3ï¼Œè€Œäº‹åŠ¡AæŸ¥åˆ°çš„kçš„å€¼æ˜¯1ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹æ™•å‘¢ï¼Ÿ</p><p>æ‰€ä»¥ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å…¶å®å°±æ˜¯æƒ³å’Œä½ è¯´æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›å€Ÿç”±æŠŠè¿™ä¸ªç–‘æƒ‘è§£å¼€çš„è¿‡ç¨‹ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ å¯¹InnoDBçš„äº‹åŠ¡å’Œé”æœ‰æ›´è¿›ä¸€æ­¥çš„ç†è§£ã€‚</p><p>åœ¨MySQLé‡Œï¼Œæœ‰ä¸¤ä¸ªâ€œè§†å›¾â€çš„æ¦‚å¿µï¼š</p><ul>
<li>ä¸€ä¸ªæ˜¯viewã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™æ‰§è¡ŒæŸ¥è¯¢è¯­å¥å¹¶ç”Ÿæˆç»“æœã€‚åˆ›å»ºè§†å›¾çš„è¯­æ³•æ˜¯create view ... ï¼Œè€Œå®ƒçš„æŸ¥è¯¢æ–¹æ³•ä¸è¡¨ä¸€æ ·ã€‚</li>
<li>å¦ä¸€ä¸ªæ˜¯InnoDBåœ¨å®ç°MVCCæ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œå³consistent read viewï¼Œç”¨äºæ”¯æŒRCï¼ˆRead Committedï¼Œè¯»æäº¤ï¼‰å’ŒRRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ã€‚</li>
</ul><p>å®ƒæ²¡æœ‰ç‰©ç†ç»“æ„ï¼Œä½œç”¨æ˜¯äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”¨æ¥å®šä¹‰â€œæˆ‘èƒ½çœ‹åˆ°ä»€ä¹ˆæ•°æ®â€ã€‚</p><p>åœ¨ç¬¬3ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/68963">ã€Šäº‹åŠ¡éš”ç¦»ï¼šä¸ºä»€ä¹ˆä½ æ”¹äº†æˆ‘è¿˜çœ‹ä¸è§ï¼Ÿã€‹</a>ä¸­ï¼Œæˆ‘è·Ÿä½ è§£é‡Šè¿‡ä¸€éMVCCçš„å®ç°é€»è¾‘ã€‚ä»Šå¤©ä¸ºäº†è¯´æ˜æŸ¥è¯¢å’Œæ›´æ–°çš„åŒºåˆ«ï¼Œæˆ‘æ¢ä¸€ä¸ªæ–¹å¼æ¥è¯´æ˜ï¼ŒæŠŠread viewæ‹†å¼€ã€‚ä½ å¯ä»¥ç»“åˆè¿™ä¸¤ç¯‡æ–‡ç« çš„è¯´æ˜æ¥æ›´æ·±ä¸€æ­¥åœ°ç†è§£MVCCã€‚</p><h1>â€œå¿«ç…§â€åœ¨MVCCé‡Œæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h1><p>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™å°±â€œæ‹äº†ä¸ªå¿«ç…§â€ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå¿«ç…§æ˜¯åŸºäºæ•´åº“çš„ã€‚</p><p>è¿™æ—¶ï¼Œä½ ä¼šè¯´è¿™çœ‹ä¸Šå»ä¸å¤ªç°å®å•Šã€‚å¦‚æœä¸€ä¸ªåº“æœ‰100Gï¼Œé‚£ä¹ˆæˆ‘å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼ŒMySQLå°±è¦æ‹·è´100Gçš„æ•°æ®å‡ºæ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾—å¤šæ…¢å•Šã€‚å¯æ˜¯ï¼Œæˆ‘å¹³æ—¶çš„äº‹åŠ¡æ‰§è¡Œèµ·æ¥å¾ˆå¿«å•Šã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ‹·è´å‡ºè¿™100Gçš„æ•°æ®ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªå¿«ç…§æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><p>InnoDBé‡Œé¢æ¯ä¸ªäº‹åŠ¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡IDï¼Œå«ä½œtransaction idã€‚å®ƒæ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘InnoDBçš„äº‹åŠ¡ç³»ç»Ÿç”³è¯·çš„ï¼Œæ˜¯æŒ‰ç”³è¯·é¡ºåºä¸¥æ ¼é€’å¢çš„ã€‚</p><p>è€Œæ¯è¡Œæ•°æ®ä¹Ÿéƒ½æ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„ã€‚æ¯æ¬¡äº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶ä¸”æŠŠtransaction idèµ‹å€¼ç»™è¿™ä¸ªæ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡IDï¼Œè®°ä¸ºrow trx_idã€‚åŒæ—¶ï¼Œæ—§çš„æ•°æ®ç‰ˆæœ¬è¦ä¿ç•™ï¼Œå¹¶ä¸”åœ¨æ–°çš„æ•°æ®ç‰ˆæœ¬ä¸­ï¼Œèƒ½å¤Ÿæœ‰ä¿¡æ¯å¯ä»¥ç›´æ¥æ‹¿åˆ°å®ƒã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®è¡¨ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œå…¶å®å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬(row)ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„row trx_idã€‚</p><p>å¦‚å›¾2æ‰€ç¤ºï¼Œå°±æ˜¯ä¸€ä¸ªè®°å½•è¢«å¤šä¸ªäº‹åŠ¡è¿ç»­æ›´æ–°åçš„çŠ¶æ€ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/68/ed/68d08d277a6f7926a41cc5541d3dfced.png" alt=""></p><center>å›¾2 è¡ŒçŠ¶æ€å˜æ›´å›¾</center><p>å›¾ä¸­è™šçº¿æ¡†é‡Œæ˜¯åŒä¸€è¡Œæ•°æ®çš„4ä¸ªç‰ˆæœ¬ï¼Œå½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯V4ï¼Œkçš„å€¼æ˜¯22ï¼Œå®ƒæ˜¯è¢«transaction id ä¸º25çš„äº‹åŠ¡æ›´æ–°çš„ï¼Œå› æ­¤å®ƒçš„row trx_idä¹Ÿæ˜¯25ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå‰é¢çš„æ–‡ç« ä¸æ˜¯è¯´ï¼Œè¯­å¥æ›´æ–°ä¼šç”Ÿæˆundo logï¼ˆå›æ»šæ—¥å¿—ï¼‰å—ï¼Ÿé‚£ä¹ˆï¼Œ<strong>undo logåœ¨å“ªå‘¢ï¼Ÿ</strong></p><p>å®é™…ä¸Šï¼Œå›¾2ä¸­çš„ä¸‰ä¸ªè™šçº¿ç®­å¤´ï¼Œå°±æ˜¯undo logï¼›è€ŒV1ã€V2ã€V3å¹¶ä¸æ˜¯ç‰©ç†ä¸ŠçœŸå®å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ¯æ¬¡éœ€è¦çš„æ—¶å€™æ ¹æ®å½“å‰ç‰ˆæœ¬å’Œundo logè®¡ç®—å‡ºæ¥çš„ã€‚æ¯”å¦‚ï¼Œéœ€è¦V2çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡V4ä¾æ¬¡æ‰§è¡ŒU3ã€U2ç®—å‡ºæ¥ã€‚</p><p>æ˜ç™½äº†å¤šç‰ˆæœ¬å’Œrow trx_idçš„æ¦‚å¿µåï¼Œæˆ‘ä»¬å†æ¥æƒ³ä¸€ä¸‹ï¼ŒInnoDBæ˜¯æ€ä¹ˆå®šä¹‰é‚£ä¸ªâ€œ100Gâ€çš„å¿«ç…§çš„ã€‚</p><p>æŒ‰ç…§å¯é‡å¤è¯»çš„å®šä¹‰ï¼Œä¸€ä¸ªäº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œèƒ½å¤Ÿçœ‹åˆ°æ‰€æœ‰å·²ç»æäº¤çš„äº‹åŠ¡ç»“æœã€‚ä½†æ˜¯ä¹‹åï¼Œè¿™ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡çš„æ›´æ–°å¯¹å®ƒä¸å¯è§ã€‚</p><p>å› æ­¤ï¼Œä¸€ä¸ªäº‹åŠ¡åªéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å£°æ˜è¯´ï¼Œâ€œä»¥æˆ‘å¯åŠ¨çš„æ—¶åˆ»ä¸ºå‡†ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ç‰ˆæœ¬æ˜¯åœ¨æˆ‘å¯åŠ¨ä¹‹å‰ç”Ÿæˆçš„ï¼Œå°±è®¤ï¼›å¦‚æœæ˜¯æˆ‘å¯åŠ¨ä»¥åæ‰ç”Ÿæˆçš„ï¼Œæˆ‘å°±ä¸è®¤ï¼Œæˆ‘å¿…é¡»è¦æ‰¾åˆ°å®ƒçš„ä¸Šä¸€ä¸ªç‰ˆæœ¬â€ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœâ€œä¸Šä¸€ä¸ªç‰ˆæœ¬â€ä¹Ÿä¸å¯è§ï¼Œé‚£å°±å¾—ç»§ç»­å¾€å‰æ‰¾ã€‚è¿˜æœ‰ï¼Œå¦‚æœæ˜¯è¿™ä¸ªäº‹åŠ¡è‡ªå·±æ›´æ–°çš„æ•°æ®ï¼Œå®ƒè‡ªå·±è¿˜æ˜¯è¦è®¤çš„ã€‚</p><p>åœ¨å®ç°ä¸Šï¼Œ InnoDBä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡IDã€‚â€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚</p><p>æ•°ç»„é‡Œé¢äº‹åŠ¡IDçš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡IDçš„æœ€å¤§å€¼åŠ 1è®°ä¸ºé«˜æ°´ä½ã€‚</p><p>è¿™ä¸ªè§†å›¾æ•°ç»„å’Œé«˜æ°´ä½ï¼Œå°±ç»„æˆäº†å½“å‰äº‹åŠ¡çš„ä¸€è‡´æ€§è§†å›¾ï¼ˆread-viewï¼‰ã€‚</p><p>è€Œæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™ï¼Œå°±æ˜¯åŸºäºæ•°æ®çš„row trx_idå’Œè¿™ä¸ªä¸€è‡´æ€§è§†å›¾çš„å¯¹æ¯”ç»“æœå¾—åˆ°çš„ã€‚</p><p>è¿™ä¸ªè§†å›¾æ•°ç»„æŠŠæ‰€æœ‰çš„row trx_id åˆ†æˆäº†å‡ ç§ä¸åŒçš„æƒ…å†µã€‚</p><p><img src="https://static001.geekbang.org/resource/image/88/5e/882114aaf55861832b4270d44507695e.png" alt=""></p><center>å›¾3 æ•°æ®ç‰ˆæœ¬å¯è§æ€§è§„åˆ™</center><p>è¿™æ ·ï¼Œå¯¹äºå½“å‰äº‹åŠ¡çš„å¯åŠ¨ç¬é—´æ¥è¯´ï¼Œä¸€ä¸ªæ•°æ®ç‰ˆæœ¬çš„row trx_idï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š</p><ol>
<li>
<p>å¦‚æœè½åœ¨ç»¿è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²æäº¤çš„äº‹åŠ¡æˆ–è€…æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¯è§çš„ï¼›</p>
</li>
<li>
<p>å¦‚æœè½åœ¨çº¢è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ˜¯è‚¯å®šä¸å¯è§çš„ï¼›</p>
</li>
<li>
<p>å¦‚æœè½åœ¨é»„è‰²éƒ¨åˆ†ï¼Œé‚£å°±åŒ…æ‹¬ä¸¤ç§æƒ…å†µ<br>
a.  è‹¥ row trx_idåœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±è¿˜æ²¡æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œä¸å¯è§ï¼›<br>
b.  è‹¥ row trx_idä¸åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¯è§ã€‚</p>
</li>
</ol><p>æ¯”å¦‚ï¼Œå¯¹äºå›¾2ä¸­çš„æ•°æ®æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒçš„ä½æ°´ä½æ˜¯18ï¼Œé‚£ä¹ˆå½“å®ƒè®¿é—®è¿™ä¸€è¡Œæ•°æ®æ—¶ï¼Œå°±ä¼šä»V4é€šè¿‡U3è®¡ç®—å‡ºV3ï¼Œæ‰€ä»¥åœ¨å®ƒçœ‹æ¥ï¼Œè¿™ä¸€è¡Œçš„å€¼æ˜¯11ã€‚</p><p>ä½ çœ‹ï¼Œæœ‰äº†è¿™ä¸ªå£°æ˜åï¼Œç³»ç»Ÿé‡Œé¢éšåå‘ç”Ÿçš„æ›´æ–°ï¼Œæ˜¯ä¸æ˜¯å°±è·Ÿè¿™ä¸ªäº‹åŠ¡çœ‹åˆ°çš„å†…å®¹æ— å…³äº†å‘¢ï¼Ÿå› ä¸ºä¹‹åçš„æ›´æ–°ï¼Œç”Ÿæˆçš„ç‰ˆæœ¬ä¸€å®šå±äºä¸Šé¢çš„2æˆ–è€…3(a)çš„æƒ…å†µï¼Œè€Œå¯¹å®ƒæ¥è¯´ï¼Œè¿™äº›æ–°çš„æ•°æ®ç‰ˆæœ¬æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡çš„å¿«ç…§ï¼Œå°±æ˜¯â€œé™æ€â€çš„äº†ã€‚</p><p>æ‰€ä»¥ä½ ç°åœ¨çŸ¥é“äº†ï¼Œ<strong>InnoDBåˆ©ç”¨äº†â€œæ‰€æœ‰æ•°æ®éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬â€çš„è¿™ä¸ªç‰¹æ€§ï¼Œå®ç°äº†â€œç§’çº§åˆ›å»ºå¿«ç…§â€çš„èƒ½åŠ›ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸€ä¸‹å›¾1ä¸­çš„ä¸‰ä¸ªäº‹åŠ¡ï¼Œåˆ†æä¸‹äº‹åŠ¡Açš„è¯­å¥è¿”å›çš„ç»“æœï¼Œä¸ºä»€ä¹ˆæ˜¯k=1ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å¦¨åšå¦‚ä¸‹å‡è®¾ï¼š</p><ol>
<li>
<p>äº‹åŠ¡Aå¼€å§‹å‰ï¼Œç³»ç»Ÿé‡Œé¢åªæœ‰ä¸€ä¸ªæ´»è·ƒäº‹åŠ¡IDæ˜¯99ï¼›</p>
</li>
<li>
<p>äº‹åŠ¡Aã€Bã€Cçš„ç‰ˆæœ¬å·åˆ†åˆ«æ˜¯100ã€101ã€102ï¼Œä¸”å½“å‰ç³»ç»Ÿé‡Œåªæœ‰è¿™å››ä¸ªäº‹åŠ¡ï¼›</p>
</li>
<li>
<p>ä¸‰ä¸ªäº‹åŠ¡å¼€å§‹å‰ï¼Œ(1,1ï¼‰è¿™ä¸€è¡Œæ•°æ®çš„row trx_idæ˜¯90ã€‚</p>
</li>
</ol><p>è¿™æ ·ï¼Œäº‹åŠ¡Açš„è§†å›¾æ•°ç»„å°±æ˜¯[99,100], äº‹åŠ¡Bçš„è§†å›¾æ•°ç»„æ˜¯[99,100,101], äº‹åŠ¡Cçš„è§†å›¾æ•°ç»„æ˜¯[99,100,101,102]ã€‚</p><p>ä¸ºäº†ç®€åŒ–åˆ†æï¼Œæˆ‘å…ˆæŠŠå…¶ä»–å¹²æ‰°è¯­å¥å»æ‰ï¼Œåªç”»å‡ºè·Ÿäº‹åŠ¡AæŸ¥è¯¢é€»è¾‘æœ‰å…³çš„æ“ä½œï¼š</p><p><img src="https://static001.geekbang.org/resource/image/94/49/9416c310e406519b7460437cb0c5c149.png" alt=""></p><center>å›¾4 äº‹åŠ¡AæŸ¥è¯¢æ•°æ®é€»è¾‘å›¾</center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªæœ‰æ•ˆæ›´æ–°æ˜¯äº‹åŠ¡Cï¼ŒæŠŠæ•°æ®ä»(1,1)æ”¹æˆäº†(1,2)ã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®çš„æœ€æ–°ç‰ˆæœ¬çš„row trx_idæ˜¯102ï¼Œè€Œ90è¿™ä¸ªç‰ˆæœ¬å·²ç»æˆä¸ºäº†å†å²ç‰ˆæœ¬ã€‚</p><p>ç¬¬äºŒä¸ªæœ‰æ•ˆæ›´æ–°æ˜¯äº‹åŠ¡Bï¼ŒæŠŠæ•°æ®ä»(1,2)æ”¹æˆäº†(1,3)ã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆå³row trx_idï¼‰æ˜¯101ï¼Œè€Œ102åˆæˆä¸ºäº†å†å²ç‰ˆæœ¬ã€‚</p><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œåœ¨äº‹åŠ¡AæŸ¥è¯¢çš„æ—¶å€™ï¼Œå…¶å®äº‹åŠ¡Bè¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯å®ƒç”Ÿæˆçš„(1,3)è¿™ä¸ªç‰ˆæœ¬å·²ç»å˜æˆå½“å‰ç‰ˆæœ¬äº†ã€‚ä½†è¿™ä¸ªç‰ˆæœ¬å¯¹äº‹åŠ¡Aå¿…é¡»æ˜¯ä¸å¯è§çš„ï¼Œå¦åˆ™å°±å˜æˆè„è¯»äº†ã€‚</p><p>å¥½ï¼Œç°åœ¨äº‹åŠ¡Aè¦æ¥è¯»æ•°æ®äº†ï¼Œå®ƒçš„è§†å›¾æ•°ç»„æ˜¯[99,100]ã€‚å½“ç„¶äº†ï¼Œè¯»æ•°æ®éƒ½æ˜¯ä»å½“å‰ç‰ˆæœ¬è¯»èµ·çš„ã€‚æ‰€ä»¥ï¼Œäº‹åŠ¡AæŸ¥è¯¢è¯­å¥çš„è¯»æ•°æ®æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul>
<li>æ‰¾åˆ°(1,3)çš„æ—¶å€™ï¼Œåˆ¤æ–­å‡ºrow trx_id=101ï¼Œæ¯”é«˜æ°´ä½å¤§ï¼Œå¤„äºçº¢è‰²åŒºåŸŸï¼Œä¸å¯è§ï¼›</li>
<li>æ¥ç€ï¼Œæ‰¾åˆ°ä¸Šä¸€ä¸ªå†å²ç‰ˆæœ¬ï¼Œä¸€çœ‹row trx_id=102ï¼Œæ¯”é«˜æ°´ä½å¤§ï¼Œå¤„äºçº¢è‰²åŒºåŸŸï¼Œä¸å¯è§ï¼›</li>
<li>å†å¾€å‰æ‰¾ï¼Œç»ˆäºæ‰¾åˆ°äº†ï¼ˆ1,1)ï¼Œå®ƒçš„row trx_id=90ï¼Œæ¯”ä½æ°´ä½å°ï¼Œå¤„äºç»¿è‰²åŒºåŸŸï¼Œå¯è§ã€‚</li>
</ul><p>è¿™æ ·æ‰§è¡Œä¸‹æ¥ï¼Œè™½ç„¶æœŸé—´è¿™ä¸€è¡Œæ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œä½†æ˜¯äº‹åŠ¡Aä¸è®ºåœ¨ä»€ä¹ˆæ—¶å€™æŸ¥è¯¢ï¼Œçœ‹åˆ°è¿™è¡Œæ•°æ®çš„ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸ºä¸€è‡´æ€§è¯»ã€‚</p><p>è¿™ä¸ªåˆ¤æ–­è§„åˆ™æ˜¯ä»ä»£ç é€»è¾‘ç›´æ¥è½¬è¯‘è¿‡æ¥çš„ï¼Œä½†æ˜¯æ­£å¦‚ä½ æ‰€è§ï¼Œç”¨äºäººè‚‰åˆ†æå¯è§æ€§å¾ˆéº»çƒ¦ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘æ¥ç»™ä½ ç¿»è¯‘ä¸€ä¸‹ã€‚ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š</p><ol>
<li>
<p>ç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼›</p>
</li>
<li>
<p>ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼›</p>
</li>
<li>
<p>ç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚</p>
</li>
</ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªè§„åˆ™æ¥åˆ¤æ–­å›¾4ä¸­çš„æŸ¥è¯¢ç»“æœï¼Œäº‹åŠ¡Açš„æŸ¥è¯¢è¯­å¥çš„è§†å›¾æ•°ç»„æ˜¯åœ¨äº‹åŠ¡Aå¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œè¿™æ—¶å€™ï¼š</p><ul>
<li>(1,3)è¿˜æ²¡æäº¤ï¼Œå±äºæƒ…å†µ1ï¼Œä¸å¯è§ï¼›</li>
<li>(1,2)è™½ç„¶æäº¤äº†ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾æ•°ç»„åˆ›å»ºä¹‹åæäº¤çš„ï¼Œå±äºæƒ…å†µ2ï¼Œä¸å¯è§ï¼›</li>
<li>(1,1)æ˜¯åœ¨è§†å›¾æ•°ç»„åˆ›å»ºä¹‹å‰æäº¤çš„ï¼Œå¯è§ã€‚</li>
</ul><p>ä½ çœ‹ï¼Œå»æ‰æ•°å­—å¯¹æ¯”åï¼Œåªç”¨æ—¶é—´å…ˆåé¡ºåºæ¥åˆ¤æ–­ï¼Œåˆ†æèµ·æ¥æ˜¯ä¸æ˜¯è½»æ¾å¤šäº†ã€‚æ‰€ä»¥ï¼Œåé¢æˆ‘ä»¬å°±éƒ½ç”¨è¿™ä¸ªè§„åˆ™æ¥åˆ†æã€‚</p><h1>æ›´æ–°é€»è¾‘</h1><p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½æœ‰ç–‘é—®äº†ï¼š<strong>äº‹åŠ¡Bçš„updateè¯­å¥ï¼Œå¦‚æœæŒ‰ç…§ä¸€è‡´æ€§è¯»ï¼Œå¥½åƒç»“æœä¸å¯¹å“¦ï¼Ÿ</strong></p><p>ä½ çœ‹å›¾5ä¸­ï¼Œäº‹åŠ¡Bçš„è§†å›¾æ•°ç»„æ˜¯å…ˆç”Ÿæˆçš„ï¼Œä¹‹åäº‹åŠ¡Cæ‰æäº¤ï¼Œä¸æ˜¯åº”è¯¥çœ‹ä¸è§(1,2)å—ï¼Œæ€ä¹ˆèƒ½ç®—å‡º(1,3)æ¥ï¼Ÿ</p><p><img src="https://static001.geekbang.org/resource/image/86/9f/86ad7e8abe7bf16505b97718d8ac149f.png" alt=""></p><center>å›¾5 äº‹åŠ¡Bæ›´æ–°é€»è¾‘å›¾</center><p>æ˜¯çš„ï¼Œå¦‚æœäº‹åŠ¡Båœ¨æ›´æ–°ä¹‹å‰æŸ¥è¯¢ä¸€æ¬¡æ•°æ®ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿”å›çš„kçš„å€¼ç¡®å®æ˜¯1ã€‚</p><p>ä½†æ˜¯ï¼Œå½“å®ƒè¦å»æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†åœ¨å†å²ç‰ˆæœ¬ä¸Šæ›´æ–°äº†ï¼Œå¦åˆ™äº‹åŠ¡Cçš„æ›´æ–°å°±ä¸¢å¤±äº†ã€‚å› æ­¤ï¼Œäº‹åŠ¡Bæ­¤æ—¶çš„set k=k+1æ˜¯åœ¨ï¼ˆ1,2ï¼‰çš„åŸºç¡€ä¸Šè¿›è¡Œçš„æ“ä½œã€‚</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œå°±ç”¨åˆ°äº†è¿™æ ·ä¸€æ¡è§„åˆ™ï¼š<strong>æ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼Œè€Œè¿™ä¸ªè¯»ï¼Œåªèƒ½è¯»å½“å‰çš„å€¼ï¼Œç§°ä¸ºâ€œå½“å‰è¯»â€ï¼ˆcurrent readï¼‰ã€‚</strong></p><p>å› æ­¤ï¼Œåœ¨æ›´æ–°çš„æ—¶å€™ï¼Œå½“å‰è¯»æ‹¿åˆ°çš„æ•°æ®æ˜¯(1,2)ï¼Œæ›´æ–°åç”Ÿæˆäº†æ–°ç‰ˆæœ¬çš„æ•°æ®(1,3)ï¼Œè¿™ä¸ªæ–°ç‰ˆæœ¬çš„row trx_idæ˜¯101ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œäº‹åŠ¡BæŸ¥è¯¢è¯­å¥çš„æ—¶å€™ï¼Œä¸€çœ‹è‡ªå·±çš„ç‰ˆæœ¬å·æ˜¯101ï¼Œæœ€æ–°æ•°æ®çš„ç‰ˆæœ¬å·ä¹Ÿæ˜¯101ï¼Œæ˜¯è‡ªå·±çš„æ›´æ–°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥æŸ¥è¯¢å¾—åˆ°çš„kçš„å€¼æ˜¯3ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æåˆ°äº†ä¸€ä¸ªæ¦‚å¿µï¼Œå«ä½œå½“å‰è¯»ã€‚å…¶å®ï¼Œé™¤äº†updateè¯­å¥å¤–ï¼Œselectè¯­å¥å¦‚æœåŠ é”ï¼Œä¹Ÿæ˜¯å½“å‰è¯»ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæŠŠäº‹åŠ¡Açš„æŸ¥è¯¢è¯­å¥select * from t where id=1ä¿®æ”¹ä¸€ä¸‹ï¼ŒåŠ ä¸Šlock in share mode æˆ– for updateï¼Œä¹Ÿéƒ½å¯ä»¥è¯»åˆ°ç‰ˆæœ¬å·æ˜¯101çš„æ•°æ®ï¼Œè¿”å›çš„kçš„å€¼æ˜¯3ã€‚ä¸‹é¢è¿™ä¸¤ä¸ªselectè¯­å¥ï¼Œå°±æ˜¯åˆ†åˆ«åŠ äº†è¯»é”ï¼ˆSé”ï¼Œå…±äº«é”ï¼‰å’Œå†™é”ï¼ˆXé”ï¼Œæ’ä»–é”ï¼‰ã€‚</p><pre><code>mysql&gt; select k from t where id=1 lock in share mode;
mysql&gt; select k from t where id=1 for update;
</code></pre><p>å†å¾€å‰ä¸€æ­¥ï¼Œå‡è®¾äº‹åŠ¡Cä¸æ˜¯é©¬ä¸Šæäº¤çš„ï¼Œè€Œæ˜¯å˜æˆäº†ä¸‹é¢çš„äº‹åŠ¡Câ€™ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p><p><img src="https://static001.geekbang.org/resource/image/cd/6e/cda2a0d7decb61e59dddc83ac51efb6e.png" alt=""></p><center>å›¾6 äº‹åŠ¡Aã€Bã€C'çš„æ‰§è¡Œæµç¨‹</center><p>äº‹åŠ¡Câ€™çš„ä¸åŒæ˜¯ï¼Œæ›´æ–°åå¹¶æ²¡æœ‰é©¬ä¸Šæäº¤ï¼Œåœ¨å®ƒæäº¤å‰ï¼Œäº‹åŠ¡Bçš„æ›´æ–°è¯­å¥å…ˆå‘èµ·äº†ã€‚å‰é¢è¯´è¿‡äº†ï¼Œè™½ç„¶äº‹åŠ¡Câ€™è¿˜æ²¡æäº¤ï¼Œä½†æ˜¯(1,2)è¿™ä¸ªç‰ˆæœ¬ä¹Ÿå·²ç»ç”Ÿæˆäº†ï¼Œå¹¶ä¸”æ˜¯å½“å‰çš„æœ€æ–°ç‰ˆæœ¬ã€‚é‚£ä¹ˆï¼Œäº‹åŠ¡Bçš„æ›´æ–°è¯­å¥ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„â€œä¸¤é˜¶æ®µé”åè®®â€å°±è¦ä¸Šåœºäº†ã€‚äº‹åŠ¡Câ€™æ²¡æäº¤ï¼Œä¹Ÿå°±æ˜¯è¯´(1,2)è¿™ä¸ªç‰ˆæœ¬ä¸Šçš„å†™é”è¿˜æ²¡é‡Šæ”¾ã€‚è€Œäº‹åŠ¡Bæ˜¯å½“å‰è¯»ï¼Œå¿…é¡»è¦è¯»æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸”å¿…é¡»åŠ é”ï¼Œå› æ­¤å°±è¢«é”ä½äº†ï¼Œå¿…é¡»ç­‰åˆ°äº‹åŠ¡Câ€™é‡Šæ”¾è¿™ä¸ªé”ï¼Œæ‰èƒ½ç»§ç»­å®ƒçš„å½“å‰è¯»ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/54/92/540967ea905e8b63630e496786d84c92.png" alt=""></p><center>å›¾7 äº‹åŠ¡Bæ›´æ–°é€»è¾‘å›¾ï¼ˆé…åˆäº‹åŠ¡C'ï¼‰</center><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠä¸€è‡´æ€§è¯»ã€å½“å‰è¯»å’Œè¡Œé”å°±ä¸²èµ·æ¥äº†ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†å›åˆ°æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼š<strong>äº‹åŠ¡çš„å¯é‡å¤è¯»çš„èƒ½åŠ›æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</strong></p><p>å¯é‡å¤è¯»çš„æ ¸å¿ƒå°±æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆconsistent readï¼‰ï¼›è€Œäº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªèƒ½ç”¨å½“å‰è¯»ã€‚å¦‚æœå½“å‰çš„è®°å½•çš„è¡Œé”è¢«å…¶ä»–äº‹åŠ¡å ç”¨çš„è¯ï¼Œå°±éœ€è¦è¿›å…¥é”ç­‰å¾…ã€‚</p><p>è€Œè¯»æäº¤çš„é€»è¾‘å’Œå¯é‡å¤è¯»çš„é€»è¾‘ç±»ä¼¼ï¼Œå®ƒä»¬æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼š</p><ul>
<li>åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºä¸€è‡´æ€§è§†å›¾ï¼Œä¹‹åäº‹åŠ¡é‡Œçš„å…¶ä»–æŸ¥è¯¢éƒ½å…±ç”¨è¿™ä¸ªä¸€è‡´æ€§è§†å›¾ï¼›</li>
<li>åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç®—å‡ºä¸€ä¸ªæ–°çš„è§†å›¾ã€‚</li>
</ul><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡Aå’Œäº‹åŠ¡Bçš„æŸ¥è¯¢è¯­å¥æŸ¥åˆ°çš„kï¼Œåˆ†åˆ«åº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œâ€œstart transaction with consistent snapshot; â€çš„æ„æ€æ˜¯ä»è¿™ä¸ªè¯­å¥å¼€å§‹ï¼Œåˆ›å»ºä¸€ä¸ªæŒç»­æ•´ä¸ªäº‹åŠ¡çš„ä¸€è‡´æ€§å¿«ç…§ã€‚æ‰€ä»¥ï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªç”¨æ³•å°±æ²¡æ„ä¹‰äº†ï¼Œç­‰æ•ˆäºæ™®é€šçš„start transactionã€‚</p><p>ä¸‹é¢æ˜¯è¯»æäº¤æ—¶çš„çŠ¶æ€å›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªæŸ¥è¯¢è¯­å¥çš„åˆ›å»ºè§†å›¾æ•°ç»„çš„æ—¶æœºå‘ç”Ÿäº†å˜åŒ–ï¼Œå°±æ˜¯å›¾ä¸­çš„read viewæ¡†ã€‚ï¼ˆæ³¨æ„ï¼šè¿™é‡Œï¼Œæˆ‘ä»¬ç”¨çš„è¿˜æ˜¯äº‹åŠ¡Cçš„é€»è¾‘ç›´æ¥æäº¤ï¼Œè€Œä¸æ˜¯äº‹åŠ¡Câ€™ï¼‰</p><p><img src="https://static001.geekbang.org/resource/image/ed/6e/ed4b8d03287df67ecca53b5b4830ee6e.png" alt=""></p><center>å›¾8 è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹çš„äº‹åŠ¡çŠ¶æ€å›¾</center><p>è¿™æ—¶ï¼Œäº‹åŠ¡Açš„æŸ¥è¯¢è¯­å¥çš„è§†å›¾æ•°ç»„æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„æ—¶å€™åˆ›å»ºçš„ï¼Œæ—¶åºä¸Š(1,2)ã€(1,3)çš„ç”Ÿæˆæ—¶é—´éƒ½åœ¨åˆ›å»ºè¿™ä¸ªè§†å›¾æ•°ç»„çš„æ—¶åˆ»ä¹‹å‰ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™ä¸ªæ—¶åˆ»ï¼š</p><ul>
<li>(1,3)è¿˜æ²¡æäº¤ï¼Œå±äºæƒ…å†µ1ï¼Œä¸å¯è§ï¼›</li>
<li>(1,2)æäº¤äº†ï¼Œå±äºæƒ…å†µ3ï¼Œå¯è§ã€‚</li>
</ul><p>æ‰€ä»¥ï¼Œè¿™æ—¶å€™äº‹åŠ¡AæŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯k=2ã€‚</p><p>æ˜¾ç„¶åœ°ï¼Œäº‹åŠ¡BæŸ¥è¯¢ç»“æœk=3ã€‚</p><h1>å°ç»“</h1><p>InnoDBçš„è¡Œæ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªæ•°æ®ç‰ˆæœ¬æœ‰è‡ªå·±çš„row trx_idï¼Œæ¯ä¸ªäº‹åŠ¡æˆ–è€…è¯­å¥æœ‰è‡ªå·±çš„ä¸€è‡´æ€§è§†å›¾ã€‚æ™®é€šæŸ¥è¯¢è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼Œä¸€è‡´æ€§è¯»ä¼šæ ¹æ®row trx_idå’Œä¸€è‡´æ€§è§†å›¾ç¡®å®šæ•°æ®ç‰ˆæœ¬çš„å¯è§æ€§ã€‚</p><ul>
<li>å¯¹äºå¯é‡å¤è¯»ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨äº‹åŠ¡å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›</li>
<li>å¯¹äºè¯»æäº¤ï¼ŒæŸ¥è¯¢åªæ‰¿è®¤åœ¨è¯­å¥å¯åŠ¨å‰å°±å·²ç»æäº¤å®Œæˆçš„æ•°æ®ï¼›</li>
</ul><p>è€Œå½“å‰è¯»ï¼Œæ€»æ˜¯è¯»å–å·²ç»æäº¤å®Œæˆçš„æœ€æ–°ç‰ˆæœ¬ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æƒ³ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¡¨ç»“æ„ä¸æ”¯æŒâ€œå¯é‡å¤è¯»â€ï¼Ÿè¿™æ˜¯å› ä¸ºè¡¨ç»“æ„æ²¡æœ‰å¯¹åº”çš„è¡Œæ•°æ®ï¼Œä¹Ÿæ²¡æœ‰row trx_idï¼Œå› æ­¤åªèƒ½éµå¾ªå½“å‰è¯»çš„é€»è¾‘ã€‚</p><p>å½“ç„¶ï¼ŒMySQL 8.0å·²ç»å¯ä»¥æŠŠè¡¨ç»“æ„æ”¾åœ¨InnoDBå­—å…¸é‡Œäº†ï¼Œä¹Ÿè®¸ä»¥åä¼šæ”¯æŒè¡¨ç»“æ„çš„å¯é‡å¤è¯»ã€‚</p><p>åˆåˆ°æ€è€ƒé¢˜æ—¶é—´äº†ã€‚æˆ‘ç”¨ä¸‹é¢çš„è¡¨ç»“æ„å’Œåˆå§‹åŒ–è¯­å¥ä½œä¸ºè¯•éªŒç¯å¢ƒï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ã€‚ç°åœ¨ï¼Œæˆ‘è¦æŠŠæ‰€æœ‰â€œå­—æ®µcå’Œidå€¼ç›¸ç­‰çš„è¡Œâ€çš„cå€¼æ¸…é›¶ï¼Œä½†æ˜¯å´å‘ç°äº†ä¸€ä¸ªâ€œè¯¡å¼‚â€çš„ã€æ”¹ä¸æ‰çš„æƒ…å†µã€‚è¯·ä½ æ„é€ å‡ºè¿™ç§æƒ…å†µï¼Œå¹¶è¯´æ˜å…¶åŸç†ã€‚</p><pre><code>mysql&gt; CREATE TABLE `t` (
  `id` int(11) NOT NULL,
  `c` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;
insert into t(id, c) values(1,1),(2,2),(3,3),(4,4);
</code></pre><p><img src="https://static001.geekbang.org/resource/image/9b/0b/9b8fe7cf88c9ba40dc12e93e36c3060b.png" alt=""><br>
å¤ç°å‡ºæ¥ä»¥åï¼Œè¯·ä½ å†æ€è€ƒä¸€ä¸‹ï¼Œåœ¨å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­æœ‰æ²¡æœ‰å¯èƒ½ç¢°åˆ°è¿™ç§æƒ…å†µï¼Ÿä½ çš„åº”ç”¨ä»£ç ä¼šä¸ä¼šæ‰è¿›è¿™ä¸ªâ€œå‘â€é‡Œï¼Œä½ åˆæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼šæ€ä¹ˆåˆ é™¤è¡¨çš„å‰10000è¡Œã€‚æ¯”è¾ƒå¤šçš„ç•™è¨€éƒ½é€‰æ‹©äº†ç¬¬äºŒç§æ–¹å¼ï¼Œå³ï¼šåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡ delete from T limit 500ã€‚</p><p>ç¡®å®æ˜¯è¿™æ ·çš„ï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯ç›¸å¯¹è¾ƒå¥½çš„ã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼ˆå³ï¼šç›´æ¥æ‰§è¡Œdelete from T limit 10000ï¼‰é‡Œé¢ï¼Œå•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼›è€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚</p><p>ç¬¬ä¸‰ç§æ–¹å¼ï¼ˆå³ï¼šåœ¨20ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œdelete from T limit 500ï¼‰ï¼Œä¼šäººä¸ºé€ æˆé”å†²çªã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@Tony Duçš„è¯„è®ºï¼Œè¯¦ç»†è€Œä¸”å‡†ç¡®ã€‚<br>
@KnightÂ²ÂºÂ¹â¸ æåˆ°äº†å¦‚æœå¯ä»¥åŠ ä¸Šç‰¹å®šæ¡ä»¶ï¼Œå°†è¿™10000è¡Œå¤©ç„¶åˆ†å¼€ï¼Œå¯ä»¥è€ƒè™‘ç¬¬ä¸‰ç§ã€‚æ˜¯çš„ï¼Œå®é™…ä¸Šåœ¨æ“ä½œçš„æ—¶å€™æˆ‘ä¹Ÿå»ºè®®ä½ å°½é‡æ‹¿åˆ°IDå†åˆ é™¤ã€‚<br>
@è’æ¼ ç”˜æ³‰ æäº†ä¸€ä¸ªä¸é”™çš„é—®é¢˜ï¼Œå¤§å®¶éœ€è¦åŒºåˆ†è¡Œé”ã€MDLé”å’Œè¡¨é”çš„åŒºåˆ«ã€‚å¯¹InnoDBè¡¨æ›´æ–°ä¸€è¡Œï¼Œå¯èƒ½è¿‡äº†MDLå…³ï¼Œå´è¢«æŒ¡åœ¨è¡Œé”é˜¶æ®µã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/ce/d9/ce7f4e35916ed1aa49206a53a0547bd9.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/0c/ee/7667642c.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¤æ—¥é›¨</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œæœ‰ä¸ªé—®é¢˜ä¸å¤ªç†è§£ï¼Œå¯¹äºæ–‡ä¸­çš„ä¾‹å­å‡è®¾transaction idä¸º98çš„äº‹åŠ¡åœ¨äº‹åŠ¡Aæ‰§è¡Œselectï¼ˆQ2ï¼‰ä¹‹å‰æ›´æ–°äº†å­—æ®µï¼Œé‚£ä¹ˆäº‹åŠ¡Aå‘ç°è¿™ä¸ªå­—æ®µçš„row trx_idæ˜¯98ï¼Œæ¯”è‡ªå·±çš„up_limit_idè¦å°ï¼Œé‚£æ­¤æ—¶äº‹åŠ¡Aä¸å°±è·å–åˆ°äº†transaction idä¸º98çš„äº‹åŠ¡æ›´æ–°åçš„å€¼äº†å—ï¼Ÿ<br>æ¢å¥è¯è¯´å¯¹äºæ–‡ä¸­&quot;ä¹‹åçš„æ›´æ–°ï¼Œäº§ç”Ÿçš„æ–°çš„æ•°æ®ç‰ˆæœ¬çš„ row trx_id éƒ½ä¼šå¤§äº up_limit_id&quot;è¿™å¥è¯ä¸å¤ªç†è§£ï¼Œ up_limit_idæ˜¯å·²ç»æäº¤äº‹åŠ¡idçš„æœ€å¤§å€¼ï¼Œé‚£ä¹Ÿå¯èƒ½å­˜åœ¨ä¸€ä¸ªæ²¡æœ‰æäº¤çš„idå°äºup_limit_idçš„äº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼Ÿè¿˜æ˜¯è¯´transaction idæ¯”up_limit_idå°çš„äº‹åŠ¡éƒ½æ˜¯ä¿è¯å·²ç»æäº¤çš„ï¼Ÿ <br></div>
                            <span class="time">2018-11-30 15:01</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ çš„é—®é¢˜è¢«å¼•ç”¨æœ€å¤šï¼Œæˆ‘å›å¤ä½ å“ˆï¼Œå…¶å®ƒåŒå­¦çœ‹è¿‡æ¥ğŸ˜„<br><br>å¥½å§ï¼Œä»Šå¤©çš„è¯¾åé—®é¢˜å…¶å®æ¯”è¾ƒç®€å•ï¼Œæœ¬æ¥æ˜¯éšè—åœ¨æ€è€ƒé¢˜é‡Œçš„å½©è›‹ï¼Œè¢«ä½ é—®å‡ºæ¥äº†å“ˆã€‚<br><br>Innodb è¦ä¿è¯è¿™ä¸ªè§„åˆ™ï¼šäº‹åŠ¡å¯åŠ¨ä»¥å‰æ‰€æœ‰è¿˜æ²¡æäº¤çš„äº‹åŠ¡ï¼Œå®ƒéƒ½ä¸å¯è§ã€‚<br><br>ä½†æ˜¯åªå­˜ä¸€ä¸ªå·²ç»æäº¤äº‹åŠ¡çš„æœ€å¤§å€¼æ˜¯ä¸å¤Ÿçš„ã€‚ å› ä¸ºå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£äº›æ¯”æœ€å¤§å€¼å°çš„äº‹åŠ¡ï¼Œä¹‹åä¹Ÿå¯èƒ½æ›´æ–°ï¼ˆå°±æ˜¯ä½ è¯´çš„98è¿™ä¸ªäº‹åŠ¡ï¼‰<br><br>æ‰€ä»¥äº‹åŠ¡å¯åŠ¨çš„æ—¶å€™è¿˜è¦ä¿å­˜â€œç°åœ¨æ­£åœ¨æ‰§è¡Œçš„æ‰€æœ‰äº‹ç‰©IDåˆ—è¡¨â€ï¼Œå¦‚æœä¸€ä¸ªrow trx_idåœ¨è¿™åˆ—è¡¨ä¸­ï¼Œä¹Ÿè¦ä¸å¯è§ã€‚<br><br>è™½ç„¶è¸©ç ´äº†å½©è›‹ï¼Œè¿˜æ˜¯èµä½ çš„æ€è€ƒå“ˆï¼Œç½®é¡¶è®©å¤§å®¶å­¦ä¹ ğŸ˜„</p>
                                <p class="reply-time">2018-11-30 23:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çº¦ä¹¦äºš</span>
                            </div>
                            <div class="bd">æ—©ã€‚<br>æ€è€ƒé¢˜ï¼ŒRRä¸‹ï¼Œç”¨å¦å¤–ä¸€ä¸ªäº‹ç‰©åœ¨updateæ‰§è¡Œä¹‹å‰ï¼Œå…ˆæŠŠæ‰€æœ‰cå€¼ä¿®æ”¹ï¼Œåº”è¯¥å°±å¯ä»¥ã€‚æ¯”å¦‚update t set c = id + 1ã€‚<br>è¿™ä¸ªå®é™…åœºæ™¯è¿˜æŒºå¸¸è§â€”â€”æ‰€è°“çš„â€œä¹è§‚é”â€ã€‚æ—¶å¸¸æˆ‘ä»¬ä¼šåŸºäºversionå­—æ®µå¯¹rowè¿›è¡Œcaså¼çš„æ›´æ–°ï¼Œç±»ä¼¼update ...set ... where id = xxx and version = xxxã€‚å¦‚æœversionè¢«å…¶ä»–äº‹åŠ¡æŠ¢å…ˆæ›´æ–°ï¼Œåˆ™åœ¨è‡ªå·±äº‹åŠ¡ä¸­æ›´æ–°å¤±è´¥ï¼Œtrx_idæ²¡æœ‰å˜æˆè‡ªèº«äº‹åŠ¡çš„idï¼ŒåŒä¸€ä¸ªäº‹åŠ¡ä¸­å†æ¬¡selectè¿˜æ˜¯æ—§å€¼ï¼Œå°±ä¼šå‡ºç°â€œæ˜æ˜å€¼æ²¡å˜å¯å°±æ˜¯æ›´æ–°ä¸äº†â€çš„â€œå¼‚è±¡â€ï¼ˆanomalyï¼‰ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯æ¯æ¬¡casæ›´æ–°ä¸ç®¡æˆåŠŸå¤±è´¥ï¼Œç»“æŸå½“å‰äº‹åŠ¡ã€‚å¦‚æœå¤±è´¥åˆ™é‡æ–°èµ·ä¸€ä¸ªäº‹åŠ¡è¿›è¡ŒæŸ¥è¯¢æ›´æ–°ã€‚<br>è®°å¾—æŸæœŸç»™è€å¸ˆç•™è¨€æåˆ°äº†ï¼Œä¼¼ä¹åªæœ‰MySQLæ˜¯åœ¨ä¸€è‡´æ€§è§†å›¾ä¸‹é‡‡ç”¨è¿™ç§å®½æ¾çš„updateæœºåˆ¶ã€‚ä¹Ÿè®¸æ˜¯è€ƒè™‘æ˜“ç”¨æ€§å§ã€‚å…¶ä»–æ•°æ®åº“å¤§å¤šåœ¨å†…éƒ¨å®ç°casï¼Œåªæ˜¯å¤±è´¥åä¸‹ä¸€æ­¥åŠ¨ä½œæœ‰åŒºåˆ«ã€‚ <br></div>
                            <span class="time">2018-11-30 08:19</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ—©<br><br>èµ<br><br>ç½®é¡¶äº†<br><br>æ˜å¤©è¯¾åé—®é¢˜æ—¶é—´ç›´æ¥æŒ‡é’ˆå¼•ç”¨äº†å“ˆğŸ˜„<br><br>è¡¥å……ä¸€ä¸‹ï¼šä¸Šé¢è¯´çš„â€œå¦‚æœå¤±è´¥å°±é‡æ–°èµ·ä¸€ä¸ªäº‹åŠ¡â€ï¼Œé‡Œé¢åˆ¤æ–­æ˜¯å¦æˆåŠŸçš„æ ‡å‡†æ˜¯ affected_rows æ˜¯ä¸æ˜¯ç­‰äºé¢„æœŸå€¼ã€‚ <br>æ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œé¢é¢„æœŸå€¼æœ¬æ¥æ˜¯4ï¼Œå½“ç„¶å®é™…ä¸šåŠ¡ä¸­è¿™ç§è¯­å¥ä¸€èˆ¬æ˜¯åŒ¹é…å”¯ä¸€ä¸»é”®ï¼Œæ‰€ä»¥é¢„æœŸä½å€¼ä¸€èˆ¬æ˜¯1ã€‚<br><br></p>
                                <p class="reply-time">2018-11-30 08:30</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/30/29/7d34099d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ithunter</span>
                            </div>
                            <div class="bd">è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œä¸šåŠ¡ä¸Šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒAã€Bä¸¤ä¸ªç”¨æˆ·ï¼Œå¦‚æœäº’ç›¸å–œæ¬¢ï¼Œåˆ™æˆä¸ºå¥½å‹ã€‚è®¾è®¡ä¸Šæ˜¯æœ‰ä¸¤å¼ è¡¨ï¼Œä¸€ä¸ªæ˜¯likeè¡¨ï¼Œä¸€ä¸ªæ˜¯friendè¡¨ï¼Œlikeè¡¨æœ‰user_idã€liker_idä¸¤ä¸ªå­—æ®µï¼Œæˆ‘è®¾ç½®ä¸ºå¤åˆå”¯ä¸€ç´¢å¼•å³uk_user_id_liker_idã€‚è¯­å¥æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š<br>ä»¥Aå–œæ¬¢Bä¸ºä¾‹ï¼š<br>1ã€å…ˆæŸ¥è¯¢å¯¹æ–¹æœ‰æ²¡æœ‰å–œæ¬¢è‡ªå·±ï¼ˆBæœ‰æ²¡æœ‰å–œæ¬¢Aï¼‰<br>select * from like where user_id = B and liker_id = A<br>2ã€å¦‚æœæœ‰ï¼Œåˆ™æˆä¸ºå¥½å‹<br>insert into friend<br>3ã€æ²¡æœ‰ï¼Œåˆ™åªæ˜¯å–œæ¬¢å…³ç³»<br>insert into like<br><br>å¦‚æœAã€BåŒæ—¶å–œæ¬¢å¯¹æ–¹ï¼Œä¼šå‡ºç°ä¸ä¼šæˆä¸ºå¥½å‹çš„é—®é¢˜ã€‚å› ä¸ºä¸Šé¢ç¬¬1æ­¥ï¼ŒåŒæ–¹éƒ½æ²¡å–œæ¬¢å¯¹æ–¹ã€‚ç¬¬1æ­¥å³ä½¿ä½¿ç”¨äº†æ’ä»–é”ä¹Ÿä¸è¡Œï¼Œå› ä¸ºè®°å½•ä¸å­˜åœ¨ï¼Œè¡Œé”æ— æ³•ç”Ÿæ•ˆã€‚è¯·é—®è¿™ç§æƒ…å†µï¼Œåœ¨mysqlé”å±‚é¢æœ‰æ²¡æœ‰åŠæ³•å¤„ç† <br></div>
                            <span class="time">2018-12-05 16:51</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ è¿™ä¸ªé—®é¢˜å¾ˆæœ‰è¶£ã€‚æˆ‘æƒ³åˆ°ä¸€ä¸ªä¸é”™çš„è§£æ³•ã€‚ä¸è¿‡æˆ‘å…ˆç½®é¡¶ã€‚è®©åˆ«çš„åŒå­¦æ¥å›ç­”çœ‹çœ‹ã€‚<br><br>å¥½é—®é¢˜ï¼Œè°æœ‰æƒ³æ³•poå‡ºæ¥ã€‚</p>
                                <p class="reply-time">2018-12-06 00:36</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/05/f3/5488276f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¿ƒé›¨é‘«æ™´</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å½“å¼€å¯äº‹åŠ¡æ—¶ï¼Œéœ€è¦ä¿å­˜æ´»è·ƒäº‹åŠ¡çš„æ•°ç»„ï¼ˆAï¼‰ï¼Œç„¶åè·å–é«˜æ°´ä½ï¼ˆBï¼‰ã€‚æˆ‘çš„ç–‘é—®å°±æ˜¯ï¼Œåœ¨è¿™ä¸¤ä¸ªåŠ¨ä½œä¹‹é—´ï¼ˆAå’ŒBä¹‹é—´ï¼‰ä¼šä¸ä¼šäº§ç”Ÿæ–°çš„äº‹åŠ¡ï¼Ÿå¦‚æœäº§ç”Ÿäº†æ–°çš„äº‹åŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°çš„äº‹åŠ¡ç›¸å¯¹äºå½“å‰äº‹åŠ¡å°±æ˜¯å¯è§çš„ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æäº¤ã€‚ <br></div>
                            <span class="time">2018-12-03 19:28</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œæœ‰å¾ˆæ·±å…¥çš„æ€è€ƒå“ˆ<br><br>ä»£ç å®ç°ä¸Šï¼Œè·å–è§†å›¾æ•°ç»„å’Œé«˜æ°´ä½æ˜¯åœ¨äº‹åŠ¡ç³»ç»Ÿçš„é”ä¿æŠ¤ä¸‹åšçš„ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯åŸå­æ“ä½œï¼ŒæœŸé—´ä¸èƒ½åˆ›å»ºäº‹åŠ¡ã€‚<br></p>
                                <p class="reply-time">2018-12-04 03:43</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/31/fe/30a17a9d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Leo</span>
                            </div>
                            <div class="bd">è€å¸ˆåœ¨æ–‡ä¸­è¯´: &quot;æ‰€ä»¥ï¼Œåœ¨æ‰§è¡Œäº‹åŠ¡ B çš„ Q1 è¯­å¥çš„æ—¶å€™ï¼Œä¸€çœ‹è‡ªå·±çš„ç‰ˆæœ¬å·æ˜¯ 101ï¼Œæœ€æ–°æ•°æ®çš„ç‰ˆæœ¬å·ä¹Ÿæ˜¯ 101ï¼Œå¯ä»¥ç”¨ï¼Œæ‰€ä»¥ Q1 å¾—åˆ°çš„ k çš„å€¼æ˜¯ 3ã€‚&quot;ï¼Œ<br>1. è¿™é‡Œä¸å‚è€ƒup_limit_idäº†å—ï¼Ÿ<br>2. å¦‚æœå‚è€ƒï¼Œäº‹åŠ¡Bçš„up_limit_idæ˜¯åœ¨æ‰§è¡Œupdateè¯­å¥å‰é‡æ–°è®¡ç®—çš„ï¼Œè¿˜æ˜¯åœ¨æ‰§è¡ŒQ1è¯­å¥å‰é‡æ–°è®¡ç®—çš„ï¼Ÿ<br> <br></div>
                            <span class="time">2018-11-30 07:36</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. åˆ¤æ–­å¯è§æ€§ä¸¤ä¸ªè§„åˆ™ï¼šä¸€ä¸ªæ˜¯up_limit_id ,å¦ä¸€ä¸ªæ˜¯â€œè‡ªå·±ä¿®æ”¹çš„â€ï¼›è¿™é‡Œç”¨åˆ°ç¬¬äºŒä¸ªè§„åˆ™<br><br>2.  è¿™æ—¶å€™äº‹åŠ¡Bup_limit_idè¿˜æ˜¯99</p>
                                <p class="reply-time">2018-11-30 08:09</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/61/57/6f3c81dd.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é˜¿å»º</span>
                            </div>
                            <div class="bd">ä»¥ä¸‹æ˜¯ä¸€ä¸ªé”™è¯¯çš„ç†è§£ï¼Œåœ¨ç¼–å†™è¯„è®ºçš„è¿‡ç¨‹ä¸­ç”¨å‰é¢åˆšå­¦åˆ°çš„çŸ¥è¯†æŠŠè‡ªå·±çš„ç»“è®ºæ¨ç¿»ï¼Œæœ‰ä¸€ç§å¿«æ„Ÿï¼Œæ‰€ä»¥è¿˜æ˜¯å†³å®šå‘å‡ºæ¥ã€‚ å“ˆå“ˆ~<br><br>äº‹åŠ¡A(100) | äº‹åŠ¡B(101)<br>-------------------<br>             | select(1)<br>-------------------<br>             | update  <br>-------------------<br>  update  |<br>-------------------<br>              | select(2) <br>-------------------<br>äº‹åŠ¡A Båœ¨äº‹åŠ¡å¯åŠ¨æ—¶çš„up_limit_idä¸º99<br>äº‹åŠ¡B update ä¹‹åè¡¨æ ¼çš„æ¯ä¸€è¡Œçš„row_trx_idå˜ä¸º101 <br>äº‹åŠ¡A å†update ä¹‹åæ¯ä¸€è¡Œçš„row_trx_idå˜ä¸º100<br>äº‹åŠ¡Bçš„select(2)æ—¶å› ä¸ºéš”ç¦»çº§åˆ«æ˜¯RRï¼Œæ‰€ä»¥å»éå†çš„æ—¶å€™æ‰¾row_trx_id&lt;=101çš„ç‰ˆæœ¬è¿”å›ï¼Œä¼˜å…ˆæ‰¾åˆ°ç‰ˆæœ¬ä¸º100çš„ï¼Œå°±ä¼šå¯¼è‡´select(2)å¹¶æ²¡æœ‰å–åˆ°è‡ªå·±çš„æ›´æ–°ã€‚<br>å¯¹äºå¯¹äºè‡ªå·±çš„ä¿®æ”¹ä¹Ÿè®¤è¿™å¥è¯å’Œundo-logçš„ä»‹ç»ï¼Œæˆ‘è§‰çš„è¿™ç§æƒ…å†µä¸‹ä¼šè·å–ä¸åˆ°è‡ªå·±æ›´æ–°çš„æœ€æ–°çš„æ•°æ®ã€‚ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹ã€‚<br><br>ä¸å¯¹ï¼å› ä¸ºäº‹åŠ¡Açš„updateæ˜¯ä¼šè¢«è¡Œé”é”ä½çš„ï¼Œè€Œä¸”é”æ˜¯è¦åœ¨äº‹åŠ¡Bç»“æŸä¹‹åæ‰é‡Šæ”¾ï¼Œæ‰€ä»¥ä¸å­˜åœ¨åœ¨äº‹åŠ¡Bçš„updateä¹‹åè¿˜åœ¨äº‹åŠ¡ä¸­è¢«äº‹åŠ¡Aç»™æ›´æ–°ï¼Œå¯¼è‡´ä¸Šé¢çš„é—®é¢˜ã€‚ <br></div>
                            <span class="time">2018-11-30 21:00</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿<br><br>æˆ‘åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯æœ€å–œæ¬¢è¿™ç§â€œè‡ªå·±æ¨ç¿»è‡ªå·±ç»“è®ºâ€çš„å¿«æ„Ÿ</p>
                                <p class="reply-time">2018-11-30 22:46</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/c0/25/348b4d76.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¢¨è§</span>
                            </div>
                            <div class="bd">å¯é‡å¤è¯»æƒ…å†µä¸‹ï¼Œäº‹åŠ¡cçš„102æ—©äºäº‹åŠ¡bçš„101ï¼Œå¦‚æœäº‹åŠ¡cå†get kï¼Œé‚£ä¸æ˜¯å°±å–å¾—101çš„å€¼äº†ï¼Ÿä¸å¤ªæ˜ç™½ã€‚ <br></div>
                            <span class="time">2018-11-30 07:38</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å’±ä»¬ä¾‹å­é‡Œé¢ï¼Œäº‹åŠ¡Cæ˜¯ç›´æ¥æäº¤çš„ï¼Œå†æ‰§è¡Œä¸€ä¸ªGET å°±æ˜¯å¦å¤–ä¸€ä¸ªäº‹åŠ¡äº†â€¦ <br><br>å¦‚æœä½ è¯´çš„æ˜¯ç”¨begin æ¥å¯åŠ¨ä¸€ä¸ªå¤šè¯­å¥äº‹åŠ¡ï¼Œé‚£ä¹ˆäº‹åŠ¡cåœ¨æ›´æ–°åæŸ¥è¯¢ï¼Œè¿˜æ˜¯çœ‹åˆ°row trx_idæ˜¯102çš„ã€‚  ã€æ³¨æ„ï¼šå¦‚æœå®ƒè¿˜æ²¡æäº¤ï¼Œ101æ ¹æœ¬ç”Ÿæˆä¸å‡ºæ¥ï¼Œå› ä¸ºäº‹åŠ¡Bè¢«è¡Œé”æŒ¡ç€å‘¢ã€‘</p>
                                <p class="reply-time">2018-11-30 08:13</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">è¿™ç¯‡ç†è®ºçŸ¥è¯†å¾ˆä¸°å¯Œ,éœ€è¦å…ˆæ€»ç»“ä¸‹<br>1.innodbæ”¯æŒRCå’ŒRRéš”ç¦»çº§åˆ«å®ç°æ˜¯ç”¨çš„ä¸€è‡´æ€§è§†å›¾(consistent read view)<br><br>2.äº‹åŠ¡åœ¨å¯åŠ¨æ—¶ä¼šæ‹ä¸€ä¸ªå¿«ç…§,è¿™ä¸ªå¿«ç…§æ˜¯åŸºäºæ•´ä¸ªåº“çš„.<br>åŸºäºæ•´ä¸ªåº“çš„æ„æ€å°±æ˜¯è¯´ä¸€ä¸ªäº‹åŠ¡å†…,æ•´ä¸ªåº“çš„ä¿®æ”¹å¯¹äºè¯¥äº‹åŠ¡éƒ½æ˜¯ä¸å¯è§çš„(å¯¹äºå¿«ç…§è¯»çš„æƒ…å†µ)<br>å¦‚æœåœ¨äº‹åŠ¡å†…select tè¡¨,å¦å¤–çš„äº‹åŠ¡æ‰§è¡Œäº†DDL tè¡¨,æ ¹æ®å‘ç”Ÿæ—¶é—´,è¦å˜›é”ä½è¦å˜›æŠ¥é”™(å‚è€ƒç¬¬å…­ç« )<br><br>3.äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„MVCCå‘¢?<br>(1)æ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡ID,å«åštransaction id(ä¸¥æ ¼é€’å¢)<br>(2)äº‹åŠ¡åœ¨å¯åŠ¨æ—¶,æ‰¾åˆ°å·²æäº¤çš„æœ€å¤§äº‹åŠ¡IDè®°ä¸ºup_limit_idã€‚<br>(3)äº‹åŠ¡åœ¨æ›´æ–°ä¸€æ¡è¯­å¥æ—¶,æ¯”å¦‚id=1æ”¹ä¸ºäº†id=2.ä¼šæŠŠid=1å’Œè¯¥è¡Œä¹‹å‰çš„row trx_idå†™åˆ°undo logé‡Œ,<br>å¹¶ä¸”åœ¨æ•°æ®é¡µä¸ŠæŠŠidçš„å€¼æ”¹ä¸º2,å¹¶ä¸”æŠŠä¿®æ”¹è¿™æ¡è¯­å¥çš„transaction idè®°åœ¨è¯¥è¡Œè¡Œå¤´<br>(4)å†å®šä¸€ä¸ªè§„çŸ©,ä¸€ä¸ªäº‹åŠ¡è¦æŸ¥çœ‹ä¸€æ¡æ•°æ®æ—¶,å¿…é¡»å…ˆç”¨è¯¥äº‹åŠ¡çš„up_limit_idä¸è¯¥è¡Œçš„transaction idåšæ¯”å¯¹,<br>å¦‚æœup_limit_id&gt;=transaction id,é‚£ä¹ˆå¯ä»¥çœ‹.å¦‚æœup_limit_id&lt;transaction id,åˆ™åªèƒ½å»undo logé‡Œå»å–ã€‚å»undo logæŸ¥æ‰¾æ•°æ®çš„æ—¶å€™,ä¹Ÿéœ€è¦åšæ¯”å¯¹,å¿…é¡»up_limit_id&gt;transaction id,æ‰è¿”å›æ•°æ®<br><br>4.ä»€ä¹ˆæ˜¯å½“å‰è¯»,ç”±äºå½“å‰è¯»éƒ½æ˜¯å…ˆè¯»åå†™,åªèƒ½è¯»å½“å‰çš„å€¼,æ‰€ä»¥ä¸ºå½“å‰è¯».ä¼šæ›´æ–°äº‹åŠ¡å†…çš„up_limit_idä¸ºè¯¥äº‹åŠ¡çš„transaction id<br><br>5.ä¸ºä»€ä¹ˆrrèƒ½å®ç°å¯é‡å¤è¯»è€Œrcä¸èƒ½,åˆ†ä¸¤ç§æƒ…å†µ<br>(1)å¿«ç…§è¯»çš„æƒ…å†µä¸‹,rrä¸èƒ½æ›´æ–°äº‹åŠ¡å†…çš„up_limit_id,<br>    è€Œrcæ¯æ¬¡ä¼šæŠŠup_limit_idæ›´æ–°ä¸ºå¿«ç…§è¯»ä¹‹å‰æœ€æ–°å·²æäº¤äº‹åŠ¡çš„transaction id,åˆ™rcä¸èƒ½å¯é‡å¤è¯»<br>(2)å½“å‰è¯»çš„æƒ…å†µä¸‹,rræ˜¯åˆ©ç”¨record lock+gap lockæ¥å®ç°çš„,è€Œrcæ²¡æœ‰gap,æ‰€ä»¥rcä¸èƒ½å¯é‡å¤è¯» <br></div>
                            <span class="time">2018-11-30 16:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿<br><br>æœ¬ç¯‡çŸ¥è¯†ç‚¹å…¨get</p>
                                <p class="reply-time">2018-12-01 09:45</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/1f/ff/aadcf237.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Eric</span>
                            </div>
                            <div class="bd">æˆ‘ä¸æ˜¯dbaï¼Œè¿™ä¸ªè¯¾ç¨‹è¿˜æ˜¯éœ€è¦ä¸€äº›åŸºç¡€æ‰ä¼šæ›´æœ‰å¸®åŠ©ï¼Œæœ‰äº›ç« èŠ‚å¯¹æˆ‘æ¥è¯´ç¡®å®çœ‹èµ·æ¥æœ‰äº›åƒåŠ›ï¼Œä½†æ˜¯åœ¨åšæŒï¼Œä¸€éçœ‹ä¸æ‡‚çœ‹ä¸¤éã€ä¸‰éï¼ŒåŒæ—¶æŸ¥æ¼è¡¥ç¼ºçš„å»æ‰¾ä¸€äº›èµ„æ–™è¡¥å……ç›²ç‚¹ï¼Œè¿˜ç»„äº†ä¸ªä¸€èµ·å­¦ä¹ çš„ç¾¤ï¼Œå¸Œæœ›èƒ½åšæŒä¸‹å»ï¼Œæ”¶è·æ»¡æ»¡ <br></div>
                            <span class="time">2018-11-30 10:29</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">èµğŸ‘ğŸ¿<br>æ…¢æ…¢æ¥</p>
                                <p class="reply-time">2018-11-30 11:44</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/04/b8/3fd2f448.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">lucky star</span>
                            </div>
                            <div class="bd">ç­”æ¡ˆï¼š<br>      åˆ†æï¼š å‡è®¾æœ‰ä¸¤ä¸ªäº‹åŠ¡Aå’ŒBï¼Œ ä¸”Aäº‹åŠ¡æ˜¯æ›´æ–°c=0çš„äº‹åŠ¡ï¼› ç»™å®šæ¡ä»¶ï¼š 1ï¼Œ äº‹åŠ¡A update è¯­å¥å·²ç»æ‰§è¡ŒæˆåŠŸï¼Œ è¯´æ˜æ²¡æœ‰å¦å¤–ä¸€ä¸ªæ´»åŠ¨ä¸­çš„äº‹åŠ¡åœ¨æ‰§è¡Œä¿®æ”¹æ¡ä»¶ä¸ºid in 1,2,3,4æˆ–c in 1,2,3,4, å¦åˆ™updateä¼šè¢«é”é˜»å¡ï¼› 2ï¼Œäº‹åŠ¡Aå†æ¬¡æ‰§è¡ŒæŸ¥è¯¢ç»“æœå´æ˜¯ä¸€æ ·ï¼Œ è¯´æ˜ä»€ä¹ˆï¼Ÿè¯´æ˜äº‹åŠ¡BæŠŠidæˆ–è€…cç»™ä¿®æ”¹äº†ï¼Œ è€Œä¸”å·²ç»æäº¤äº†ï¼Œ å¯¼è‡´äº‹åŠ¡Aâ€œå½“å‰è¯»â€æ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„æ¡ä»¶ï¼› äº‹åŠ¡Açš„æŸ¥è¯¢è¯­å¥è¯´æ˜äº†äº‹åŠ¡Bæ‰§è¡Œæ›´æ–°åï¼Œæäº¤äº‹åŠ¡Bä¸€å®šæ˜¯åœ¨äº‹åŠ¡Aç¬¬ä¸€æ¡æŸ¥è¯¢è¯­å¥ä¹‹åæ‰§è¡Œçš„ï¼› <br><br>æ‰€ä»¥æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯ï¼š<br>1ï¼Œ äº‹åŠ¡A select * from t;<br>2,   äº‹åŠ¡B update t set c = c + 4;  &#47;&#47; åªè¦cæˆ–è€…idå¤§äºç­‰äº5å°±è¡Œ;  å½“ç„¶è¿™è¡Œä¹Ÿå¯ä»¥å’Œ1è°ƒæ¢ï¼Œ ä¸å½±å“<br>3,   äº‹åŠ¡B commit;<br>4,   äº‹åŠ¡A update t set c = 0 where id = c; &#47;&#47; å½“å‰è¯»ï¼› æ­¤æ—¶å·²ç»æ²¡æœ‰åŒ¹é…çš„è¡Œ<br>5ï¼Œ äº‹åŠ¡A select * from t;<br><br>è¯»å®Œç¬¬ä¸‰ç¯‡åå°±é™·å…¥äº†äº‹åŠ¡æ‰§è¡ŒåŸç†çš„æ³¥æ½­ä¸­äº†ï¼Œ ä¹Ÿæ‰¾äº†ä¸å°‘ç›¸å…³èµ„æ–™ï¼Œ ä½†æ€»æ„Ÿè§‰è¿˜ä¸æ˜¯ç‰¹åˆ«æ˜ç™½ï¼Œ ä»Šå¤©çœ‹å®Œè¿™ç¯‡ç»ˆäºèŒ…å¡é¡¿å¼€å‘€ï¼Œ ä»¿ä½›æ‰“é€šäº†ä»»ç£äºŒè„‰äº†ã€‚ã€‚ã€‚ã€‚<br> <br></div>
                            <span class="time">2018-12-15 23:21</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯å—¯ï¼Œåˆ†æå¾—å¾ˆå¯¹ã€‚<br><br>èŒ…å¡é¡¿å¼€çš„æ„Ÿè§‰å¾ˆå¥½ï¼Œæ­å–œğŸ‰ğŸˆ</p>
                                <p class="reply-time">2018-12-16 02:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e1/09/9483f537.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">â˜</span>
                            </div>
                            <div class="bd">è€å¸ˆæ‚¨å¥½ï¼š<br>    ä»Šå¤©é‡æ–°çœ‹äº†ä¸€ä¸‹è¿™ç« æ‚¨çš„ä¿®æ”¹åœ°æ–¹ï¼Œæœ‰ä¸ªåœ°æ–¹ä¸æ˜ç™½<br>    è½åœ¨é»„è‰²åŒºåŸŸæœªæäº¤äº‹åŠ¡é›†åˆéƒ¨åˆ†æ€ä¹ˆè¿˜è¦åˆ†ç±»ï¼Œä½æ°´ä½+é«˜æ°´ä½ä¸å°±æ˜¯è¿™ä¸ªæ•°ç»„äº†å—ï¼Œä¹‹å‰è¯´ï¼Œè¿™ä¸ªæ•°ç»„æ˜¯è®°å½•äº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œæ‰€æœ‰å·²ç»å¯åŠ¨è¿˜æœªæäº¤çš„äº‹åŠ¡IDï¼Œé‚£ä¸åº”è¯¥æ˜¯æœªæäº¤çš„äº‹åŠ¡å—ï¼Œä¸å°±åº”è¯¥æ˜¯ä¸å¯è¯»çš„å—<br>ä¹‹å‰è¯´çš„æ˜¯å¯åŠ¨æ—¶ä¼šè·å–ä¸€ä¸ªæœ€å¤§row trx_idï¼Œæ‰€æœ‰å¤§äºè¿™ä¸ªidéƒ½ä¸è®¤ï¼Œè¿™ä¸ªidè‚¯å®šæ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡çš„æ‰å¯¹å•Šï¼Œè¿™ä¸ªidä¸æ‰åº”è¯¥æ˜¯æ•°ç»„çš„é«˜æ°´ä½å—ï¼Œè¿™é‡Œæœ‰ç‚¹æ‡µäº† <br></div>
                            <span class="time">2018-12-03 18:49</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ è®¾è®¡ä¸€ä¸ªâ€œæ¯”ä½æ°´ä½å¤§ï¼Œä½†æ˜¯åœ¨å½“å‰äº‹åŠ¡å¯åŠ¨å‰ï¼Œå°±å·²ç»æäº¤äº†çš„ä¾‹å­ğŸ˜„</p>
                                <p class="reply-time">2018-12-03 22:02</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f3/2d/711d73b2.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è–›ç•…</span>
                            </div>
                            <div class="bd">è¯„è®ºåŒºçš„å¥½å¤šç•™è¨€éƒ½è®¤ä¸º up_limit_id æ˜¯å·²ç»æäº¤äº‹åŠ¡ id çš„æœ€å¤§å€¼ï¼Œä½†æ˜¯è€å¸ˆå¹¶æœªæŒ‡å‡ºæœ‰ä½•ä¸å¯¹ï¼Œè¿™è®©æˆ‘å¾ˆå›°æƒ‘ã€‚<br>è€å¸ˆåœ¨ç¬¬äºŒç‰ˆçš„æ–‡ç« ä¸­é€šç¯‡æœªæ up_limit_idï¼Œä½†æ˜¯æ–‡ç« ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼šâ€œInnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨â€œæ´»è·ƒâ€çš„æ‰€æœ‰äº‹åŠ¡ IDã€‚â€œæ´»è·ƒâ€æŒ‡çš„å°±æ˜¯ï¼Œå¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤ã€‚æ•°ç»„é‡Œé¢äº‹åŠ¡ ID çš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼åŠ  1 è®°ä¸ºé«˜æ°´ä½â€ã€‚é‚£ä¹ˆè¿™ä¸ª up_limit_id æŒ‡çš„æ˜¯ä¸æ˜¯æ•°ç»„é‡Œé¢äº‹åŠ¡ ID çš„æœ€å°å€¼ï¼Œå‡å¦‚æ˜¯çš„è¯ï¼Œé‚£ä¹ˆ up_limit_id å¹¶ä¸æ˜¯å·²ç»æäº¤äº‹åŠ¡ id çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯æ´»è·ƒäº‹ç‰©çš„æœ€å°å€¼ã€‚ <br></div>
                            <span class="time">2018-12-03 13:49</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åœ¨è¿™ç‰ˆé‡Œé¢å°±æ˜¯ç”¨â€œä½æ°´ä½â€æ¥ä½œä¸ºæ´»è·ƒçš„æœ€å°IDçš„æ¦‚å¿µï¼Œ<br><br>å—¯å…¶å®æ˜¯ä¸ºäº†ç†è§£åŸç†ï¼Œç”¨äº†ä¸åŒçš„è¡¨è¿°æ–¹å¼å“ˆã€‚<br><br>åé¢å‘ç°ä¸Šä¸€ç‰ˆçš„æè¿°æ–¹æ³•å¤ªå…¬å¼åŒ–äº†ï¼Œä¸åˆ©äºäººå·¥åˆ†æ</p>
                                <p class="reply-time">2018-12-03 14:11</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">qpm</span>
                            </div>
                            <div class="bd">è¿™æ˜¯å…¸å‹çš„â€œä¸¢å¤±æ›´æ–°â€é—®é¢˜ã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°æ“ä½œè¢«å¦å¤–ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°æ“ä½œè¦†ç›–ã€‚åœ¨RRçŠ¶æ€ä¸‹ï¼Œæ™®é€šselectçš„æ—¶å€™æ˜¯ä¼šè·å¾—æ—§ç‰ˆæœ¬æ•°æ®çš„ï¼Œä½†æ˜¯updateçš„æ—¶å€™å°±æ£€ç´¢åˆ°æœ€æ–°çš„æ•°æ®ã€‚<br>è§£å†³æ–¹æ³•ï¼šåœ¨è¯»å–çš„è¿‡ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªæ’ä»–é”ï¼Œåœ¨ begin äº‹åŠ¡é‡Œï¼Œ select è¯­å¥ä¸­å¢åŠ  for update åç¼€ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åˆ«çš„äº‹åŠ¡åœ¨æ­¤äº‹åŠ¡å®Œæˆcommitå‰æ— æ³•æ“ä½œè®°å½•ã€‚å‚è€ƒã€ŠMySQLæŠ€æœ¯å†…å¹• InnoDBå­˜å‚¨å¼•æ“ã€‹ <br></div>
                            <span class="time">2018-12-01 00:35</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGMibYc0m7cDHMsNRBUur2NPVnlBZFXoNjWomibfjnHeAO3XRt27VaH3WNtdUX11d3uIT1ZHWCxLeg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">york</span>
                            </div>
                            <div class="bd">æ€è€ƒé¢˜ä¸ºä½•æˆ‘åšå‡ºæ¥æˆåŠŸä¿®æ”¹ä¸º0äº†å•Šï¼Ÿ <br></div>
                            <span class="time">2018-11-30 12:44</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é‚£å°±æ˜¯æ²¡å¤ç°ğŸ˜„</p>
                                <p class="reply-time">2018-12-01 10:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Sinyo</span>
                            </div>
                            <div class="bd">åŸæ¥åœ¨åŒä¸€è¡Œæ•°æ®ï¼Œæœ€æ–°ç‰ˆæœ¬çš„ row trx_id æ˜¯å¯èƒ½ä¼šå°äºæ—§ç‰ˆæœ¬çš„ row trx_idçš„ï¼Œè¿™é‡Œæ‰ææ˜ç™½(æƒ­æ„§è„¸)ã€‚ã€‚ <br></div>
                            <span class="time">2018-12-07 10:05</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">èµï¼Œè¿™ä¸ªæƒ³é€šçš„æ„Ÿè§‰æ˜¯å¾ˆçˆ½çš„</p>
                                <p class="reply-time">2018-12-07 11:23</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/6e/50/c85284da.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Sawyer</span>
                            </div>
                            <div class="bd">ç®€å•çš„æ€»ç»“ä¸€ä¸‹ï¼š<br>1. ä¸€è‡´æ€§è¯†å›¾ï¼Œä¿è¯äº†å½“å‰äº‹åŠ¡ä»å¯åŠ¨åˆ°æäº¤æœŸé—´ï¼Œè¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ˆåŒ…æ‹¬å½“å‰äº‹åŠ¡çš„ä¿®æ”¹ï¼‰ã€‚<br>2. å½“å‰è¯»ï¼Œä¿è¯äº†å½“å‰äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¸ä¼šä¸¢å¤±å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„ä¿®æ”¹ã€‚<br>3. ä¸¤é˜¶æ®µé”åè®®ï¼Œä¿è¯äº†å½“å‰äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¸ä¼šä¸¢å¤±å…¶ä»–äº‹åŠ¡æœªæäº¤çš„ä¿®æ”¹ã€‚<br>4. RRæ˜¯é€šè¿‡äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºä¸€è‡´æ€§è¯†å›¾æ¥å®ç°ï¼ŒRCæ˜¯è¯­å¥æ‰§è¡Œæ—¶åˆ›å»ºä¸€è‡´æ€§è¯†å›¾æ¥å®ç°ã€‚ <br></div>
                            <span class="time">2018-12-03 14:10</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/e9/0b/53bf91d3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WL</span>
                            </div>
                            <div class="bd">æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆ, åœ¨æ•°æ®å¯è§æ€§è§„åˆ™é‚£ä¸€éƒ¨åˆ†ä¸­çš„ç¬¬ä¸‰ç§å¯èƒ½çš„bæƒ…å†µ: &quot;è‹¥ row trx_id ä¸åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¯è§ã€‚&quot;å¯¹äºè¿™éƒ¨åˆ†å†…å®¹æˆ‘å¼€å§‹ä¸æ˜¯å¾ˆç†è§£, åæ¥åå¤æ€è€ƒäº†ä¸€ä¸‹, å¯è§æ€§è§„åˆ™è¿™éƒ¨åˆ†æ˜¯ä¸æ˜¯åœ¨è¯´æ˜è¿™ç§æƒ…å†µ:  å› ä¸ºæ•°æ®çš„row trx_idæ˜¯ä¾æ¬¡é€’å¢çš„, ä½†æ˜¯äº‹åŠ¡ç”±äºåˆ›å»ºå’Œæäº¤çš„æ—¶é—´ä¸å¯é¢„æœŸæ‰€ä»¥transactionIdå¯èƒ½æ˜¯è·³è·ƒçš„, æ‰€ä»¥å‡å¦‚æœ‰äº‹åŠ¡A, æ¯”Açš„transactionIdå¤§çš„æ•°æ®çš„row trx_idå¯¹äºäº‹åŠ¡Aä¸€å®šä¸å¯è§, ä½†æ˜¯æ¯”Açš„transactionIdå°çš„æ•°æ®çš„row trx_idä¹Ÿå¯èƒ½åœ¨Açš„äº‹åŠ¡æ•°ç»„ä¸­, æ‰€ä»¥è¦åˆ¤æ–­ä¸€æ¬¡. ä¸çŸ¥é“è¿™ä¹ˆç†è§£å¯¹ä¸å¯¹? <br></div>
                            <span class="time">2018-12-08 14:54</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„ï¼Œæœ€åè¿™ä¸ªâ€œå¯èƒ½â€è¯´å¾—å¾ˆå¥½ï¼Œ<br>å¯èƒ½åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸åœ¨ï¼Œå°±ç”¨â€œæ˜¯å¦åœ¨æ•°ç»„ä¸­â€æ¥åˆ¤æ–­</p>
                                <p class="reply-time">2018-12-09 13:31</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¿¡ä¿¡</span>
                            </div>
                            <div class="bd">è€å¸ˆæ‚¨å¥½ï¼Œæœ‰å¤„ç–‘é—®ï¼Œæ–‡ä¸­è¯´ï¼šâ€œå¯¹äºå›¾ 2 ä¸­çš„æ•°æ®æ¥è¯´ï¼Œå¦‚æœæœ‰ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒçš„ä½æ°´ä½æ˜¯ 18ï¼Œé‚£ä¹ˆå½“å®ƒè®¿é—®è¿™ä¸€è¡Œæ•°æ®æ—¶ï¼Œå°±ä¼šä» V4 é€šè¿‡ U3 è®¡ç®—å‡º V3ã€‚â€çœ‹ä¸Šå»åƒæ˜¯ä¸€å®šä¼šå–å°äºä½æ°´ä½çš„å€¼ã€‚é‚£å‡å¦‚æˆ‘çš„äº‹åŠ¡idæ˜¯27ï¼Œæ´»è·ƒæ•°ç»„æ˜¯18ï¼Œ19ï¼Œ26ï¼Œè¿™æ ·çš„è¯äº‹åŠ¡idä¸º25çš„æ•°æ®æˆ‘ä¹Ÿè®¤å‘€ã€‚æ³è¯·è€å¸ˆè§£æƒ‘ã€‚ <br></div>
                            <span class="time">2018-12-04 00:27</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è¿™ä¸ªå¿…é¡»è¦å•ç‹¬å›å¤ä¸€ä¸‹è€å¸ˆï¼š<br>æˆ‘çš„æ‰€æœ‰ç•™è¨€è€å¸ˆéƒ½ä¸€ä¸€å›å¤ï¼Œé—®é¢˜å…¨éƒ¨éƒ½è§£é‡Šçš„å¾ˆæ¸…æ¥šã€‚åœ¨å­¦æ ¡å…¶å®mysqlç”¨çš„éå¸¸ç®€å•ï¼ŒçœŸçš„è¦è¯´ä¸€ä¸‹è¿™ä¸ªè¯¾å®åœ¨å¤ªå¥½äº†ï¼ŒæŠŠåŸç†è®²å¾—ç®€å•æ˜“æ‡‚ï¼Œå¹¶ä¸”è¯„è®ºé‡Œçš„è®¨è®ºåŠ æ·±äº†è‡ªå·±çš„è®¤çŸ¥ã€‚<br>æ‰€ä»¥çœŸçš„å¾ˆæ„Ÿè°¢è€å¸ˆ~~æ„Ÿè°¢æ„Ÿè°¢ <br></div>
                            <span class="time">2018-12-12 12:03</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¹Ÿè°¢è°¢ä½ ï¼Œè¯´æ˜ä½ çš„é—®é¢˜è´¨é‡é«˜å“¦ã€‚<br><br>å…¶å®æˆ‘æ²¡æœ‰å›å¤å¤§å®¶æ‰€æœ‰çš„è¯„è®ºï¼Œ<br>ä¸è¿‡é—®å¾—è®¤çœŸè¯¦ç»†çš„ã€åˆè·Ÿå…¶ä»–åŒå­¦é—®é¢˜ä¸é‡å¤çš„é—®é¢˜ï¼Œæˆ‘ä¼šå°½é‡å…¨éƒ¨å›å¤ï¼Œ<br><br>å› ä¸ºæŠŠé—®é¢˜é—®æ¸…æ¥šæœ¬èº«æ˜¯è¦èŠ±å¿ƒæ€çš„ï¼Œä¸èƒ½è¾œè´Ÿå‘€<br><br><br></p>
                                <p class="reply-time">2018-12-12 18:04</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/c5/5e/24cc5a72.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é˜¿ç‹¸çˆ±JAVA</span>
                            </div>
                            <div class="bd">åªæ˜¯ç†è§£ä¸€ä¸‹è¿™æ„Ÿè§‰èº«ä½“è¢«æç©ºï¼Œå¦‚æœä¸ºæˆ‘è‡ªå·±å»å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œæˆ‘åªæƒ³é™é™ï¼Œä½•å†µæˆ‘çœ‹åˆ°çš„åªæ˜¯å†°å±±ä¸€è§’ã€‚ä¸å¾—ä¸è¯´å¾ˆä½©æœğŸ‘ <br></div>
                            <span class="time">2018-12-12 12:00</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>