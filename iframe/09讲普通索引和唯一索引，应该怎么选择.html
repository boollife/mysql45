<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                09è®²æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/91/8c/91e44e4672ed4d966b2ea312b98b568c.jpg">

                <div>
                  <audio controls="controls" height="100" width="100">
                    <source src="09è®²æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©.mp3" type="audio/mp3" />
                    <embed height="100" width="100" src="09è®²æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œåº”è¯¥æ€ä¹ˆé€‰æ‹©.mp3" />
                  </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p><span class="reference">ä»Šå¤©çš„æ­£æ–‡å¼€å§‹å‰ï¼Œæˆ‘è¦ç‰¹æ„æ„Ÿè°¢ä¸€ä¸‹è¯„è®ºåŒºå‡ ä½ç•™ä¸‹é«˜è´¨é‡ç•™è¨€çš„åŒå­¦ã€‚</span></p><p><span class="reference">ç”¨æˆ·åæ˜¯ @æŸã€äºº çš„åŒå­¦ï¼Œå¯¹æ–‡ç« çš„çŸ¥è¯†ç‚¹åšäº†æ¢³ç†ï¼Œç„¶åæäº†å…³äºäº‹åŠ¡å¯è§æ€§çš„é—®é¢˜ï¼Œå°±æ˜¯å…ˆå¯åŠ¨ä½†æ˜¯åæäº¤çš„äº‹åŠ¡ï¼Œå¯¹æ•°æ®å¯è§æ€§çš„å½±å“ã€‚@å¤æ—¥é›¨åŒå­¦ä¹Ÿæåˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åœ¨ç½®é¡¶è¯„è®ºä¸­å›å¤äº†ï¼Œä»Šå¤©çš„æ–‡ç« æœ«å°¾ä¹Ÿä¼šå†å±•å¼€è¯´æ˜ã€‚@Justinå’Œ@å€ªå¤§äººä¸¤ä½åŒå­¦æäº†ä¸¤ä¸ªå¥½é—®é¢˜ã€‚</span></p><p><span class="reference">å¯¹äºèƒ½å¤Ÿå¼•å‘æ›´æ·±ä¸€æ­¥æ€è€ƒçš„é—®é¢˜ï¼Œæˆ‘ä¼šåœ¨å›å¤çš„å†…å®¹ä¸­å†™ä¸Šâ€œå¥½é—®é¢˜â€ä¸‰ä¸ªå­—ï¼Œæ–¹ä¾¿ä½ æœç´¢ï¼Œä½ ä¹Ÿå¯ä»¥å»çœ‹çœ‹ä»–ä»¬çš„ç•™è¨€ã€‚</span></p><p><span class="reference">éå¸¸æ„Ÿè°¢å¤§å®¶å¾ˆç»†è‡´åœ°çœ‹æ–‡ç« ï¼Œå¹¶ä¸”ç•™ä¸‹äº†é‚£ä¹ˆå¤šå’Œå¾ˆé«˜è´¨é‡çš„ç•™è¨€ã€‚çŸ¥é“æ–‡ç« æœ‰ç»™å¤§å®¶å¸¦æ¥ä¸€äº›æ–°ç†è§£ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¼“åŠ±ã€‚åŒæ—¶ï¼Œä¹Ÿè®©å…¶ä»–è®¤çœŸçœ‹è¯„è®ºåŒºçš„åŒå­¦ï¼Œæœ‰æœºä¼šå‘ç°ä¸€äº›è‡ªå·±è¿˜æ²¡æœ‰æ„è¯†åˆ°çš„ã€ä½†å¯èƒ½è¿˜ä¸æ¸…æ™°çš„çŸ¥è¯†ç‚¹ï¼Œè¿™ä¹Ÿåœ¨æ€»ä½“ä¸Šæé«˜äº†æ•´ä¸ªä¸“æ çš„è´¨é‡ã€‚å†æ¬¡è°¢è°¢ä½ ä»¬ã€‚</span></p><p><span class="reference">å¥½äº†ï¼Œç°åœ¨å°±å›åˆ°æˆ‘ä»¬ä»Šå¤©çš„æ­£æ–‡å†…å®¹ã€‚</span></p><p>åœ¨å‰é¢çš„åŸºç¡€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç»™ä½ ä»‹ç»è¿‡ç´¢å¼•çš„åŸºæœ¬æ¦‚å¿µï¼Œç›¸ä¿¡ä½ å·²ç»äº†è§£äº†å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„åŒºåˆ«ã€‚ä»Šå¤©æˆ‘ä»¬å°±ç»§ç»­æ¥è°ˆè°ˆï¼Œåœ¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œåº”è¯¥é€‰æ‹©æ™®é€šç´¢å¼•ï¼Œè¿˜æ˜¯å”¯ä¸€ç´¢å¼•ï¼Ÿ</p><p>å‡è®¾ä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå¸‚æ°‘ç³»ç»Ÿï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„èº«ä»½è¯å·ï¼Œè€Œä¸”ä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥ä¸¤ä¸ªé‡å¤çš„èº«ä»½è¯å·ã€‚å¦‚æœå¸‚æ°‘ç³»ç»Ÿéœ€è¦æŒ‰ç…§èº«ä»½è¯å·æŸ¥å§“åï¼Œå°±ä¼šæ‰§è¡Œç±»ä¼¼è¿™æ ·çš„SQLè¯­å¥ï¼š</p><!-- [[[read_end]]] --><pre><code>select name from CUser where id_card = 'xxxxxxxyyyyyyzzzzz';
</code></pre><p>æ‰€ä»¥ï¼Œä½ ä¸€å®šä¼šè€ƒè™‘åœ¨id_cardå­—æ®µä¸Šå»ºç´¢å¼•ã€‚</p><p>ç”±äºèº«ä»½è¯å·å­—æ®µæ¯”è¾ƒå¤§ï¼Œæˆ‘ä¸å»ºè®®ä½ æŠŠèº«ä»½è¯å·å½“åšä¸»é”®ï¼Œé‚£ä¹ˆç°åœ¨ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œè¦ä¹ˆç»™id_cardå­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œè¦ä¹ˆåˆ›å»ºä¸€ä¸ªæ™®é€šç´¢å¼•ã€‚å¦‚æœä¸šåŠ¡ä»£ç å·²ç»ä¿è¯äº†ä¸ä¼šå†™å…¥é‡å¤çš„èº«ä»½è¯å·ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªé€‰æ‹©é€»è¾‘ä¸Šéƒ½æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç°åœ¨æˆ‘è¦é—®ä½ çš„æ˜¯ï¼Œä»æ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œä½ é€‰æ‹©å”¯ä¸€ç´¢å¼•è¿˜æ˜¯æ™®é€šç´¢å¼•å‘¢ï¼Ÿé€‰æ‹©çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ç¬¬4ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/69236">ã€Šæ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸Šï¼‰ã€‹</a>ä¸­çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå‡è®¾å­—æ®µ k ä¸Šçš„å€¼éƒ½ä¸é‡å¤ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/1e/46/1ed9536031d6698570ea175a7b7f9a46.png" alt=""></p><center>å›¾1 InnoDBçš„ç´¢å¼•ç»„ç»‡ç»“æ„</center><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸¤ç§ç´¢å¼•å¯¹æŸ¥è¯¢è¯­å¥å’Œæ›´æ–°è¯­å¥çš„æ€§èƒ½å½±å“æ¥è¿›è¡Œåˆ†æã€‚</p><h1>æŸ¥è¯¢è¿‡ç¨‹</h1><p>å‡è®¾ï¼Œæ‰§è¡ŒæŸ¥è¯¢çš„è¯­å¥æ˜¯ select id from T where k=5ã€‚è¿™ä¸ªæŸ¥è¯¢è¯­å¥åœ¨ç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾çš„è¿‡ç¨‹ï¼Œå…ˆæ˜¯é€šè¿‡B+æ ‘ä»æ ‘æ ¹å¼€å§‹ï¼ŒæŒ‰å±‚æœç´¢åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­å³ä¸‹è§’çš„è¿™ä¸ªæ•°æ®é¡µï¼Œç„¶åå¯ä»¥è®¤ä¸ºæ•°æ®é¡µå†…éƒ¨é€šè¿‡äºŒåˆ†æ³•æ¥å®šä½è®°å½•ã€‚</p><ul>
<li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•(5,500)åï¼Œéœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç›´åˆ°ç¢°åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³k=5æ¡ä»¶çš„è®°å½•ã€‚</li>
<li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œç”±äºç´¢å¼•å®šä¹‰äº†å”¯ä¸€æ€§ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åï¼Œå°±ä¼šåœæ­¢ç»§ç»­æ£€ç´¢ã€‚</li>
</ul><p>é‚£ä¹ˆï¼Œè¿™ä¸ªä¸åŒå¸¦æ¥çš„æ€§èƒ½å·®è·ä¼šæœ‰å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œå¾®ä¹å…¶å¾®ã€‚</p><p>ä½ çŸ¥é“çš„ï¼ŒInnoDBçš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éœ€è¦è¯»ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å°†è¿™ä¸ªè®°å½•æœ¬èº«ä»ç£ç›˜è¯»å‡ºæ¥ï¼Œè€Œæ˜¯ä»¥é¡µä¸ºå•ä½ï¼Œå°†å…¶æ•´ä½“è¯»å…¥å†…å­˜ã€‚åœ¨InnoDBä¸­ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯16KBã€‚</p><p>å› ä¸ºå¼•æ“æ˜¯æŒ‰é¡µè¯»å†™çš„ï¼Œæ‰€ä»¥è¯´ï¼Œå½“æ‰¾åˆ°k=5çš„è®°å½•çš„æ—¶å€™ï¼Œå®ƒæ‰€åœ¨çš„æ•°æ®é¡µå°±éƒ½åœ¨å†…å­˜é‡Œäº†ã€‚é‚£ä¹ˆï¼Œå¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œè¦å¤šåšçš„é‚£ä¸€æ¬¡â€œæŸ¥æ‰¾å’Œåˆ¤æ–­ä¸‹ä¸€æ¡è®°å½•â€çš„æ“ä½œï¼Œå°±åªéœ€è¦ä¸€æ¬¡æŒ‡é’ˆå¯»æ‰¾å’Œä¸€æ¬¡è®¡ç®—ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœk=5è¿™ä¸ªè®°å½•åˆšå¥½æ˜¯è¿™ä¸ªæ•°æ®é¡µçš„æœ€åä¸€ä¸ªè®°å½•ï¼Œé‚£ä¹ˆè¦å–ä¸‹ä¸€ä¸ªè®°å½•ï¼Œå¿…é¡»è¯»å–ä¸‹ä¸€ä¸ªæ•°æ®é¡µï¼Œè¿™ä¸ªæ“ä½œä¼šç¨å¾®å¤æ‚ä¸€äº›ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹‹å‰è®¡ç®—è¿‡ï¼Œå¯¹äºæ•´å‹å­—æ®µï¼Œä¸€ä¸ªæ•°æ®é¡µå¯ä»¥æ”¾è¿‘åƒä¸ªkeyï¼Œå› æ­¤å‡ºç°è¿™ç§æƒ…å†µçš„æ¦‚ç‡ä¼šå¾ˆä½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è®¡ç®—å¹³å‡æ€§èƒ½å·®å¼‚æ—¶ï¼Œä»å¯ä»¥è®¤ä¸ºè¿™ä¸ªæ“ä½œæˆæœ¬å¯¹äºç°åœ¨çš„CPUæ¥è¯´å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p><h1>æ›´æ–°è¿‡ç¨‹</h1><p>ä¸ºäº†è¯´æ˜æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½çš„å½±å“è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦å…ˆè·Ÿä½ ä»‹ç»ä¸€ä¸‹change bufferã€‚</p><p>å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œè€Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­çš„è¯ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInooDBä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨change bufferä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œchange bufferä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶åå­—å«ä½œchange bufferï¼Œå®é™…ä¸Šå®ƒæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange bufferåœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚</p><p>å°†change bufferä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸ºmergeã€‚é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘mergeå¤–ï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸmergeã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œmergeæ“ä½œã€‚</p><p>æ˜¾ç„¶ï¼Œå¦‚æœèƒ½å¤Ÿå°†æ›´æ–°æ“ä½œå…ˆè®°å½•åœ¨change bufferï¼Œå‡å°‘è¯»ç£ç›˜ï¼Œè¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ä¼šå¾—åˆ°æ˜æ˜¾çš„æå‡ã€‚è€Œä¸”ï¼Œæ•°æ®è¯»å…¥å†…å­˜æ˜¯éœ€è¦å ç”¨buffer poolçš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼è¿˜èƒ½å¤Ÿé¿å…å ç”¨å†…å­˜ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>ä»€ä¹ˆæ¡ä»¶ä¸‹å¯ä»¥ä½¿ç”¨change bufferå‘¢ï¼Ÿ</strong></p><p>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸã€‚æ¯”å¦‚ï¼Œè¦æ’å…¥(4,400)è¿™ä¸ªè®°å½•ï¼Œå°±è¦å…ˆåˆ¤æ–­ç°åœ¨è¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨k=4çš„è®°å½•ï¼Œè€Œè¿™å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­ã€‚å¦‚æœéƒ½å·²ç»è¯»å…¥åˆ°å†…å­˜äº†ï¼Œé‚£ç›´æ¥æ›´æ–°å†…å­˜ä¼šæ›´å¿«ï¼Œå°±æ²¡å¿…è¦ä½¿ç”¨change bufferäº†ã€‚</p><p>å› æ­¤ï¼Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°å°±ä¸èƒ½ä½¿ç”¨change bufferï¼Œå®é™…ä¸Šä¹Ÿåªæœ‰æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ã€‚</p><p>change bufferç”¨çš„æ˜¯buffer poolé‡Œçš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§ã€‚change bufferçš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•°innodb_change_buffer_max_sizeæ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º50çš„æ—¶å€™ï¼Œè¡¨ç¤ºchange bufferçš„å¤§å°æœ€å¤šåªèƒ½å ç”¨buffer poolçš„50%ã€‚</p><p>ç°åœ¨ï¼Œä½ å·²ç»ç†è§£äº†change bufferçš„æœºåˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†ä¸€èµ·æ¥çœ‹çœ‹<strong>å¦‚æœè¦åœ¨è¿™å¼ è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è®°å½•(4,400)çš„è¯ï¼ŒInnoDBçš„å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ã€‚</strong></p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œ<strong>è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µåœ¨å†…å­˜ä¸­</strong>ã€‚è¿™æ—¶ï¼ŒInnoDBçš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ul>
<li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ°3å’Œ5ä¹‹é—´çš„ä½ç½®ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›</li>
<li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œæ‰¾åˆ°3å’Œ5ä¹‹é—´çš„ä½ç½®ï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸã€‚</li>
</ul><p>è¿™æ ·çœ‹æ¥ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å¯¹æ›´æ–°è¯­å¥æ€§èƒ½å½±å“çš„å·®åˆ«ï¼Œåªæ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œåªä¼šè€—è´¹å¾®å°çš„CPUæ—¶é—´ã€‚</p><p>ä½†ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œ<strong>è¿™ä¸ªè®°å½•è¦æ›´æ–°çš„ç›®æ ‡é¡µä¸åœ¨å†…å­˜ä¸­</strong>ã€‚è¿™æ—¶ï¼ŒInnoDBçš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ul>
<li>å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œéœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­åˆ°æ²¡æœ‰å†²çªï¼Œæ’å…¥è¿™ä¸ªå€¼ï¼Œè¯­å¥æ‰§è¡Œç»“æŸï¼›</li>
<li>å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ˜¯å°†æ›´æ–°è®°å½•åœ¨change bufferï¼Œè¯­å¥æ‰§è¡Œå°±ç»“æŸäº†ã€‚</li>
</ul><p>å°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠéšæœºIOçš„è®¿é—®ï¼Œæ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€ã€‚change bufferå› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡æ˜¯ä¼šå¾ˆæ˜æ˜¾çš„ã€‚</p><p>ä¹‹å‰æˆ‘å°±ç¢°åˆ°è¿‡ä¸€ä»¶äº‹å„¿ï¼Œæœ‰ä¸ªDBAçš„åŒå­¦è·Ÿæˆ‘åé¦ˆè¯´ï¼Œä»–è´Ÿè´£çš„æŸä¸ªä¸šåŠ¡çš„åº“å†…å­˜å‘½ä¸­ç‡çªç„¶ä»99%é™ä½åˆ°äº†75%ï¼Œæ•´ä¸ªç³»ç»Ÿå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ›´æ–°è¯­å¥å…¨éƒ¨å µä½ã€‚è€Œæ¢ç©¶å…¶åŸå› åï¼Œæˆ‘å‘ç°è¿™ä¸ªä¸šåŠ¡æœ‰å¤§é‡æ’å…¥æ•°æ®çš„æ“ä½œï¼Œè€Œä»–åœ¨å‰ä¸€å¤©æŠŠå…¶ä¸­çš„æŸä¸ªæ™®é€šç´¢å¼•æ”¹æˆäº†å”¯ä¸€ç´¢å¼•ã€‚</p><h1>change bufferçš„ä½¿ç”¨åœºæ™¯</h1><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œä½ å·²ç»æ¸…æ¥šäº†ä½¿ç”¨change bufferå¯¹æ›´æ–°è¿‡ç¨‹çš„åŠ é€Ÿä½œç”¨ï¼Œä¹Ÿæ¸…æ¥šäº†change bufferåªé™äºç”¨åœ¨æ™®é€šç´¢å¼•çš„åœºæ™¯ä¸‹ï¼Œè€Œä¸é€‚ç”¨äºå”¯ä¸€ç´¢å¼•ã€‚é‚£ä¹ˆï¼Œç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šæ™®é€šç´¢å¼•çš„æ‰€æœ‰åœºæ™¯ï¼Œä½¿ç”¨change bufferéƒ½å¯ä»¥èµ·åˆ°åŠ é€Ÿä½œç”¨å—ï¼Ÿ</p><p>å› ä¸ºmergeçš„æ—¶å€™æ˜¯çœŸæ­£è¿›è¡Œæ•°æ®æ›´æ–°çš„æ—¶åˆ»ï¼Œè€Œchange bufferçš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µåšmergeä¹‹å‰ï¼Œchange bufferè®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚</p><p>åè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘mergeè¿‡ç¨‹ã€‚è¿™æ ·éšæœºè®¿é—®IOçš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº†change bufferçš„ç»´æŠ¤ä»£ä»·ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchange bufferåè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚</p><h1>ç´¢å¼•é€‰æ‹©å’Œå®è·µ</h1><p>å›åˆ°æˆ‘ä»¬æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼Œæ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•åº”è¯¥æ€ä¹ˆé€‰æ‹©ã€‚å…¶å®ï¼Œè¿™ä¸¤ç±»ç´¢å¼•åœ¨æŸ¥è¯¢èƒ½åŠ›ä¸Šæ˜¯æ²¡å·®åˆ«çš„ï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å¯¹æ›´æ–°æ€§èƒ½çš„å½±å“ã€‚æ‰€ä»¥ï¼Œæˆ‘å»ºè®®ä½ å°½é‡é€‰æ‹©æ™®é€šç´¢å¼•ã€‚</p><p>å¦‚æœæ‰€æœ‰çš„æ›´æ–°åé¢ï¼Œéƒ½é©¬ä¸Šä¼´éšç€å¯¹è¿™ä¸ªè®°å½•çš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆä½ åº”è¯¥å…³é—­change bufferã€‚è€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œchange bufferéƒ½èƒ½æå‡æ›´æ–°æ€§èƒ½ã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œæ™®é€šç´¢å¼•å’Œchange bufferçš„é…åˆä½¿ç”¨ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„è¡¨çš„æ›´æ–°ä¼˜åŒ–è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚</p><p>ç‰¹åˆ«åœ°ï¼Œåœ¨ä½¿ç”¨æœºæ¢°ç¡¬ç›˜æ—¶ï¼Œchange bufferè¿™ä¸ªæœºåˆ¶çš„æ”¶æ•ˆæ˜¯éå¸¸æ˜¾è‘—çš„ã€‚æ‰€ä»¥ï¼Œå½“ä½ æœ‰ä¸€ä¸ªç±»ä¼¼â€œå†å²æ•°æ®â€çš„åº“ï¼Œå¹¶ä¸”å‡ºäºæˆæœ¬è€ƒè™‘ç”¨çš„æ˜¯æœºæ¢°ç¡¬ç›˜æ—¶ï¼Œé‚£ä½ åº”è¯¥ç‰¹åˆ«å…³æ³¨è¿™äº›è¡¨é‡Œçš„ç´¢å¼•ï¼Œå°½é‡ä½¿ç”¨æ™®é€šç´¢å¼•ï¼Œç„¶åæŠŠchange buffer å°½é‡å¼€å¤§ï¼Œä»¥ç¡®ä¿è¿™ä¸ªâ€œå†å²æ•°æ®â€è¡¨çš„æ•°æ®å†™å…¥é€Ÿåº¦ã€‚</p><h1>change buffer å’Œ redo log</h1><p>ç†è§£äº†change bufferçš„åŸç†ï¼Œä½ å¯èƒ½ä¼šè”æƒ³åˆ°æˆ‘åœ¨å‰é¢æ–‡ç« ä¸­å’Œä½ ä»‹ç»è¿‡çš„redo logå’ŒWALã€‚</p><p>åœ¨å‰é¢æ–‡ç« çš„è¯„è®ºä¸­ï¼Œæˆ‘å‘ç°æœ‰åŒå­¦æ··æ·†äº†redo logå’Œchange bufferã€‚WAL æå‡æ€§èƒ½çš„æ ¸å¿ƒæœºåˆ¶ï¼Œä¹Ÿçš„ç¡®æ˜¯å°½é‡å‡å°‘éšæœºè¯»å†™ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µç¡®å®å®¹æ˜“æ··æ·†ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘æŠŠå®ƒä»¬æ”¾åˆ°äº†åŒä¸€ä¸ªæµç¨‹é‡Œæ¥è¯´æ˜ï¼Œä¾¿äºä½ åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚</p><blockquote>
<p>å¤‡æ³¨ï¼šè¿™é‡Œï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ç¬¬2ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/68633">ã€Šæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p>
</blockquote><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¦åœ¨è¡¨ä¸Šæ‰§è¡Œè¿™ä¸ªæ’å…¥è¯­å¥ï¼š</p><pre><code>mysql&gt; insert into t(id,k) values(id1,k1),(id2,k2);
</code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬å‡è®¾å½“å‰kç´¢å¼•æ ‘çš„çŠ¶æ€ï¼ŒæŸ¥æ‰¾åˆ°ä½ç½®åï¼Œk1æ‰€åœ¨çš„æ•°æ®é¡µåœ¨å†…å­˜(InnoDB buffer pool)ä¸­ï¼Œk2æ‰€åœ¨çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­ã€‚å¦‚å›¾2æ‰€ç¤ºæ˜¯å¸¦change bufferçš„æ›´æ–°çŠ¶æ€å›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/98/a3/980a2b786f0ea7adabef2e64fb4c4ca3.png" alt=""></p><center>å›¾2 å¸¦change bufferçš„æ›´æ–°è¿‡ç¨‹</center><p>åˆ†æè¿™æ¡æ›´æ–°è¯­å¥ï¼Œä½ ä¼šå‘ç°å®ƒæ¶‰åŠäº†å››ä¸ªéƒ¨åˆ†ï¼šå†…å­˜ã€redo logï¼ˆib_log_fileXï¼‰ã€ æ•°æ®è¡¨ç©ºé—´ï¼ˆt.ibdï¼‰ã€ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆibdata1ï¼‰ã€‚</p><p>è¿™æ¡æ›´æ–°è¯­å¥åšäº†å¦‚ä¸‹çš„æ“ä½œï¼ˆæŒ‰ç…§å›¾ä¸­çš„æ•°å­—é¡ºåºï¼‰ï¼š</p><ol>
<li>
<p>Page 1åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æ›´æ–°å†…å­˜ï¼›</p>
</li>
<li>
<p>Page 2æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±åœ¨å†…å­˜çš„change bufferåŒºåŸŸï¼Œè®°å½•ä¸‹â€œæˆ‘è¦å¾€Page 2æ’å…¥ä¸€è¡Œâ€è¿™ä¸ªä¿¡æ¯</p>
</li>
<li>
<p>å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥redo logä¸­ï¼ˆå›¾ä¸­3å’Œ4ï¼‰ã€‚</p>
</li>
</ol><p>åšå®Œä¸Šé¢è¿™äº›ï¼Œäº‹åŠ¡å°±å¯ä»¥å®Œæˆäº†ã€‚æ‰€ä»¥ï¼Œä½ ä¼šçœ‹åˆ°ï¼Œæ‰§è¡Œè¿™æ¡æ›´æ–°è¯­å¥çš„æˆæœ¬å¾ˆä½ï¼Œå°±æ˜¯å†™äº†ä¸¤å¤„å†…å­˜ï¼Œç„¶åå†™äº†ä¸€å¤„ç£ç›˜ï¼ˆä¸¤æ¬¡æ“ä½œåˆåœ¨ä¸€èµ·å†™äº†ä¸€æ¬¡ç£ç›˜ï¼‰ï¼Œè€Œä¸”è¿˜æ˜¯é¡ºåºå†™çš„ã€‚</p><p>åŒæ—¶ï¼Œå›¾ä¸­çš„ä¸¤ä¸ªè™šçº¿ç®­å¤´ï¼Œæ˜¯åå°æ“ä½œï¼Œä¸å½±å“æ›´æ–°çš„å“åº”æ—¶é—´ã€‚</p><p>é‚£åœ¨è¿™ä¹‹åçš„è¯»è¯·æ±‚ï¼Œè¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨è¦æ‰§è¡Œ select * from t where k in (k1, k2)ã€‚è¿™é‡Œï¼Œæˆ‘ç”»äº†è¿™ä¸¤ä¸ªè¯»è¯·æ±‚çš„æµç¨‹å›¾ã€‚</p><p>å¦‚æœè¯»è¯­å¥å‘ç”Ÿåœ¨æ›´æ–°è¯­å¥åä¸ä¹…ï¼Œå†…å­˜ä¸­çš„æ•°æ®éƒ½è¿˜åœ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„è¿™ä¸¤ä¸ªè¯»æ“ä½œå°±ä¸ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆibdata1ï¼‰å’Œ redo logï¼ˆib_log_fileXï¼‰æ— å…³äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘åœ¨å›¾ä¸­å°±æ²¡ç”»å‡ºè¿™ä¸¤éƒ¨åˆ†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/6d/8e/6dc743577af1dbcbb8550bddbfc5f98e.png" alt=""></p><center>å›¾3 å¸¦change bufferçš„è¯»è¿‡ç¨‹</center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><ol>
<li>
<p>è¯»Page 1çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜è¿”å›ã€‚æœ‰å‡ ä½åŒå­¦åœ¨å‰é¢æ–‡ç« çš„è¯„è®ºä¸­é—®åˆ°ï¼ŒWALä¹‹åå¦‚æœè¯»æ•°æ®ï¼Œæ˜¯ä¸æ˜¯ä¸€å®šè¦è¯»ç›˜ï¼Œæ˜¯ä¸æ˜¯ä¸€å®šè¦ä»redo logé‡Œé¢æŠŠæ•°æ®æ›´æ–°ä»¥åæ‰å¯ä»¥è¿”å›ï¼Ÿå…¶å®æ˜¯ä¸ç”¨çš„ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹å›¾3çš„è¿™ä¸ªçŠ¶æ€ï¼Œè™½ç„¶ç£ç›˜ä¸Šè¿˜æ˜¯ä¹‹å‰çš„æ•°æ®ï¼Œä½†æ˜¯è¿™é‡Œç›´æ¥ä»å†…å­˜è¿”å›ç»“æœï¼Œç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p>
</li>
<li>
<p>è¦è¯»Page 2çš„æ—¶å€™ï¼Œéœ€è¦æŠŠPage 2ä»ç£ç›˜è¯»å…¥å†…å­˜ä¸­ï¼Œç„¶ååº”ç”¨change bufferé‡Œé¢çš„æ“ä½œæ—¥å¿—ï¼Œç”Ÿæˆä¸€ä¸ªæ­£ç¡®çš„ç‰ˆæœ¬å¹¶è¿”å›ç»“æœã€‚</p>
</li>
</ol><p>å¯ä»¥çœ‹åˆ°ï¼Œç›´åˆ°éœ€è¦è¯»Page 2çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®é¡µæ‰ä¼šè¢«è¯»å…¥å†…å­˜ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœè¦ç®€å•åœ°å¯¹æ¯”è¿™ä¸¤ä¸ªæœºåˆ¶åœ¨æå‡æ›´æ–°æ€§èƒ½ä¸Šçš„æ”¶ç›Šçš„è¯ï¼Œ<strong>redo log ä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„IOæ¶ˆè€—ï¼ˆè½¬æˆé¡ºåºå†™ï¼‰ï¼Œè€Œchange bufferä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„IOæ¶ˆè€—ã€‚</strong></p><h1>å°ç»“</h1><p>ä»Šå¤©ï¼Œæˆ‘ä»æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©å¼€å§‹ï¼Œå’Œä½ åˆ†äº«äº†æ•°æ®çš„æŸ¥è¯¢å’Œæ›´æ–°è¿‡ç¨‹ï¼Œç„¶åè¯´æ˜äº†change bufferçš„æœºåˆ¶ä»¥åŠåº”ç”¨åœºæ™¯ï¼Œæœ€åè®²åˆ°äº†ç´¢å¼•é€‰æ‹©çš„å®è·µã€‚</p><p>ç”±äºå”¯ä¸€ç´¢å¼•ç”¨ä¸ä¸Šchange bufferçš„ä¼˜åŒ–æœºåˆ¶ï¼Œå› æ­¤å¦‚æœä¸šåŠ¡å¯ä»¥æ¥å—ï¼Œä»æ€§èƒ½è§’åº¦å‡ºå‘æˆ‘å»ºè®®ä½ ä¼˜å…ˆè€ƒè™‘éå”¯ä¸€ç´¢å¼•ã€‚</p><p>æœ€åï¼Œåˆåˆ°äº†æ€è€ƒé¢˜æ—¶é—´ã€‚</p><p>é€šè¿‡å›¾2ä½ å¯ä»¥çœ‹åˆ°ï¼Œchange bufferä¸€å¼€å§‹æ˜¯å†™å†…å­˜çš„ï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªæ—¶å€™æœºå™¨æ‰ç”µé‡å¯ï¼Œä¼šä¸ä¼šå¯¼è‡´change bufferä¸¢å¤±å‘¢ï¼Ÿchange bufferä¸¢å¤±å¯ä¸æ˜¯å°äº‹å„¿ï¼Œå†ä»ç£ç›˜è¯»å…¥æ•°æ®å¯å°±æ²¡æœ‰äº†mergeè¿‡ç¨‹ï¼Œå°±ç­‰äºæ˜¯æ•°æ®ä¸¢å¤±äº†ã€‚ä¼šä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><p><strong>è¡¥å……ï¼š</strong><br>
è¯„è®ºåŒºå¤§å®¶å¯¹â€œæ˜¯å¦ä½¿ç”¨å”¯ä¸€ç´¢å¼•â€æœ‰æ¯”è¾ƒå¤šçš„è®¨è®ºï¼Œä¸»è¦æ˜¯çº ç»“åœ¨â€œä¸šåŠ¡å¯èƒ½æ— æ³•ç¡®ä¿â€çš„æƒ…å†µã€‚è¿™é‡Œï¼Œæˆ‘å†è¯´æ˜ä¸€ä¸‹ï¼š</p><ul>
<li>é¦–å…ˆï¼Œä¸šåŠ¡æ­£ç¡®æ€§ä¼˜å…ˆã€‚å’±ä»¬è¿™ç¯‡æ–‡ç« çš„å‰ææ˜¯â€œä¸šåŠ¡ä»£ç å·²ç»ä¿è¯ä¸ä¼šå†™å…¥é‡å¤æ•°æ®â€çš„æƒ…å†µä¸‹ï¼Œè®¨è®ºæ€§èƒ½é—®é¢˜ã€‚å¦‚æœä¸šåŠ¡ä¸èƒ½ä¿è¯ï¼Œæˆ–è€…ä¸šåŠ¡å°±æ˜¯è¦æ±‚æ•°æ®åº“æ¥åšçº¦æŸï¼Œé‚£ä¹ˆæ²¡å¾—é€‰ï¼Œå¿…é¡»åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ¬ç¯‡æ–‡ç« çš„æ„ä¹‰åœ¨äºï¼Œå¦‚æœç¢°ä¸Šäº†å¤§é‡æ’å…¥æ•°æ®æ…¢ã€å†…å­˜å‘½ä¸­ç‡ä½çš„æ—¶å€™ï¼Œå¯ä»¥ç»™ä½ å¤šæä¾›ä¸€ä¸ªæ’æŸ¥æ€è·¯ã€‚</li>
<li>ç„¶åï¼Œåœ¨ä¸€äº›â€œå½’æ¡£åº“â€çš„åœºæ™¯ï¼Œä½ æ˜¯å¯ä»¥è€ƒè™‘ä½¿ç”¨å”¯ä¸€ç´¢å¼•çš„ã€‚æ¯”å¦‚ï¼Œçº¿ä¸Šæ•°æ®åªéœ€è¦ä¿ç•™åŠå¹´ï¼Œç„¶åå†å²æ•°æ®ä¿å­˜åœ¨å½’æ¡£åº“ã€‚è¿™æ—¶å€™ï¼Œå½’æ¡£æ•°æ®å·²ç»æ˜¯ç¡®ä¿æ²¡æœ‰å”¯ä¸€é”®å†²çªäº†ã€‚è¦æé«˜å½’æ¡£æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘æŠŠè¡¨é‡Œé¢çš„å”¯ä¸€ç´¢å¼•æ”¹æˆæ™®é€šç´¢å¼•ã€‚</li>
</ul><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•æ„é€ ä¸€ä¸ªâ€œæ•°æ®æ— æ³•ä¿®æ”¹â€çš„åœºæ™¯ã€‚è¯„è®ºåŒºé‡Œå·²ç»æœ‰ä¸å°‘åŒå­¦ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œè¿™é‡Œæˆ‘å†æè¿°ä¸€ä¸‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/be/ae/be7a4d8af04cdf93aaa11108933559ae.png" alt=""><br>
è¿™æ ·ï¼Œsession Açœ‹åˆ°çš„å°±æ˜¯æˆ‘æˆªå›¾çš„æ•ˆæœäº†ã€‚</p><p>å…¶å®ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§åœºæ™¯ï¼ŒåŒå­¦ä»¬åœ¨ç•™è¨€åŒºéƒ½è¿˜æ²¡æœ‰æåˆ°ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/e2/fa/e24a0689571337959138d787c408defa.png" alt=""></p><p>è¿™ä¸ªæ“ä½œåºåˆ—è·‘å‡ºæ¥ï¼Œsession  Açœ‹çš„å†…å®¹ä¹Ÿæ˜¯èƒ½å¤Ÿå¤ç°æˆ‘æˆªå›¾çš„æ•ˆæœçš„ã€‚è¿™ä¸ªsession Bâ€™å¯åŠ¨çš„äº‹åŠ¡æ¯”Aè¦æ—©ï¼Œå…¶å®æ˜¯ä¸ŠæœŸæˆ‘ä»¬æè¿°äº‹åŠ¡ç‰ˆæœ¬çš„å¯è§æ€§è§„åˆ™æ—¶ç•™çš„å½©è›‹ï¼Œå› ä¸ºè§„åˆ™é‡Œè¿˜æœ‰ä¸€ä¸ªâ€œæ´»è·ƒäº‹åŠ¡çš„åˆ¤æ–­â€ï¼Œæˆ‘æ˜¯å‡†å¤‡ç•™åˆ°è¿™é‡Œå†è¡¥å……çš„ã€‚</p><p>å½“æˆ‘è¯•å›¾åœ¨è¿™é‡Œè®²è¿°å®Œæ•´è§„åˆ™çš„æ—¶å€™ï¼Œå‘ç°ç¬¬8ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/70562">ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹</a>ä¸­çš„è§£é‡Šå¼•å…¥äº†å¤ªå¤šçš„æ¦‚å¿µï¼Œä»¥è‡´äºåˆ†æèµ·æ¥éå¸¸å¤æ‚ã€‚</p><p>å› æ­¤ï¼Œæˆ‘é‡å†™äº†ç¬¬8ç¯‡ï¼Œè¿™æ ·æˆ‘ä»¬äººå·¥å»åˆ¤æ–­å¯è§æ€§çš„æ—¶å€™ï¼Œæ‰ä¼šæ›´æ–¹ä¾¿ã€‚ã€çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘å»ºè®®ä½ èƒ½å¤Ÿå†é‡æ–°æ‰“å¼€ç¬¬8ç¯‡æ–‡ç« å¹¶è®¤çœŸå­¦ä¹ ä¸€æ¬¡ã€‚å¦‚æœå­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»»ä½•é—®é¢˜ï¼Œä¹Ÿæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ã€‘</p><p>ç”¨æ–°çš„æ–¹å¼æ¥åˆ†æsession Bâ€™çš„æ›´æ–°ä¸ºä»€ä¹ˆå¯¹session Aä¸å¯è§å°±æ˜¯ï¼šåœ¨session Aè§†å›¾æ•°ç»„åˆ›å»ºçš„ç¬é—´ï¼Œsession Bâ€™æ˜¯æ´»è·ƒçš„ï¼Œå±äºâ€œç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§â€è¿™ç§æƒ…å†µã€‚</p><p>ä¸šåŠ¡ä¸­å¦‚æœè¦ç»•è¿‡è¿™ç±»é—®é¢˜ï¼Œ@çº¦ä¹¦äºšæä¾›äº†ä¸€ä¸ªâ€œä¹è§‚é”â€çš„è§£æ³•ï¼Œå¤§å®¶å¯ä»¥å»ä¸Šä¸€ç¯‡çš„ç•™è¨€åŒºçœ‹ä¸€ä¸‹ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@æŸã€äººã€@å¤æ—¥é›¨ã€@å‘¨å·˜ã€@æé‡‘åˆš ç­‰åŒå­¦æäº†ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©ç­”æ¡ˆçš„session Bâ€™ çš„æƒ…å†µï¼›<br>
@justin æåˆ°äº†æäº¤å’Œæœªæäº¤ç‰ˆæœ¬çš„åŒºåˆ«å¯¹å¾…ï¼Œ@å€ªå¤§äºº æåˆ°äº†è¯»æäº¤å’Œå½“å‰è¯»çš„åŒºåˆ«ï¼Œéƒ½æ˜¯ç»è¿‡äº†æ€è€ƒåæå‡ºçš„å¥½é—®é¢˜ï¼Œå¤§å®¶å¯ä»¥å»ç•™è¨€åŒºçœ‹çœ‹ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/ce/d9/ce7f4e35916ed1aa49206a53a0547bd9.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">å…ˆå›ç­”ä»Šå¤©çš„é—®é¢˜,ä»Šå¤©çš„ç­”æ¡ˆåº”è¯¥åœ¨æ–‡ç« é‡Œå°±èƒ½æ‰¾åˆ°<br>1.change bufferæœ‰ä¸€éƒ¨åˆ†åœ¨å†…å­˜æœ‰ä¸€éƒ¨åˆ†åœ¨ibdata.<br>åšpurgeæ“ä½œ,åº”è¯¥å°±ä¼šæŠŠchange bufferé‡Œç›¸åº”çš„æ•°æ®æŒä¹…åŒ–åˆ°ibdata<br>2.redo logé‡Œè®°å½•äº†æ•°æ®é¡µçš„ä¿®æ”¹ä»¥åŠchange bufferæ–°å†™å…¥çš„ä¿¡æ¯<br>å¦‚æœæ‰ç”µ,æŒä¹…åŒ–çš„change bufferæ•°æ®å·²ç»purge,ä¸ç”¨æ¢å¤ã€‚ä¸»è¦åˆ†ææ²¡æœ‰æŒä¹…åŒ–çš„æ•°æ®<br>æƒ…å†µåˆåˆ†ä¸ºä»¥ä¸‹å‡ ç§:<br>(1)change bufferå†™å…¥,redo logè™½ç„¶åšäº†fsyncä½†æœªcommit,binlogæœªfsyncåˆ°ç£ç›˜,è¿™éƒ¨åˆ†æ•°æ®ä¸¢å¤±<br>(2)change bufferå†™å…¥,redo logå†™å…¥ä½†æ²¡æœ‰commit,binlogä»¥åŠfsyncåˆ°ç£ç›˜,å…ˆä»binlogæ¢å¤redo log,å†ä»redo logæ¢å¤change buffer<br>(3)change bufferå†™å…¥,redo logå’Œbinlogéƒ½å·²ç»fsync.é‚£ä¹ˆç›´æ¥ä»redo logé‡Œæ¢å¤ã€‚<br><br>è€å¸ˆ,æˆ‘æœ‰å‡ ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹:<br>1.å¦‚æœæ˜¯é’ˆå¯¹éå”¯ä¸€ç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•çš„æ›´æ–°å’Œdeleteè€Œä¸”æ¡ä»¶æ˜¯where ç´¢å¼•å€¼=è¿™ç§æƒ…å†µ,<br>æ˜¯å¦äºŒçº§ç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•å°±æ²¡æœ‰åŒºåˆ«å‘¢<br>2.rræ¨¡å¼ä¸‹,éå”¯ä¸€ç´¢å¼•è¿˜ä¼šåŠ gap,å¼€é”€åº”è¯¥ä¹Ÿä¸ç®—å°å§<br>3.è¿˜æœ‰è€å¸ˆä½ æ˜¯æ€ä¹ˆåˆ¤æ–­å†…å­˜å‘½ä¸­ç‡çš„,æ˜¯hit rateå˜›ï¼Ÿ<br>4.obå¥½åƒå°±æ˜¯è¿™ä¸ªæ€è·¯æ¥åšçš„èšç°‡ç´¢å¼•çš„insertä¼˜åŒ–,ä¸çŸ¥é“æ˜¯æ€ä¹ˆåˆ¤æ–­çš„å”¯ä¸€æ€§<br><br>ç‰¹åˆ«æ„Ÿè°¢è€å¸ˆ,ä»¥å‰çš„çŸ¥è¯†éƒ½æ˜¯å¾ˆç¢ç‰‡åŒ–,æ²¡æœ‰æ·±å…¥çš„å»æ€è€ƒã€‚<br>ç»è¿‡å‡ æœŸçš„å­¦ä¹ ä»¥å,æ„Ÿè§‰æ€è·¯è¶Šæ¥è¶Šå¼€é˜”,ä»¥å‰è§‰å¾—å¾ˆé«˜æ·±çš„çŸ¥è¯†ç‚¹,ç°åœ¨ä¹Ÿæœ‰ç‚¹è±ç„¶å¼€æœ—çš„æ„Ÿè§‰ã€‚ <br></div>
                            <span class="time">2018-12-03 21:51</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åˆ†æå¾ˆèµï¼ŒæŠŠ02ç¯‡å’Œè¿™ç¯‡æ–‡ç« è´¯é€šäº†.<br><br>é—®é¢˜<br>1. è¿™æ—¶å€™è¦â€œå…ˆè¯»åå†™â€ï¼Œè¯»çš„æ—¶å€™æ•°æ®ä¼šè¯»å…¥å†…å­˜ï¼Œæ›´æ–°çš„æ—¶å€™ç›´æ¥æ”¹å†…å­˜ï¼Œå°±ä¸éœ€è¦change bufferäº†<br><br>2. Gapé”å–å†³äºä¸šåŠ¡æ€ä¹ˆç”¨å“ˆã€‚æˆ‘æ„Ÿè§‰ä¸»è¦æ˜¯å› ä¸ºgapé”æ¦‚å¿µæ¯”è¾ƒéš¾è¯´æ¸…ï¼Œå¤§å®¶æœ‰ç‚¹æ”¾å¤§å®ƒçš„æ„æ€äº†å“ˆå“ˆ<br><br>3. Hit rate <br><br>4. æˆ‘ä¸å¤Ÿç†Ÿæ‚‰ï¼Œä¸èƒ½ä¹±å›ç­”è¯¯å¯¼ä½ ğŸ˜„</p>
                                <p class="reply-time">2018-12-03 22:19</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ—æ™“æ–Œ</span>
                            </div>
                            <div class="bd">æŠ±æ­‰åšä¸€ä¸ªåè¯å‹˜è¯¯ï¼ŒæŠŠchange bufferåº”ç”¨åˆ°æ—§çš„æ•°æ®é¡µï¼Œå¾—åˆ°æ–°çš„æ•°æ®é¡µçš„è¿‡ç¨‹ï¼Œåº”è¯¥ç§°ä¸ºmergeæ›´åˆé€‚ã€‚ <br></div>
                            <span class="time">2018-12-04 10:29</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/AwEHMTGSmVsia3WZDyIicBQPAfS11lBZ0yUappicPzfmGDmMwkje1UoqKK3UJ6FCBdsZyiauuV1SEfcrFzWfx9n1RQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è™šçˆ±å‡¯å¹³</span>
                            </div>
                            <div class="bd">æ„Ÿè§‰ä»Šå¤©è¿™ç¯‡é—®é¢˜å¾ˆä¸¥é‡å•Š, é¦–å…ˆè¯´ä¸€ä¸‹æˆ‘æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ change bufferè¿™ä¸ªæ¦‚å¿µ, å¯èƒ½äº§ç”Ÿäº†ä»€ä¹ˆè¯¯ä¼š..<br>æˆ‘ç†è§£çš„æ–‡ä¸­è®²è¿°change bufferçš„ä½œç”¨ä½“ç°åœ¨ é’ˆå¯¹æ™®é€šç´¢å¼•(éä¸»é”®çš„éƒ½æ˜¯äºŒçº§ç´¢å¼•, äºŒçº§ç´¢å¼•åˆåŒ…æ‹¬äº†å”¯ä¸€ç´¢å¼•å’Œæ™®é€šç´¢å¼•)åœ¨æœ‰æ•°æ®updateæ“ä½œ(ä¸åŒ…æ‹¬insert)çš„æ—¶å€™,èƒ½æœ‰å‡å°‘ioå†™æ“ä½œçš„åŠŸèƒ½, è€Œä¸”è¿™ä¸ªæ“ä½œæ˜¯æç°åœ¨æ›´æ–°è¡¨æ•°æ®ä¸Šçš„. ä¸ºä»€ä¹ˆæˆ‘åœ¨è¿™é‡Œä¼šç†è§£æˆupdateæ“ä½œå‘¢.. (InnoDBä¸­è¡¨å°±æ˜¯æŒ‰ç´¢å¼•çš„æ–¹å¼å­˜æ”¾çš„, å³ä½¿æˆ‘ä»¬ä¸ä¸»åŠ¨åˆ›å»ºä¸»é”® ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„row_idæ¥å½“åšä¸»é”®, æ„å‘³ç€è¡¨ä¸€å®šæ˜¯æœ‰ä¸€ä¸ªä¸»é”®, å³å”¯ä¸€ç´¢å¼•. insertæ“ä½œ ä¸€å®šä¼šæ¶‰åŠä¸»é”®ç´¢å¼•çš„å˜åŠ¨, æ‰€ä»¥change bufferé’ˆå¯¹ insert æ˜¯å®Œå…¨æ²¡æœ‰ç”¨çš„å—??) <br><br>é’ˆå¯¹change buffer æˆ‘ç™¾åº¦äº†ä¸€ä¸‹, æœ‰æ–‡ç« æè¿° change buffer æ˜¯é’ˆå¯¹è¡¨ä¸­åŒ…å«æ™®é€šç´¢å¼•çš„è¡¨åœ¨insertæ“ä½œæ—¶, ä¼˜åŒ– æ™®é€šç´¢å¼•çš„æ›´æ–°(åœ¨insertæ—¶,ä¸ä¼šç«‹å³æ›´æ–°æ™®é€šç´¢å¼• è€Œæ˜¯ä¿å­˜åˆ°change bufferå»¶è¿Ÿå¤„ç†). è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½. ä¸çŸ¥é“ è¿™ä¸ªç†è§£æ˜¯å¦æ­£ç¡®å‘¢? <br></div>
                            <span class="time">2018-12-03 13:34</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç¬¬ä¸€æ®µçš„ç†è§£ä¸å‡†ç¡®å“ˆã€‚<br>insertçš„æ—¶å€™ï¼Œå†™ä¸»é”®æ˜¯è‚¯å®šä¸èƒ½ç”¨change bufferäº†ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šè¦å†™å…¶å®ƒç´¢å¼•ï¼Œè€Œå…¶å®ƒç´¢å¼•ä¸­çš„â€œéå”¯ä¸€ç´¢å¼•â€æ˜¯å¯ä»¥ç”¨çš„è¿™ä¸ªæœºåˆ¶çš„ï¼›<br><br>ç¬¬äºŒæ®µï¼Œä½ æœå‡ºæ¥çš„è¿™ä¸ªä¸å¤ªå®Œæ•´ã€‚æ˜¯è¿™æ ·çš„ï¼Œchange bufferçš„å‰èº«æ˜¯insert buffer,åªèƒ½å¯¹insert æ“ä½œä¼˜åŒ–ï¼›åæ¥å‡çº§äº†ï¼Œå¢åŠ äº†update&#47;deleteçš„æ”¯æŒï¼Œåå­—ä¹Ÿæ”¹å«change buffer.<br><br><br><br></p>
                                <p class="reply-time">2018-12-03 14:40</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/e9/0b/53bf91d3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">WL</span>
                            </div>
                            <div class="bd">æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆç³»ç»Ÿè¡¨ç©ºé—´è·Ÿæ•°æ®è¡¨ç©ºé—´è¿™ä¸¤ä¸ªæ¦‚å¿µå„æ˜¯ä»€ä¹ˆæ„æ€. <br></div>
                            <span class="time">2018-12-09 10:52</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç³»ç»Ÿè¡¨ç©ºé—´å°±æ˜¯ç”¨æ¥æ”¾ç³»ç»Ÿä¿¡æ¯çš„ï¼Œæ¯”å¦‚æ•°æ®å­—å…¸ä»€ä¹ˆçš„ï¼Œå¯¹åº”çš„ç£ç›˜æ–‡ä»¶æ˜¯ibdata1, <br>æ•°æ®è¡¨ç©ºé—´å°±æ˜¯ä¸€ä¸ªä¸ªçš„è¡¨æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„ç£ç›˜æ–‡ä»¶å°±æ˜¯ è¡¨å.ibd</p>
                                <p class="reply-time">2018-12-09 19:17</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çº¦ä¹¦äºš</span>
                            </div>
                            <div class="bd">æ—©ï¼Œè¯·æ‚¨çœ‹çœ‹æˆ‘ä»¥ä¸‹ç–‘é—®ï¼š<br>1. çœ‹å®Œåæ„Ÿè§‰ç‰µæ‰¯åˆ°ä¹‹å‰çš„å†…å®¹ï¼Œåˆç³Šæ¶‚äº†ã€‚change bufferç›¸å½“äºæ¨è¿Ÿäº†æ›´æ–°æ“ä½œï¼Œé‚£å¯¹å¹¶å‘æ§åˆ¶ç›¸å…³çš„æ˜¯å¦æœ‰å½±å“ï¼Œæ¯”å¦‚åŠ é”ï¼Ÿæˆ‘ä¸€ç›´ä»¥ä¸ºåŠ é”éœ€è¦æŠŠå…·ä½“çš„æ•°æ®é¡µè¯»åˆ°å†…å­˜ä¸­æ¥ï¼Œæ‰èƒ½åŠ é”ï¼Œç„¶è€Œå¹¶ä¸æ˜¯ï¼Ÿ<br>2. åœ¨change bufferä¸­æœ‰æ­¤è¡Œè®°å½•çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡æ›´æ”¹ï¼Œæ˜¯å¢åŠ ä¸€æ¡è¿˜æ˜¯åŸåœ°ä¿®æ”¹ï¼Ÿ<br>3. purgeè¡Œä¸ºä¹‹ååº”è¯¥ä¸ä¼šå†äº§ç”Ÿredo logäº†å§ï¼Ÿ<br><br>ä»åº”ç”¨å¼€å‘çš„è§’åº¦çœ‹ï¼Œè¿˜æ˜¯ç”±æ•°æ®åº“ä¿è¯å”¯ä¸€å¥½ã€‚ <br></div>
                            <span class="time">2018-12-03 10:15</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1 3 å¥½é—®é¢˜<br><br>1. é”æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœæ•°æ®é¡µä¸Šæœ‰é”ï¼Œchange buffer åœ¨åˆ¤æ–­â€œæ˜¯å¦èƒ½ç”¨â€çš„æ—¶å€™ï¼Œå°±ä¼šè®¤ä¸ºå¦<br><br>2. å¢åŠ <br><br>3. æ˜¯è¿™æ ·çš„ï¼Œè¿™ä¸ªé—®é¢˜ä½ åˆ†æˆä¸¤æ­¥æ¥è€ƒè™‘ã€‚<br>ç¬¬ä¸€æ­¥ï¼Œmergeå…¶å®æ˜¯ä»ç£ç›˜è¯»æ•°æ®é¡µåˆ°å†…å­˜ï¼Œç„¶ååº”ç”¨ï¼Œè¿™ä¸€æ­¥éƒ½æ˜¯æ›´æ–°çš„å†…å­˜ï¼ŒåŒæ—¶å†™redolog<br><br>ç°åœ¨å†…å­˜å˜æˆè„é¡µäº†ï¼Œè·Ÿç£ç›˜æ•°æ®ä¸ä¸€æ ·ã€‚ä¹‹åå°±èµ°åˆ·è„é¡µçš„æµç¨‹ã€‚åˆ·è„é¡µä¹Ÿä¸ç”¨å†™ã€‚<br><br><br>=====<br><br>æ˜¯å¦ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼Œè¿™ä¸ªè¦çœ‹ä¸šåŠ¡æœ‰æ²¡æœ‰ä¿è¯ï¼Œå’Œæ€§èƒ½æ˜¯å¦æœ‰é—®é¢˜ã€‚<br><br>æœ‰å‡ ä½åŒå­¦éƒ½æäº†ï¼Œæˆ‘åŠ åˆ°æ–‡æœ«è¯´æ˜ä¸€ä¸‹ã€‚</p>
                                <p class="reply-time">2018-12-05 02:07</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/d3/6e/281b85aa.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ°¸å…‰</span>
                            </div>
                            <div class="bd">ä¼šå¯¼è‡´change bufferä¸¢å¤±ï¼Œä¼šå¯¼è‡´æœ¬æ¬¡æœªå®Œæˆçš„æ“ä½œæ•°æ®ä¸¢å¤±ï¼Œä½†ä¸ä¼šå¯¼è‡´å·²å®Œæˆæ“ä½œçš„æ•°æ®ä¸¢å¤±ã€‚<br>1.change bufferä¸­åˆ†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æœ¬æ¬¡å†™å…¥æœªå†™å®Œçš„ï¼Œä¸€éƒ¨åˆ†æ˜¯å·²ç»å†™å…¥å®Œæˆçš„ã€‚<br>2.é’ˆå¯¹æœªå†™å®Œçš„ï¼Œæ­¤éƒ¨åˆ†æ“ä½œï¼Œè¿˜æœªå†™å…¥redo logï¼Œå› æ­¤äº‹åŠ¡è¿˜æœªæäº¤ï¼Œæ‰€ä»¥æ²¡å½±å“ã€‚<br>2.é’ˆå¯¹ï¼Œå·²ç»å†™å®Œæˆçš„ï¼Œå¯ä»¥é€šè¿‡redo logæ¥è¿›è¡Œæ¢å¤ã€‚<br><br>æ‰€ä»¥ï¼Œä¸ä¼šå¯¹æ•°æ®åº“é€ æˆå½±å“ã€‚ <br></div>
                            <span class="time">2018-12-03 07:22</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¼˜ç§€</p>
                                <p class="reply-time">2018-12-03 09:19</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/AwEHMTGSmVsia3WZDyIicBQPAfS11lBZ0yUappicPzfmGDmMwkje1UoqKK3UJ6FCBdsZyiauuV1SEfcrFzWfx9n1RQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è™šçˆ±å‡¯å¹³</span>
                            </div>
                            <div class="bd">æœ‰ç‚¹ç–‘æƒ‘: ä¸»é”®idä¹Ÿæ˜¯å”¯ä¸€ç´¢å¼•å§? é‚£æˆ‘ä»¬çš„æ–°å¢æ“ä½œå¦‚ä½•åˆ©ç”¨ change bufferå‘¢?  <br></div>
                            <span class="time">2018-12-03 03:40</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ‰€ä»¥ä¸»é”®ç´¢å¼•ç”¨ä¸ä¸Šï¼Œéƒ½æ˜¯å¯¹äºé‚£äº›äºŒçº§ç´¢å¼•çš„æ‰æœ‰æ•ˆã€‚ <br><br>ä¸€ä¸ªinsertè¯­å¥è¦æ“ä½œæ‰€æœ‰ç´¢å¼•çš„å˜›ï¼Œæ”¶ç›Šåœ¨äºŒçº§ç´¢å¼•</p>
                                <p class="reply-time">2018-12-03 09:17</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e9/8e/6dc15a91.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ™¨æ€æš®è¯­</span>
                            </div>
                            <div class="bd">ä¸è€å¸ˆï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ä¸æ˜¯å¾ˆæ˜ç™½ï¼æœ€åå°ç»“ä¹‹å‰ï¼Œè€Œchange buffer ä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„IOæ¶ˆè€—ã€‚è¿™å¥è¯æ€ä¹ˆç†è§£ï¼Œå› ä¸ºçœ‹å‰é¢çš„è®²è§£ï¼Œchange bufferå¯¹æ€§èƒ½çš„ä¸»è¦æå‡ï¼Œæ˜¯åœ¨ä¸€ä¸ªå†™å¤šè¯»å°‘çš„ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ™®é€šç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œåˆå¹¶å¤šæ¬¡å†™ä¸ºä¸€æ¬¡æ¥æ›´æ–°ç£ç›˜ï¼ <br></div>
                            <span class="time">2018-12-04 13:55</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/df/6d/44cf0de4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Ivan</span>
                            </div>
                            <div class="bd">å›ç­”ä¸€ä¸‹melonçš„é—®é¢˜ã€‚<br>change Bufferå’Œæ•°æ®é¡µä¸€æ ·ï¼Œä¹Ÿæ˜¯ç‰©ç†é¡µçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œæ•°æ®ç»“æ„ä¹Ÿæ˜¯ä¸€é¢—B+æ ‘ï¼Œè¿™æ£µB+æ ‘æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ï¼Œé»˜è®¤ibdata1ä¸­ã€‚change buffer  å†™å…¥ç³»ç»Ÿè¡¨ç©ºé—´æœºåˆ¶åº”è¯¥å’Œæ™®é€šè¡¨çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜æ˜¯ç›¸åŒçš„æœºåˆ¶--Checkpointæœºåˆ¶ï¼›<br>ä¹‹æ‰€ä»¥change bufferè¦å†™å…¥ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œæ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œchange bufferåšä¿®æ”¹æ—¶éœ€è¦å†™redoï¼Œåœ¨åšæ¢å¤æ—¶éœ€è¦æ ¹æ®redoæ¥æ¢å¤change bufferï¼Œè‹¥æ˜¯ä¸è¿›è¡Œchange bufferå†™å…¥ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ä¸è¿›è¡ŒæŒä¹…åŒ–ï¼Œé‚£ä¹ˆåœ¨change bufferå†™å…¥å†…å­˜åæ‰ç”µï¼ˆä¹Ÿå°±æ˜¯ç¯‡å°¾æå‡ºçš„é—®é¢˜ï¼‰ï¼Œåˆ™æ— æ³•è¿›è¡Œæ•°æ®æ¢å¤ã€‚è¿™æ ·ä¹Ÿä¼šå¯¼è‡´ç´¢å¼•ä¸­çš„æ•°æ®å’Œç›¸åº”è¡¨çš„ç›¸åº”åˆ—ä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚<br>change buffer å†™å…¥åˆ°äº†ç³»ç»Ÿè¡¨ç©ºé—´ï¼Œpurge çš„æ—¶å€™ä¼šå…ˆæŸ¥è¯¢change bufferé‡Œå¯¹åº”çš„è®°å½•ï¼Œç„¶åè¿›è¡Œpurgeï¼Œå› ä¸ºchange buffer B+æ ‘çš„keyæ˜¯è¡¨ç©ºé—´IDï¼Œæ‰€ä»¥æŸ¥è¯¢æ ¹æ®è¡¨ç©ºé—´ID æŸ¥è¯¢change bufferä¼šå¾ˆå¿«ã€‚ <br></div>
                            <span class="time">2018-12-03 20:01</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-03 22:09</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/df/6d/44cf0de4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Ivan</span>
                            </div>
                            <div class="bd">ä¸ä¼šå¯¼è‡´change bufferä¸¢å¤±ã€‚å› ä¸ºåœ¨æ›´æ”¹change buffer æ—¶ä¹Ÿä¼šå†™redo logï¼Œä¹Ÿéœ€è¦æŒä¹…åŒ–ã€‚<br>change buffer æ›´æ–°å®Œæˆå¹¶ä¸”ç›¸åº”äº‹åŠ¡æäº¤çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆè¦ä¿è¯redo logè½ç›˜ï¼ˆäºŒé˜¶æ®µæäº¤ï¼‰ï¼Œè‹¥æ­¤æ—¶æ‰ç”µé‡å¯ï¼Œåˆ™å¯ä»¥æ ¹æ® redo è¿›è¡Œæ¢å¤;<br>è‹¥change buffer æ›´æ–°å®Œæˆä½†æ˜¯ç›¸åº”äº‹åŠ¡æœªæäº¤çš„æƒ…å†µä¸‹ï¼Œåˆ™redo æœ‰å¯èƒ½è½ç›˜äº†ï¼ˆredo çš„ç»„æäº¤ï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æœªè½ç›˜ï¼Œè‹¥è½ç›˜äº†ï¼Œè¯»å–redoå‘ç°æ²¡æœ‰commitæ ‡å¿—ï¼ˆè¿˜ä¼šè¿›è¡Œlsnï¼Œbinlogçš„å¯¹æ¯”ï¼‰ï¼Œåˆ™å›æ»šï¼›è‹¥redoæœªè½ç›˜åˆ™ä¹Ÿå°±ä¸ä¼šå‡ºç°å‰æ»šå’Œå›æ»šçš„æƒ…å†µï¼Œæ•°æ®ä¾æ—§ä¸€è‡´ã€‚ <br></div>
                            <span class="time">2018-12-03 17:18</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿<br><br>æ‹†å¼€äº†åˆ†æå¾ˆå¥½</p>
                                <p class="reply-time">2018-12-03 18:19</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/ab/e1/f6b921fa.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å£¹ç¬™â˜æ¼‚æ³Š</span>
                            </div>
                            <div class="bd">å‰ä¸¤æ¬¡å­¦äº†ä¹‹åæ²¡æ—¶é—´æ€»ç»“ã€‚ã€‚ä»Šå¤©ç»§ç»­<br>æ€»ç»“:<br>é€‰æ‹©æ™®é€šç´¢å¼•è¿˜æ˜¯å”¯ä¸€ç´¢å¼•ï¼Ÿ<br>å¯¹äºæŸ¥è¯¢è¿‡ç¨‹æ¥è¯´ï¼š<br>aã€æ™®é€šç´¢å¼•ï¼ŒæŸ¥åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•åï¼Œç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼ŒçŸ¥é“ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•<br>bã€å”¯ä¸€ç´¢å¼•ï¼Œç”±äºç´¢å¼•å”¯ä¸€æ€§ï¼ŒæŸ¥åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åï¼Œåœæ­¢æ£€ç´¢<br>ä½†æ˜¯ï¼Œä¸¤è€…çš„æ€§èƒ½å·®è·å¾®ä¹å…¶å¾®ã€‚å› ä¸ºInnoDBæ ¹æ®æ•°æ®é¡µæ¥è¯»å†™çš„ã€‚<br>å¯¹äºæ›´æ–°è¿‡ç¨‹æ¥è¯´ï¼š<br>æ¦‚å¿µï¼šchange buffer<br>å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œå¦‚æœä¸åœ¨å†…å­˜ä¸­ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInnoDBä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨change bufferä¸­ã€‚ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œchange bufferä¸­çš„ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚<br><br>change bufferæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚åœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Š<br><br>purge:å°†change bufferä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µä¸Šï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ï¼Œæˆä¸ºpurge<br>è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘purgeï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹å®šæœŸpurgeï¼Œåœ¨æ•°æ®åº“æ­£å¸¸å…³é—­çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œpurge<br><br>å”¯ä¸€ç´¢å¼•çš„æ›´æ–°ä¸èƒ½ä½¿ç”¨change buffer<br><br>change bufferç”¨çš„æ˜¯buffer poolé‡Œçš„å†…å­˜ï¼Œchange bufferçš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•°innodb_change_buffer_max_sizeæ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º50çš„æ—¶å€™ï¼Œè¡¨ç¤ºchange bufferçš„å¤§å°æœ€å¤šåªèƒ½å ç”¨buffer poolçš„50%ã€‚<br><br>å°†æ•°æ®ä»ç£ç›˜è¯»å…¥å†…å­˜æ¶‰åŠéšæœºIOçš„è®¿é—®ï¼Œæ˜¯æ•°æ®åº“é‡Œé¢æˆæœ¬æœ€é«˜çš„æ“ä½œä¹‹ä¸€ã€‚ <br>change buffer å› ä¸ºå‡å°‘äº†éšæœºç£ç›˜è®¿é—®ï¼Œæ‰€ä»¥å¯¹æ›´æ–°æ€§èƒ½çš„æå‡å¾ˆæ˜æ˜¾ã€‚<br><br>change bufferä½¿ç”¨åœºæ™¯<br>åœ¨ä¸€ä¸ªæ•°æ®é¡µåšpurgeä¹‹å‰ï¼Œchange bufferè®°å½•çš„å˜æ›´è¶Šå¤šï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚<br>å¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶change bufferçš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚<br><br>åè¿‡æ¥ï¼Œå‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨change buffer,ä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘purgeè¿‡ç¨‹ã€‚<br>è¿™æ ·éšæœºè®¿é—®IOçš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº†change bufferçš„ç»´æŠ¤ä»£ä»·ã€‚æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§ä¸šåŠ¡æ¨¡å¼æ¥è¯´ï¼Œchange bufferåè€Œèµ·åˆ°äº†å‰¯ä½œç”¨ã€‚<br><br>ç´¢å¼•çš„é€‰æ‹©å’Œå®è·µï¼š<br>å°½å¯èƒ½ä½¿ç”¨æ™®é€šç´¢å¼•ã€‚<br>redo logä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„IOæ¶ˆè€—(è½¬æˆé¡ºåºå†™)ï¼Œè€Œchange bufferä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„IOæ¶ˆè€—ã€‚<br><br>æ€è€ƒé¢˜ï¼š<br>change bufferä¸ä¼šä¸¢å¤±ï¼Œå› ä¸ºchange bufferæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ï¼Œåœ¨ç£ç›˜ä¸Šå æ®äº†ç³»ç»Ÿè¡¨ç©ºé—´ibdataï¼Œå¯¹åº”çš„å†…éƒ¨ç³»ç»Ÿè¡¨åä¸ºSYS_IBUF_TABLEã€‚å› æ­¤åœ¨å¼‚å¸¸å…³æœºçš„æ—¶å€™ï¼Œä¸ä¼šä¸¢å¤±ã€‚ <br></div>
                            <span class="time">2018-12-03 09:46</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">èµğŸ‘ğŸ¿<br><br>ä¸ä¼šä¸¢å¤±è¿˜æœ‰redologçš„åŠŸåŠ³å“ˆ</p>
                                <p class="reply-time">2018-12-03 11:57</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/1f/c3/1ef2bccf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åŒ…å­æœ¨æœ‰é¦…</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œæˆ‘è¯´ä¸‹æˆ‘çš„ç†è§£ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰é—®é¢˜<br>1ã€changebufferè·Ÿæ™®é€šæ•°æ®é¡µä¸€æ ·ä¹Ÿæ˜¯å­˜åœ¨ç£ç›˜é‡Œï¼ŒåŒºåˆ«åœ¨äºchangebufferæ˜¯åœ¨å…±äº«è¡¨ç©ºé—´ibdata1é‡Œ<br>2ã€redologæœ‰ä¸¤ç§ï¼Œä¸€ç§è®°å½•æ™®é€šæ•°æ®é¡µçš„æ”¹åŠ¨ï¼Œä¸€ç§è®°å½•changebufferçš„æ”¹åŠ¨<br>3ã€åªè¦å†…å­˜é‡Œè„é¡µï¼ˆinnodb buffer poolï¼‰é‡Œçš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ä¸€å®šä¼šè®°å½•2ä¸­å‰ä¸€ç§redolog<br>ï¼ˆå¯¹æ•°æ®çš„ä¿®æ”¹è®°å½•åœ¨changebufferé‡Œçš„æ—¶å€™ï¼Œå†…å­˜é‡Œæ˜¯æ²¡æœ‰è¿™ä¸ªç‰©ç†é¡µçš„ï¼Œä¸å­˜åœ¨è„é¡µï¼‰<br>3ã€çœŸæ­£å¯¹ç£ç›˜æ•°æ®é¡µçš„ä¿®æ”¹æ˜¯é€šè¿‡å°†å†…å­˜é‡Œè„é¡µçš„æ•°æ®åˆ·å›ç£ç›˜æ¥å®Œæˆçš„ï¼Œè€Œä¸æ˜¯æ ¹æ®redolog <br></div>
                            <span class="time">2018-12-06 10:51</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">éå¸¸å¥½ï¼Œå°¤å…¶æ‹¬å·é‡Œé‚£å¥å’Œæœ€åä¸€å¥</p>
                                <p class="reply-time">2018-12-06 12:43</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/f1/bd/049a06b0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ziven</span>
                            </div>
                            <div class="bd">å’Œ @æ™¨æ€æš®è¯­ æœ‰åŒæ ·çš„ç–‘é—®ã€‚å…³äºchange buffer ä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„ IOæ¶ˆè€—è¿™ä¸ªç‚¹ï¼Œæˆ‘çš„ç†è§£æ˜¯å¦‚æœæ²¡æœ‰change bufferæœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œæ›´æ–°åï¼ˆå†™å…¥redologï¼‰ï¼Œè¯»å–æ•°æ®çš„æ—¶å€™éœ€è¦ä»æ¬¡ç£ç›˜éšæœºè¯»å–redologåˆå¹¶åˆ°æ•°æ®ä¸­ï¼Œä¸»è¦å‡å°‘çš„æ˜¯è¿™éƒ¨åˆ†æ¶ˆè€—ï¼Ÿ <br></div>
                            <span class="time">2018-12-20 20:03</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸æ˜¯ï¼Œå¦‚æœæ²¡æœ‰change buffer, æ‰§è¡Œæ›´æ–°çš„â€œå½“æ—¶é‚£ä¸€åˆ»â€ï¼Œå°±è¦æ±‚ä»ç£ç›˜æŠŠæ•°æ®é¡µè¯»å‡ºæ¥ï¼ˆè¿™ä¸ªæ“ä½œæ˜¯éšæœºè¯»ï¼‰ã€‚<br><br>Chsnge bufferçœäº†è¿™ä¸ªã€‚<br>å¥½é—®é¢˜</p>
                                <p class="reply-time">2018-12-20 22:18</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/13/72/434a40f1.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é™ä»¥å‚¨åŠ¿Â·Shuke</span>
                            </div>
                            <div class="bd">è¦ç†è§£change bufferè¿˜å¾—å…ˆç†è§£buffer poolæ˜¯å•¥ï¼Œé¡¾åæ€ä¹‰ï¼Œç¡¬ç›˜åœ¨è¯»å†™é€Ÿåº¦ä¸Šç›¸æ¯”å†…å­˜æœ‰ç€æ•°é‡çº§å·®è·ï¼Œå¦‚æœæ¯æ¬¡è¯»å†™éƒ½è¦ä»ç£ç›˜åŠ è½½ç›¸åº”æ•°æ®é¡µï¼ŒDBçš„æ•ˆç‡å°±ä¸Šä¸æ¥ï¼Œå› è€Œä¸ºäº†åŒ–è§£è¿™ä¸ªå›°å±€ï¼Œå‡ ä¹æ‰€æœ‰çš„DBéƒ½ä¼šæŠŠç¼“å­˜æ± å½“åšæ ‡é…ï¼ˆåœ¨å†…å­˜ä¸­å¼€è¾Ÿçš„ä¸€æ•´å—ç©ºé—´ï¼Œç”±å¼•æ“åˆ©ç”¨ä¸€äº›å‘½ä¸­ç®—æ³•å’Œæ·˜æ±°ç®—æ³•è´Ÿè´£ç»´æŠ¤å’Œç®¡ç†ï¼‰ï¼Œchange bufferåˆ™æ›´è¿›ä¸€æ­¥ï¼ŒæŠŠåœ¨å†…å­˜ä¸­æ›´æ–°å°±èƒ½å¯ä»¥ç«‹å³è¿”å›æ‰§è¡Œç»“æœå¹¶ä¸”æ»¡è¶³ä¸€è‡´æ€§çº¦æŸï¼ˆæ˜¾å¼æˆ–éšå¼å®šä¹‰çš„çº¦æŸæ¡ä»¶ï¼‰çš„è®°å½•ä¹Ÿæš‚æ—¶æ”¾åœ¨ç¼“å­˜æ± ä¸­ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†ç£ç›˜IOæ“ä½œçš„å‡ ç‡ <br></div>
                            <span class="time">2018-12-05 08:41</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-05 12:44</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/13/32/4cfd28df.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é«˜åŸ</span>
                            </div>
                            <div class="bd">ChangeBufferå°±æ˜¯å¯¹ã€Šæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡ SQL æ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿã€‹ä¸­ update è¯­å¥æ‰§è¡Œæµç¨‹è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚æ›´æ–°æ­¥éª¤ï¼šå…ˆæ›´æ–°å†…å­˜ï¼Œå†é€šè¿‡redo logæ›´æ–°ç£ç›˜ã€‚<br>è€ŒChange Bufferçš„å¼•å…¥ä½¿å¾—æ›´æ–°å†…å­˜éƒ½æ˜¯æŒ‰éœ€æ›´æ–°ï¼Œåªæœ‰åœ¨éœ€è¦è¯»çš„æ—¶å€™æ‰æ›´æ–°ã€‚ å¦‚æœè¿™æ ·ç†è§£å¯¹çš„è¯ï¼Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨purgeä¹‹å‰ï¼Œredo logæ‰§è¡Œäº†ç£ç›˜å†™ï¼Œé‚£change bufferé‡Œçš„æ“ä½œæ˜¯ä¸æ˜¯å°±æœ‰å†²çªæ€ä¹ˆè®©å¤±æ•ˆå‘¢ï¼Ÿ<br>2018-12-03<br>î˜ˆ ä½œè€…å›å¤<br>å‰é¢è¯´çš„å¯¹ï¼Œæœ€åä¸€å¥è¯é—®é¢˜æ²¡ç†è§£â€¦ ä½ å†å‘é‡å‘ä¸€ä¸‹é—®é¢˜ğŸ˜“<br>---------------------------------------------------------<br>é—®é¢˜ï¼šç°åœ¨ä¸€ä¸ªæ‰§è¡Œæµç¨‹æ˜¯ï¼Œæ“ä½œå†™å…¥change buffer, å†™å…¥redo log commit. ä½†è¿™ä¸ªæ—¶å€™åº”è¯¥æ²¡æœ‰purge,ä¹Ÿæ²¡æœ‰é€šè¿‡redo logå†™å…¥ç£ç›˜ã€‚ Purge æ˜¯åœ¨æœ‰çš„æŸ¥è¯¢æ“ä½œçš„æ—¶å€™å‘ç”Ÿï¼ˆä¸è€ƒè™‘ç³»ç»Ÿè‡ªåŠ¨purgeï¼‰ï¼Œé‚£è¿‡æ®µæ—¶é—´åº”è¯¥ä¼šé€šè¿‡redo logæ›´æ–°åˆ°ç£ç›˜ã€‚<br>æˆ‘çš„é—®é¢˜å°±æ˜¯é€šè¿‡redo logæ›´æ–°åˆ°ç£ç›˜çš„æ—¶å€™ï¼Œå¦‚æœè¿˜æ²¡æœ‰å‘ç”Ÿpurgeæ“ä½œï¼Œé‚£å¦‚æœå†æ¬¡è¯»è§¦å‘Purgeä»ç£ç›˜è¯»ï¼ˆç£ç›˜å·²ç»æ˜¯redo logæ›´æ–°åçš„æ•°æ®äº†), æ‰€ä»¥è¿™ä¸ªåœ°æ–¹æ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶ç¡®ä¿æ²¡æœ‰å†²çªçš„ï¼Ÿ è°¢è°¢ï¼Œè€å¸ˆè®²çš„å¾ˆå¥½ï¼Œä¸çŸ¥é“æˆ‘è¯´æ˜ç™½æ²¡æœ‰ï¼Ÿ<br>2018-12-03<br>î˜ˆ ä½œè€…å›å¤<br>æˆ‘å¤§æ¦‚ç†è§£ä½ çš„æ„æ€äº†ã€‚<br><br>å¦‚æœæ²¡æœ‰purge,ç£ç›˜ä¸Šçš„page 2ä¸ä¼šå˜çš„ï¼Œredologæ²¡å¸®ä»–åšæ›´æ–°ã€‚<br><br>åªæœ‰purge æ‰ä¼šè§¦å‘æ›´æ–°æ•°æ®ï¼Œå¾—åˆ°æ–°çš„page 2<br>-----------------------------------------------------<br>è¿™ä¸ªåœ°æ–¹å°±ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼Œredo logä¸å°±æ˜¯ç”¨æ¥æœé›†æ“ä½œï¼Œé€‚æ—¶æ›´æ–°åˆ°ç£ç›˜å—ï¼Œè€ŒğŸˆ¶äº†change bufferåï¼Œredo logæ›´æ–°ç£ç›˜çš„æœºåˆ¶å°±ä¸ç”Ÿæ•ˆäº†å—ï¼Ÿ ä¸çŸ¥é“æ˜¯å“ªä¸ªåœ°æ–¹ç†è§£é”™äº†ï¼Ÿ <br></div>
                            <span class="time">2018-12-03 22:36</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¯¹äºpage 2, redologå¹¶ä¸çŸ¥é“ä»–è¦æ€ä¹ˆæ›´æ–°ï¼Œredologé‡Œé¢è®°å½•çš„æ˜¯change bufferä¸Šçš„æ›´æ–°ï¼Œè€Œchange bufferä¸Šè®°å½•çš„æ˜¯æ•°æ®é¡µçš„æ›´æ–°åŠ¨ä½œ</p>
                                <p class="reply-time">2018-12-04 09:24</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/18/07/c0a73a52.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ†¶æµ·æ‹¾è²</span>
                            </div>
                            <div class="bd">å”¯ä¸€å­—æ®µä¸åŠ å”¯ä¸€ç´¢å¼•, å¢¨è²å®šå¾‹ä¼šå‡ºæ¥æäº‹.  -- è®°ä¸€æ¬¡è¸©å‘ç»éªŒ.. <br></div>
                            <span class="time">2018-12-03 10:40</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯è¿™é‡Œå…¶å®è¦è¯´ç­‰æ˜¯â€œä¸šåŠ¡è¦ä¿è¯â€<br>å½“è¦æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œå¤šä¸€ä¸ªcheckçš„ç‚¹</p>
                                <p class="reply-time">2018-12-03 11:01</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/bc/0d/00424e81.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åˆ°é“å¯é“</span>
                            </div>
                            <div class="bd">æœ‰äº† redo logï¼ŒInnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸ºcrash-safeã€‚<br>å¯¹äºåœ¨change bufferä¸­çš„æ•°æ®ï¼Œä½†å·²æäº¤çš„éƒ¨åˆ†ï¼Œå·²ç»å†™äº†redo logï¼Œæ­¤æ—¶æ–­ç”µé‡å¯æ˜¯æ²¡æœ‰å½±å“çš„ï¼Œä½†å¯¹äºæœªå†™redo logçš„ï¼Œå³äº‹åŠ¡è¿˜æœªæäº¤çš„ï¼Œä¼šæ­£å¸¸ä¸¢å¤±è¿™éƒ¨åˆ†æ•°æ®ã€‚ <br></div>
                            <span class="time">2018-12-03 08:16</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/1d/13/31ea1b0b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å³°</span>
                            </div>
                            <div class="bd">å¶å›å¤ä¸‹å‡¯å¹³çš„é—®é¢˜ï¼Œä¸»é”®idæ˜¯ä¸»ç´¢å¼•ï¼Œåœ¨æ’å…¥çš„æ—¶å€™ï¼Œæ˜¯æ ¹æ®å®ƒæ¥å¯»æ‰¾æ’å…¥ä½ç½®çš„ï¼Œæ‰€ä»¥å·²ç»è€ƒè™‘äº†å®ƒçš„å”¯ä¸€æ€§ã€‚<br>ç„¶åæ€è€ƒé¢˜çš„è¯ï¼Œæ¯•ç«Ÿä¸ redoå†™å…¥changebufferçš„å˜åŒ–çš„æ“ä½œç»„æˆäº†äº‹åŠ¡ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿä¸¢å¤±ã€‚ <br></div>
                            <span class="time">2018-12-03 08:12</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ°ä¹‹7</span>
                            </div>
                            <div class="bd">åŸºç¡€ç¯‡å­¦ä¹ å®Œä¹‹åï¼Œè¿›å…¥å®æˆ˜çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚æ™®é€šç´¢å¼•å’Œå”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œä½¿ç”¨è¿™ä¸¤ç§ç´¢å¼•æ€§èƒ½è§’åº¦ä¸Šæ˜¯å·®ä¸å¤šçš„ï¼Œå› ä¸ºInnoDBæŒ‰æ•°æ®é¡µä¸ºå•å…ƒè¿›è¡Œè¯»å†™ã€‚å¯¹äºæ›´æ–°è¯­å¥æ¥è¯´ï¼Œå¯¹æ¥å†…å­˜ä¸­çš„æ•°æ®ç›´æ¥åœ¨å†…å­˜æ›´æ–°ï¼Œå¯¹äºä¸åœ¨å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¯¹äºå”¯ä¸€ç´¢å¼•ï¼Œè¿˜æ˜¯éœ€è¦è¿›è¡Œè¯»å†…å­˜ï¼Œä½†å¯¹äºæ™®é€šç´¢å¼•å°±å¯ä»¥é€šè¿‡ä½¿ç”¨change bufferæ¥å‡å°‘å¯¹ç£ç›˜çš„è®¿é—®ã€‚æ ¹æ®è¿™ä¸€åŸç†ï¼Œè€å¸ˆåœ¨æ–‡ç« é€šè¿‡ä¸€ä¸ªè¯»å…¥å‘½ä¸­ç‡ç”±99%å˜æˆ75%ï¼ŒåŸå› å°±æ˜¯å› ä¸ºæ™®é€šæ‰€ä»¥ç´¢å¼•æ”¹æˆäº†å”¯ä¸€ç´¢å¼•ã€‚æ‰€ä»¥é€šè¿‡æœ¬èŠ‚çš„å­¦ä¹ ï¼Œç†è§£æ™®é€šç´¢å¼•å’ŒChange buffer é…åˆä½¿ç”¨çš„åŸç†ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„è¡¨æ›´æ–°ä¼˜åŒ–æ•ˆç‡å¾ˆæ˜æ˜¾ã€‚é€šè¿‡è¿™äº›ç« èŠ‚çš„å­¦ä¹ ï¼Œåœ¨ç†è§£æ•°æ®åº“çš„æ ¸å¿ƒåŸç†ä¹‹åï¼Œç°åœ¨æˆ‘å›è¿‡åç»§ç»­å®è·µæ•°æ®åº“sqlè¯­å¥çš„çš„æ“ä½œï¼Œè‚¯å®šæ¯”ä¹‹å‰æ›´å¤§çš„è¿›æ­¥å’Œè‡ªä¿¡ã€‚ <br></div>
                            <span class="time">2018-12-10 21:17</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ‰‹åŠ¨ç‚¹èµ</p>
                                <p class="reply-time">2018-12-10 22:10</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/07/8c/51401220.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å°ç¾</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæ­£æ–‡é‡Œé¢è¯´ï¼šéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶åå­—å«ä½œ change bufferï¼Œå®é™…ä¸Šå®ƒæ˜¯å¯ä»¥æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œchange buffer åœ¨å†…å­˜ä¸­æœ‰æ‹·è´ï¼Œä¹Ÿä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚<br>æˆ‘çš„é—®é¢˜æ˜¯ï¼šchange bufferå¤šä¹…å†™å…¥ä¸€æ¬¡ç£ç›˜ï¼Ÿå¦‚æœchange bufferç£ç›˜ä¸­çš„å†…å®¹ä¼šå®Œå…¨åœ¨å†…å­˜ä¸­å—ï¼Ÿå¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£mergeå²‚ä¸æ˜¯è¦è¯»ä¸¤æ¬¡ç£ç›˜ï¼Ÿ <br></div>
                            <span class="time">2018-12-08 16:25</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. è¿™ä¸ªæ˜¯â€œflushâ€ç­–ç•¥ï¼Œä»Šæ™šä¼šå‘çš„æ–°çš„ä¸€ç¯‡å°±ä¼šè¯´åˆ°<br><br>2. ä¸ä¸€å®šä¸€æ ·<br><br>3. å¦‚æœå†…å­˜é‡Œæœ‰ï¼Œå†…å­˜é‡Œä¸€å®šæ˜¯å¯¹çš„</p>
                                <p class="reply-time">2018-12-09 13:29</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>