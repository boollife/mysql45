<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                15è®²ç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/44/ea/443082ccfc58d56e263f544ee56d1aea.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="15è®²ç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="15è®²ç­”ç–‘æ–‡ç« ï¼ˆä¸€ï¼‰ï¼šæ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>åœ¨ä»Šå¤©è¿™ç¯‡ç­”ç–‘æ–‡ç« æ›´æ–°å‰ï¼ŒMySQLå®æˆ˜è¿™ä¸ªä¸“æ å·²ç»æ›´æ–°äº†14ç¯‡ã€‚åœ¨è¿™äº›æ–‡ç« ä¸­ï¼Œå¤§å®¶åœ¨è¯„è®ºåŒºç•™ä¸‹äº†å¾ˆå¤šé«˜è´¨é‡çš„ç•™è¨€ã€‚ç°åœ¨ï¼Œæ¯ç¯‡æ–‡ç« çš„è¯„è®ºåŒºéƒ½æœ‰çƒ­å¿ƒçš„åŒå­¦å¸®å¿™æ€»ç»“æ–‡ç« çŸ¥è¯†ç‚¹ï¼Œä¹Ÿæœ‰ä¸å°‘åŒå­¦æå‡ºäº†å¾ˆå¤šé«˜è´¨é‡çš„é—®é¢˜ï¼Œæ›´æœ‰ä¸€äº›åŒå­¦å¸®å¿™è§£ç­”å…¶ä»–åŒå­¦æå‡ºçš„é—®é¢˜ã€‚</p><p>åœ¨æµè§ˆè¿™äº›ç•™è¨€å¹¶å›å¤çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å€å—é¼“èˆï¼Œä¹Ÿå°½æˆ‘æ‰€çŸ¥åœ°å¸®åŠ©ä½ è§£å†³é—®é¢˜ã€å’Œä½ è®¨è®ºã€‚å¯ä»¥è¯´ï¼Œä½ ä»¬çš„ç•™è¨€æ´»è·ƒäº†æ•´ä¸ªä¸“æ çš„æ°›å›´ã€æå‡äº†æ•´ä¸ªä¸“æ çš„è´¨é‡ï¼Œè°¢è°¢ä½ ä»¬ã€‚</p><p>è¯„è®ºåŒºçš„å¤§å¤šæ•°ç•™è¨€æˆ‘éƒ½ç›´æ¥å›å¤äº†ï¼Œå¯¹äºéœ€è¦å±•å¼€è¯´æ˜çš„é—®é¢˜ï¼Œæˆ‘éƒ½æ‹¿å‡ºå°æœ¬å­è®°äº†ä¸‹æ¥ã€‚è¿™äº›è¢«è®°ä¸‹æ¥çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¿™ç¯‡ç­”ç–‘æ–‡ç« çš„ç´ æäº†ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å·²ç»æ”¶é›†äº†47ä¸ªé—®é¢˜ï¼Œå¾ˆéš¾é€šè¿‡ä»Šå¤©è¿™ä¸€ç¯‡æ–‡ç« å…¨éƒ¨å±•å¼€ã€‚æ‰€ä»¥ï¼Œæˆ‘å°±å…ˆä»ä¸­æ‰¾äº†å‡ ä¸ªè”ç³»éå¸¸ç´§å¯†çš„é—®é¢˜ï¼Œä¸²äº†èµ·æ¥ï¼Œå¸Œæœ›å¯ä»¥å¸®ä½ è§£å†³å…³äºæ—¥å¿—å’Œç´¢å¼•çš„ä¸€äº›ç–‘æƒ‘ã€‚è€Œå…¶ä»–é—®é¢˜ï¼Œæˆ‘ä»¬å°±ç•™ç€åé¢æ…¢æ…¢å±•å¼€å§ã€‚</p><h1>æ—¥å¿—ç›¸å…³é—®é¢˜</h1><p>æˆ‘åœ¨ç¬¬2ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/68633">ã€Šæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿã€‹</a>ä¸­ï¼Œå’Œä½ è®²åˆ°binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰å’Œredo logï¼ˆé‡åšæ—¥å¿—ï¼‰é…åˆå´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯åè¯æ³•ï¼Œè¯´æ˜äº†å¦‚æœæ²¡æœ‰ä¸¤é˜¶æ®µæäº¤ï¼Œä¼šå¯¼è‡´MySQLå‡ºç°ä¸»å¤‡æ•°æ®ä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸‹é¢ï¼Œå¾ˆå¤šåŒå­¦åœ¨é—®ï¼Œåœ¨ä¸¤é˜¶æ®µæäº¤çš„ä¸åŒç¬é—´ï¼ŒMySQLå¦‚æœå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œæ˜¯æ€ä¹ˆä¿è¯æ•°æ®å®Œæ•´æ€§çš„ï¼Ÿ</p><!-- [[[read_end]]] --><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±ä»è¿™ä¸ªé—®é¢˜å¼€å§‹å§ã€‚</p><p>æˆ‘å†æ”¾ä¸€æ¬¡ä¸¤é˜¶æ®µæäº¤çš„å›¾ï¼Œæ–¹ä¾¿ä½ å­¦ä¹ ä¸‹é¢çš„å†…å®¹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/ee/2a/ee9af616e05e4b853eba27048351f62a.jpg" alt=""></p><center><span class="reference">å›¾1 ä¸¤é˜¶æ®µæäº¤ç¤ºæ„å›¾</span></center><p>è¿™é‡Œï¼Œæˆ‘è¦å…ˆå’Œä½ è§£é‡Šä¸€ä¸ªè¯¯ä¼šå¼çš„é—®é¢˜ã€‚æœ‰åŒå­¦åœ¨è¯„è®ºåŒºé—®åˆ°ï¼Œè¿™ä¸ªå›¾ä¸æ˜¯ä¸€ä¸ªupdateè¯­å¥çš„æ‰§è¡Œæµç¨‹å—ï¼Œæ€ä¹ˆè¿˜ä¼šè°ƒç”¨commitè¯­å¥ï¼Ÿ</p><p>ä»–äº§ç”Ÿè¿™ä¸ªç–‘é—®çš„åŸå› ï¼Œæ˜¯æŠŠ<strong>ä¸¤ä¸ªâ€œcommitâ€çš„æ¦‚å¿µ</strong>æ··æ·†äº†ï¼š</p><ul>
<li>ä»–è¯´çš„â€œcommitè¯­å¥â€ï¼Œæ˜¯æŒ‡MySQLè¯­æ³•ä¸­ï¼Œç”¨äºæäº¤ä¸€ä¸ªäº‹åŠ¡çš„å‘½ä»¤ã€‚ä¸€èˆ¬è·Ÿbegin/start transaction é…å¯¹ä½¿ç”¨ã€‚</li>
<li>è€Œæˆ‘ä»¬å›¾ä¸­ç”¨åˆ°çš„è¿™ä¸ªâ€œcommitæ­¥éª¤â€ï¼ŒæŒ‡çš„æ˜¯äº‹åŠ¡æäº¤è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªå°æ­¥éª¤ï¼Œä¹Ÿæ˜¯æœ€åä¸€æ­¥ã€‚å½“è¿™ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåï¼Œè¿™ä¸ªäº‹åŠ¡å°±æäº¤å®Œæˆäº†ã€‚</li>
<li>â€œcommitè¯­å¥â€æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šåŒ…å«â€œcommit æ­¥éª¤â€ã€‚</li>
</ul><p>è€Œæˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œæ²¡æœ‰æ˜¾å¼åœ°å¼€å¯äº‹åŠ¡ï¼Œå› æ­¤è¿™ä¸ªupdateè¯­å¥è‡ªå·±å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨æ‰§è¡Œå®Œæˆåæäº¤äº‹åŠ¡æ—¶ï¼Œå°±ä¼šç”¨åˆ°è¿™ä¸ªâ€œcommitæ­¥éª¤â€œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·åˆ†æä¸€ä¸‹<strong>åœ¨ä¸¤é˜¶æ®µæäº¤çš„ä¸åŒæ—¶åˆ»ï¼ŒMySQLå¼‚å¸¸é‡å¯ä¼šå‡ºç°ä»€ä¹ˆç°è±¡ã€‚</strong></p><p>å¦‚æœåœ¨å›¾ä¸­æ—¶åˆ»Açš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å†™å…¥redo log å¤„äºprepareé˜¶æ®µä¹‹åã€å†™binlogä¹‹å‰ï¼Œå‘ç”Ÿäº†å´©æºƒï¼ˆcrashï¼‰ï¼Œç”±äºæ­¤æ—¶binlogè¿˜æ²¡å†™ï¼Œredo logä¹Ÿè¿˜æ²¡æäº¤ï¼Œæ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡ä¼šå›æ»šã€‚è¿™æ—¶å€™ï¼Œbinlogè¿˜æ²¡å†™ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šä¼ åˆ°å¤‡åº“ã€‚åˆ°è¿™é‡Œï¼Œå¤§å®¶éƒ½å¯ä»¥ç†è§£ã€‚</p><p>å¤§å®¶å‡ºç°é—®é¢˜çš„åœ°æ–¹ï¼Œä¸»è¦é›†ä¸­åœ¨æ—¶åˆ»Bï¼Œä¹Ÿå°±æ˜¯binlogå†™å®Œï¼Œredo logè¿˜æ²¡commitå‰å‘ç”Ÿcrashï¼Œé‚£å´©æºƒæ¢å¤çš„æ—¶å€™MySQLä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å´©æºƒæ¢å¤æ—¶çš„åˆ¤æ–­è§„åˆ™ã€‚</p><ol>
<li>
<p>å¦‚æœredo logé‡Œé¢çš„äº‹åŠ¡æ˜¯å®Œæ•´çš„ï¼Œä¹Ÿå°±æ˜¯å·²ç»æœ‰äº†commitæ ‡è¯†ï¼Œåˆ™ç›´æ¥æäº¤ï¼›</p>
</li>
<li>
<p>å¦‚æœredo logé‡Œé¢çš„äº‹åŠ¡åªæœ‰å®Œæ•´çš„prepareï¼Œåˆ™åˆ¤æ–­å¯¹åº”çš„äº‹åŠ¡binlogæ˜¯å¦å­˜åœ¨å¹¶å®Œæ•´ï¼š<br>
a.  å¦‚æœæ˜¯ï¼Œåˆ™æäº¤äº‹åŠ¡ï¼›<br>
b.  å¦åˆ™ï¼Œå›æ»šäº‹åŠ¡ã€‚</p>
</li>
</ol><p>è¿™é‡Œï¼Œæ—¶åˆ»Bå‘ç”Ÿcrashå¯¹åº”çš„å°±æ˜¯2(a)çš„æƒ…å†µï¼Œå´©æºƒæ¢å¤è¿‡ç¨‹ä¸­äº‹åŠ¡ä¼šè¢«æäº¤ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­å»¶å±•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚</p><h2>è¿½é—®1ï¼šMySQLæ€ä¹ˆçŸ¥é“binlogæ˜¯å®Œæ•´çš„?</h2><p>å›ç­”ï¼šä¸€ä¸ªäº‹åŠ¡çš„binlogæ˜¯æœ‰å®Œæ•´æ ¼å¼çš„ï¼š</p><ul>
<li>statementæ ¼å¼çš„binlogï¼Œæœ€åä¼šæœ‰COMMITï¼›</li>
<li>rowæ ¼å¼çš„binlogï¼Œæœ€åä¼šæœ‰ä¸€ä¸ªXID eventã€‚</li>
</ul><p>å¦å¤–ï¼Œåœ¨MySQL 5.6.2ç‰ˆæœ¬ä»¥åï¼Œè¿˜å¼•å…¥äº†binlog-checksumå‚æ•°ï¼Œç”¨æ¥éªŒè¯binlogå†…å®¹çš„æ­£ç¡®æ€§ã€‚å¯¹äºbinlogæ—¥å¿—ç”±äºç£ç›˜åŸå› ï¼Œå¯èƒ½ä¼šåœ¨æ—¥å¿—ä¸­é—´å‡ºé”™çš„æƒ…å†µï¼ŒMySQLå¯ä»¥é€šè¿‡æ ¡éªŒchecksumçš„ç»“æœæ¥å‘ç°ã€‚æ‰€ä»¥ï¼ŒMySQLè¿˜æ˜¯æœ‰åŠæ³•éªŒè¯äº‹åŠ¡binlogçš„å®Œæ•´æ€§çš„ã€‚</p><h2>è¿½é—®2ï¼šredo log å’Œ binlogæ˜¯æ€ä¹ˆå…³è”èµ·æ¥çš„?</h2><p>å›ç­”ï¼šå®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„æ•°æ®å­—æ®µï¼Œå«XIDã€‚å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œä¼šæŒ‰é¡ºåºæ‰«æredo logï¼š</p><ul>
<li>å¦‚æœç¢°åˆ°æ—¢æœ‰prepareã€åˆæœ‰commitçš„redo logï¼Œå°±ç›´æ¥æäº¤ï¼›</li>
<li>å¦‚æœç¢°åˆ°åªæœ‰parepareã€è€Œæ²¡æœ‰commitçš„redo logï¼Œå°±æ‹¿ç€XIDå»binlogæ‰¾å¯¹åº”çš„äº‹åŠ¡ã€‚</li>
</ul><h2>è¿½é—®3ï¼šå¤„äºprepareé˜¶æ®µçš„redo logåŠ ä¸Šå®Œæ•´binlogï¼Œé‡å¯å°±èƒ½æ¢å¤ï¼ŒMySQLä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡?</h2><p>å›ç­”ï¼šå…¶å®ï¼Œè¿™ä¸ªé—®é¢˜è¿˜æ˜¯è·Ÿæˆ‘ä»¬åœ¨åè¯æ³•ä¸­è¯´åˆ°çš„æ•°æ®ä¸å¤‡ä»½çš„ä¸€è‡´æ€§æœ‰å…³ã€‚åœ¨æ—¶åˆ»Bï¼Œä¹Ÿå°±æ˜¯binlogå†™å®Œä»¥åMySQLå‘ç”Ÿå´©æºƒï¼Œè¿™æ—¶å€™binlogå·²ç»å†™å…¥äº†ï¼Œä¹‹åå°±ä¼šè¢«ä»åº“ï¼ˆæˆ–è€…ç”¨è¿™ä¸ªbinlogæ¢å¤å‡ºæ¥çš„åº“ï¼‰ä½¿ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ä¸»åº“ä¸Šä¹Ÿè¦æäº¤è¿™ä¸ªäº‹åŠ¡ã€‚é‡‡ç”¨è¿™ä¸ªç­–ç•¥ï¼Œä¸»åº“å’Œå¤‡åº“çš„æ•°æ®å°±ä¿è¯äº†ä¸€è‡´æ€§ã€‚</p><h2>è¿½é—®4ï¼šå¦‚æœè¿™æ ·çš„è¯ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¸¤é˜¶æ®µæäº¤å‘¢ï¼Ÿå¹²è„†å…ˆredo logå†™å®Œï¼Œå†å†™binlogã€‚å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œå¿…é¡»å¾—ä¸¤ä¸ªæ—¥å¿—éƒ½å®Œæ•´æ‰å¯ä»¥ã€‚æ˜¯ä¸æ˜¯ä¸€æ ·çš„é€»è¾‘ï¼Ÿ</h2><p>å›ç­”ï¼šå…¶å®ï¼Œä¸¤é˜¶æ®µæäº¤æ˜¯ç»å…¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿé—®é¢˜ï¼Œå¹¶ä¸æ˜¯MySQLç‹¬æœ‰çš„ã€‚</p><p>å¦‚æœå¿…é¡»è¦ä¸¾ä¸€ä¸ªåœºæ™¯ï¼Œæ¥è¯´æ˜è¿™ä¹ˆåšçš„å¿…è¦æ€§çš„è¯ï¼Œé‚£å°±æ˜¯äº‹åŠ¡çš„æŒä¹…æ€§é—®é¢˜ã€‚</p><p>å¯¹äºInnoDBå¼•æ“æ¥è¯´ï¼Œå¦‚æœredo logæäº¤å®Œæˆäº†ï¼Œäº‹åŠ¡å°±ä¸èƒ½å›æ»šï¼ˆå¦‚æœè¿™è¿˜å…è®¸å›æ»šï¼Œå°±å¯èƒ½è¦†ç›–æ‰åˆ«çš„äº‹åŠ¡çš„æ›´æ–°ï¼‰ã€‚è€Œå¦‚æœredo logç›´æ¥æäº¤ï¼Œç„¶åbinlogå†™å…¥çš„æ—¶å€™å¤±è´¥ï¼ŒInnoDBåˆå›æ»šä¸äº†ï¼Œæ•°æ®å’Œbinlogæ—¥å¿—åˆä¸ä¸€è‡´äº†ã€‚</p><p>ä¸¤é˜¶æ®µæäº¤å°±æ˜¯ä¸ºäº†ç»™æ‰€æœ‰äººä¸€ä¸ªæœºä¼šï¼Œå½“æ¯ä¸ªäººéƒ½è¯´â€œæˆ‘okâ€çš„æ—¶å€™ï¼Œå†ä¸€èµ·æäº¤ã€‚</p><h2>è¿½é—®5ï¼šä¸å¼•å…¥ä¸¤ä¸ªæ—¥å¿—ï¼Œä¹Ÿå°±æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤çš„å¿…è¦äº†ã€‚åªç”¨binlogæ¥æ”¯æŒå´©æºƒæ¢å¤ï¼Œåˆèƒ½æ”¯æŒå½’æ¡£ï¼Œä¸å°±å¯ä»¥äº†ï¼Ÿ</h2><p>å›ç­”ï¼šè¿™ä½åŒå­¦çš„æ„æ€æ˜¯ï¼Œåªä¿ç•™binlogï¼Œç„¶åå¯ä»¥æŠŠæäº¤æµç¨‹æ”¹æˆè¿™æ ·ï¼šâ€¦ -&gt; â€œæ•°æ®æ›´æ–°åˆ°å†…å­˜â€ -&gt; â€œå†™ binlogâ€ -&gt; â€œæäº¤äº‹åŠ¡â€ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æä¾›å´©æºƒæ¢å¤çš„èƒ½åŠ›ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸å¯ä»¥ã€‚</p><p>å¦‚æœè¯´<strong>å†å²åŸå› </strong>çš„è¯ï¼Œé‚£å°±æ˜¯InnoDBå¹¶ä¸æ˜¯MySQLçš„åŸç”Ÿå­˜å‚¨å¼•æ“ã€‚MySQLçš„åŸç”Ÿå¼•æ“æ˜¯MyISAMï¼Œè®¾è®¡ä¹‹åˆå°±æœ‰æ²¡æœ‰æ”¯æŒå´©æºƒæ¢å¤ã€‚</p><p>InnoDBåœ¨ä½œä¸ºMySQLçš„æ’ä»¶åŠ å…¥MySQLå¼•æ“å®¶æ—ä¹‹å‰ï¼Œå°±å·²ç»æ˜¯ä¸€ä¸ªæä¾›äº†å´©æºƒæ¢å¤å’Œäº‹åŠ¡æ”¯æŒçš„å¼•æ“äº†ã€‚</p><p>InnoDBæ¥å…¥äº†MySQLåï¼Œå‘ç°æ—¢ç„¶binlogæ²¡æœ‰å´©æºƒæ¢å¤çš„èƒ½åŠ›ï¼Œé‚£å°±ç”¨InnoDBåŸæœ‰çš„redo logå¥½äº†ã€‚</p><p>è€Œå¦‚æœè¯´<strong>å®ç°ä¸Šçš„åŸå› </strong>çš„è¯ï¼Œå°±æœ‰å¾ˆå¤šäº†ã€‚å°±æŒ‰ç…§é—®é¢˜ä¸­è¯´çš„ï¼Œåªç”¨binlogæ¥å®ç°å´©æºƒæ¢å¤çš„æµç¨‹ï¼Œæˆ‘ç”»äº†ä¸€å¼ ç¤ºæ„å›¾ï¼Œè¿™é‡Œå°±æ²¡æœ‰redo logäº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/eb/63/eb838b87e9c20fa00aca50ef154f2a63.jpg" alt=""></p><center><span class="reference">å›¾2 åªç”¨binlogæ”¯æŒå´©æºƒæ¢å¤</span></center><p>è¿™æ ·çš„æµç¨‹ä¸‹ï¼Œbinlogè¿˜æ˜¯ä¸èƒ½æ”¯æŒå´©æºƒæ¢å¤çš„ã€‚æˆ‘è¯´ä¸€ä¸ªä¸æ”¯æŒçš„ç‚¹å§ï¼šbinlogæ²¡æœ‰èƒ½åŠ›æ¢å¤â€œæ•°æ®é¡µâ€ã€‚</p><p>å¦‚æœåœ¨å›¾ä¸­æ ‡çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯binlog2å†™å®Œäº†ï¼Œä½†æ˜¯æ•´ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰commitçš„æ—¶å€™ï¼ŒMySQLå‘ç”Ÿäº†crashã€‚</p><p>é‡å¯åï¼Œå¼•æ“å†…éƒ¨äº‹åŠ¡2ä¼šå›æ»šï¼Œç„¶ååº”ç”¨binlog2å¯ä»¥è¡¥å›æ¥ï¼›ä½†æ˜¯å¯¹äºäº‹åŠ¡1æ¥è¯´ï¼Œç³»ç»Ÿå·²ç»è®¤ä¸ºæäº¤å®Œæˆäº†ï¼Œä¸ä¼šå†åº”ç”¨ä¸€æ¬¡binlog1ã€‚</p><p>ä½†æ˜¯ï¼ŒInnoDBå¼•æ“ä½¿ç”¨çš„æ˜¯WALæŠ€æœ¯ï¼Œæ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™ï¼Œå†™å®Œå†…å­˜å’Œæ—¥å¿—ï¼Œäº‹åŠ¡å°±ç®—å®Œæˆäº†ã€‚å¦‚æœä¹‹åå´©æºƒï¼Œè¦ä¾èµ–äºæ—¥å¿—æ¥æ¢å¤æ•°æ®é¡µã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨å›¾ä¸­è¿™ä¸ªä½ç½®å‘ç”Ÿå´©æºƒçš„è¯ï¼Œäº‹åŠ¡1ä¹Ÿæ˜¯å¯èƒ½ä¸¢å¤±äº†çš„ï¼Œè€Œä¸”æ˜¯æ•°æ®é¡µçº§çš„ä¸¢å¤±ã€‚æ­¤æ—¶ï¼Œbinlogé‡Œé¢å¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„æ›´æ–°ç»†èŠ‚ï¼Œæ˜¯è¡¥ä¸å›æ¥çš„ã€‚</p><p>ä½ å¦‚æœè¦è¯´ï¼Œé‚£æˆ‘ä¼˜åŒ–ä¸€ä¸‹binlogçš„å†…å®¹ï¼Œè®©å®ƒæ¥è®°å½•æ•°æ®é¡µçš„æ›´æ”¹å¯ä»¥å—ï¼Ÿä½†ï¼Œè¿™å…¶å®å°±æ˜¯åˆåšäº†ä¸€ä¸ªredo logå‡ºæ¥ã€‚</p><p>æ‰€ä»¥ï¼Œè‡³å°‘ç°åœ¨çš„binlogèƒ½åŠ›ï¼Œè¿˜ä¸èƒ½æ”¯æŒå´©æºƒæ¢å¤ã€‚</p><h2>è¿½é—®6ï¼šé‚£èƒ½ä¸èƒ½åè¿‡æ¥ï¼Œåªç”¨redo logï¼Œä¸è¦binlogï¼Ÿ</h2><p>å›ç­”ï¼šå¦‚æœåªä»å´©æºƒæ¢å¤çš„è§’åº¦æ¥è®²æ˜¯å¯ä»¥çš„ã€‚ä½ å¯ä»¥æŠŠbinlogå…³æ‰ï¼Œè¿™æ ·å°±æ²¡æœ‰ä¸¤é˜¶æ®µæäº¤äº†ï¼Œä½†ç³»ç»Ÿä¾ç„¶æ˜¯crash-safeçš„ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ äº†è§£ä¸€ä¸‹ä¸šç•Œå„ä¸ªå…¬å¸çš„ä½¿ç”¨åœºæ™¯çš„è¯ï¼Œå°±ä¼šå‘ç°åœ¨æ­£å¼çš„ç”Ÿäº§åº“ä¸Šï¼Œbinlogéƒ½æ˜¯å¼€ç€çš„ã€‚å› ä¸ºbinlogæœ‰ç€redo logæ— æ³•æ›¿ä»£çš„åŠŸèƒ½ã€‚</p><p>ä¸€ä¸ªæ˜¯å½’æ¡£ã€‚redo logæ˜¯å¾ªç¯å†™ï¼Œå†™åˆ°æœ«å°¾æ˜¯è¦å›åˆ°å¼€å¤´ç»§ç»­å†™çš„ã€‚è¿™æ ·å†å²æ—¥å¿—æ²¡æ³•ä¿ç•™ï¼Œredo logä¹Ÿå°±èµ·ä¸åˆ°å½’æ¡£çš„ä½œç”¨ã€‚</p><p>ä¸€ä¸ªå°±æ˜¯MySQLç³»ç»Ÿä¾èµ–äºbinlogã€‚binlogä½œä¸ºMySQLä¸€å¼€å§‹å°±æœ‰çš„åŠŸèƒ½ï¼Œè¢«ç”¨åœ¨äº†å¾ˆå¤šåœ°æ–¹ã€‚å…¶ä¸­ï¼ŒMySQLç³»ç»Ÿé«˜å¯ç”¨çš„åŸºç¡€ï¼Œå°±æ˜¯binlogå¤åˆ¶ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šå…¬å¸æœ‰å¼‚æ„ç³»ç»Ÿï¼ˆæ¯”å¦‚ä¸€äº›æ•°æ®åˆ†æç³»ç»Ÿï¼‰ï¼Œè¿™äº›ç³»ç»Ÿå°±é æ¶ˆè´¹MySQLçš„binlogæ¥æ›´æ–°è‡ªå·±çš„æ•°æ®ã€‚å…³æ‰binlogçš„è¯ï¼Œè¿™äº›ä¸‹æ¸¸ç³»ç»Ÿå°±æ²¡æ³•è¾“å…¥äº†ã€‚</p><p>æ€»ä¹‹ï¼Œç”±äºç°åœ¨åŒ…æ‹¬MySQLé«˜å¯ç”¨åœ¨å†…çš„å¾ˆå¤šç³»ç»Ÿæœºåˆ¶éƒ½ä¾èµ–äºbinlogï¼Œæ‰€ä»¥â€œé¸ å é¹Šå·¢â€redo logè¿˜åšä¸åˆ°ã€‚ä½ çœ‹ï¼Œå‘å±•ç”Ÿæ€æ˜¯å¤šä¹ˆé‡è¦ã€‚</p><h2>è¿½é—®7ï¼šredo logä¸€èˆ¬è®¾ç½®å¤šå¤§ï¼Ÿ</h2><p>å›ç­”ï¼šredo logå¤ªå°çš„è¯ï¼Œä¼šå¯¼è‡´å¾ˆå¿«å°±è¢«å†™æ»¡ï¼Œç„¶åä¸å¾—ä¸å¼ºè¡Œåˆ·redo logï¼Œè¿™æ ·WALæœºåˆ¶çš„èƒ½åŠ›å°±å‘æŒ¥ä¸å‡ºæ¥äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæ˜¯ç°åœ¨å¸¸è§çš„å‡ ä¸ªTBçš„ç£ç›˜çš„è¯ï¼Œå°±ä¸è¦å¤ªå°æ°”äº†ï¼Œç›´æ¥å°†redo logè®¾ç½®ä¸º4ä¸ªæ–‡ä»¶ã€æ¯ä¸ªæ–‡ä»¶1GBå§ã€‚</p><h2>è¿½é—®8ï¼šæ­£å¸¸è¿è¡Œä¸­çš„å®ä¾‹ï¼Œæ•°æ®å†™å…¥åçš„æœ€ç»ˆè½ç›˜ï¼Œæ˜¯ä»redo logæ›´æ–°è¿‡æ¥çš„è¿˜æ˜¯ä»buffer poolæ›´æ–°è¿‡æ¥çš„å‘¢ï¼Ÿ</h2><p>å›ç­”ï¼šè¿™ä¸ªé—®é¢˜å…¶å®é—®å¾—éå¸¸å¥½ã€‚è¿™é‡Œæ¶‰åŠåˆ°äº†ï¼Œâ€œredo logé‡Œé¢åˆ°åº•æ˜¯ä»€ä¹ˆâ€çš„é—®é¢˜ã€‚</p><p>å®é™…ä¸Šï¼Œredo logå¹¶æ²¡æœ‰è®°å½•æ•°æ®é¡µçš„å®Œæ•´æ•°æ®ï¼Œæ‰€ä»¥å®ƒå¹¶æ²¡æœ‰èƒ½åŠ›è‡ªå·±å»æ›´æ–°ç£ç›˜æ•°æ®é¡µï¼Œä¹Ÿå°±ä¸å­˜åœ¨â€œæ•°æ®æœ€ç»ˆè½ç›˜ï¼Œæ˜¯ç”±redo logæ›´æ–°è¿‡å»â€çš„æƒ…å†µã€‚</p><ol>
<li>
<p>å¦‚æœæ˜¯æ­£å¸¸è¿è¡Œçš„å®ä¾‹çš„è¯ï¼Œæ•°æ®é¡µè¢«ä¿®æ”¹ä»¥åï¼Œè·Ÿç£ç›˜çš„æ•°æ®é¡µä¸ä¸€è‡´ï¼Œç§°ä¸ºè„é¡µã€‚æœ€ç»ˆæ•°æ®è½ç›˜ï¼Œå°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®é¡µå†™ç›˜ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œç”šè‡³ä¸redo logæ¯«æ— å…³ç³»ã€‚</p>
</li>
<li>
<p>åœ¨å´©æºƒæ¢å¤åœºæ™¯ä¸­ï¼ŒInnoDBå¦‚æœåˆ¤æ–­åˆ°ä¸€ä¸ªæ•°æ®é¡µå¯èƒ½åœ¨å´©æºƒæ¢å¤çš„æ—¶å€™ä¸¢å¤±äº†æ›´æ–°ï¼Œå°±ä¼šå°†å®ƒè¯»åˆ°å†…å­˜ï¼Œç„¶åè®©redo logæ›´æ–°å†…å­˜å†…å®¹ã€‚æ›´æ–°å®Œæˆåï¼Œå†…å­˜é¡µå˜æˆè„é¡µï¼Œå°±å›åˆ°äº†ç¬¬ä¸€ç§æƒ…å†µçš„çŠ¶æ€ã€‚</p>
</li>
</ol><h2>è¿½é—®9ï¼šredo log bufferæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å…ˆä¿®æ”¹å†…å­˜ï¼Œè¿˜æ˜¯å…ˆå†™redo logæ–‡ä»¶ï¼Ÿ</h2><p>å›ç­”ï¼šè¿™ä¸¤ä¸ªé—®é¢˜å¯ä»¥ä¸€èµ·å›ç­”ã€‚</p><p>åœ¨ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ—¥å¿—æ˜¯è¦å†™å¤šæ¬¡çš„ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªäº‹åŠ¡ï¼š</p><pre><code>begin;
insert into t1 ...
insert into t2 ...
commit;
</code></pre><p>è¿™ä¸ªäº‹åŠ¡è¦å¾€ä¸¤ä¸ªè¡¨ä¸­æ’å…¥è®°å½•ï¼Œæ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆçš„æ—¥å¿—éƒ½å¾—å…ˆä¿å­˜èµ·æ¥ï¼Œä½†åˆä¸èƒ½åœ¨è¿˜æ²¡commitçš„æ—¶å€™å°±ç›´æ¥å†™åˆ°redo logæ–‡ä»¶é‡Œã€‚</p><p>æ‰€ä»¥ï¼Œredo log bufferå°±æ˜¯ä¸€å—å†…å­˜ï¼Œç”¨æ¥å…ˆå­˜redoæ—¥å¿—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªinsertçš„æ—¶å€™ï¼Œæ•°æ®çš„å†…å­˜è¢«ä¿®æ”¹äº†ï¼Œredo log bufferä¹Ÿå†™å…¥äº†æ—¥å¿—ã€‚</p><p>ä½†æ˜¯ï¼ŒçœŸæ­£æŠŠæ—¥å¿—å†™åˆ°redo logæ–‡ä»¶ï¼ˆæ–‡ä»¶åæ˜¯ ib_logfile+æ•°å­—ï¼‰ï¼Œæ˜¯åœ¨æ‰§è¡Œcommitè¯­å¥çš„æ—¶å€™åšçš„ã€‚</p><p>ï¼ˆè¿™é‡Œè¯´çš„æ˜¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šâ€œä¸»åŠ¨å»åˆ·ç›˜â€ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„IOæ¶ˆè€—ã€‚ä½†æ˜¯å¯èƒ½ä¼šå‡ºç°â€œè¢«åŠ¨å†™å…¥ç£ç›˜â€ï¼Œæ¯”å¦‚å†…å­˜ä¸å¤Ÿã€å…¶ä»–äº‹åŠ¡æäº¤ç­‰æƒ…å†µã€‚è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¼šåœ¨åé¢ç¬¬22ç¯‡æ–‡ç« ã€ŠMySQLæœ‰å“ªäº›â€œé¥®é¸©æ­¢æ¸´â€çš„æé«˜æ€§èƒ½çš„æ–¹æ³•ï¼Ÿã€‹ä¸­å†è¯¦ç»†å±•å¼€ï¼‰ã€‚</p><p>å•ç‹¬æ‰§è¡Œä¸€ä¸ªæ›´æ–°è¯­å¥çš„æ—¶å€™ï¼ŒInnoDBä¼šè‡ªå·±å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆçš„æ—¶å€™æäº¤ã€‚è¿‡ç¨‹è·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯â€œå‹ç¼©â€åˆ°äº†ä¸€ä¸ªè¯­å¥é‡Œé¢å®Œæˆã€‚</p><p>ä»¥ä¸Šè¿™äº›é—®é¢˜ï¼Œå°±æ˜¯æŠŠå¤§å®¶æè¿‡çš„å…³äºredo logå’Œbinlogçš„é—®é¢˜ä¸²èµ·æ¥ï¼Œåšçš„ä¸€æ¬¡é›†ä¸­å›ç­”ã€‚å¦‚æœä½ è¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºç»§ç»­ç•™è¨€è¡¥å……ã€‚</p><h1>ä¸šåŠ¡è®¾è®¡é—®é¢˜</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†å’Œä½ åˆ†äº«@ithunter åŒå­¦åœ¨ç¬¬8ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/70562">ã€Š</a><a href="https://time.geekbang.org/column/article/70562">äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿ</a><a href="https://time.geekbang.org/column/article/70562">ã€‹</a>çš„è¯„è®ºåŒºæåˆ°çš„è·Ÿç´¢å¼•ç›¸å…³çš„ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘è§‰å¾—è¿™ä¸ªé—®é¢˜æŒºæœ‰è¶£ã€ä¹ŸæŒºå®ç”¨çš„ï¼Œå…¶ä»–åŒå­¦ä¹Ÿå¯èƒ½ä¼šç¢°ä¸Šè¿™æ ·çš„åœºæ™¯ï¼Œåœ¨è¿™é‡Œè§£ç­”å’Œåˆ†äº«ä¸€ä¸‹ã€‚</p><p>é—®é¢˜æ˜¯è¿™æ ·çš„ï¼ˆæˆ‘æ–‡å­—ä¸Šç¨å¾®åšäº†ç‚¹ä¿®æ”¹ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ï¼‰ï¼š</p><blockquote>
<p>ä¸šåŠ¡ä¸Šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒAã€Bä¸¤ä¸ªç”¨æˆ·ï¼Œå¦‚æœäº’ç›¸å…³æ³¨ï¼Œåˆ™æˆä¸ºå¥½å‹ã€‚è®¾è®¡ä¸Šæ˜¯æœ‰ä¸¤å¼ è¡¨ï¼Œä¸€ä¸ªæ˜¯likeè¡¨ï¼Œä¸€ä¸ªæ˜¯friendè¡¨ï¼Œlikeè¡¨æœ‰user_idã€liker_idä¸¤ä¸ªå­—æ®µï¼Œæˆ‘è®¾ç½®ä¸ºå¤åˆå”¯ä¸€ç´¢å¼•å³uk_user_id_liker_idã€‚è¯­å¥æ‰§è¡Œé€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p>
</blockquote><blockquote>
<p>ä»¥Aå…³æ³¨Bä¸ºä¾‹ï¼š<br>
ç¬¬ä¸€æ­¥ï¼Œå…ˆæŸ¥è¯¢å¯¹æ–¹æœ‰æ²¡æœ‰å…³æ³¨è‡ªå·±ï¼ˆBæœ‰æ²¡æœ‰å…³æ³¨Aï¼‰<br>
select * from like where user_id = B and liker_id = A;</p>
</blockquote><blockquote>
<p>å¦‚æœæœ‰ï¼Œåˆ™æˆä¸ºå¥½å‹<br>
insert into friend;</p>
</blockquote><blockquote>
<p>æ²¡æœ‰ï¼Œåˆ™åªæ˜¯å•å‘å…³æ³¨å…³ç³»<br>
insert into like;</p>
</blockquote><blockquote>
<p>ä½†æ˜¯å¦‚æœAã€BåŒæ—¶å…³æ³¨å¯¹æ–¹ï¼Œä¼šå‡ºç°ä¸ä¼šæˆä¸ºå¥½å‹çš„æƒ…å†µã€‚å› ä¸ºä¸Šé¢ç¬¬1æ­¥ï¼ŒåŒæ–¹éƒ½æ²¡å…³æ³¨å¯¹æ–¹ã€‚ç¬¬1æ­¥å³ä½¿ä½¿ç”¨äº†æ’ä»–é”ä¹Ÿä¸è¡Œï¼Œå› ä¸ºè®°å½•ä¸å­˜åœ¨ï¼Œè¡Œé”æ— æ³•ç”Ÿæ•ˆã€‚è¯·é—®è¿™ç§æƒ…å†µï¼Œåœ¨MySQLé”å±‚é¢æœ‰æ²¡æœ‰åŠæ³•å¤„ç†ï¼Ÿ</p>
</blockquote><p>é¦–å…ˆï¼Œæˆ‘è¦å…ˆèµä¸€ä¸‹è¿™æ ·çš„æé—®æ–¹å¼ã€‚è™½ç„¶æå®¢æ—¶é—´ç°åœ¨çš„è¯„è®ºåŒºè¿˜ä¸èƒ½è¿½åŠ è¯„è®ºï¼Œä½†å¦‚æœå¤§å®¶èƒ½å¤Ÿä¸€æ¬¡ç•™è¨€å°±æŠŠé—®é¢˜è®²æ¸…æ¥šçš„è¯ï¼Œå…¶å®å½±å“ä¹Ÿä¸å¤§ã€‚æ‰€ä»¥ï¼Œæˆ‘å¸Œæœ›ä½ åœ¨ç•™è¨€æé—®çš„æ—¶å€™ï¼Œä¹Ÿèƒ½å€Ÿé‰´è¿™ç§æ–¹å¼ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘æŠŠ@ithunter åŒå­¦è¯´çš„è¡¨æ¨¡æ‹Ÿå‡ºæ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬è®¨è®ºã€‚</p><pre><code>CREATE TABLE `like` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `liker_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id_liker_id` (`user_id`,`liker_id`)
) ENGINE=InnoDB;

CREATE TABLE `friend` (
  id` int(11) NOT NULL AUTO_INCREMENT,
  `friend_1_id` int(11) NOT NULL,
  `firned_2_id` int(11) NOT NULL,
  UNIQUE KEY `uk_friend` (`friend_1_id`,`firned_2_id`)
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;
</code></pre><p>è™½ç„¶è¿™ä¸ªé¢˜å¹²ä¸­ï¼Œå¹¶æ²¡æœ‰è¯´åˆ°friendè¡¨çš„ç´¢å¼•ç»“æ„ã€‚ä½†æˆ‘çŒœæµ‹friend_1_idå’Œfriend_2_idä¹Ÿæœ‰ç´¢å¼•ï¼Œä¸ºä¾¿äºæè¿°ï¼Œæˆ‘ç»™åŠ ä¸Šå”¯ä¸€ç´¢å¼•ã€‚</p><p>é¡ºä¾¿è¯´æ˜ä¸€ä¸‹ï¼Œâ€œlikeâ€æ˜¯å…³é”®å­—ï¼Œæˆ‘ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨å…³é”®å­—ä½œä¸ºåº“åã€è¡¨åã€å­—æ®µåæˆ–ç´¢å¼•åã€‚</p><p>æˆ‘æŠŠä»–çš„ç–‘é—®ç¿»è¯‘ä¸€ä¸‹ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªäººï¼Œè®¾ç½®ä¸ºå…³æ³¨å¯¹æ–¹ï¼Œå°±å¯èƒ½å¯¼è‡´æ— æ³•æˆåŠŸåŠ ä¸ºæœ‹å‹å…³ç³»ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ç”¨ä½ å·²ç»ç†Ÿæ‚‰çš„æ—¶åˆ»é¡ºåºè¡¨çš„å½¢å¼ï¼ŒæŠŠè¿™ä¸¤ä¸ªäº‹åŠ¡çš„æ‰§è¡Œè¯­å¥åˆ—å‡ºæ¥ï¼š<br>
<img src="https://static001.geekbang.org/resource/image/c4/ed/c45063baf1ae521bf5d98b6d7c0e0ced.png" alt=""></p><center><span class="reference">å›¾3 å¹¶å‘â€œå–œæ¬¢â€é€»è¾‘æ“ä½œé¡ºåº</span></center><p>ç”±äºä¸€å¼€å§‹Aå’ŒBä¹‹é—´æ²¡æœ‰å…³æ³¨å…³ç³»ï¼Œæ‰€ä»¥ä¸¤ä¸ªäº‹åŠ¡é‡Œé¢çš„selectè¯­å¥æŸ¥å‡ºæ¥çš„ç»“æœéƒ½æ˜¯ç©ºã€‚</p><p>å› æ­¤ï¼Œsession 1çš„é€»è¾‘å°±æ˜¯â€œæ—¢ç„¶Bæ²¡æœ‰å…³æ³¨Aï¼Œé‚£å°±åªæ’å…¥ä¸€ä¸ªå•å‘å…³æ³¨å…³ç³»â€ã€‚session 2ä¹ŸåŒæ ·æ˜¯è¿™ä¸ªé€»è¾‘ã€‚</p><p>è¿™ä¸ªç»“æœå¯¹ä¸šåŠ¡æ¥è¯´å°±æ˜¯bugäº†ã€‚å› ä¸ºåœ¨ä¸šåŠ¡è®¾å®šé‡Œé¢ï¼Œè¿™ä¸¤ä¸ªé€»è¾‘éƒ½æ‰§è¡Œå®Œæˆä»¥åï¼Œæ˜¯åº”è¯¥åœ¨friendè¡¨é‡Œé¢æ’å…¥ä¸€è¡Œè®°å½•çš„ã€‚</p><p>å¦‚æé—®é‡Œé¢è¯´çš„ï¼Œâ€œç¬¬1æ­¥å³ä½¿ä½¿ç”¨äº†æ’ä»–é”ä¹Ÿä¸è¡Œï¼Œå› ä¸ºè®°å½•ä¸å­˜åœ¨ï¼Œè¡Œé”æ— æ³•ç”Ÿæ•ˆâ€ã€‚ä¸è¿‡ï¼Œæˆ‘æƒ³åˆ°äº†å¦å¤–ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œè¦ç»™â€œlikeâ€è¡¨å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œæ¯”å¦‚å«ä½œ relation_shipï¼Œå¹¶è®¾ä¸ºæ•´å‹ï¼Œå–å€¼1ã€2ã€3ã€‚</p><blockquote>
<p>å€¼æ˜¯1çš„æ—¶å€™ï¼Œè¡¨ç¤ºuser_id å…³æ³¨ liker_id;<br>
å€¼æ˜¯2çš„æ—¶å€™ï¼Œè¡¨ç¤ºliker_id å…³æ³¨ user_id;<br>
å€¼æ˜¯3çš„æ—¶å€™ï¼Œè¡¨ç¤ºäº’ç›¸å…³æ³¨ã€‚</p>
</blockquote><p>ç„¶åï¼Œå½“ Aå…³æ³¨Bçš„æ—¶å€™ï¼Œé€»è¾‘æ”¹æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼š</p><p>åº”ç”¨ä»£ç é‡Œé¢ï¼Œæ¯”è¾ƒAå’ŒBçš„å¤§å°ï¼Œå¦‚æœA&lt;Bï¼Œå°±æ‰§è¡Œä¸‹é¢çš„é€»è¾‘</p><pre><code>mysql&gt; begin; /*å¯åŠ¨äº‹åŠ¡*/
insert into `like`(user_id, liker_id, relation_ship) values(A, B, 1) on duplicate key update relation_ship=relation_ship | 1;
select relation_ship from `like` where user_id=A and liker_id=B;
/*ä»£ç ä¸­åˆ¤æ–­è¿”å›çš„ relation_shipï¼Œ
  å¦‚æœæ˜¯1ï¼Œäº‹åŠ¡ç»“æŸï¼Œæ‰§è¡Œ commit
  å¦‚æœæ˜¯3ï¼Œåˆ™æ‰§è¡Œä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥ï¼š
  */
insert ignore into friend(friend_1_id, friend_2_id) values(A,B);
commit;
</code></pre><p>å¦‚æœA&gt;Bï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„é€»è¾‘</p><pre><code>mysql&gt; begin; /*å¯åŠ¨äº‹åŠ¡*/
insert into `like`(user_id, liker_id, relation_ship) values(B, A, 2) on duplicate key update relation_ship=relation_ship | 2;
select relation_ship from `like` where user_id=B and liker_id=A;
/*ä»£ç ä¸­åˆ¤æ–­è¿”å›çš„ relation_shipï¼Œ
  å¦‚æœæ˜¯2ï¼Œäº‹åŠ¡ç»“æŸï¼Œæ‰§è¡Œ commit
  å¦‚æœæ˜¯3ï¼Œåˆ™æ‰§è¡Œä¸‹é¢è¿™ä¸¤ä¸ªè¯­å¥ï¼š
*/
insert ignore into friend(friend_1_id, friend_2_id) values(B,A);
commit;
</code></pre><p>è¿™ä¸ªè®¾è®¡é‡Œï¼Œè®©â€œlikeâ€è¡¨é‡Œçš„æ•°æ®ä¿è¯user_id &lt; liker_idï¼Œè¿™æ ·ä¸è®ºæ˜¯Aå…³æ³¨Bï¼Œè¿˜æ˜¯Bå…³æ³¨Aï¼Œåœ¨æ“ä½œâ€œlikeâ€è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåå‘çš„å…³ç³»å·²ç»å­˜åœ¨ï¼Œå°±ä¼šå‡ºç°è¡Œé”å†²çªã€‚</p><p>ç„¶åï¼Œinsert â€¦ on duplicateè¯­å¥ï¼Œç¡®ä¿äº†åœ¨äº‹åŠ¡å†…éƒ¨ï¼Œæ‰§è¡Œäº†è¿™ä¸ªSQLè¯­å¥åï¼Œå°±å¼ºè¡Œå ä½äº†è¿™ä¸ªè¡Œé”ï¼Œä¹‹åçš„select åˆ¤æ–­relation_shipè¿™ä¸ªé€»è¾‘æ—¶å°±ç¡®ä¿äº†æ˜¯åœ¨è¡Œé”ä¿æŠ¤ä¸‹çš„è¯»æ“ä½œã€‚</p><p>æ“ä½œç¬¦ â€œ|â€ æ˜¯æŒ‰ä½æˆ–ï¼Œè¿åŒæœ€åä¸€å¥insertè¯­å¥é‡Œçš„ignoreï¼Œæ˜¯ä¸ºäº†ä¿è¯é‡å¤è°ƒç”¨æ—¶çš„å¹‚ç­‰æ€§ã€‚</p><p>è¿™æ ·ï¼Œå³ä½¿åœ¨åŒæ–¹â€œåŒæ—¶â€æ‰§è¡Œå…³æ³¨æ“ä½œï¼Œæœ€ç»ˆæ•°æ®åº“é‡Œçš„ç»“æœï¼Œä¹Ÿæ˜¯likeè¡¨é‡Œé¢æœ‰ä¸€æ¡å…³äºAå’ŒBçš„è®°å½•ï¼Œè€Œä¸”relation_shipçš„å€¼æ˜¯3ï¼Œ å¹¶ä¸”friendè¡¨é‡Œé¢ä¹Ÿæœ‰äº†Aå’ŒBçš„è¿™æ¡è®°å½•ã€‚</p><p>ä¸çŸ¥é“ä½ ä¼šä¸ä¼šåæ§½ï¼šä¹‹å‰æ˜æ˜è¿˜è¯´å°½é‡ä¸è¦ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼Œç»“æœè¿™ä¸ªä¾‹å­ä¸€ä¸Šæ¥æˆ‘å°±åˆ›å»ºäº†ä¸¤ä¸ªã€‚è¿™é‡Œæˆ‘è¦å†å’Œä½ è¯´æ˜ä¸€ä¸‹ï¼Œä¹‹å‰æ–‡ç« æˆ‘ä»¬è®¨è®ºçš„ï¼Œæ˜¯åœ¨â€œä¸šåŠ¡å¼€å‘ä¿è¯ä¸ä¼šæ’å…¥é‡å¤è®°å½•â€çš„æƒ…å†µä¸‹ï¼Œç€é‡è¦è§£å†³æ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œæ‰å»ºè®®å°½é‡ä½¿ç”¨æ™®é€šç´¢å¼•ã€‚</p><p>è€Œåƒè¿™ä¸ªä¾‹å­é‡Œï¼ŒæŒ‰ç…§è¿™ä¸ªè®¾è®¡ï¼Œä¸šåŠ¡æ ¹æœ¬å°±æ˜¯ä¿è¯â€œæˆ‘ä¸€å®šä¼šæ’å…¥é‡å¤æ•°æ®ï¼Œæ•°æ®åº“ä¸€å®šè¦è¦æœ‰å”¯ä¸€æ€§çº¦æŸâ€ï¼Œè¿™æ—¶å°±æ²¡å•¥å¥½è¯´çš„äº†ï¼Œå”¯ä¸€ç´¢å¼•å»ºèµ·æ¥å§ã€‚</p><h1>å°ç»“</h1><p>è¿™æ˜¯ä¸“æ çš„ç¬¬ä¸€ç¯‡ç­”ç–‘æ–‡ç« ã€‚</p><p>æˆ‘é’ˆå¯¹å‰14ç¯‡æ–‡ç« ï¼Œå¤§å®¶åœ¨è¯„è®ºåŒºä¸­çš„ç•™è¨€ï¼Œä»ä¸­æ‘˜å–äº†å…³äºæ—¥å¿—å’Œç´¢å¼•çš„ç›¸å…³é—®é¢˜ï¼Œä¸²æˆäº†ä»Šå¤©è¿™ç¯‡æ–‡ç« ã€‚è¿™é‡Œæˆ‘ä¹Ÿè¦å†å’Œä½ è¯´ä¸€å£°ï¼Œæœ‰äº›æˆ‘ç­”åº”åœ¨ç­”ç–‘æ–‡ç« ä¸­è¿›è¡Œæ‰©å±•çš„è¯é¢˜ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« æ²¡æ¥å¾—åŠæ‰©å±•ï¼Œåç»­æˆ‘ä¼šå†æ‰¾æœºä¼šä¸ºä½ è§£ç­”ã€‚æ‰€ä»¥ï¼Œç¯‡å¹…æ‰€é™ï¼Œè¯„è®ºåŒºè§å§ã€‚</p><p>æœ€åï¼Œè™½ç„¶è¿™ç¯‡æ˜¯ç­”ç–‘æ–‡ç« ï¼Œä½†è¯¾åé—®é¢˜è¿˜æ˜¯è¦æœ‰çš„ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„è¡¨tï¼Œå¹¶æ’å…¥ä¸€è¡Œï¼Œç„¶åå¯¹è¿™ä¸€è¡Œåšä¿®æ”¹ã€‚</p><pre><code>mysql&gt; CREATE TABLE `t` (
`id` int(11) NOT NULL primary key auto_increment,
`a` int(11) DEFAULT NULL
) ENGINE=InnoDB;
insert into t values(1,2);
</code></pre><p>è¿™æ—¶å€™ï¼Œè¡¨té‡Œæœ‰å”¯ä¸€çš„ä¸€è¡Œæ•°æ®(1,2)ã€‚å‡è®¾ï¼Œæˆ‘ç°åœ¨è¦æ‰§è¡Œï¼š</p><pre><code>mysql&gt; update t set a=2 where id=1;
</code></pre><p>ä½ ä¼šçœ‹åˆ°è¿™æ ·çš„ç»“æœï¼š</p><p><img src="https://static001.geekbang.org/resource/image/36/70/367b3f299b94353f32f75ea825391170.png" alt=""><br>
ç»“æœæ˜¾ç¤ºï¼ŒåŒ¹é…(rows matched)äº†ä¸€è¡Œï¼Œä¿®æ”¹(Changed)äº†0è¡Œã€‚</p><p>ä»…ä»ç°è±¡ä¸Šçœ‹ï¼ŒMySQLå†…éƒ¨åœ¨å¤„ç†è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§é€‰æ‹©ï¼š</p><ol>
<li>
<p>æ›´æ–°éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼ŒMySQLè¯»å‡ºæ•°æ®ï¼Œå‘ç°açš„å€¼æœ¬æ¥å°±æ˜¯2ï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼Œæ‰§è¡Œç»“æŸï¼›</p>
</li>
<li>
<p>MySQLè°ƒç”¨äº†InnoDBå¼•æ“æä¾›çš„â€œä¿®æ”¹ä¸º(1,2)â€è¿™ä¸ªæ¥å£ï¼Œä½†æ˜¯å¼•æ“å‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼›</p>
</li>
<li>
<p>InnoDBè®¤çœŸæ‰§è¡Œäº†â€œæŠŠè¿™ä¸ªå€¼ä¿®æ”¹æˆ(1,2)"è¿™ä¸ªæ“ä½œï¼Œè¯¥åŠ é”çš„åŠ é”ï¼Œè¯¥æ›´æ–°çš„æ›´æ–°ã€‚</p>
</li>
</ol><p>ä½ è§‰å¾—å®é™…æƒ…å†µä¼šæ˜¯ä»¥ä¸Šå“ªç§å‘¢ï¼Ÿä½ å¯å¦ç”¨æ„é€ å®éªŒçš„æ–¹å¼ï¼Œæ¥è¯æ˜ä½ çš„ç»“è®ºï¼Ÿè¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼ŒMySQLä¸ºä»€ä¹ˆè¦é€‰æ‹©è¿™ç§ç­–ç•¥å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„éªŒè¯æ–¹æ³•å’Œæ€è€ƒå†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œç”¨ä¸€ä¸ªè®¡æ•°è¡¨è®°å½•ä¸€ä¸ªä¸šåŠ¡è¡¨çš„æ€»è¡Œæ•°ï¼Œåœ¨å¾€ä¸šåŠ¡è¡¨æ’å…¥æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦ç»™è®¡æ•°å€¼åŠ 1ã€‚</p><p>é€»è¾‘å®ç°ä¸Šæ˜¯å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰§è¡Œä¸¤ä¸ªè¯­å¥ï¼š</p><ol>
<li>
<p>insert into æ•°æ®è¡¨ï¼›</p>
</li>
<li>
<p>update è®¡æ•°è¡¨ï¼Œè®¡æ•°å€¼åŠ 1ã€‚</p>
</li>
</ol><p>ä»ç³»ç»Ÿå¹¶å‘èƒ½åŠ›çš„è§’åº¦è€ƒè™‘ï¼Œæ€ä¹ˆå®‰æ’è¿™ä¸¤ä¸ªè¯­å¥çš„é¡ºåºã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ç›´æ¥å¤åˆ¶ @é˜¿å»º çš„å›ç­”è¿‡æ¥ä¾›ä½ å‚è€ƒï¼š</p><blockquote>
<p>å¹¶å‘ç³»ç»Ÿæ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œåº”è¯¥å…ˆæ’å…¥æ“ä½œè®°å½•ï¼Œå†æ›´æ–°è®¡æ•°è¡¨ã€‚<br>
çŸ¥è¯†ç‚¹åœ¨<a href="https://time.geekbang.org/column/article/70215">ã€Šè¡Œé”åŠŸè¿‡ï¼šæ€ä¹ˆå‡å°‘è¡Œé”å¯¹æ€§èƒ½çš„å½±å“ï¼Ÿã€‹</a><br>
å› ä¸ºæ›´æ–°è®¡æ•°è¡¨æ¶‰åŠåˆ°è¡Œé”çš„ç«äº‰ï¼Œå…ˆæ’å…¥å†æ›´æ–°èƒ½æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡å¹¶å‘åº¦ã€‚</p>
</blockquote><p>è¯„è®ºåŒºæœ‰åŒå­¦è¯´ï¼Œåº”è¯¥æŠŠupdateè®¡æ•°è¡¨æ”¾åé¢ï¼Œå› ä¸ºè¿™ä¸ªè®¡æ•°è¡¨å¯èƒ½ä¿å­˜äº†å¤šä¸ªä¸šåŠ¡è¡¨çš„è®¡æ•°å€¼ã€‚å¦‚æœæŠŠupdateè®¡æ•°è¡¨æ”¾åˆ°äº‹åŠ¡çš„ç¬¬ä¸€ä¸ªè¯­å¥ï¼Œå¤šä¸ªä¸šåŠ¡è¡¨åŒæ—¶æ’å…¥æ•°æ®çš„è¯ï¼Œç­‰å¾…æ—¶é—´ä¼šæ›´é•¿ã€‚</p><p>è¿™ä¸ªç­”æ¡ˆçš„ç»“è®ºæ˜¯å¯¹çš„ï¼Œä½†æ˜¯ç†è§£ä¸å¤ªæ­£ç¡®ã€‚å³ä½¿æˆ‘ä»¬ç”¨ä¸€ä¸ªè®¡æ•°è¡¨è®°å½•å¤šä¸ªä¸šåŠ¡è¡¨çš„è¡Œæ•°ï¼Œä¹Ÿè‚¯å®šä¼šç»™è¡¨åå­—æ®µåŠ å”¯ä¸€ç´¢å¼•ã€‚ç±»ä¼¼äºä¸‹é¢è¿™æ ·çš„è¡¨ç»“æ„ï¼š</p><pre><code>CREATE TABLE `rows_stat` (
  `table_name` varchar(64) NOT NULL,
  `row_count` int(10) unsigned NOT NULL,
  PRIMARY KEY (`table_name`)
) ENGINE=InnoDB;
</code></pre><p>åœ¨æ›´æ–°è®¡æ•°è¡¨çš„æ—¶å€™ï¼Œä¸€å®šä¼šä¼ å…¥where table_name=$table_nameï¼Œä½¿ç”¨ä¸»é”®ç´¢å¼•ï¼Œæ›´æ–°åŠ è¡Œé”åªä¼šé”åœ¨ä¸€è¡Œä¸Šã€‚</p><p>è€Œåœ¨ä¸åŒä¸šåŠ¡è¡¨æ’å…¥æ•°æ®ï¼Œæ˜¯æ›´æ–°ä¸åŒçš„è¡Œï¼Œä¸ä¼šæœ‰è¡Œé”ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@åŒ—å¤©é­”ç‹¼ã€@æ–œé¢é•œå­ Bil å’Œ@Bin ç­‰åŒå­¦ï¼Œéƒ½ç»™å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼›<br>
@æœç„¶å¦‚æ­¤ åŒå­¦æäº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œè™½ç„¶å¼•å…¥äº‹åŠ¡ï¼Œé¿å…çœ‹åˆ°â€ä¸šåŠ¡ä¸Šè¿˜æ²¡æäº¤çš„æ›´æ–°â€ï¼Œä½†æ˜¯Redisçš„è®¡æ•°è¢«æå‰çœ‹åˆ°äº†ã€‚æ ¸å¿ƒåŸå› è¿˜æ˜¯ä¸¤ä¸ªç³»ç»Ÿï¼Œä¸æ”¯æŒä¸€è‡´æ€§è§†å›¾ï¼›<br>
@ å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸† åŒå­¦çš„é—®é¢˜æé†’äº†å¤§å®¶ï¼Œcount(id)ä¹Ÿæ˜¯å¯ä»¥èµ°æ™®é€šç´¢å¼•å¾—åˆ°çš„ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">å­”ä¹™å·±æ¥åˆ°é…’é¦†å¤§å–Šä¸€å£°è€æ¿æ¥äºŒä¸¤é…’èµŠç€,é…’é¦†ç”Ÿæ„å¤ªå¥½,è€æ¿æŠŠå­”ä¹™å·±çš„æ¬ è´¦è®°å½•è®°åˆ°å°é»‘æ¿ä¸Šå¹¶è®°å½•äº†å­”ä¹™å·±ç‚¹çš„èœå•ã€‚å­”ä¹™å·±è·Ÿåˆ«äººå¹äº†ä¼šç‰›,å¿˜äº†å«çš„å‡ ä¸¤é…’äº†ã€‚åˆç»™è€æ¿è¯´,è€æ¿æŠŠé…’æ”¹æˆäºŒä¸¤ã€‚è€æ¿ä¹Ÿä¸ç¡®å®šå­”ä¹™å·±å«æ²¡å«é…’,å°±å»æŸ¥èœå•,å‘ç°å­”ä¹™å·±ç¡®å®ç‚¹äº†é…’,ä½†æ˜¯æœ¬æ¥å°±äºŒä¸¤,ä¹Ÿå°±éš¾å¾—éº»çƒ¦äº†,åˆè¦ä¿®æ”¹å°é»‘æ¿,åˆè¦æ”¹èœå•ã€‚ç›´æ¥å°±ç»™å­”ä¹™å·±è¯´å·²ç»æ”¹å¥½äº†ã€‚ğŸ˜„ <br></div>
                            <span class="time">2018-12-17 17:07</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è€æ¿çœ‹å®Œæ¿ï¼Œæ­£è¦å‘ŠçŸ¥å­”ä¹™å·±ä»Šæ—¥æ€»è´¦æ˜¯èµŠè´¦äºŒä¸¤é…’ï¼Œ<br>å°äºŒè¿å¿™è¿‡æ¥æ‹¦ä½ï¼Œâ€œè€æ¿ï¼Œåˆšåˆšå­”ä¹™å·±åˆšåˆèµŠè´¦äº†ä¸€ç¢ŸèŒ´é¦™è±†ã€‚â€<br>è€æ¿å¤§æƒŠï¼Œâ€œå·®ç‚¹äºäº†æˆ‘ä¸€ç¢Ÿè±†å­ï¼æˆ‘æ€ä¸çŸ¥ï¼Ÿâ€<br>å°äºŒé“ï¼Œâ€œè€æ¿ä½ æ–¹æ‰çœ‹æ¿çš„ä¹‹æ—¶æ²¡æ‹¿è®°è´¦ç¬”ï¼Œæˆ‘çœ‹è®°è´¦ç¬”æ²¡äººä½¿ç”¨ï¼ŒæŒ‰åº—è§„è‡ªç„¶å¯ç”¨ã€‚è€æ¿ä½ è‡ªå·±æ²¡çœ‹â€<br><br>è€æ¿æƒŠå‘¼ï¼Œâ€œäºçš„ä½ å°å¿ƒâ€ã€‚<br><br>æš—åœ°æƒ³åº—è§„ç¡®æœ‰ä¸å¦¥ã€‚<br><br>äºæ˜¯æŠŠåº—è§„â€œå˜è´¦é¡»ç”¨è®°è´¦ç¬”ã€‚â€ æ”¹ä¸º<br>â€œæ”¹å¸å‡é¡»åŠ¨ç¬”ã€‚çºµä¸ºä¸å˜ä¹‹å¸ï¼Œä»éœ€è¦†å†™ä¹‹â€<br><br>ğŸ˜„</p>
                                <p class="reply-time">2018-12-17 20:50</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/57/96/b65bdf43.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¤ç«è™«</span>
                            </div>
                            <div class="bd">æ—è€å¸ˆçš„æ¯æ¬¡æ›´æ–°æˆ‘éƒ½ä¼šè·Ÿç€çœ‹ è·Ÿç€å­¦ å·²ç»åšæŒ15èŠ‚è¯¾äº† å—ç›Šè‰¯å¤š åªæ˜¯å¿ƒé‡Œæœ‰æ—¶ä¼šåé—®è‡ªå·± åº•å±‚åŸç†æœ‰é‚£ä¹ˆé‡è¦å—ï¼Ÿ ä¼šç”¨ä¸å°±è¡Œäº†å—ï¼Ÿ è‡ªå·±ä¸çŸ¥é“è¯¥æ€ä¹ˆæ¨ç¿»è¿™äº›æƒ³æ³• åŠ ä¸Šè‡ªå·±æœ‰ä¸ªä¸å¥½çš„ä¹ æƒ¯ å°±æ˜¯å®¹æ˜“æ”¾å¼ƒ å¸Œæœ›è‡ªå·±èƒ½å¤ŸåšæŒåˆ°æœ€åã€‚  <br></div>
                            <span class="time">2018-12-17 11:37</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åŠ æ²¹ã€‚<br><br>è¯´ä¸‹æˆ‘è‡ªå·±çš„ç†è§£ã€‚<br><br>æˆ‘åœ¨å¸¦æ–°äººçš„æ—¶å€™ï¼Œè¦æ±‚å¤§å®¶åœ¨å†™SQLè¯­å¥çš„æ—¶å€™ï¼Œå¿ƒé‡Œæ˜¯æœ‰æ•°çš„ï¼ŒçŸ¥é“æ¯ä¸ªè¯­å¥æ‰§è¡Œçš„ç»“æœï¼Œä»¥åŠè¿™äº›ä»£ç ä¼šæ¶ˆè€—ä»€ä¹ˆèµ„æºã€å¦‚æœæ…¢äº†ä¼šæ…¢åœ¨å“ªé‡Œã€æ¯ä¸ªè¯­å¥æ‰§è¡Œä¼šå ç”¨å“ªäº›é”ç­‰ç­‰ã€‚<br><br>æœ‰çš„æ–°äººä¼šé—®â€œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆéº»çƒ¦ï¼Œæˆ‘æ‰§è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹ç»“æœå¯¹ä¸å¯¹ï¼Œå¯¹äº†å°±è¡Œï¼Œä¸å¯¹å°±æ”¹ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ï¼Ÿâ€<br><br>æˆ‘è¯´ä¸å¯ä»¥ã€‚å› ä¸ºå¦‚æœè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¼šå—åˆ°å¾ˆå¤šå±€é™ï¼Œå³ä½¿æˆ‘ä»¬å®šä½è‡ªå·±æ˜¯ä¸šåŠ¡å¼€å‘äººå‘˜ã€‚<br><br>è¿™é‡Œæˆ‘è¯´ä¸€ä¸ªé™åˆ¶ï¼š<br><br>è¿™ä¼šé™åˆ¶åŸºäºæ•°æ®åº“çš„ä¸šåŠ¡æ¶æ„èƒ½åŠ›ã€‚ä¸€ä¸ªè¯­å¥å¯ä»¥è¯•ï¼Œä¸€ä¸ªäº”ä¸ªè¯­å¥çš„äº‹åŠ¡åˆ†æå°±è¦è¯•å¾ˆå¤šæ¬¡ï¼Œä¸€ä¸ªå¤æ‚ä¸šåŠ¡ç³»ç»Ÿçš„æ•°æ®åº“è®¾è®¡ï¼Œæ˜¯è¯•ä¸å‡ºæ¥çš„ã€‚<br><br>åŸç†å¯ä»¥å¸®æˆ‘ä»¬å‰ªæï¼Œæ’é™¤æ‰é‚£äº›ç†è®ºä¸Šæ˜æ˜¾é”™è¯¯çš„æ–¹æ¡ˆï¼Œè¿™æ ·æ‰æœ‰ç²¾åŠ›çœŸçš„å»è¯•é‚£äº›æœ‰é™çš„ã€å¯èƒ½æ­£ç¡®çš„æ–¹æ¡ˆã€‚<br><br><br>æˆ‘ä»¬ä¸éœ€è¦100%ç²¾é€šMySQL(æˆ‘è‡ªå·±ç¦»è¿™ä¸ªç›®æ ‡ä¹Ÿç›¸å»ç”šè¿œï¼‰ï¼Œä½†æ˜¯åªè¦å¤šçŸ¥é“ä¸€äº›åŸç†ï¼Œå°±èƒ½å¤šå‰ªä¸€äº›æï¼Œæ¶æ„è®¾è®¡å°±èƒ½å°‘ä¸€äº›é”™è¯¯é€‰é¡¹çš„å¹²æ‰°ï¼Œè®¾è®¡å‡ºæ¥çš„é¡¹ç›®æ¶æ„æ­£ç¡®çš„å¯èƒ½æ€§æ›´é«˜ã€‚<br><br>æˆ‘è‡ªå·±ç‰¹åˆ«å–œæ¬¢è¿™ä¸ªå‰ªæçš„è¿‡ç¨‹å’Œæ„Ÿè§‰ï¼Œä»–è¡¨ç¤ºæˆ‘ç”¨ä»¥å‰å­¦ä¹ çš„æ—¶é—´ï¼Œæ¥èŠ‚çœäº†ç°åœ¨å·¥ä½œçš„æ—¶é—´ã€‚<br><br><br>å½“ç„¶ï¼Œâ€œåŸç†â€æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ¦‚å¿µï¼Œæœ‰çš„åŸç†æ›´æ¥è¿‘å®æˆ˜ï¼Œæœ‰çš„è¿œä¸€äº›ã€‚è¿™ä¸ªä¸“æ æˆ‘æŒ‘çš„æ˜¯è·Ÿå¹³æ—¶ä½¿ç”¨ç›¸å…³çš„åŸç†ï¼Œä»¥ä¾¿å¤§å®¶å¯ä»¥æœ‰æœºä¼šè¾¹å­¦è¾¹ç”¨ã€‚<br><br>ä¸€èµ·åŠ æ²¹å§ğŸ¤<br><br></p>
                                <p class="reply-time">2018-12-17 12:24</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Gavin</span>
                            </div>
                            <div class="bd">è¯¾åé—®é¢˜ï¼š<br>åœ¨å‘½ä»¤è¡Œå…ˆæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆæ³¨æ„ä¸è¦æäº¤äº‹åŠ¡ï¼‰ï¼š<br>BEGIN;<br>UPDATE t SET a=2 WHERE id=1;<br><br>æ–°å»ºä¸€ä¸ªå‘½ä»¤è¡Œç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br>UPDATE t SET a=2 WHERE id=1;<br><br>ä»æ–°å»ºçš„å‘½ä»¤è¡Œç»ˆç«¯çš„æ‰§è¡Œç»“æœçœ‹ï¼Œè¿™æ¡æ›´æ–°è¯­å¥è¢«é˜»å¡äº†ï¼Œå¦‚æœæ—¶é—´è¶³å¤Ÿçš„è¯ï¼ˆInnoDBè¡Œé”é»˜è®¤ç­‰å¾…æ—¶é—´æ˜¯50ç§’ï¼‰ï¼Œè¿˜ä¼šæŠ¥é”ç­‰å¾…è¶…æ—¶çš„é”™è¯¯ã€‚<br>ç»¼ä¸Šï¼ŒMySQLåº”è¯¥æ˜¯é‡‡ç”¨ç¬¬3ç§æ–¹å¼å¤„ç†é¢˜è¿°åœºæ™¯ã€‚<br><br>å¯¹äºMySQLä¸ºä»€ä¹ˆé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ã€Š08 | äº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹å›¾5çš„æ›´æ–°é€»è¾‘å›¾æ¥è§£é‡Šï¼šå‡è®¾äº‹åŠ¡Cæ›´æ–°åaçš„å€¼å°±æ˜¯2ï¼Œè€Œäº‹åŠ¡Bæ‰§è¡Œå†æ‰§è¡ŒUPDATE t SET a=2 WHERE id=1;æ—¶ä¸æŒ‰ç¬¬3ç§æ–¹å¼å¤„ç†ï¼Œå³ä¸åŠ é”ä¸æ›´æ–°ï¼Œé‚£ä¹ˆåœ¨äº‹åŠ¡Bä¸­æ¥ä¸‹æ¥æŸ¥è¯¢açš„å€¼å°†è¿˜æ˜¯1ï¼Œå› ä¸ºå¯¹äº‹åŠ¡Bæ¥è¯´ï¼Œtrx_idä¸º102ç‰ˆæœ¬çš„æ•°æ®æ˜¯ä¸å¯è§çš„ï¼Œè¿™å°±è¿åäº†â€œå½“å‰è¯»çš„è§„åˆ™â€ã€‚<br><br>ä»¥ä¸Šæ˜¯æˆ‘çš„ç†è§£ä¸åˆ†æï¼Œä¸æ˜¯å¾ˆç¡®å®šå‡†ç¡®ä¸å¦ã€‚<br> <br></div>
                            <span class="time">2018-12-17 17:47</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ¼‚äº®</p>
                                <p class="reply-time">2018-12-17 18:08</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">null</span>
                            </div>
                            <div class="bd">çœ‹åˆ°è‡ªå·±çš„é—®é¢˜ä¸Šæ¦œï¼Œè¿™æ˜¯å¯¹è‡ªå·±çš„æœ€å¤§é¼“åŠ±ã€‚<br><br>å­¦ä¹ ä¸“æ ä¹‹å‰ï¼Œè‡ªå·±åªæ˜¯ä¸€ä¸ª CRUD boyï¼Œå¹³æ—¶åŒäº‹é—´è®¨è®º MySQL çš„é—®é¢˜ï¼Œè‡ªå·±å®Œå…¨æ­ä¸ä¸Šè¯ï¼Œå› ä¸ºå¯¹ MySQL åº•å±‚åŸç†å®Œå…¨ä¸æ‡‚ã€‚å¯¹ MySQL çš„è®¤çŸ¥å°±ä»…é™ä¸€ç‚¹ï¼šç´¢å¼•èƒ½æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆèƒ½æé«˜ï¼Ÿä¸çŸ¥é“ï¼ï¼<br><br>ç°åœ¨å›æƒ³ï¼Œä»¥å‰çŠ¯è¿‡å¾ˆå¤šé”™è¯¯ï¼š<br>1. ä¸»é”®ä½¿ç”¨ UUIDï¼Œéè‡ªå¢ä¸»é”®ã€‚<br>2. æ»¥ç”¨ç´¢å¼•ï¼Œå…¶å®å¯ä»¥é€šè¿‡â€œæœ€å·¦å‰ç¼€åŸåˆ™â€æ¥ç²¾å‡ç´¢å¼•ã€‚<br>3. ä¸ç®¡ SQL è¯­å¥æ˜¯å¦åˆç†ï¼Œåªè¦èƒ½è¿”å›ç»“æœé›†å°±æ˜¯å¥½ SQLã€‚<br>4. å»ºè¡¨æ—¶å­—æ®µç±»å‹æ‹¿æä¸å‡†ã€‚<br><br>ç°åœ¨éƒ½ä¼šåå¤å­¦ä¹ ä¸“æ çš„æ¯ä¸€ç¯‡æ–‡ç« ï¼Œæ¯æ¬¡å­¦ä¹ éƒ½æœ‰ä¸ä¸€æ ·çš„æ”¶è·ã€‚<br>ç¬¬ä¸€æ¬¡å¯èƒ½æ˜¯ï¼šå–”ï¼ŒåŸæ¥æœ‰è¿™ä¹ˆä¸ªçŸ¥è¯†ç‚¹ï¼Œä½†å¯¹å®ƒçš„å®ç°åŸç†ä¸€çŸ¥åŠè§£ã€‚<br>ç¬¬äºŒæ¬¡å´æ˜¯ï¼šå¯¹å®ƒçš„å®ç°åŸç†æœ‰äº†æ›´æ·±çš„è®¤è¯†ï¼ŒåŠ å¼ºå¯¹çŸ¥è¯†çš„ç†è§£ï¼ŒåŸºæœ¬ä¼šå½¢æˆä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„é€»è¾‘ã€‚<br>ç¬¬ä¸‰æ¬¡æ˜¯ï¼ŒMySQL çš„è¿™ç§å®ç°åŸç†ï¼Œæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ç­‰ç­‰ã€‚<br><br>ç°åœ¨æ„Ÿè§‰æœ‰ç‚¹â€œèµ°ç«å…¥é­”â€äº†ï¼Œä»¥å‰æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œå…³æ³¨çš„å¤šä¹…èƒ½è¿”å›ç»“æœé›†ã€‚<br>ç°åœ¨å…³æ³¨çš„å´æ˜¯ï¼šè¿æ¥å™¨ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨å’Œ InnoDB å¼•æ“ã€‚<br>è¿æ¥æˆåŠŸåï¼Œè·å–æˆ‘çš„æƒé™ï¼ŒæŸ¥è¯¢ç¼“å­˜ï¼Œå‘½ä¸­ç¼“å­˜ç›´æ¥è¿”å›ï¼Œå¦åˆ™è¿›è¡Œåç»­çš„æ“ä½œã€‚ï¼ˆè®°å¾—è€å¸ˆç•™è¨€åŒºå›å¤è¿‡ï¼šè¿æ¥å™¨å–æƒé™ï¼Œæ‰§è¡Œå™¨ç”¨æƒé™ã€‚è€Œç¼–å†™ç•™è¨€åˆ°è¿™äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼šæŸ¥è¯¢ç¼“å­˜å‰ï¼Œåº”è¯¥ä¼šæ ¡éªŒæƒé™ï¼Œæ‰€ä»¥è¿æ¥å™¨ä¹Ÿä¼šç”¨æƒé™ï¼Ÿï¼‰<br>åˆ†æå™¨é˜¶æ®µè¿›è¡Œè¯æ³•åˆ†æï¼Œè§£æå…³é”®å­—ï¼Œå­—æ®µåï¼Œè¡¨åç­‰ã€‚è¯­æ³•åˆ†æåˆ¤æ–­è¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚ï¼ˆè®°å¾—ç¬¬ä¸€ç¯‡ã€ŠåŸºç¡€æ¶æ„ã€‹ç•™è¨€æåˆ°è¯­ä¹‰åˆ†æï¼Œä»Šæ™šè¦æ‰¾èµ„æ–™å­¦ä¹ ä¸‹ï¼‰ã€‚<br>ä¼˜åŒ–å™¨é˜¶æ®µç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œé€‰æ‹©ç´¢å¼•ï¼ˆè¿™æ—¶ä¼šæ€€ç–‘ MySQL é€‰æ‹©çš„ç´¢å¼•æ˜¯å¦æœ€ä¼˜ï¼‰ï¼Œèƒ½å¦ä½¿ç”¨ç´¢å¼•ä¸‹æ¨å’Œè¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨æŸ¥è¯¢ï¼Œæé«˜æ€§èƒ½ã€‚<br>æ‰§è¡Œå™¨é˜¶æ®µè°ƒç”¨å¼•æ“æ¥å£æŸ¥è¯¢æ•°æ®ï¼ŒServer å±‚è¦å•¥ï¼Œå¼•æ“ç»™å•¥ï¼ŒInnoDB åªç»™å¿…è¦çš„å€¼ã€‚<br>æŸ¥è¯¢ç»“æŸåï¼Œè¿”å›ç»“æœé›†ï¼Œå¹¶å°†ç»“æœé›†æ”¾å…¥æŸ¥è¯¢ç¼“å­˜ã€‚<br><br>æ›´æ–°è¯­å¥çš„å…³æ³¨ç‚¹æ˜¯éš”ç¦»æ€§ï¼Œè§†å›¾ï¼ŒMVCCï¼Œå›æ»šæ—¥å¿—ï¼Œredo logï¼Œbinlogï¼Œä¸¤é˜¶æ®µæäº¤ç­‰ã€‚<br>å†™ä¸šåŠ¡ä»£ç æ—¶ï¼Œä¼šè€ƒè™‘äº‹åŠ¡å†…çš„ SQL è¯­å¥ï¼Œèƒ½å¦è°ƒæ•´ SQL è¯­å¥çš„é¡ºåºï¼Œå‡å°‘æ›´æ–°è¡¨æ—¶è¡Œé”å¯¹æ€§èƒ½çš„å½±å“ã€‚<br>åœ¨å»ºè¡¨çš„æ—¶ï¼Œä¼šåå¤æ¨æ•²è¿™ä¸ªç´¢å¼•æ˜¯å¦åˆç†ã€‚ä½¿ç”¨æ™®é€šç´¢å¼•è¿˜æ˜¯å”¯ä¸€ç´¢å¼•æ›´ä¸ºåˆé€‚ã€‚èƒ½å¦é€šè¿‡â€œæœ€å·¦å‰ç¼€åŸåˆ™â€æ¥å‡å°‘åˆ›å»ºç´¢å¼•çš„ä¸ªæ•°ã€‚å¦‚æœç´¢å¼•å­—æ®µçš„ç±»å‹æ˜¯å­—ç¬¦ä¸²å¹¶é•¿åº¦å¤ªé•¿ï¼Œå¦‚ä½•ä¼˜åŒ–ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå‡å°‘ç©ºé—´å ç”¨ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚<br><br>å­¦ä¹ ä¸“æ åï¼ŒåŸºæœ¬ä¸Šæ¶‰åŠåˆ° MySQL çš„å†…å®¹ï¼Œè¿™äº›çŸ¥è¯†ç‚¹éƒ½ä¼šæµ®ç°åœ¨è„‘æµ·ä¸­ã€‚æ˜¨å¤©è¿˜å·®ç‚¹åº”ç”¨è¿™äº›çŸ¥è¯†ï¼Œå¸®åŒäº‹ä¼˜åŒ–ä»–çš„ SQL è¯­å¥ã€‚æ˜¨å¤©è·Ÿå¾€å¸¸ä¸€æ ·ï¼Œå½“å†™ä»£ç å†™ç´¯äº†ï¼Œå°±è·‘åˆ°åŒäº‹é‚£æºœè¾¾æºœè¾¾ã€‚<br>ä»–æ­£åœ¨çº¿ä¸Šçš„å¤‡åº“æµ‹è¯•æŸ¥è¯¢ç™¾ä¸‡æ•°æ®è¦å¤šä¹…ï¼Œå¦ä¸€ä½åŒäº‹å»ºè®®ä»–ä½¿ç”¨ force index å¼ºåˆ¶ç´¢å¼•ï¼Œè¿™æ¬¡æ‰§è¡Œ 5 ç§’ï¼Œå†æ‰§è¡Œé›¶ç‚¹å‡ ç§’ã€‚<br>ä»–æƒŠä¹ï¼Œä¸ºå•¥è¿™æ¬¡è¿™ä¹ˆå¿«ã€‚æˆ‘è¯´ï¼Œè¿™æ¬¡æŸ¥äº†ç¼“å­˜ã€‚æˆ‘è¿˜æƒ³å¸®ä»–çœ‹çœ‹ SQL è¯­å¥ï¼Œæ˜¯å¦ MySQL é€‰æ‹©é”™äº†ç´¢å¼•ï¼Œå¯¼è‡´ä½¿ç”¨ force index æ˜¾å¼æŒ‡å®šç´¢å¼•ã€‚è¯´ä¸å®šä½¿ç”¨ order by field å°±è§£å†³äº†å‘¢ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚åé¢æœ‰äº‹ï¼Œæ²¡æœ‰ç»§ç»­è·Ÿè¿›ä»–è¿™é—®é¢˜äº†ã€‚<br><br>éå¸¸æ„Ÿæ©ï¼Œè·Ÿç€è€å¸ˆå­¦ä¹ ï¼Œè®©æˆ‘ä½“ä¼šåˆ°äº†å­¦ä¹ æ˜¯ä¸€ä»¶è‡ªç„¶è€Œåˆå……æ»¡é­…åŠ›çš„äº‹æƒ…ï¼Œä¹Ÿè®©æˆ‘ä»ä¸€ä¸ªåŸºç¡€ä¸ç‰¢å›ºçš„å°ç™½ï¼Œä¸€æ­¥æ­¥åœ°å……å®äº†è‡ªå·±çš„çŸ¥è¯†åº“ï¼Œå¦å¤–è€å¸ˆéå¸¸å°½è´£ï¼Œç»å¸¸åŠå¤œå›å¤ç­”ç–‘ï¼Œå¸Œæœ›è€å¸ˆä¿é‡èº«ä½“ã€‚è°¢è°¢ï¼ï¼ <br></div>
                            <span class="time">2018-12-18 14:11</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">â€œæˆ‘è¯´ï¼Œè¿™æ¬¡æŸ¥äº†ç¼“å­˜â€<br><br>å“ˆå“ˆï¼Œè¿™ä¸ªåœºæ™¯å¥½æ£’ï¼Œè¿™ä¸ªç”»é¢æ„Ÿï¼Œæœ‰ä¸€ç§æ‰«åœ°åƒ§çš„æ„Ÿè§‰ğŸ‘ğŸ¿<br><br>ä¸€èµ·åŠ æ²¹<br><br></p>
                                <p class="reply-time">2018-12-18 15:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åŠ›æŒ½ç‹‚æ¾œçˆ†ç‚¸è¾“å‡ºçš„è‡­è‡­å®</span>
                            </div>
                            <div class="bd">é’ˆå¯¹ä¸èƒ½åªç”¨binlogå®Œæˆæ•°æ®æ¢å¤æˆ‘çš„ç†è§£ï¼š<br>æŒ‰ç…§æ–‡ä¸­è¿™ä¸ªè¯é¢˜ä¸‹çš„ç¤ºä¾‹ï¼Œå› ä¸ºMySQLå†™æ•°æ®æ˜¯å†™åœ¨å†…å­˜é‡Œçš„ï¼Œä¸ä¿è¯è½ç›˜ï¼Œæ‰€ä»¥commit1çš„æ•°æ®ä¹Ÿå¯èƒ½ä¸¢å¤±ï¼›ä½†æ˜¯æ¢å¤åªæ¢å¤binlogå¤±è´¥çš„ä¹Ÿå°±æ˜¯commit2çš„æ•°æ®ï¼Œæ‰€ä»¥æ•°æ®ä¼šä¸¢å¤±ã€‚<br>è¿™æ ·ç†è§£å¯¹å—ï¼Ÿ <br></div>
                            <span class="time">2018-12-20 20:36</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„ï¼Œbinlogä¸€æ¥æ—¶æœºæ§åˆ¶ä¸å¥½ï¼ˆå°±æ˜¯ä½ è¯´çš„è¿™ä¸ªï¼‰ï¼ŒäºŒæ¥å†…å®¹çš„èƒ½åŠ›ä¸è¶³ï¼ˆæ²¡æœ‰é¡µé¢ä¿¡æ¯ï¼‰<br>ğŸ‘ğŸ¿<br></p>
                                <p class="reply-time">2018-12-20 22:16</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/1f/ff/aadcf237.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Eric</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæ‚¨å®åœ¨æ˜¯å¤ªè‰¯å¿ƒäº†ã€‚æ•´ç†è¿™äº›é—®é¢˜åº”è¯¥å¾ˆè´¹æ—¶é—´å§ã€‚çœ‹å®Œç­”ç–‘ä¹‹åæ„Ÿè§‰åˆåŠ æ·±äº†ä¸€éå°è±¡ã€‚åƒå¾ˆå¤šçŸ¥è¯†ç‚¹éƒ½éœ€è¦åå¤ç†è§£æ‰èƒ½çœŸæ­£æŒæ¡ã€‚ç­”ç–‘æ¥çš„å¾ˆåŠæ—¶ï¼Œæ„Ÿè°¢ï¼ <br></div>
                            <span class="time">2018-12-17 09:47</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/fc/e5/c26c67ea.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é™ˆæ–°ä»</span>
                            </div>
                            <div class="bd">ã€æ“ä½œç¬¦â€œ|â€æ˜¯é€»è¾‘æˆ–ï¼Œè¿åŒæœ€åä¸€å¥insertè¯­å¥é‡Œ...ã€‘<br>è€å¸ˆï¼Œâ€œ|â€ è¿™åº”è¯¥å«ä½è¿ç®—ç¬¦çš„æŒ‰ä½æˆ–æ“ä½œç¬¦ï¼Œé€»è¾‘æˆ–æ˜¯â€œ||â€å§ï¼Ÿ<br>è¿™é‡Œçš„å¹‚ç­‰æ€§åŸç†å°±æ˜¯ï¼šA &lt; B: relation_ship = 2 | 1; A &gt; B:relation_ship = 1 | 2ï¼›é‡å¤æ’å…¥ 3 | 1 æˆ–è€… 3 | 2 ã€‚ä½è¿ç®—ï¼š 2 | 1 == 1 | 2 == 3 | 1 == 3 | 2 == 3ã€‚æ„Ÿè§‰è¿™é‡Œæƒ³æ³•å¾ˆå·§å¦™ã€‚ <br></div>
                            <span class="time">2018-12-17 11:26</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ è¯´å¾—å¯¹ï¼Œæ˜¯æŒ‰ä½æˆ–ï¼Œçœ‹å¾—å¾ˆç»†è‡´ğŸ‘ğŸ¿<br><br>æˆ‘å‘ä¸ªå ªè¯¯</p>
                                <p class="reply-time">2018-12-17 14:16</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/18/22/e817914c.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">äºæµ·</span>
                            </div>
                            <div class="bd">åœ¨æå®¢æ—¶é—´ä¹Ÿå­¦äº†ä¸å°‘è¯¾ç¨‹ï¼Œæ—è€å¸ˆæ˜¯è¿™å…¶ä¸­æœ€è®¤çœŸè´Ÿè´£çš„ï¼Œå¥½çš„è¯¾ç¨‹æ˜¯ç”¨â€œå¿ƒâ€å†™å‡ºæ¥çš„ <br></div>
                            <span class="time">2018-12-17 16:05</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è°¢è°¢ğŸ™ <br>å¸Œæœ›å¤§å®¶éƒ½æœ‰æ”¶è·</p>
                                <p class="reply-time">2018-12-17 18:14</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/84/49/abb7bfe3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è§‚å¼ˆé“äºº</span>
                            </div>
                            <div class="bd">è¤ç«è™«çš„é—®é¢˜åº”è¯¥æ˜¯é“å‡ºäº†å¾ˆå¤šä¸šåŠ¡å¼€å‘çš„å¿ƒå£°ï¼Œå·¥å…·æœ¬æ¥æ˜¯æ–¹ä¾¿å¼€å‘äººå‘˜çš„å´å¸¦æ¥äº†å¾ˆå¤§å­¦ä¹ è´Ÿæ‹…ï¼Œå¦‚springboot æœ¬æ¥æ˜¯ä¸ºæ–¹ä¾¿ä½¿ç”¨spring,ç°åœ¨å¸‚åœºç¯å¢ƒï¼ˆæ‹›è˜æ–¹ï¼‰è¦æ±‚æ‡‚å®ƒçš„åŸç†ï¼Œå¯¼è‡´å¤§é‡ç²¾åŠ›æŠ•å…¥å­¦ä¹ è¿™äº›ä¸Šå±‚çŸ¥è¯†ï¼Œä¸æ–­è¿­ä»£ç‰ˆæœ¬ä¸æ–­è·Ÿè¿›ã€‚ <br></div>
                            <span class="time">2018-12-26 08:04</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">éƒ­æ±Ÿä¼Ÿ</span>
                            </div>
                            <div class="bd">åˆ›å»ºæµ‹è¯•æ•°æ®ï¼š<br>mysql&gt; create table t(id int primary key auto_increment,a int );<br>mysql&gt; insert into t values(1,2);<br>mysql&gt; begin;<br>Query OK, 0 rows affected (0.00 sec)<br>mysql&gt; update t set a=2 where id=1;<br>Query OK, 0 rows affected (0.00 sec)<br>æŸ¥çœ‹ç³»ç»Ÿé”æƒ…å†µï¼š<br>show engine innodb status<br>---TRANSACTION 958998, ACTIVE 51 sec<br>2 lock struct(s), heap size 1136, 1 row lock(s)<br>MySQL thread id 2, OS thread handle 139663691581184, query id 22 localhost root<br>mysql&gt; show processlist;<br>+----+------+-----------+--------------------+---------+------+----------+------------------+<br>| Id | User | Host      | db                 | Command | Time | State    | Info             |<br>+----+------+-----------+--------------------+---------+------+----------+------------------+<br>|  2 | root | localhost | sysbench           | Sleep   |  352 |          | NULL             |<br>|  3 | root | localhost | NULL               | Sleep   |  301 |          | NULL             |<br>+----+------+-----------+--------------------+---------+------+----------+------------------+<br>å…¶ä¸­Thread id=2 ä¸ºupdateä¼šè¯ï¼Œè¯´æ˜ç³»ç»Ÿæœ‰é”<br>å¦ä¸€ä¼šè¯æ‰§è¡Œ update t set a=2 where id=1;<br>ERROR 1205 (HY000): Unknown error 1205 MySQL error code 1205 (ER_LOCK_WAIT_TIMEOUT): Lock wait timeout exceeded; try restarting transaction<br>æäº¤ç¬¬ä¸€ä¸ªä¼šè¯æŸ¥çœ‹ç”Ÿæˆçš„binlog<br>### INSERT INTO `sysbench`.`t`<br>### SET<br>###   @1=1 &#47;* INT meta=0 nullable=0 is_null=0 *&#47;<br>###   @2=2 &#47;* INT meta=0 nullable=1 is_null=0 *&#47;<br># at 858<br>#181217 14:28:21 server id 9012  end_log_pos 889 CRC32 0xf96f7fcb 	Xid = 20<br>COMMIT&#47;*!*&#47;;<br># at 889<br>#181217 14:42:14 server id 9012  end_log_pos 930 CRC32 0x3de034ba 	Rotate to bin.000089  pos: 4<br>SET @@SESSION.GTID_NEXT= &#39;AUTOMATIC&#39; &#47;* added by mysqlbinlog *&#47; &#47;*!*&#47;;<br>DELIMITER ;<br># End of log file<br>&#47;*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*&#47;;<br>&#47;*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*&#47;;<br>å‘ç°æ²¡æœ‰updateçš„binlogäº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¯­å¥åœ¨serverå±‚æ²¡æœ‰å®é™…æ‰§è¡Œ<br>ç”¨hexdumpå¯¹æ¯”updateå‰åçš„æ•°æ®è¡Œï¼Œå‘ç°äº‹åŠ¡idå’Œå›æ»šidä¹Ÿæ²¡å˜ï¼Œè¯´æ˜innodbæ²¡æœ‰å®é™…æ›´æ–°è¡Œã€‚<br>é‰´äºè¯¥è¯­å¥äº§ç”Ÿäº†è¡Œé”ï¼Œæœ‰äº‹åŠ¡ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å®é™…ä¿®æ”¹ï¼Œå¯åˆ¤æ–­innodbåœ¨æ›´æ–°å‰åå€¼ä¸€æ ·æ—¶ä¸ä¼šå®é™…æ›´æ–°æ•°æ® <br></div>
                            <span class="time">2018-12-17 15:13</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">Hexdumpå‰æœ‰æ²¡æœ‰å…³é—­MySQL?</p>
                                <p class="reply-time">2018-12-17 22:10</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/b7/00/12149f4e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">éƒ­åˆš</span>
                            </div>
                            <div class="bd">ç»“è®ºæ˜¯æ–¹å¼3ï¼š<br>autocommitè®¾ç½®çš„æ˜¯0<br><br>å®éªŒè¿‡ç¨‹ï¼š<br>session1:<br>mysql&gt; update t set a=2 where id=1;<br>Query OK, 0 rows affected (0.00 sec)<br>Rows matched: 1  Changed: 0  Warnings: 0<br>session2:<br>mysql&gt; update t set a=2 where id=1;<br>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction <br></div>
                            <span class="time">2018-12-17 17:54</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">è€å¸ˆæå‡ ä¸ªé—®é¢˜ï¼š<br>1.äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œbinlogæ˜¯å¦åƒredo logä¸€æ ·è®°å½•åˆ°binlog_cacheé‡Œï¼Ÿ<br>2.ä¸ºä»€ä¹ˆæŠŠredo log bufferè®¾ç½®æˆå…¨å±€å‚æ•°ï¼Œbinlog cacheè®¾ç½®ä¸ºäº‹åŠ¡çº§åˆ«å‚æ•°ï¼Ÿ<br>3.ä¸ºä»€ä¹ˆä¸€èˆ¬æ˜¯binlogè½ç›˜æ¯”redo logæ›´è€—æ—¶ï¼Ÿ<br>4.å¦‚æœsyncä¸º1ï¼Œdumpçº¿ç¨‹æ˜¯ç­‰åˆ°binlog æˆåŠŸflushï¼Œå†ä»binlog cacheä¸­æŠŠbinlog eventå‘é€ç»™ä»åº“ï¼Ÿå¦‚æœé1,æ˜¯åœ¨æœ€åxidå†™å…¥å°±ä»binlog cacheä¸­æŠŠbinlog eventå‘é€ç»™ä»åº“ï¼Ÿ <br></div>
                            <span class="time">2018-12-17 01:22</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. å—¯ï¼Œå®ƒæœ‰å•ç‹¬çš„å†…å­˜ï¼Œredo log buffer<br><br>2. Binlog cache sizeä¹Ÿæ˜¯global çš„å‘€ï¼Œæˆ‘è¿˜å»ç¡®è®¤äº†5.5ï½5.7ï¼Œä½ ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬ï¼Ÿ<br><br>3. è¿™ä¸ªæ•°æ®æ˜¯æ€ä¹ˆå¾—åˆ°çš„ğŸ˜„<br><br>4. å†™å®Œç£ç›˜å°±å‘ï¼Œç„¶åå†å›æ¥flushã€‚ <br>     ä¸æ˜¯ï¼Œæ”¾åœ¨binlog cacheè¡¨ç¤ºâ€œè¿™äº‹åŠ¡è¿˜æ²¡åšå®Œâ€ï¼Œä¸å‘çš„</p>
                                <p class="reply-time">2018-12-17 11:55</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/84/49/abb7bfe3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è§‚å¼ˆé“äºº</span>
                            </div>
                            <div class="bd">ä¸è€å¸ˆï¼Œä¸å¥½æ„æ€ï¼Œåˆšæ‰æçš„A &gt; B, A &lt; Bé—®é¢˜ï¼Œæˆ‘è¦å†é‡å¤ä¸€ä¸‹ã€‚A &gt; B: åº”è¯¥æ˜¯è¡¨ç¤ºå½“å‰ä¸šåŠ¡æ“ä½œä¸ºAç”¨æˆ·å…³æ³¨Bç”¨æˆ·, sqlä¸º: insert into like(&#39;a_user_id&#39;, &#39;b_user_id&#39;, 1), å¦‚æœåå‘å…³è”åˆ™ä¸ºinsert into like(&#39;b_user_id&#39;, &#39;a_user_id&#39;, 2), äº’ç›¸å…³è”åˆ™relation_ship update ä¸º3, æ‚¨çš„æ„æ€æ˜¯é€šè¿‡relation_shipè¡¨ç¤ºuser_id,liker_idå“ªä¸ªä¸ºè¢«å…³æ³¨æ–¹,å“ªä¸ªæ˜¯å…³æ³¨æ–¹ï¼Œæ‰€ä»¥ï¼Œæˆ‘è¿˜æ˜¯ç†è§£ A &gt; B ,ä¸åº”è¯¥ç†è§£æˆ A å¤§äº B,è€Œæ˜¯A å…³æ³¨ Bï¼Œæˆ‘è®¤ä¸ºA å¤§äº Bçš„æ¯”è¾ƒæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ¯”è¾ƒç–‘æƒ‘æˆ‘è¿™æ ·ç†è§£åå·®åœ¨å“ªé‡Œ?ğŸ˜– <br></div>
                            <span class="time">2019-01-02 16:59</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸æ˜¯Aå…³æ³¨Bï¼Œå°±æ˜¯Aå¤§äºBï¼Œè¯´çš„æ˜¯ç”¨æˆ·idå“¦</p>
                                <p class="reply-time">2019-01-02 17:26</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/94/59/ac2aa72b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Smile</span>
                            </div>
                            <div class="bd">å¦‚æœ A&gt;Bï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„é€»è¾‘<br><br>&#47;* ä»£ç ä¸­åˆ¤æ–­è¿”å›çš„ relation_ship.....<br>å¦‚æœæ˜¯ 1ï¼Œäº‹åŠ¡ç»“æŸï¼Œæ‰§è¡Œ commit<br>----------<br>è€å¸ˆï¼Œè¿™é‡Œåº”è¯¥ä¸º â€œå¦‚æœæ˜¯2â€ å§<br><br> <br></div>
                            <span class="time">2018-12-18 16:53</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„æ˜¯çš„ï¼Œ<br>æˆ‘ä»ä¸Šé¢æ‹·ä¸‹æ¥åæ³¨é‡Šå¿˜è®°æ”¹äº†ï¼Œ<br><br>ä½ çœ‹å¾—å¥½ç»†è‡´ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-18 17:43</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e1/e7/d1b2e914.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ˜äº®</span>
                            </div>
                            <div class="bd">æ¥ä¸Šä¸€ä¸ªæé—®ï¼Œå¦‚æœç»™redoæ€»ä½“å¤§å°è®¾ç½®4Gï¼Œè¿™æ—¶åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å†™10Gæ•°æ®æ˜¯å¦å¯æˆåŠŸè¡Œå‘¢ï¼Ÿ <br></div>
                            <span class="time">2018-12-18 12:55</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">mahonebags</span>
                            </div>
                            <div class="bd">æˆ‘ç»™è¡¨æ–°åŠ äº†ä¸€ä¸ªupdate_time on update current_timestampå­—æ®µï¼Œå‘ç°ä¼šåŠ é”ï¼Œä½†æ˜¯æäº¤åupdate_timeä¸ä¼šå˜åŒ–ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰binlogç”Ÿæˆï¼Œæ‰€ä»¥æ˜¯åŠ é”äº†ä½†æ˜¯å®é™…æ²¡æ›´æ–°ï¼Ÿ <br></div>
                            <span class="time">2018-12-18 10:06</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/78/31/c7f8d1db.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Laputa</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œé—´éš™é”æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ<br>å®é™…ä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š<br>å‡å¦‚æˆ‘æœ‰ä¸€å¼ è¡¨ table1ï¼Œidåˆ—ä¸ºä¸»é”®<br>äº‹åŠ¡1ï¼š<br>begin;<br>select * from table1 where id = 1 for update;<br>æ­¤æ—¶å¼€å§‹äº‹åŠ¡2ï¼š<br>begin;<br>select * from table1 where id = 1 for update;<br>äº‹åŠ¡1ç»§ç»­æ‰§è¡Œï¼š<br>#è‹¥idä¸º1çš„è®°å½•ä¸å­˜åœ¨åˆ™æ‰§è¡Œï¼š<br>insert into table1 values(1);<br>æ­¤æ—¶äº‹åŠ¡1ä¼šé˜»å¡,åº”è¯¥æ˜¯åœ¨è·å–é”ï¼›<br>ç„¶åäº‹åŠ¡2ä¹Ÿä¼šæ‰§è¡ŒåŒæ ·çš„é€»è¾‘ï¼Œå› ä¸ºidä¸º1çš„è®°å½•ä¸å­˜åœ¨ï¼Œä¹Ÿä¼šæ‰§è¡Œæ’å…¥æ“ä½œï¼š<br>insert into table1 values(1);<br>æ­¤æ—¶äº‹åŠ¡2ä¼šæŠ¥æ­»é”ï¼Œäº‹åŠ¡1ä¼šæ‰§è¡ŒæˆåŠŸï¼š<br>Deadlock found when trying to get lock; try restarting transactionï¼›<br><br>ä¸šåŠ¡ä¸Šçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š<br>æ ¹æ®IDæŸ¥æ‰¾å¯¹åº”çš„è®°å½•ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ’å…¥å¯¹åº”çš„è®°å½•ï¼Œè‹¥å­˜åœ¨å°±æ›´æ–°å¯¹åº”çš„è®°å½•ï¼Œå½“æœ‰ä¸¤ä¸ªè¯·æ±‚åŒæ—¶æ‰§è¡Œæ­¤é€»è¾‘ä¸”å¯¹åº”IDä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè€å¸ˆèƒ½ä¸è§£é‡Šä¸‹é—´éš™é”å’Œå¦‚ä½•é¿å…æ­¤ç§æƒ…å†µçš„æ­»é”ï¼Œè°¢è°¢ <br></div>
                            <span class="time">2018-12-17 23:22</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™çœŸæ˜¯ä¸ªå¥½é—®é¢˜ï¼Œç¬¬21ç¯‡ä¼šè®²åˆ°</p>
                                <p class="reply-time">2018-12-19 02:42</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/46/56/5e83f44b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Dkey</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹<br>1. redo logè·Ÿbinlogéƒ½æ˜¯åœ¨commité˜¶æ®µè¿›è¡Œsyncç£ç›˜æ“ä½œçš„å—ï¼ˆåŒ1ï¼‰<br>2. masterçº¿ç¨‹æ¯ç§’ä¹Ÿä¼šåˆ·ç›˜redo logè·Ÿcommité˜¶æ®µåˆ·ç›˜æ˜¯ä¸å†²çªçš„å§ã€‚<br>3. sync_binlogä¸º1æ—¶å‘é€binlogæ˜¯åœ¨syncåˆ°ç£ç›˜ä¹‹åå—ï¼Ÿåä¹‹æ˜¯åœ¨flushä¹‹åã€‚è¢«å‘é€çš„binlogæ˜¯ä»binlogæ–‡ä»¶è¯»å–å‡ºæ¥çš„ã€‚<br>æ„Ÿè°¢å›ç­” <br></div>
                            <span class="time">2018-12-17 13:28</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/9f/1d/ec173090.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">melon</span>
                            </div>
                            <div class="bd">æ€è€ƒé¢˜ï¼šåº”è¯¥æ˜¯ç¬¬ä¸‰ç§ï¼Œå› ä¸ºä¸¤ä¸ªäº‹åŠ¡å¹¶è¡Œæ‰§è¡Œè¯¥updateï¼Œæœ‰ä¸€ä¸ªä¼šå¡ä½ï¼Œè¯´æ˜æœ‰åŠ é”ï¼Œè€Œä¸”updateè¯­å¥æ‰§è¡Œåï¼ŒæŸ¥çœ‹ibdæ–‡ä»¶å’Œredo logæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´éƒ½æ›´æ–°äº†ã€‚é€šè¿‡show engine innodb status è¿›ä¸€æ­¥éªŒè¯ï¼ŒæŸ¥çœ‹LSNç¡®å®å¢åŠ äº†ï¼Œè€Œä¸”Number of rows updated ä¹ŸåŠ +1äº†ã€‚ <br></div>
                            <span class="time">2018-12-17 13:24</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¿¡ä¿¡</span>
                            </div>
                            <div class="bd">å¦‚æœå›¾1çš„â€œå†™å…¥redo logâ€æ˜¯å†™å†…å­˜ï¼Œå½“æ—¶åˆ»Bå‘ç”Ÿcrashï¼Œé‡å¯åè¿™éƒ¨åˆ†redo logéƒ½ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆä½•è°ˆåˆ¤æ–­redo logæ˜¯å¦æœ‰å®Œæ•´çš„prepareè¿˜æ˜¯commitæ ‡å¿—å‘¢ï¼Ÿ <br></div>
                            <span class="time">2018-12-17 13:14</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸æ˜¯å“¦ï¼Œ<br>åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´æ˜¯åœ¨redo log buffer.<br><br>åœ¨å›¾ä¸­å†™binlogä¹‹å‰ï¼Œå°±å·²ç»éƒ½å†™äº†ç›˜å¹¶ä¸”fsyncäº†</p>
                                <p class="reply-time">2018-12-17 22:15</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>