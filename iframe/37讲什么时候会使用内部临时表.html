<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                37è®²ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/04/2d/041a7e2f4ba932d3cb6cbeac6264412d.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="37è®²ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="37è®²ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p><span class="orange">ä»Šå¤©æ˜¯å¤§å¹´åˆäºŒï¼Œåœ¨å¼€å§‹æˆ‘ä»¬ä»Šå¤©çš„å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘è¦å…ˆå’Œä½ é“ä¸€å£°æ˜¥èŠ‚å¿«ä¹ï¼</span></p><p>åœ¨<a href="https://time.geekbang.org/column/article/73479">ç¬¬16</a>å’Œ<a href="https://time.geekbang.org/column/article/79700">ç¬¬34</a>ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘åˆ†åˆ«å’Œä½ ä»‹ç»äº†sort bufferã€å†…å­˜ä¸´æ—¶è¡¨å’Œjoin bufferã€‚è¿™ä¸‰ä¸ªæ•°æ®ç»“æ„éƒ½æ˜¯ç”¨æ¥å­˜æ”¾è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸­é—´æ•°æ®ï¼Œä»¥è¾…åŠ©SQLè¯­å¥çš„æ‰§è¡Œçš„ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬åœ¨æ’åºçš„æ—¶å€™ç”¨åˆ°äº†sort bufferï¼Œåœ¨ä½¿ç”¨joinè¯­å¥çš„æ—¶å€™ç”¨åˆ°äº†join bufferã€‚</p><p>ç„¶åï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼ŒMySQLä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨å‘¢ï¼Ÿ</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°±å…ˆç»™ä½ ä¸¾ä¸¤ä¸ªéœ€è¦ç”¨åˆ°å†…éƒ¨ä¸´æ—¶è¡¨çš„ä¾‹å­ï¼Œæ¥çœ‹çœ‹å†…éƒ¨ä¸´æ—¶è¡¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ç„¶åï¼Œæˆ‘ä»¬å†æ¥åˆ†æï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ã€‚</p><h1>union æ‰§è¡Œæµç¨‹</h1><p>ä¸ºäº†ä¾¿äºé‡åŒ–åˆ†æï¼Œæˆ‘ç”¨ä¸‹é¢çš„è¡¨t1æ¥ä¸¾ä¾‹ã€‚</p><pre><code>create table t1(id int primary key, a int, b int, index(a));
delimiter ;;
create procedure idata()
begin
  declare i int;

  set i=1;
  while(i&lt;=1000)do
    insert into t1 values(i, i, i);
    set i=i+1;
  end while;
end;;
delimiter ;
call idata();
</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢è¿™æ¡è¯­å¥ï¼š</p><pre><code>(select 1000 as f) union (select id from t1 order by id desc limit 2);
</code></pre><p>è¿™æ¡è¯­å¥ç”¨åˆ°äº†unionï¼Œå®ƒçš„è¯­ä¹‰æ˜¯ï¼Œå–è¿™ä¸¤ä¸ªå­æŸ¥è¯¢ç»“æœçš„å¹¶é›†ã€‚å¹¶é›†çš„æ„æ€å°±æ˜¯è¿™ä¸¤ä¸ªé›†åˆåŠ èµ·æ¥ï¼Œé‡å¤çš„è¡Œåªä¿ç•™ä¸€è¡Œã€‚</p><p>ä¸‹å›¾æ˜¯è¿™ä¸ªè¯­å¥çš„explainç»“æœã€‚</p><p><img src="https://static001.geekbang.org/resource/image/40/4e/402cbdef84eef8f1b42201c6ec4bad4e.png" alt=""></p><center><span class="reference">å›¾1 unionè¯­å¥explain ç»“æœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul>
<li>ç¬¬äºŒè¡Œçš„key=PRIMARYï¼Œè¯´æ˜ç¬¬äºŒä¸ªå­å¥ç”¨åˆ°äº†ç´¢å¼•idã€‚</li>
<li>ç¬¬ä¸‰è¡Œçš„Extraå­—æ®µï¼Œè¡¨ç¤ºåœ¨å¯¹å­æŸ¥è¯¢çš„ç»“æœé›†åšunionçš„æ—¶å€™ï¼Œä½¿ç”¨äº†ä¸´æ—¶è¡¨(Using temporary)ã€‚</li>
</ul><!-- [[[read_end]]] --><p>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>åˆ›å»ºä¸€ä¸ªå†…å­˜ä¸´æ—¶è¡¨ï¼Œè¿™ä¸ªä¸´æ—¶è¡¨åªæœ‰ä¸€ä¸ªæ•´å‹å­—æ®µfï¼Œå¹¶ä¸”fæ˜¯ä¸»é”®å­—æ®µã€‚</p>
</li>
<li>
<p>æ‰§è¡Œç¬¬ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œå¾—åˆ°1000è¿™ä¸ªå€¼ï¼Œå¹¶å­˜å…¥ä¸´æ—¶è¡¨ä¸­ã€‚</p>
</li>
<li>
<p>æ‰§è¡Œç¬¬äºŒä¸ªå­æŸ¥è¯¢ï¼š</p>
<ul>
<li>æ‹¿åˆ°ç¬¬ä¸€è¡Œid=1000ï¼Œè¯•å›¾æ’å…¥ä¸´æ—¶è¡¨ä¸­ã€‚ä½†ç”±äº1000è¿™ä¸ªå€¼å·²ç»å­˜åœ¨äºä¸´æ—¶è¡¨äº†ï¼Œè¿åäº†å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥æ’å…¥å¤±è´¥ï¼Œç„¶åç»§ç»­æ‰§è¡Œï¼›</li>
<li>å–åˆ°ç¬¬äºŒè¡Œid=999ï¼Œæ’å…¥ä¸´æ—¶è¡¨æˆåŠŸã€‚</li>
</ul>
</li>
<li>
<p>ä»ä¸´æ—¶è¡¨ä¸­æŒ‰è¡Œå–å‡ºæ•°æ®ï¼Œè¿”å›ç»“æœï¼Œå¹¶åˆ é™¤ä¸´æ—¶è¡¨ï¼Œç»“æœä¸­åŒ…å«ä¸¤è¡Œæ•°æ®åˆ†åˆ«æ˜¯1000å’Œ999ã€‚</p>
</li>
</ol><p>è¿™ä¸ªè¿‡ç¨‹çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/5d/0e/5d038c1366d375cc997005a5d65c600e.jpg" alt=""></p><center><span class="reference">å›¾ 2 union æ‰§è¡Œæµç¨‹</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„å†…å­˜ä¸´æ—¶è¡¨èµ·åˆ°äº†æš‚å­˜æ•°æ®çš„ä½œç”¨ï¼Œè€Œä¸”è®¡ç®—è¿‡ç¨‹è¿˜ç”¨ä¸Šäº†ä¸´æ—¶è¡¨ä¸»é”®idçš„å”¯ä¸€æ€§çº¦æŸï¼Œå®ç°äº†unionçš„è¯­ä¹‰ã€‚</p><p>é¡ºä¾¿æä¸€ä¸‹ï¼Œå¦‚æœæŠŠä¸Šé¢è¿™ä¸ªè¯­å¥ä¸­çš„unionæ”¹æˆunion allçš„è¯ï¼Œå°±æ²¡æœ‰äº†â€œå»é‡â€çš„è¯­ä¹‰ã€‚è¿™æ ·æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¾æ¬¡æ‰§è¡Œå­æŸ¥è¯¢ï¼Œå¾—åˆ°çš„ç»“æœç›´æ¥ä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ï¼Œå‘ç»™å®¢æˆ·ç«¯ã€‚å› æ­¤ä¹Ÿå°±ä¸éœ€è¦ä¸´æ—¶è¡¨äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/c1/6d/c1e90d1d7417b484d566b95720fe3f6d.png" alt=""></p><center><span class="reference">å›¾3 union allçš„explainç»“æœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒè¡Œçš„Extraå­—æ®µæ˜¾ç¤ºçš„æ˜¯Using indexï¼Œè¡¨ç¤ºåªä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œæ²¡æœ‰ç”¨ä¸´æ—¶è¡¨äº†ã€‚</p><h1>group by æ‰§è¡Œæµç¨‹</h1><p>å¦å¤–ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨ä¸´æ—¶è¡¨çš„ä¾‹å­æ˜¯group byï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªè¯­å¥ï¼š</p><pre><code>select id%10 as m, count(*) as c from t1 group by m;
</code></pre><p>è¿™ä¸ªè¯­å¥çš„é€»è¾‘æ˜¯æŠŠè¡¨t1é‡Œçš„æ•°æ®ï¼ŒæŒ‰ç…§ id%10 è¿›è¡Œåˆ†ç»„ç»Ÿè®¡ï¼Œå¹¶æŒ‰ç…§mçš„ç»“æœæ’åºåè¾“å‡ºã€‚å®ƒçš„explainç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/3d/98/3d1cb94589b6b3c4bb57b0bdfa385d98.png" alt=""></p><center><span class="reference">å›¾4 group by çš„explainç»“æœ</span></center><p>åœ¨Extraå­—æ®µé‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªä¿¡æ¯ï¼š</p><ul>
<li>Using indexï¼Œè¡¨ç¤ºè¿™ä¸ªè¯­å¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œé€‰æ‹©äº†ç´¢å¼•aï¼Œä¸éœ€è¦å›è¡¨ï¼›</li>
<li>Using temporaryï¼Œè¡¨ç¤ºä½¿ç”¨äº†ä¸´æ—¶è¡¨ï¼›</li>
<li>Using filesortï¼Œè¡¨ç¤ºéœ€è¦æ’åºã€‚</li>
</ul><p>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>åˆ›å»ºå†…å­˜ä¸´æ—¶è¡¨ï¼Œè¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µmå’Œcï¼Œä¸»é”®æ˜¯mï¼›</p>
</li>
<li>
<p>æ‰«æè¡¨t1çš„ç´¢å¼•aï¼Œä¾æ¬¡å–å‡ºå¶å­èŠ‚ç‚¹ä¸Šçš„idå€¼ï¼Œè®¡ç®—id%10çš„ç»“æœï¼Œè®°ä¸ºxï¼›</p>
<ul>
<li>å¦‚æœä¸´æ—¶è¡¨ä¸­æ²¡æœ‰ä¸»é”®ä¸ºxçš„è¡Œï¼Œå°±æ’å…¥ä¸€ä¸ªè®°å½•(x,1);</li>
<li>å¦‚æœè¡¨ä¸­æœ‰ä¸»é”®ä¸ºxçš„è¡Œï¼Œå°±å°†xè¿™ä¸€è¡Œçš„cå€¼åŠ 1ï¼›</li>
</ul>
</li>
<li>
<p>éå†å®Œæˆåï¼Œå†æ ¹æ®å­—æ®µmåšæ’åºï¼Œå¾—åˆ°ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
</ol><p>è¿™ä¸ªæµç¨‹çš„æ‰§è¡Œå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/03/54/0399382169faf50fc1b354099af71954.jpg" alt=""></p><center><span class="reference">å›¾5 group byæ‰§è¡Œæµç¨‹</span></center><p>å›¾ä¸­æœ€åä¸€æ­¥ï¼Œå¯¹å†…å­˜ä¸´æ—¶è¡¨çš„æ’åºï¼Œåœ¨<a href="https://time.geekbang.org/column/article/73795">ç¬¬17ç¯‡æ–‡ç« </a>ä¸­å·²ç»æœ‰è¿‡ä»‹ç»ï¼Œæˆ‘æŠŠå›¾è´´è¿‡æ¥ï¼Œæ–¹ä¾¿ä½ å›é¡¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/b5/68/b5168d201f5a89de3b424ede2ebf3d68.jpg" alt=""></p><center><span class="reference">å›¾6 å†…å­˜ä¸´æ—¶è¡¨æ’åºæµç¨‹</span></center><p>å…¶ä¸­ï¼Œä¸´æ—¶è¡¨çš„æ’åºè¿‡ç¨‹å°±æ˜¯å›¾6ä¸­è™šçº¿æ¡†å†…çš„è¿‡ç¨‹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿™æ¡è¯­å¥çš„æ‰§è¡Œç»“æœï¼š</p><p><img src="https://static001.geekbang.org/resource/image/ae/55/ae6a28d890efc35ee4d07f694068f455.png" alt=""></p><center><span class="reference">å›¾ 7 group byæ‰§è¡Œç»“æœ</span></center><p>å¦‚æœä½ çš„éœ€æ±‚å¹¶ä¸éœ€è¦å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œé‚£ä½ å¯ä»¥åœ¨SQLè¯­å¥æœ«å°¾å¢åŠ order by nullï¼Œä¹Ÿå°±æ˜¯æ”¹æˆï¼š</p><pre><code>select id%10 as m, count(*) as c from t1 group by m order by null;
</code></pre><p>è¿™æ ·å°±è·³è¿‡äº†æœ€åæ’åºçš„é˜¶æ®µï¼Œç›´æ¥ä»ä¸´æ—¶è¡¨ä¸­å–æ•°æ®è¿”å›ã€‚è¿”å›çš„ç»“æœå¦‚å›¾8æ‰€ç¤ºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/03/eb/036634e53276eaf8535c3442805dfaeb.png" alt=""></p><center><span class="reference">å›¾8 group + order by null çš„ç»“æœï¼ˆå†…å­˜ä¸´æ—¶è¡¨ï¼‰</span></center><p>ç”±äºè¡¨t1ä¸­çš„idå€¼æ˜¯ä»1å¼€å§‹çš„ï¼Œå› æ­¤è¿”å›çš„ç»“æœé›†ä¸­ç¬¬ä¸€è¡Œæ˜¯id=1ï¼›æ‰«æåˆ°id=10çš„æ—¶å€™æ‰æ’å…¥m=0è¿™ä¸€è¡Œï¼Œå› æ­¤ç»“æœé›†é‡Œæœ€åä¸€è¡Œæ‰æ˜¯m=0ã€‚</p><p>è¿™ä¸ªä¾‹å­é‡Œç”±äºä¸´æ—¶è¡¨åªæœ‰10è¡Œï¼Œå†…å­˜å¯ä»¥æ”¾å¾—ä¸‹ï¼Œå› æ­¤å…¨ç¨‹åªä½¿ç”¨äº†å†…å­˜ä¸´æ—¶è¡¨ã€‚ä½†æ˜¯ï¼Œå†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå‚æ•°tmp_table_sizeå°±æ˜¯æ§åˆ¶è¿™ä¸ªå†…å­˜å¤§å°çš„ï¼Œé»˜è®¤æ˜¯16Mã€‚</p><p>å¦‚æœæˆ‘æ‰§è¡Œä¸‹é¢è¿™ä¸ªè¯­å¥åºåˆ—ï¼š</p><pre><code>set tmp_table_size=1024;
select id%100 as m, count(*) as c from t1 group by m order by null limit 10;
</code></pre><p>æŠŠå†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°é™åˆ¶ä¸ºæœ€å¤§1024å­—èŠ‚ï¼Œå¹¶æŠŠè¯­å¥æ”¹æˆid % 100ï¼Œè¿™æ ·è¿”å›ç»“æœé‡Œæœ‰100è¡Œæ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™æ—¶çš„å†…å­˜ä¸´æ—¶è¡¨å¤§å°ä¸å¤Ÿå­˜ä¸‹è¿™100è¡Œæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå‘ç°å†…å­˜ä¸´æ—¶è¡¨å¤§å°åˆ°è¾¾äº†ä¸Šé™ï¼ˆ1024å­—èŠ‚ï¼‰ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™æ—¶å€™å°±ä¼šæŠŠå†…å­˜ä¸´æ—¶è¡¨è½¬æˆç£ç›˜ä¸´æ—¶è¡¨ï¼Œç£ç›˜ä¸´æ—¶è¡¨é»˜è®¤ä½¿ç”¨çš„å¼•æ“æ˜¯InnoDBã€‚ è¿™æ—¶ï¼Œè¿”å›çš„ç»“æœå¦‚å›¾9æ‰€ç¤ºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/a7/6e/a76381d0f3c947292cc28198901f9e6e.png" alt=""></p><center><span class="reference">å›¾9 group + order by null çš„ç»“æœï¼ˆç£ç›˜ä¸´æ—¶è¡¨ï¼‰</span></center><p>å¦‚æœè¿™ä¸ªè¡¨t1çš„æ•°æ®é‡å¾ˆå¤§ï¼Œå¾ˆå¯èƒ½è¿™ä¸ªæŸ¥è¯¢éœ€è¦çš„ç£ç›˜ä¸´æ—¶è¡¨å°±ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚</p><h1>group by ä¼˜åŒ–æ–¹æ³• --ç´¢å¼•</h1><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºæ˜¯ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨ï¼Œgroup byé€»è¾‘éƒ½éœ€è¦æ„é€ ä¸€ä¸ªå¸¦å”¯ä¸€ç´¢å¼•çš„è¡¨ï¼Œæ‰§è¡Œä»£ä»·éƒ½æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å¦‚æœè¡¨çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä¸Šé¢è¿™ä¸ªgroup byè¯­å¥æ‰§è¡Œèµ·æ¥å°±ä¼šå¾ˆæ…¢ï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆä¼˜åŒ–çš„æ–¹æ³•å‘¢ï¼Ÿ</p><p>è¦è§£å†³group byè¯­å¥çš„ä¼˜åŒ–é—®é¢˜ï¼Œä½ å¯ä»¥å…ˆæƒ³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼šæ‰§è¡Œgroup byè¯­å¥ä¸ºä»€ä¹ˆéœ€è¦ä¸´æ—¶è¡¨ï¼Ÿ</p><p>group byçš„è¯­ä¹‰é€»è¾‘ï¼Œæ˜¯ç»Ÿè®¡ä¸åŒçš„å€¼å‡ºç°çš„ä¸ªæ•°ã€‚ä½†æ˜¯ï¼Œç”±äºæ¯ä¸€è¡Œçš„id%100çš„ç»“æœæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œæ¥è®°å½•å¹¶ç»Ÿè®¡ç»“æœã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæ‰«æè¿‡ç¨‹ä¸­å¯ä»¥ä¿è¯å‡ºç°çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæ˜¯ä¸æ˜¯å°±ç®€å•äº†å‘¢ï¼Ÿ</p><p>å‡è®¾ï¼Œç°åœ¨æœ‰ä¸€ä¸ªç±»ä¼¼å›¾10çš„è¿™ä¹ˆä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹group byå¯ä»¥æ€ä¹ˆåšã€‚</p><p><img src="https://static001.geekbang.org/resource/image/5c/19/5c4a581c324c1f6702f9a2c70acddd19.jpg" alt=""></p><center><span class="reference">å›¾10 group byç®—æ³•ä¼˜åŒ–-æœ‰åºè¾“å…¥</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¯ä»¥ç¡®ä¿è¾“å…¥çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆè®¡ç®—group byçš„æ—¶å€™ï¼Œå°±åªéœ€è¦ä»å·¦åˆ°å³ï¼Œé¡ºåºæ‰«æï¼Œä¾æ¬¡ç´¯åŠ ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªè¿‡ç¨‹ï¼š</p><ul>
<li>å½“ç¢°åˆ°ç¬¬ä¸€ä¸ª1çš„æ—¶å€™ï¼Œå·²ç»çŸ¥é“ç´¯ç§¯äº†Xä¸ª0ï¼Œç»“æœé›†é‡Œçš„ç¬¬ä¸€è¡Œå°±æ˜¯(0,X);</li>
<li>å½“ç¢°åˆ°ç¬¬ä¸€ä¸ª2çš„æ—¶å€™ï¼Œå·²ç»çŸ¥é“ç´¯ç§¯äº†Yä¸ª1ï¼Œç»“æœé›†é‡Œçš„ç¬¬äºŒè¡Œå°±æ˜¯(1,Y);</li>
</ul><p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘æ‰§è¡Œçš„è¯ï¼Œæ‰«æåˆ°æ•´ä¸ªè¾“å…¥çš„æ•°æ®ç»“æŸï¼Œå°±å¯ä»¥æ‹¿åˆ°group byçš„ç»“æœï¼Œä¸éœ€è¦ä¸´æ—¶è¡¨ï¼Œä¹Ÿä¸éœ€è¦å†é¢å¤–æ’åºã€‚</p><p>ä½ ä¸€å®šæƒ³åˆ°äº†ï¼ŒInnoDBçš„ç´¢å¼•ï¼Œå°±å¯ä»¥æ»¡è¶³è¿™ä¸ªè¾“å…¥æœ‰åºçš„æ¡ä»¶ã€‚</p><p>åœ¨MySQL 5.7ç‰ˆæœ¬æ”¯æŒäº†generated columnæœºåˆ¶ï¼Œç”¨æ¥å®ç°åˆ—æ•°æ®çš„å…³è”æ›´æ–°ã€‚ä½ å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹æ³•åˆ›å»ºä¸€ä¸ªåˆ—zï¼Œç„¶ååœ¨zåˆ—ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼ˆå¦‚æœæ˜¯MySQL 5.6åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºæ™®é€šåˆ—å’Œç´¢å¼•ï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼‰ã€‚</p><pre><code>alter table t1 add column z int generated always as(id % 100), add index(z);
</code></pre><p>è¿™æ ·ï¼Œç´¢å¼•zä¸Šçš„æ•°æ®å°±æ˜¯ç±»ä¼¼å›¾10è¿™æ ·æœ‰åºçš„äº†ã€‚ä¸Šé¢çš„group byè¯­å¥å°±å¯ä»¥æ”¹æˆï¼š</p><pre><code>select z, count(*) as c from t1 group by z;
</code></pre><p>ä¼˜åŒ–åçš„group byè¯­å¥çš„explainç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/c9/b9/c9f88fa42d92cf7dde78fca26c4798b9.png" alt=""></p><center><span class="reference">å›¾11 group by ä¼˜åŒ–çš„explainç»“æœ</span></center><p>ä»Extraå­—æ®µå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œä¸å†éœ€è¦ä¸´æ—¶è¡¨ï¼Œä¹Ÿä¸éœ€è¦æ’åºäº†ã€‚</p><h1>group byä¼˜åŒ–æ–¹æ³• --ç›´æ¥æ’åº</h1><p>æ‰€ä»¥ï¼Œå¦‚æœå¯ä»¥é€šè¿‡åŠ ç´¢å¼•æ¥å®Œæˆgroup byé€»è¾‘å°±å†å¥½ä¸è¿‡äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¢°ä¸Šä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„åœºæ™¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦è€è€å®å®åšæ’åºçš„ã€‚é‚£ä¹ˆï¼Œè¿™æ—¶å€™çš„group byè¦æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿ</p><p>å¦‚æœæˆ‘ä»¬æ˜æ˜çŸ¥é“ï¼Œä¸€ä¸ªgroup byè¯­å¥ä¸­éœ€è¦æ”¾åˆ°ä¸´æ—¶è¡¨ä¸Šçš„æ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œå´è¿˜æ˜¯è¦æŒ‰ç…§â€œå…ˆæ”¾åˆ°å†…å­˜ä¸´æ—¶è¡¨ï¼Œæ’å…¥ä¸€éƒ¨åˆ†æ•°æ®åï¼Œå‘ç°å†…å­˜ä¸´æ—¶è¡¨ä¸å¤Ÿç”¨äº†å†è½¬æˆç£ç›˜ä¸´æ—¶è¡¨â€ï¼Œçœ‹ä¸Šå»å°±æœ‰ç‚¹å„¿å‚»ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ä¼šæƒ³äº†ï¼ŒMySQLæœ‰æ²¡æœ‰è®©æˆ‘ä»¬ç›´æ¥èµ°ç£ç›˜ä¸´æ—¶è¡¨çš„æ–¹æ³•å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œæœ‰çš„ã€‚</p><p>åœ¨group byè¯­å¥ä¸­åŠ å…¥SQL_BIG_RESULTè¿™ä¸ªæç¤ºï¼ˆhintï¼‰ï¼Œå°±å¯ä»¥å‘Šè¯‰ä¼˜åŒ–å™¨ï¼šè¿™ä¸ªè¯­å¥æ¶‰åŠçš„æ•°æ®é‡å¾ˆå¤§ï¼Œè¯·ç›´æ¥ç”¨ç£ç›˜ä¸´æ—¶è¡¨ã€‚</p><p>MySQLçš„ä¼˜åŒ–å™¨ä¸€çœ‹ï¼Œç£ç›˜ä¸´æ—¶è¡¨æ˜¯B+æ ‘å­˜å‚¨ï¼Œå­˜å‚¨æ•ˆç‡ä¸å¦‚æ•°ç»„æ¥å¾—é«˜ã€‚æ‰€ä»¥ï¼Œæ—¢ç„¶ä½ å‘Šè¯‰æˆ‘æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä»ç£ç›˜ç©ºé—´è€ƒè™‘ï¼Œè¿˜æ˜¯ç›´æ¥ç”¨æ•°ç»„æ¥å­˜å§ã€‚</p><p>å› æ­¤ï¼Œä¸‹é¢è¿™ä¸ªè¯­å¥</p><pre><code>select SQL_BIG_RESULT id%100 as m, count(*) as c from t1 group by m;
</code></pre><p>çš„æ‰§è¡Œæµç¨‹å°±æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>åˆå§‹åŒ–sort_bufferï¼Œç¡®å®šæ”¾å…¥ä¸€ä¸ªæ•´å‹å­—æ®µï¼Œè®°ä¸ºmï¼›</p>
</li>
<li>
<p>æ‰«æè¡¨t1çš„ç´¢å¼•aï¼Œä¾æ¬¡å–å‡ºé‡Œé¢çš„idå€¼, å°† id%100çš„å€¼å­˜å…¥sort_bufferä¸­ï¼›</p>
</li>
<li>
<p>æ‰«æå®Œæˆåï¼Œå¯¹sort_bufferçš„å­—æ®µmåšæ’åºï¼ˆå¦‚æœsort_bufferå†…å­˜ä¸å¤Ÿç”¨ï¼Œå°±ä¼šåˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºï¼‰ï¼›</p>
</li>
<li>
<p>æ’åºå®Œæˆåï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚</p>
</li>
</ol><p>æ ¹æ®æœ‰åºæ•°ç»„ï¼Œå¾—åˆ°æ•°ç»„é‡Œé¢çš„ä¸åŒå€¼ï¼Œä»¥åŠæ¯ä¸ªå€¼çš„å‡ºç°æ¬¡æ•°ã€‚è¿™ä¸€æ­¥çš„é€»è¾‘ï¼Œä½ å·²ç»ä»å‰é¢çš„å›¾10ä¸­äº†è§£è¿‡äº†ã€‚</p><p>ä¸‹é¢ä¸¤å¼ å›¾åˆ†åˆ«æ˜¯æ‰§è¡Œæµç¨‹å›¾å’Œæ‰§è¡Œexplainå‘½ä»¤å¾—åˆ°çš„ç»“æœã€‚</p><p><img src="https://static001.geekbang.org/resource/image/82/6a/8269dc6206a7ef20cb515c23df0b846a.jpg" alt=""></p><center><span class="reference">å›¾12 ä½¿ç”¨ SQL_BIG_RESULTçš„æ‰§è¡Œæµç¨‹å›¾</span></center><p><img src="https://static001.geekbang.org/resource/image/83/ec/83b6cd6b3e37dfbf9699cf0ccc0f1bec.png" alt=""></p><center><span class="reference">å›¾13 ä½¿ç”¨ SQL_BIG_RESULTçš„explain ç»“æœ</span></center><p>ä»Extraå­—æ®µå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ²¡æœ‰å†ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œè€Œæ˜¯ç›´æ¥ç”¨äº†æ’åºç®—æ³•ã€‚</p><p>åŸºäºä¸Šé¢çš„unionã€union allå’Œgroup byè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹çš„åˆ†æï¼Œæˆ‘ä»¬æ¥å›ç­”æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼šMySQLä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨å†…éƒ¨ä¸´æ—¶è¡¨ï¼Ÿ</p><ol>
<li>
<p>å¦‚æœè¯­å¥æ‰§è¡Œè¿‡ç¨‹å¯ä»¥ä¸€è¾¹è¯»æ•°æ®ï¼Œä¸€è¾¹ç›´æ¥å¾—åˆ°ç»“æœï¼Œæ˜¯ä¸éœ€è¦é¢å¤–å†…å­˜çš„ï¼Œå¦åˆ™å°±éœ€è¦é¢å¤–çš„å†…å­˜ï¼Œæ¥ä¿å­˜ä¸­é—´ç»“æœï¼›</p>
</li>
<li>
<p>join_bufferæ˜¯æ— åºæ•°ç»„ï¼Œsort_bufferæ˜¯æœ‰åºæ•°ç»„ï¼Œä¸´æ—¶è¡¨æ˜¯äºŒç»´è¡¨ç»“æ„ï¼›</p>
</li>
<li>
<p>å¦‚æœæ‰§è¡Œé€»è¾‘éœ€è¦ç”¨åˆ°äºŒç»´è¡¨ç‰¹æ€§ï¼Œå°±ä¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œunionéœ€è¦ç”¨åˆ°å”¯ä¸€ç´¢å¼•çº¦æŸï¼Œ group byè¿˜éœ€è¦ç”¨åˆ°å¦å¤–ä¸€ä¸ªå­—æ®µæ¥å­˜ç´¯ç§¯è®¡æ•°ã€‚</p>
</li>
</ol><h1>å°ç»“</h1><p>é€šè¿‡ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘é‡ç‚¹å’Œä½ è®²äº†group byçš„å‡ ç§å®ç°ç®—æ³•ï¼Œä»ä¸­å¯ä»¥æ€»ç»“ä¸€äº›ä½¿ç”¨çš„æŒ‡å¯¼åŸåˆ™ï¼š</p><ol>
<li>
<p>å¦‚æœå¯¹group byè¯­å¥çš„ç»“æœæ²¡æœ‰æ’åºè¦æ±‚ï¼Œè¦åœ¨è¯­å¥åé¢åŠ  order by nullï¼›</p>
</li>
<li>
<p>å°½é‡è®©group byè¿‡ç¨‹ç”¨ä¸Šè¡¨çš„ç´¢å¼•ï¼Œç¡®è®¤æ–¹æ³•æ˜¯explainç»“æœé‡Œæ²¡æœ‰Using temporary å’Œ Using filesortï¼›</p>
</li>
<li>
<p>å¦‚æœgroup byéœ€è¦ç»Ÿè®¡çš„æ•°æ®é‡ä¸å¤§ï¼Œå°½é‡åªä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼›ä¹Ÿå¯ä»¥é€šè¿‡é€‚å½“è°ƒå¤§tmp_table_sizeå‚æ•°ï¼Œæ¥é¿å…ç”¨åˆ°ç£ç›˜ä¸´æ—¶è¡¨ï¼›</p>
</li>
<li>
<p>å¦‚æœæ•°æ®é‡å®åœ¨å¤ªå¤§ï¼Œä½¿ç”¨SQL_BIG_RESULTè¿™ä¸ªæç¤ºï¼Œæ¥å‘Šè¯‰ä¼˜åŒ–å™¨ç›´æ¥ä½¿ç”¨æ’åºç®—æ³•å¾—åˆ°group byçš„ç»“æœã€‚</p>
</li>
</ol><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>æ–‡ç« ä¸­å›¾8å’Œå›¾9éƒ½æ˜¯order by nullï¼Œä¸ºä»€ä¹ˆå›¾8çš„è¿”å›ç»“æœé‡Œé¢ï¼Œ0æ˜¯åœ¨ç»“æœé›†çš„æœ€åä¸€è¡Œï¼Œè€Œå›¾9çš„ç»“æœé‡Œé¢ï¼Œ0æ˜¯åœ¨ç»“æœé›†çš„ç¬¬ä¸€è¡Œï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æå†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼šä¸ºä»€ä¹ˆä¸èƒ½ç”¨renameä¿®æ”¹ä¸´æ—¶è¡¨çš„æ”¹åã€‚</p><p>åœ¨å®ç°ä¸Šï¼Œæ‰§è¡Œrename tableè¯­å¥çš„æ—¶å€™ï¼Œè¦æ±‚æŒ‰ç…§â€œåº“å/è¡¨å.frmâ€çš„è§„åˆ™å»ç£ç›˜æ‰¾æ–‡ä»¶ï¼Œä½†æ˜¯ä¸´æ—¶è¡¨åœ¨ç£ç›˜ä¸Šçš„frmæ–‡ä»¶æ˜¯æ”¾åœ¨tmpdirç›®å½•ä¸‹çš„ï¼Œå¹¶ä¸”æ–‡ä»¶åçš„è§„åˆ™æ˜¯â€œ#sql{è¿›ç¨‹id}_{çº¿ç¨‹id}_åºåˆ—å·.frmâ€ï¼Œå› æ­¤ä¼šæŠ¥â€œæ‰¾ä¸åˆ°æ–‡ä»¶åâ€çš„é”™è¯¯ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@poppy åŒå­¦ï¼Œé€šè¿‡æ‰§è¡Œè¯­å¥çš„æŠ¥é”™ç°è±¡æ¨æµ‹äº†è¿™ä¸ªå®ç°è¿‡ç¨‹ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è€æ¨åŒå¿—</span>
                            </div>
                            <div class="bd">è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåªéœ€è¦å»é‡ï¼Œä¸éœ€è¦æ‰§è¡Œèšåˆå‡½æ•°ï¼Œdistinct å’Œgroup byé‚£ç§æ•ˆç‡é«˜ä¸€äº›å‘¢ï¼Ÿ<br><br>è¯¾åä¹ é¢˜:<br>å›¾8ï¼ŒæŠŠç»Ÿè®¡ç»“æœå­˜å†…å­˜ä¸´æ—¶è¡¨ï¼Œä¸æ’åºã€‚idæ˜¯ä»1åˆ°1000ï¼Œæ¨¡10çš„ç»“æœé¡ºåºå°±æ˜¯1ã€2ã€3ã€4ã€5ã€‚ã€‚ã€‚<br>å›¾9ï¼Œè€å¸ˆæŠŠtmp_table_sizeæ”¹å°äº†ï¼Œå†…å­˜ä¸´æ—¶è¡¨è£…ä¸ä¸‹ï¼Œæ”¹ç”¨ç£ç›˜ä¸´æ—¶è¡¨ã€‚æ ¹æ®è€å¸ˆè®²çš„æµç¨‹ï¼Œidå–æ¨¡çš„ç»“æœï¼Œæ’åºåå­˜å…¥ä¸´æ—¶è¡¨ï¼Œä¸´æ—¶çš„æ•°æ®åº”è¯¥æ˜¯0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,2,......<br>ä»è¿™ä¸ªç£ç›˜ä¸´æ—¶è¡¨è¯»å–æ•°æ®æ±‡æ€»çš„ç»“æœçš„é¡ºåºå°±æ˜¯0,1,2,3,4,5ã€‚ã€‚ã€‚ <br></div>
                            <span class="time">2019-02-06 22:03</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ–°å¹´å¥½<br><br>å¥½é—®é¢˜ï¼Œæˆ‘åŠ åˆ°åé¢æ–‡ç« ä¸­ã€‚<br>ç®€å•è¯´ä¸‹ç»“è®ºï¼Œåªéœ€è¦å»é‡çš„è¯ï¼Œå¦‚æœæ²¡æœ‰limitï¼Œæ˜¯ä¸€æ ·çš„ï¼›<br>æœ‰limitçš„è¯ï¼Œdistinct å¿«äº›ã€‚<br><br>æ¼‚äº®çš„å›ç­”ğŸ‘<br><br></p>
                                <p class="reply-time">2019-02-07 09:25</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/a8/e2/0262d330.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Li Shunduo</span>
                            </div>
                            <div class="bd">è¯·é—®Group Byéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªè¯­å¥ explain select id%10 as m, count(*) as c from t1 group by mï¼›ä¸ºä»€ä¹ˆé€‰æ‹©çš„æ˜¯ç´¢å¼•aï¼Œè€Œä¸æ˜¯primary keyï¼Ÿå¦‚æœå­—æ®µaä¸Šæœ‰ç©ºå€¼ï¼Œä½¿ç”¨ç´¢å¼•aå²‚ä¸æ˜¯å°±ä¸èƒ½å–åˆ°æ‰€æœ‰çš„idå€¼äº†ï¼Ÿ <br></div>
                            <span class="time">2019-02-07 12:23</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å› ä¸ºç´¢å¼•cçš„ä¿¡æ¯ä¹Ÿè¶³å¤Ÿï¼Œè€Œä¸”æ¯”ä¸»é”®ç´¢å¼•å°ï¼Œä½¿ç”¨ç´¢å¼•cæ›´ä¼šå¥½ã€‚<br><br>â€œå¦‚æœå­—æ®µaä¸Šæœ‰ç©ºå€¼ï¼Œä½¿ç”¨ç´¢å¼•aå²‚ä¸æ˜¯å°±ä¸èƒ½å–åˆ°æ‰€æœ‰çš„idå€¼äº†ï¼Ÿâ€ï¼Œä¸ä¼šçš„</p>
                                <p class="reply-time">2019-02-07 17:34</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/57/6e/dd0eee5f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿï¼ˆåä»”ï¼‰</span>
                            </div>
                            <div class="bd">è¿‡å¹´å¥½ï¼Œè€å¸ˆã€‚è¿™å‘¨ è¡¥è¡¥è½ä¸‹çš„è¯¾ <br></div>
                            <span class="time">2019-02-13 15:30</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Long</span>
                            </div>
                            <div class="bd">è€å¸ˆå¯èƒ½æ²¡çœ‹åˆ°ï¼Œå†å‘ä¸‹ã€‚<br>è€å¸ˆï¼Œæ–°å¹´å¥½ï¼ :-)<br><br>æœ‰å‡ ä¸ªç‰ˆæœ¬å·®å¼‚çš„é—®é¢˜ï¼š<br>ï¼ˆ1ï¼‰å›¾1ä¸­çš„æ‰§è¡Œè®¡åˆ’åº”è¯¥æ˜¯5.7ç‰ˆæœ¬ä»¥åçš„å§ï¼Œè²Œä¼¼æ²¡æ‰¾åˆ°è¯´åœ¨å“ªä¸ªç¯å¢ƒï¼Œæˆ‘åœ¨5.6å’Œ5.7åˆ†åˆ«æµ‹è¯•äº†ï¼Œid = 2çš„é‚£ä¸ªrowsï¼Œåœ¨5.6ç‰ˆæœ¬ï¼ˆ5.6.26ï¼‰æ˜¯1000ï¼Œåœ¨5.7ç‰ˆæœ¬æ˜¯2è¡Œã€‚åº”è¯¥æ˜¯5.7åšçš„ä¼˜åŒ–å§ï¼Ÿ<br><br>ï¼ˆ2ï¼‰å›¾ 9 group + order by null çš„ç»“æœï¼ˆæ­¤ç›˜ä¸´æ—¶è¡¨ï¼‰ï¼Œè¿™é‡Œé¢mysql5.6é‡Œé¢æ‰§è¡Œçš„ç»“æœæ˜¯ï¼ˆ1ï¼Œ10ï¼‰ï¼Œï¼ˆ2ï¼Œ10ï¼‰...(10ï¼Œ10)ï¼Œæ‰§è¡Œè®¡åˆ’éƒ½æ˜¯åªæœ‰ä¸€æ ·ï¼Œæ²¡æ‰¾åˆ°å·®å¼‚ã€‚<br>è·Ÿè¸ªä¸‹äº†ä¸‹optimizer traceï¼Œå‘ç°é—®é¢˜åº”è¯¥æ˜¯åœ¨ä¸´æ—¶è¡¨ç©ºé—´æ»¡çš„çš„æ—¶å€™ï¼Œmysql5.7ç”¨çš„æ˜¯ï¼šconverting_tmp_table_to_ondisk &quot;location&quot;: &quot;disk (InnoDB)&quot;,ï¼Œè€Œmysql 5.6ç”¨çš„æ˜¯converting_tmp_table_to_myisam &quot;location&quot;: &quot;disk (MyISAM)&quot;çš„åŸå› å¯¼è‡´çš„ã€‚<br>æŸ¥äº†ä¸‹å‚æ•°ï¼š<br>default_tmp_storage_engineã€‚ï¼ˆ5.6ï¼Œ5.7å½“å‰å€¼éƒ½æ˜¯innodbï¼‰<br>internal_tmp_disk_storage_engineï¼ˆåªæœ‰5.7æœ‰è¿™ä¸ªå‚æ•°ï¼Œå½“å‰å€¼æ˜¯innodbï¼‰ï¼Œ5.6åº”è¯¥æ˜¯é»˜è®¤ç£ç›˜ä¸´æ—¶è¡¨å°±æ˜¯MyISAMå¼•æ“çš„äº†ï¼Œç”±äºæœ¬åœ°æµ‹è¯•ç¯å¢ƒé‚£ä¸ªä¸´æ—¶è¡¨çš„ç›®å½•ä¸‹æ‰¾ä¸åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œä¹Ÿæ²¡æ³•ç»§ç»­åˆ†æäº†ã€‚ã€‚ã€‚<br><br>è‡³äºä¸ºä»€ä¹ˆMySQL 5.6ä¸­ç»“æœå±•ç¤ºmå­—æ®µä¸æ˜¯0-9è€Œæ˜¯1-10ï¼Œè¿˜å¾—è¯·è€å¸ˆå¸®å¿™è§£ç­”ä¸‹äº†ã€‚<br><br><br>è¿˜æœ‰å‡ ä¸ªå°é—®é¢˜ï¼Œä¸ºäº†æ–¹ä¾¿è§£ç­”ï¼Œåºå·ç»Ÿä¸€äº†ï¼š<br>ï¼ˆ3ï¼‰åœ¨é˜…è¯»mysqlæ‰§è¡Œè®¡åˆ’çš„æ—¶å€™ï¼Œçœ‹äº†ç½‘ä¸Šæœ‰å¾ˆå¤šè¯´æ³•ï¼Œä¹Ÿå‚è€ƒäº†mysqlå®˜ç½‘å¯¹idï¼ˆselect_idï¼‰çš„è§£é‡Šï¼š<br>id (JSON name: select_id)<br>The SELECT identifier. This is the sequential number of the SELECT within the query.ï¼ˆæ„Ÿè§‰è¿™ä¸ªè¯»èµ·æ¥ä¹Ÿæœ‰ç‚¹æ­§ä¹‰ï¼Œè¿™ä¸ªsequentialå­—é¢è§£é‡Šæ„Ÿè§‰åªæœ‰é¡ºåºçš„å·ç ï¼Œå¹¶å’©æœ‰è¯´æ‰§è¡Œé¡ºåºï¼‰<br>æ¯”å¦‚å›¾1ï¼Œæ–‡ä¸­è§£é‡Šå°±æ˜¯ä»IDå°çš„å¾€å¤§çš„æ‰§è¡Œçš„ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå…¶ä»–è¯´æ³•ï¼Œæœ‰çš„æ˜¯è¯´IDä»å¤§åˆ°å°æ‰§è¡Œï¼Œé‡åˆ°IDä¸€æ ·çš„ï¼Œå°±ä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚æœ‰çš„è¯´æ˜¯ä»å°å¾€å¤§é¡ºåºæ‰§è¡Œã€‚ä¸çŸ¥é“è€å¸ˆæ˜¯å¦å¯ä»¥å®˜æ–¹è®²è§£ä¸‹ã€‚<br><br>ï¼ˆ4ï¼‰æˆ‘å‘ç°æƒ³ææ‡‚ä¸€ä¸ªåŸç†ï¼Œå¹¶ä¸”è®²æ¸…æ¥šè®©åˆ«äººæ˜ç™½ï¼ŒçœŸçš„æ˜¯å¾ˆæœ‰éš¾åº¦ï¼Œéå¸¸æ„Ÿè°¢è€å¸ˆçš„åˆ†äº«ã€‚è¿™æ¬¡ä¸“æ ç»“æŸï¼Œè¿˜ä¼šæ¨å‡ºçš„æ–°çš„ä¸“æ å—ï¼Ÿ éå¸¸æœŸå¾…ã€‚ <br></div>
                            <span class="time">2019-02-13 14:28</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eop9WylZJicLQxlvXukXUgPp39zJHyyReK5s1C9VhA6rric7GiarbfQMuWhdCCDdxdfL610Hc4cNkn9Q/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¿˜ä¸€æ£µæ ‘</span>
                            </div>
                            <div class="bd">group by æ‰§è¡Œæµç¨‹é‡Œé¢ï¼Œä¸ºä»€ä¹ˆæœ‰æœ€åæ’åºæ“ä½œï¼Œæ„Ÿè§‰è¿™ä¸€æ­¥æ˜¯å¤šä½™çš„ï¼Œæ‰«æå®Œæœ€åä¸€è¡Œæ•°æ®å ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥ä»temporaryè¡¨è¿”å›æ•°æ® <br></div>
                            <span class="time">2019-02-12 14:28</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯ è¯­ä¹‰å°±æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼Œå¦‚æœä¸éœ€è¦æ’åºï¼Œè¦æ‰‹åŠ¨åŠ ä¸Š order by null å“ˆ</p>
                                <p class="reply-time">2019-02-12 21:28</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/51/c8/83852d5a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¢¦åº·</span>
                            </div>
                            <div class="bd">å®è·µå‘ç°æ–‡ä¸­æè¿°çš„ group by æ‰§è¡Œè¿‡ç¨‹ä¸­è§£é‡Šä¸é€šã€‚æ¡ˆä¾‹å¦‚ä¸‹<br><br>select `aid`,sum(`pv`) as num from article_rank force index(idx_day_aid_pv)  where `day`&gt;20190115 group by aid order by num desc LIMIT 10;<br><br>å†…å­˜ä¸´æ—¶è¡¨ä¸å¤Ÿï¼Œéœ€è¦å†™å…¥ç£ç›˜<br><br>select `aid`,sum(`pv`) as num from article_rank force index(idx_aid_day_pv)  where `day`&gt;20190115 group by aid order by num desc LIMIT 10;<br><br>å†…å­˜ä¸´æ—¶è¡¨è¶³å¤Ÿã€‚<br><br>é€‰çš„ç´¢å¼•ä¸ä¸€æ ·ï¼Œä½†æ˜¯æœ€åç­›é€‰å‡ºæ¥çš„æ€»è¡Œåº”è¯¥æ˜¯ä¸€æ ·çš„å‘€ï¼Œæ‰€ä»¥ç°åœ¨æ›´åŠ å›°æƒ‘äº†ã€‚ <br></div>
                            <span class="time">2019-02-11 17:27</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/51/c8/83852d5a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¢¦åº·</span>
                            </div>
                            <div class="bd">æœ‰ä¸€å¼ è¡¨article_rank é‡Œé¢æœ‰æ˜¯ä¸ªå­—æ®µï¼ˆid,aid,pv,dayï¼‰ï¼Œéƒ½æ˜¯ int ç±»å‹ã€‚ç°æ‰§è¡Œå¦‚ä¸‹ sql<br>select `aid`,sum(`pv`) as num from article_rank where `day`&gt;20190115 group by aid order by num desc limit 10;<br><br>optimizer_trace ç»“æœä¸­å…³äºæ‰§è¡Œé˜¶æ®µæ•°æ®è§£è¯»è¿˜æ˜¯æœ‰äº›é—®é¢˜ã€‚<br>  {<br>    &quot;creating_tmp_table&quot;: {<br>      &quot;tmp_table_info&quot;: {<br>        &quot;table&quot;: &quot;intermediate_tmp_table&quot;,<br>        &quot;row_length&quot;: 20,<br>        &quot;key_length&quot;: 4,<br>        &quot;unique_constraint&quot;: false,<br>        &quot;location&quot;: &quot;memory (heap)&quot;,<br>        &quot;row_limit_estimate&quot;: 838860<br>      }<br>    }<br>  },<br>  {<br>    &quot;converting_tmp_table_to_ondisk&quot;: {<br>      &quot;cause&quot;: &quot;memory_table_size_exceeded&quot;,<br>      &quot;tmp_table_info&quot;: {<br>        &quot;table&quot;: &quot;intermediate_tmp_table&quot;,<br>        &quot;row_length&quot;: 20,<br>        &quot;key_length&quot;: 4,<br>        &quot;unique_constraint&quot;: false,<br>        &quot;location&quot;: &quot;disk (InnoDB)&quot;,<br>        &quot;record_format&quot;: &quot;fixed&quot;<br>      }<br>    }<br>  }<br><br>1. row_length ä¸ºä»€ä¹ˆæ˜¯20å‘¢ï¼Ÿæˆ‘ gdb è°ƒè¯•ç¡®è®¤ä¸´æ—¶è¡¨é‡Œå­˜æ”¾çš„æ˜¯ aidï¼Œnumã€‚ aid 4ä¸ªå­—èŠ‚ï¼Œnum å› ä¸ºæ˜¯ sum çš„ç»“æœæ˜¯ DECIMAL ç±»å‹ï¼Œæ‰€ä»¥æ˜¯15ä¸ªå­—èŠ‚ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ€»é•¿åº¦æ˜¯20å­—èŠ‚äº†ã€‚æµ‹è¯•å…¶ä»– sql å‡å‘ç°row_lengthä¼šæ¯”ä¸´æ—¶è¡¨ç§çš„å­—æ®µæ‰€å é•¿åº¦å¤š1å­—èŠ‚ï¼Œè¿™æ˜¯ä¸ºä½•å‘¢ï¼Ÿ<br>2. åˆ›å»ºä¸´æ—¶è¡¨æç¤ºå†…å­˜è¶…å‡ºé™åˆ¶ï¼Œä½†æ˜¯æ ¹æ®ç¬¬ä¸€æ­¥è¡Œæ•°é™åˆ¶æ˜¯ 838860 è¡Œï¼Œå®é™…æ€»å…±ç¬¦åˆæ¡ä»¶çš„è¡Œæ•°ä¸º 649091 é€šè¿‡ select count(distinct aid) from article_rank where `day`&gt;20190115 æŸ¥è¯¢å¾—åˆ°ã€‚ä¸ºä»€ä¹ˆä¼šè¶…å‡ºå†…å­˜å‘¢ï¼Ÿ<br><br>éº»çƒ¦è€å¸ˆå¸®å¿™è§£ç­”ä¸‹ã€‚è°¢è°¢å•¦ã€‚ <br></div>
                            <span class="time">2019-02-11 15:40</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/31/c8/a64e4aef.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å…”æ–¯åŸº</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œå…³äºæ’åºæœ‰å‡ ä¸ªé—®é¢˜ã€‚<br>order by idï¼Œä¸»é”®<br>order by nullï¼Œ<br>ä¸åŠ order by<br>è¿™ä¸‰ç§å†™æ³•å“ªç§æ‰§è¡Œæ•ˆç‡æ›´é«˜ä¸€äº›ï¼Ÿåé¢ä¸¤è€…æ˜¯ä¸æ˜¯ç­‰ä»·çš„ï¼Ÿ <br></div>
                            <span class="time">2019-02-11 07:55</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™ä¸‰ç§å†™æ³•è¯­ä¹‰ä¸Šä¸ä¸€æ ·ã€‚ã€‚<br><br>å¦‚æœå¯¹è¿”å›ç»“æœæ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œé‚£å†™ä¸Šorder by nullè‚¯å®šæ˜¯å¥½çš„ã€‚<br><br>â€œorder by nullâ€å’Œâ€œä¸åŠ order byâ€ä¸ç­‰ä»·ï¼Œå’±ä»¬æ–‡ä¸­æœ‰è¯´å“ˆ</p>
                                <p class="reply-time">2019-02-11 16:29</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/94/59/ac2aa72b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Smile</span>
                            </div>
                            <div class="bd">å½“ç¢°åˆ°ç¬¬ä¸€ä¸ª 2 çš„æ—¶å€™ï¼Œå·²ç»çŸ¥é“ç´¯ç§¯äº† Y ä¸ª 1ï¼Œç»“æœé›†é‡Œçš„ç¬¬ä¸€è¡Œå°±æ˜¯ (1,Y);<br>---- <br>åº”è¯¥æ˜¯ ç»“æœé›†é‡Œçš„ç¬¬ äºŒ è¡Œ å§<br><br><br><br> <br></div>
                            <span class="time">2019-02-11 00:30</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¯¹çš„ï¼ŒğŸ‘ğŸ¿ç»†è‡´<br><br>å‘èµ·å‹˜è¯¯äº†ï¼Œæ–°å¹´å¿«ä¹</p>
                                <p class="reply-time">2019-02-11 11:09</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Long</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæ–°å¹´å¥½ï¼ :-)<br><br>æœ‰å‡ ä¸ªç‰ˆæœ¬å·®å¼‚çš„é—®é¢˜ï¼š<br>ï¼ˆ1ï¼‰å›¾1ä¸­çš„æ‰§è¡Œè®¡åˆ’åº”è¯¥æ˜¯5.7ç‰ˆæœ¬ä»¥åçš„å§ï¼Œè²Œä¼¼æ²¡æ‰¾åˆ°è¯´åœ¨å“ªä¸ªç¯å¢ƒï¼Œæˆ‘åœ¨5.6å’Œ5.7åˆ†åˆ«æµ‹è¯•äº†ï¼Œid = 2çš„é‚£ä¸ªrowsï¼Œåœ¨5.6ç‰ˆæœ¬ï¼ˆ5.6.26ï¼‰æ˜¯1000ï¼Œåœ¨5.7ç‰ˆæœ¬æ˜¯2è¡Œã€‚åº”è¯¥æ˜¯5.7åšçš„ä¼˜åŒ–å§ï¼Ÿ<br><br>ï¼ˆ2ï¼‰å›¾ 9 group + order by null çš„ç»“æœï¼ˆæ­¤ç›˜ä¸´æ—¶è¡¨ï¼‰ï¼Œè¿™é‡Œé¢mysql5.6é‡Œé¢æ‰§è¡Œçš„ç»“æœæ˜¯ï¼ˆ1ï¼Œ10ï¼‰ï¼Œï¼ˆ2ï¼Œ10ï¼‰...(10ï¼Œ10)ï¼Œæ‰§è¡Œè®¡åˆ’éƒ½æ˜¯åªæœ‰ä¸€æ ·ï¼Œæ²¡æ‰¾åˆ°å·®å¼‚ã€‚<br>è·Ÿè¸ªä¸‹äº†ä¸‹optimizer traceï¼Œå‘ç°é—®é¢˜åº”è¯¥æ˜¯åœ¨ä¸´æ—¶è¡¨ç©ºé—´æ»¡çš„çš„æ—¶å€™ï¼Œmysql5.7ç”¨çš„æ˜¯ï¼šconverting_tmp_table_to_ondisk  &quot;location&quot;: &quot;disk (InnoDB)&quot;,ï¼Œè€Œmysql 5.6ç”¨çš„æ˜¯converting_tmp_table_to_myisam &quot;location&quot;: &quot;disk (MyISAM)&quot;çš„åŸå› å¯¼è‡´çš„ã€‚<br>æŸ¥äº†ä¸‹å‚æ•°ï¼š<br>default_tmp_storage_engineã€‚ï¼ˆ5.6ï¼Œ5.7å½“å‰å€¼éƒ½æ˜¯innodbï¼‰<br>internal_tmp_disk_storage_engineï¼ˆåªæœ‰5.7æœ‰è¿™ä¸ªå‚æ•°ï¼Œå½“å‰å€¼æ˜¯innodbï¼‰ï¼Œ5.6åº”è¯¥æ˜¯é»˜è®¤ç£ç›˜ä¸´æ—¶è¡¨å°±æ˜¯MyISAMå¼•æ“çš„äº†ï¼Œç”±äºæœ¬åœ°æµ‹è¯•ç¯å¢ƒé‚£ä¸ªä¸´æ—¶è¡¨çš„ç›®å½•ä¸‹æ‰¾ä¸åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œä¹Ÿæ²¡æ³•ç»§ç»­åˆ†æäº†ã€‚ã€‚ã€‚<br><br>è‡³äºä¸ºä»€ä¹ˆMySQL 5.6ä¸­ç»“æœå±•ç¤ºmå­—æ®µä¸æ˜¯0-9è€Œæ˜¯1-10ï¼Œè¿˜å¾—è¯·è€å¸ˆå¸®å¿™è§£ç­”ä¸‹äº†ã€‚<br><br><br>è¿˜æœ‰å‡ ä¸ªå°é—®é¢˜ï¼Œä¸ºäº†æ–¹ä¾¿è§£ç­”ï¼Œåºå·ç»Ÿä¸€äº†ï¼š<br>ï¼ˆ3ï¼‰åœ¨é˜…è¯»mysqlæ‰§è¡Œè®¡åˆ’çš„æ—¶å€™ï¼Œçœ‹äº†ç½‘ä¸Šæœ‰å¾ˆå¤šè¯´æ³•ï¼Œä¹Ÿå‚è€ƒäº†mysqlå®˜ç½‘å¯¹idï¼ˆselect_idï¼‰çš„è§£é‡Šï¼š<br>id (JSON name: select_id)<br>The SELECT identifier. This is the sequential number of the SELECT within the query.ï¼ˆæ„Ÿè§‰è¿™ä¸ªè¯»èµ·æ¥ä¹Ÿæœ‰ç‚¹æ­§ä¹‰ï¼Œè¿™ä¸ªsequentialå­—é¢è§£é‡Šæ„Ÿè§‰åªæœ‰é¡ºåºçš„å·ç ï¼Œå¹¶å’©æœ‰è¯´æ‰§è¡Œé¡ºåºï¼‰<br>æ¯”å¦‚å›¾1ï¼Œæ–‡ä¸­è§£é‡Šå°±æ˜¯ä»IDå°çš„å¾€å¤§çš„æ‰§è¡Œçš„ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå…¶ä»–è¯´æ³•ï¼Œæœ‰çš„æ˜¯è¯´IDä»å¤§åˆ°å°æ‰§è¡Œï¼Œé‡åˆ°IDä¸€æ ·çš„ï¼Œå°±ä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚æœ‰çš„è¯´æ˜¯ä»å°å¾€å¤§é¡ºåºæ‰§è¡Œã€‚ä¸çŸ¥é“è€å¸ˆæ˜¯å¦å¯ä»¥å®˜æ–¹è®²è§£ä¸‹ã€‚<br><br>ï¼ˆ4ï¼‰æˆ‘å‘ç°æƒ³ææ‡‚ä¸€ä¸ªåŸç†ï¼Œå¹¶ä¸”è®²æ¸…æ¥šè®©åˆ«äººæ˜ç™½ï¼ŒçœŸçš„æ˜¯å¾ˆæœ‰éš¾åº¦ï¼Œéå¸¸æ„Ÿè°¢è€å¸ˆçš„åˆ†äº«ã€‚è¿™æ¬¡ä¸“æ ç»“æŸï¼Œè¿˜ä¼šæ¨å‡ºçš„æ–°çš„ä¸“æ å—ï¼Ÿ éå¸¸æœŸå¾…ã€‚ <br></div>
                            <span class="time">2019-02-10 08:24</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/78/31/c7f8d1db.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Laputa</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œæ–‡ä¸­è¯´çš„ä¸éœ€è¦æ’åºä¸ºä»€ä¹ˆä¸ç›´æ¥æŠŠorderbyå»æ‰è€Œæ˜¯å†™order by null <br></div>
                            <span class="time">2019-02-08 17:36</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">MySQL è¯­ä¹‰ä¸Šè¿™ä¹ˆå®šä¹‰çš„â€¦ </p>
                                <p class="reply-time">2019-02-08 22:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">HuaMax</span>
                            </div>
                            <div class="bd">è¯¾åé¢˜è§£ç­”ã€‚å›¾8æ˜¯ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œæ–‡ä¸­å·²ç»æåˆ°ï¼Œæ˜¯æŒ‰ç…§è¡¨t1çš„ç´¢å¼•aé¡ºåºå–å‡ºæ•°æ®ï¼Œæ¨¡10å¾—0çš„idæ˜¯æœ€åä¸€è¡Œï¼›å›¾9æ˜¯ç”¨ç¡¬ç›˜ä¸´æ—¶è¡¨ï¼Œé»˜è®¤ç”¨innodb çš„ç´¢å¼•ï¼Œä¸»é”®æ˜¯id%10ï¼Œå› æ­¤å­˜å…¥ç¡¬ç›˜åå†æŒ‰ä¸»é”®æ ‘é¡ºåºå–å‡ºï¼Œ0å°±æ’åˆ°ç¬¬ä¸€è¡Œäº†ã€‚ <br></div>
                            <span class="time">2019-02-07 21:17</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://thirdwx.qlogo.cn/mmopen/vi_32/DkPNQQn7d39cpNa5Ux8l1AomYPDNb1EKPMcY5NlkL6MCxj2bzxAYicBTu6KFhQ4br7fwWPgdc0dxnezp7v8l7JA/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ç‰›ç‰›</span>
                            </div>
                            <div class="bd">æ–°å¹´å¿«ä¹ï½ã€æ„Ÿè°¢æœ‰æ‚¨ï½^_^ï½ <br></div>
                            <span class="time">2019-02-06 22:30</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ–°å¹´å¿«ä¹~ğŸ¤</p>
                                <p class="reply-time">2019-02-07 09:22</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/0c/48/ba59d28d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">poppy</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæ˜¥èŠ‚å¿«ä¹ï¼Œè¿‡å¹´è¿˜åœ¨æ›´æ–°ï¼Œè¾›è‹¦è¾›è‹¦ã€‚<br>å…³äºæ€è€ƒé¢˜ï¼Œæˆ‘çš„ç†è§£æ˜¯å›¾8ä¸­çš„æŸ¥è¯¢æ˜¯ä½¿ç”¨äº†å†…å­˜ä¸´æ—¶è¡¨ï¼Œå­˜å‚¨çš„é¡ºåºå°±æ˜¯id%10çš„å€¼çš„æ’å…¥é¡ºåºï¼Œè€Œå›¾9ä¸­çš„æŸ¥è¯¢ï¼Œç”±äºå†…å­˜ä¸´æ—¶è¡¨å¤§å°æ— æ³•æ»¡è¶³ï¼Œæ‰€ä»¥ä½¿ç”¨äº†ç£ç›˜ä¸´æ—¶è¡¨ï¼Œå¯¹äºInnoDBæ¥è¯´ï¼Œå°±æ˜¯å¯¹åº”B+æ ‘è¿™ç§æ•°æ®ç»“æ„ï¼Œè¿™é‡Œä¼šæŒ‰ç…§id%100(å³m)çš„å¤§å°é¡ºåºæ¥å­˜å‚¨çš„ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœå½“ç„¶ä¹Ÿæ˜¯æœ‰åºçš„ <br></div>
                            <span class="time">2019-02-06 20:17</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ–°å¹´å¥½~ <br><br>ğŸ‘</p>
                                <p class="reply-time">2019-02-07 09:26</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/20/9a/96259fb9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¼ å…«ç™¾</span>
                            </div>
                            <div class="bd">æ˜¥èŠ‚å¿«ä¹ï¼Œè€å¸ˆã€‚è°¢è°¢ä½ è®©æˆ‘å­¦åˆ°ä¸å°‘çŸ¥è¯† <br></div>
                            <span class="time">2019-02-06 13:17</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ–°å¹´å¿«ä¹ğŸ¤</p>
                                <p class="reply-time">2019-02-06 16:28</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">è€å¸ˆæ˜¥èŠ‚å¿«ä¹ï¼Œè¾›è‹¦äº† <br></div>
                            <span class="time">2019-02-06 09:59</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¥èŠ‚å¿«ä¹ï¼ŒğŸ¤</p>
                                <p class="reply-time">2019-02-06 12:33</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é•¿æ°</span>
                            </div>
                            <div class="bd">å›¾ä¹ä½¿ç”¨çš„æ˜¯ç£ç›˜ä¸´æ—¶è¡¨ï¼Œç£ç›˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„å¼•æ“æ˜¯innodbï¼Œinnodbæ˜¯ç´¢å¼•ç»„ç»‡è¡¨ï¼ŒæŒ‰ä¸»é”®é¡ºåºå­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥æ˜¯æŒ‰ç…§må­—æ®µæœ‰åºçš„ã€‚ <br></div>
                            <span class="time">2019-02-06 08:38</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿<br>æ˜¥èŠ‚å¿«ä¹</p>
                                <p class="reply-time">2019-02-06 12:34</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>