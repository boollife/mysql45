<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                16è®²â€œorderbyâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/71/37/716e55f77ce1ac695121595a1eb4d937.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="16è®²â€œorderbyâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="16è®²â€œorderbyâ€æ˜¯æ€ä¹ˆå·¥ä½œçš„.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>åœ¨ä½ å¼€å‘åº”ç”¨çš„æ—¶å€™ï¼Œä¸€å®šä¼šç»å¸¸ç¢°åˆ°éœ€è¦æ ¹æ®æŒ‡å®šçš„å­—æ®µæ’åºæ¥æ˜¾ç¤ºç»“æœçš„éœ€æ±‚ã€‚è¿˜æ˜¯ä»¥æˆ‘ä»¬å‰é¢ä¸¾ä¾‹ç”¨è¿‡çš„å¸‚æ°‘è¡¨ä¸ºä¾‹ï¼Œå‡è®¾ä½ è¦æŸ¥è¯¢åŸå¸‚æ˜¯â€œæ­å·â€çš„æ‰€æœ‰äººåå­—ï¼Œå¹¶ä¸”æŒ‰ç…§å§“åæ’åºè¿”å›å‰1000ä¸ªäººçš„å§“åã€å¹´é¾„ã€‚</p><p>å‡è®¾è¿™ä¸ªè¡¨çš„éƒ¨åˆ†å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>CREATE TABLE `t` (
  `id` int(11) NOT NULL,
  `city` varchar(16) NOT NULL,
  `name` varchar(16) NOT NULL,
  `age` int(11) NOT NULL,
  `addr` varchar(128) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `city` (`city`)
) ENGINE=InnoDB;
</code></pre><p>è¿™æ—¶ï¼Œä½ çš„SQLè¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre><code>select city,name,age from t where city='æ­å·' order by name limit 1000  ;
</code></pre><p>è¿™ä¸ªè¯­å¥çœ‹ä¸Šå»é€»è¾‘å¾ˆæ¸…æ™°ï¼Œä½†æ˜¯ä½ äº†è§£å®ƒçš„æ‰§è¡Œæµç¨‹å—ï¼Ÿä»Šå¤©ï¼Œæˆ‘å°±å’Œä½ èŠèŠè¿™ä¸ªè¯­å¥æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œä»¥åŠæœ‰ä»€ä¹ˆå‚æ•°ä¼šå½±å“æ‰§è¡Œçš„è¡Œä¸ºã€‚</p><h1>å…¨å­—æ®µæ’åº</h1><p>å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡ç´¢å¼•ï¼Œæ‰€ä»¥ä½ ç°åœ¨å°±å¾ˆæ¸…æ¥šäº†ï¼Œä¸ºé¿å…å…¨è¡¨æ‰«æï¼Œæˆ‘ä»¬éœ€è¦åœ¨cityå­—æ®µåŠ ä¸Šç´¢å¼•ã€‚</p><p>åœ¨cityå­—æ®µä¸Šåˆ›å»ºç´¢å¼•ä¹‹åï¼Œæˆ‘ä»¬ç”¨explainå‘½ä»¤æ¥çœ‹çœ‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæƒ…å†µã€‚</p><p><img src="https://static001.geekbang.org/resource/image/82/03/826579b63225def812330ef6c344a303.png" alt=""></p><center><span class="reference">å›¾1 ä½¿ç”¨explainå‘½ä»¤æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œæƒ…å†µ</span></center><p>Extraè¿™ä¸ªå­—æ®µä¸­çš„â€œUsing filesortâ€è¡¨ç¤ºçš„å°±æ˜¯éœ€è¦æ’åºï¼ŒMySQLä¼šç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—å†…å­˜ç”¨äºæ’åºï¼Œç§°ä¸ºsort_bufferã€‚</p><p>ä¸ºäº†è¯´æ˜è¿™ä¸ªSQLæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹cityè¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/53/3e/5334cca9118be14bde95ec94b02f0a3e.png" alt=""></p><center><span class="reference">å›¾2 cityå­—æ®µçš„ç´¢å¼•ç¤ºæ„å›¾</span></center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„è¡Œï¼Œæ˜¯ä»ID_Xåˆ°ID_(X+N)çš„è¿™äº›è®°å½•ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹æ‰€ç¤º ï¼š</p><!-- [[[read_end]]] --><ol>
<li>
<p>åˆå§‹åŒ–sort_bufferï¼Œç¡®å®šæ”¾å…¥nameã€cityã€ageè¿™ä¸‰ä¸ªå­—æ®µï¼›</p>
</li>
<li>
<p>ä»ç´¢å¼•cityæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„ä¸»é”®idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Xï¼›</p>
</li>
<li>
<p>åˆ°ä¸»é”®idç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€cityã€ageä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œå­˜å…¥sort_bufferä¸­ï¼›</p>
</li>
<li>
<p>ä»ç´¢å¼•cityå–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”®idï¼›</p>
</li>
<li>
<p>é‡å¤æ­¥éª¤3ã€4ç›´åˆ°cityçš„å€¼ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ä¸ºæ­¢ï¼Œå¯¹åº”çš„ä¸»é”®idä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Yï¼›</p>
</li>
<li>
<p>å¯¹sort_bufferä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µnameåšå¿«é€Ÿæ’åºï¼›</p>
</li>
<li>
<p>æŒ‰ç…§æ’åºç»“æœå–å‰1000è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
</ol><p>æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªæ’åºè¿‡ç¨‹ï¼Œç§°ä¸ºå…¨å­—æ®µæ’åºï¼Œæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬è¿˜ä¼šç”¨åˆ°è¿™ä¸ªæ’åºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/6c/72/6c821828cddf46670f9d56e126e3e772.jpg" alt=""></p><center><span class="reference">å›¾3 å…¨å­—æ®µæ’åº</span></center><p>å›¾ä¸­â€œæŒ‰nameæ’åºâ€è¿™ä¸ªåŠ¨ä½œï¼Œå¯èƒ½åœ¨å†…å­˜ä¸­å®Œæˆï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œè¿™å–å†³äºæ’åºæ‰€éœ€çš„å†…å­˜å’Œå‚æ•°sort_buffer_sizeã€‚</p><p>sort_buffer_sizeï¼Œå°±æ˜¯MySQLä¸ºæ’åºå¼€è¾Ÿçš„å†…å­˜ï¼ˆsort_bufferï¼‰çš„å¤§å°ã€‚å¦‚æœè¦æ’åºçš„æ•°æ®é‡å°äºsort_buffer_sizeï¼Œæ’åºå°±åœ¨å†…å­˜ä¸­å®Œæˆã€‚ä½†å¦‚æœæ’åºæ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜æ”¾ä¸ä¸‹ï¼Œåˆ™ä¸å¾—ä¸åˆ©ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶è¾…åŠ©æ’åºã€‚</p><p>ä½ å¯ä»¥ç”¨ä¸‹é¢ä»‹ç»çš„æ–¹æ³•ï¼Œæ¥ç¡®å®šä¸€ä¸ªæ’åºè¯­å¥æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p><pre><code>/* æ‰“å¼€optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */
SET optimizer_trace='enabled=on'; 

/* @aä¿å­˜Innodb_rows_readçš„åˆå§‹å€¼ */
select VARIABLE_VALUE into @a from  performance_schema.session_status where variable_name = 'Innodb_rows_read';

/* æ‰§è¡Œè¯­å¥ */
select city, name,age from t where city='æ­å·' order by name limit 1000; 

/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */
SELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\G

/* @bä¿å­˜Innodb_rows_readçš„å½“å‰å€¼ */
select VARIABLE_VALUE into @b from performance_schema.session_status where variable_name = 'Innodb_rows_read';

/* è®¡ç®—Innodb_rows_readå·®å€¼ */
select @b-@a;
</code></pre><p>è¿™ä¸ªæ–¹æ³•æ˜¯é€šè¿‡æŸ¥çœ‹ OPTIMIZER_TRACE çš„ç»“æœæ¥ç¡®è®¤çš„ï¼Œä½ å¯ä»¥ä» number_of_tmp_filesä¸­çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶æ–‡ä»¶ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/89/95/89baf99cdeefe90a22370e1d6f5e6495.png" alt=""></p><center><span class="reference">å›¾4 å…¨æ’åºçš„OPTIMIZER_TRACEéƒ¨åˆ†ç»“æœ</span></center><p>number_of_tmp_filesè¡¨ç¤ºçš„æ˜¯ï¼Œæ’åºè¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸´æ—¶æ–‡ä»¶æ•°ã€‚ä½ ä¸€å®šå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆéœ€è¦12ä¸ªæ–‡ä»¶ï¼Ÿå†…å­˜æ”¾ä¸ä¸‹æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨å¤–éƒ¨æ’åºï¼Œå¤–éƒ¨æ’åºä¸€èˆ¬ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ã€‚å¯ä»¥è¿™ä¹ˆç®€å•ç†è§£ï¼Œ<strong>MySQLå°†éœ€è¦æ’åºçš„æ•°æ®åˆ†æˆ12ä»½ï¼Œæ¯ä¸€ä»½å•ç‹¬æ’åºåå­˜åœ¨è¿™äº›ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ç„¶åæŠŠè¿™12ä¸ªæœ‰åºæ–‡ä»¶å†åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶ã€‚</strong></p><p>å¦‚æœsort_buffer_sizeè¶…è¿‡äº†éœ€è¦æ’åºçš„æ•°æ®é‡çš„å¤§å°ï¼Œnumber_of_tmp_fileså°±æ˜¯0ï¼Œè¡¨ç¤ºæ’åºå¯ä»¥ç›´æ¥åœ¨å†…å­˜ä¸­å®Œæˆã€‚</p><p>å¦åˆ™å°±éœ€è¦æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­æ’åºã€‚sort_buffer_sizeè¶Šå°ï¼Œéœ€è¦åˆ†æˆçš„ä»½æ•°è¶Šå¤šï¼Œnumber_of_tmp_filesçš„å€¼å°±è¶Šå¤§ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†å’Œä½ è§£é‡Šä¸€ä¸‹å›¾4ä¸­å…¶ä»–ä¸¤ä¸ªå€¼çš„æ„æ€ã€‚</p><p>æˆ‘ä»¬çš„ç¤ºä¾‹è¡¨ä¸­æœ‰4000æ¡æ»¡è¶³city='æ­å·â€™çš„è®°å½•ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ° examined_rows=4000ï¼Œè¡¨ç¤ºå‚ä¸æ’åºçš„è¡Œæ•°æ˜¯4000è¡Œã€‚</p><p>sort_mode é‡Œé¢çš„packed_additional_fieldsçš„æ„æ€æ˜¯ï¼Œæ’åºè¿‡ç¨‹å¯¹å­—ç¬¦ä¸²åšäº†â€œç´§å‡‘â€å¤„ç†ã€‚å³ä½¿nameå­—æ®µçš„å®šä¹‰æ˜¯varchar(16)ï¼Œåœ¨æ’åºè¿‡ç¨‹ä¸­è¿˜æ˜¯è¦æŒ‰ç…§å®é™…é•¿åº¦æ¥åˆ†é…ç©ºé—´çš„ã€‚</p><p>åŒæ—¶ï¼Œæœ€åä¸€ä¸ªæŸ¥è¯¢è¯­å¥select @b-@a çš„è¿”å›ç»“æœæ˜¯4000ï¼Œè¡¨ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹åªæ‰«æäº†4000è¡Œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…å¯¹ç»“è®ºé€ æˆå¹²æ‰°ï¼Œæˆ‘æŠŠinternal_tmp_disk_storage_engineè®¾ç½®æˆMyISAMã€‚å¦åˆ™ï¼Œselect @b-@açš„ç»“æœä¼šæ˜¾ç¤ºä¸º4001ã€‚</p><p>è¿™æ˜¯å› ä¸ºæŸ¥è¯¢OPTIMIZER_TRACEè¿™ä¸ªè¡¨æ—¶ï¼Œéœ€è¦ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œè€Œinternal_tmp_disk_storage_engineçš„é»˜è®¤å€¼æ˜¯InnoDBã€‚å¦‚æœä½¿ç”¨çš„æ˜¯InnoDBå¼•æ“çš„è¯ï¼ŒæŠŠæ•°æ®ä»ä¸´æ—¶è¡¨å–å‡ºæ¥çš„æ—¶å€™ï¼Œä¼šè®©Innodb_rows_readçš„å€¼åŠ 1ã€‚</p><h1>rowidæ’åº</h1><p>åœ¨ä¸Šé¢è¿™ä¸ªç®—æ³•è¿‡ç¨‹é‡Œé¢ï¼Œåªå¯¹åŸè¡¨çš„æ•°æ®è¯»äº†ä¸€éï¼Œå‰©ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨sort_bufferå’Œä¸´æ—¶æ–‡ä»¶ä¸­æ‰§è¡Œçš„ã€‚ä½†è¿™ä¸ªç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæŸ¥è¯¢è¦è¿”å›çš„å­—æ®µå¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆsort_bufferé‡Œé¢è¦æ”¾çš„å­—æ®µæ•°å¤ªå¤šï¼Œè¿™æ ·å†…å­˜é‡Œèƒ½å¤ŸåŒæ—¶æ”¾ä¸‹çš„è¡Œæ•°å¾ˆå°‘ï¼Œè¦åˆ†æˆå¾ˆå¤šä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºçš„æ€§èƒ½ä¼šå¾ˆå·®ã€‚</p><p>æ‰€ä»¥å¦‚æœå•è¡Œå¾ˆå¤§ï¼Œè¿™ä¸ªæ–¹æ³•æ•ˆç‡ä¸å¤Ÿå¥½ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>å¦‚æœMySQLè®¤ä¸ºæ’åºçš„å•è¡Œé•¿åº¦å¤ªå¤§ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥ä¿®æ”¹ä¸€ä¸ªå‚æ•°ï¼Œè®©MySQLé‡‡ç”¨å¦å¤–ä¸€ç§ç®—æ³•ã€‚</p><pre><code>SET max_length_for_sort_data = 16;
</code></pre><p>max_length_for_sort_dataï¼Œæ˜¯MySQLä¸­ä¸“é—¨æ§åˆ¶ç”¨äºæ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦çš„ä¸€ä¸ªå‚æ•°ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœå•è¡Œçš„é•¿åº¦è¶…è¿‡è¿™ä¸ªå€¼ï¼ŒMySQLå°±è®¤ä¸ºå•è¡Œå¤ªå¤§ï¼Œè¦æ¢ä¸€ä¸ªç®—æ³•ã€‚</p><p>cityã€nameã€age è¿™ä¸‰ä¸ªå­—æ®µçš„å®šä¹‰æ€»é•¿åº¦æ˜¯36ï¼Œæˆ‘æŠŠmax_length_for_sort_dataè®¾ç½®ä¸º16ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è®¡ç®—è¿‡ç¨‹æœ‰ä»€ä¹ˆæ”¹å˜ã€‚</p><p>æ–°çš„ç®—æ³•æ”¾å…¥sort_bufferçš„å­—æ®µï¼Œåªæœ‰è¦æ’åºçš„åˆ—ï¼ˆå³nameå­—æ®µï¼‰å’Œä¸»é”®idã€‚</p><p>ä½†è¿™æ—¶ï¼Œæ’åºçš„ç»“æœå°±å› ä¸ºå°‘äº†cityå’Œageå­—æ®µçš„å€¼ï¼Œä¸èƒ½ç›´æ¥è¿”å›äº†ï¼Œæ•´ä¸ªæ‰§è¡Œæµç¨‹å°±å˜æˆå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼š</p><ol>
<li>
<p>åˆå§‹åŒ–sort_bufferï¼Œç¡®å®šæ”¾å…¥ä¸¤ä¸ªå­—æ®µï¼Œå³nameå’Œidï¼›</p>
</li>
<li>
<p>ä»ç´¢å¼•cityæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„ä¸»é”®idï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Xï¼›</p>
</li>
<li>
<p>åˆ°ä¸»é”®idç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€idè¿™ä¸¤ä¸ªå­—æ®µï¼Œå­˜å…¥sort_bufferä¸­ï¼›</p>
</li>
<li>
<p>ä»ç´¢å¼•cityå–ä¸‹ä¸€ä¸ªè®°å½•çš„ä¸»é”®idï¼›</p>
</li>
<li>
<p>é‡å¤æ­¥éª¤3ã€4ç›´åˆ°ä¸æ»¡è¶³city='æ­å·â€™æ¡ä»¶ä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ID_Yï¼›</p>
</li>
<li>
<p>å¯¹sort_bufferä¸­çš„æ•°æ®æŒ‰ç…§å­—æ®µnameè¿›è¡Œæ’åºï¼›</p>
</li>
<li>
<p>éå†æ’åºç»“æœï¼Œå–å‰1000è¡Œï¼Œå¹¶æŒ‰ç…§idçš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡ºcityã€nameå’Œageä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
</ol><p>è¿™ä¸ªæ‰§è¡Œæµç¨‹çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼Œæˆ‘æŠŠå®ƒç§°ä¸ºrowidæ’åºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/dc/6d/dc92b67721171206a302eb679c83e86d.jpg" alt=""></p><center><span class="reference">å›¾5 rowidæ’åº</span></center><p>å¯¹æ¯”å›¾3çš„å…¨å­—æ®µæ’åºæµç¨‹å›¾ä½ ä¼šå‘ç°ï¼Œrowidæ’åºå¤šè®¿é—®äº†ä¸€æ¬¡è¡¨tçš„ä¸»é”®ç´¢å¼•ï¼Œå°±æ˜¯æ­¥éª¤7ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæœ€åçš„â€œç»“æœé›†â€æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå®é™…ä¸ŠMySQLæœåŠ¡ç«¯ä»æ’åºåçš„sort_bufferä¸­ä¾æ¬¡å–å‡ºidï¼Œç„¶ååˆ°åŸè¡¨æŸ¥åˆ°cityã€nameå’Œageè¿™ä¸‰ä¸ªå­—æ®µçš„ç»“æœï¼Œä¸éœ€è¦åœ¨æœåŠ¡ç«¯å†è€—è´¹å†…å­˜å­˜å‚¨ç»“æœï¼Œæ˜¯ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯çš„ã€‚</p><p>æ ¹æ®è¿™ä¸ªè¯´æ˜è¿‡ç¨‹å’Œå›¾ç¤ºï¼Œä½ å¯ä»¥æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªæ—¶å€™æ‰§è¡Œselect @b-@aï¼Œç»“æœä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ç»“æœæœ‰ä»€ä¹ˆä¸åŒã€‚</p><p>é¦–å…ˆï¼Œå›¾ä¸­çš„examined_rowsçš„å€¼è¿˜æ˜¯4000ï¼Œè¡¨ç¤ºç”¨äºæ’åºçš„æ•°æ®æ˜¯4000è¡Œã€‚ä½†æ˜¯select @b-@aè¿™ä¸ªè¯­å¥çš„å€¼å˜æˆ5000äº†ã€‚</p><p>å› ä¸ºè¿™æ—¶å€™é™¤äº†æ’åºè¿‡ç¨‹å¤–ï¼Œåœ¨æ’åºå®Œæˆåï¼Œè¿˜è¦æ ¹æ®idå»åŸè¡¨å–å€¼ã€‚ç”±äºè¯­å¥æ˜¯limit 1000ï¼Œå› æ­¤ä¼šå¤šè¯»1000è¡Œã€‚</p><p><img src="https://static001.geekbang.org/resource/image/27/9b/27f164804d1a4689718291be5d10f89b.png" alt=""></p><center><span class="reference">å›¾6 rowidæ’åºçš„OPTIMIZER_TRACEéƒ¨åˆ†è¾“å‡º</span></center><p>ä»OPTIMIZER_TRACEçš„ç»“æœä¸­ï¼Œä½ è¿˜èƒ½çœ‹åˆ°å¦å¤–ä¸¤ä¸ªä¿¡æ¯ä¹Ÿå˜äº†ã€‚</p><ul>
<li>sort_modeå˜æˆäº†&lt;sort_key, rowid&gt;ï¼Œè¡¨ç¤ºå‚ä¸æ’åºçš„åªæœ‰nameå’Œidè¿™ä¸¤ä¸ªå­—æ®µã€‚</li>
<li>number_of_tmp_fileså˜æˆ10äº†ï¼Œæ˜¯å› ä¸ºè¿™æ—¶å€™å‚ä¸æ’åºçš„è¡Œæ•°è™½ç„¶ä»ç„¶æ˜¯4000è¡Œï¼Œä½†æ˜¯æ¯ä¸€è¡Œéƒ½å˜å°äº†ï¼Œå› æ­¤éœ€è¦æ’åºçš„æ€»æ•°æ®é‡å°±å˜å°äº†ï¼Œéœ€è¦çš„ä¸´æ—¶æ–‡ä»¶ä¹Ÿç›¸åº”åœ°å˜å°‘äº†ã€‚</li>
</ul><h1>å…¨å­—æ®µæ’åº VS rowidæ’åº</h1><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œä»è¿™ä¸¤ä¸ªæ‰§è¡Œæµç¨‹é‡Œï¼Œè¿˜èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºã€‚</p><p>å¦‚æœMySQLå®åœ¨æ˜¯æ‹…å¿ƒæ’åºå†…å­˜å¤ªå°ï¼Œä¼šå½±å“æ’åºæ•ˆç‡ï¼Œæ‰ä¼šé‡‡ç”¨rowidæ’åºç®—æ³•ï¼Œè¿™æ ·æ’åºè¿‡ç¨‹ä¸­ä¸€æ¬¡å¯ä»¥æ’åºæ›´å¤šè¡Œï¼Œä½†æ˜¯éœ€è¦å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚</p><p>å¦‚æœMySQLè®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§ï¼Œä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼ŒæŠŠéœ€è¦çš„å­—æ®µéƒ½æ”¾åˆ°sort_bufferä¸­ï¼Œè¿™æ ·æ’åºåå°±ä¼šç›´æ¥ä»å†…å­˜é‡Œé¢è¿”å›æŸ¥è¯¢ç»“æœäº†ï¼Œä¸ç”¨å†å›åˆ°åŸè¡¨å»å–æ•°æ®ã€‚</p><p>è¿™ä¹Ÿå°±ä½“ç°äº†MySQLçš„ä¸€ä¸ªè®¾è®¡æ€æƒ³ï¼š<strong>å¦‚æœå†…å­˜å¤Ÿï¼Œå°±è¦å¤šåˆ©ç”¨å†…å­˜ï¼Œå°½é‡å‡å°‘ç£ç›˜è®¿é—®ã€‚</strong></p><p>å¯¹äºInnoDBè¡¨æ¥è¯´ï¼Œrowidæ’åºä¼šè¦æ±‚å›è¡¨å¤šé€ æˆç£ç›˜è¯»ï¼Œå› æ­¤ä¸ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚</p><p>è¿™ä¸ªç»“è®ºçœ‹ä¸Šå»æœ‰ç‚¹åºŸè¯çš„æ„Ÿè§‰ï¼Œä½†æ˜¯ä½ è¦è®°ä½å®ƒï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å°±ä¼šç”¨åˆ°ã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å°±äº†è§£äº†ï¼ŒMySQLåšæ’åºæ˜¯ä¸€ä¸ªæˆæœ¬æ¯”è¾ƒé«˜çš„æ“ä½œã€‚é‚£ä¹ˆä½ ä¼šé—®ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„order byéƒ½éœ€è¦æ’åºæ“ä½œå‘¢ï¼Ÿå¦‚æœä¸æ’åºå°±èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œé‚£å¯¹ç³»ç»Ÿçš„æ¶ˆè€—ä¼šå°å¾ˆå¤šï¼Œè¯­å¥çš„æ‰§è¡Œæ—¶é—´ä¹Ÿä¼šå˜å¾—æ›´çŸ­ã€‚</p><p>å…¶å®ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„order byè¯­å¥ï¼Œéƒ½éœ€è¦æ’åºæ“ä½œçš„ã€‚ä»ä¸Šé¢åˆ†æçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMySQLä¹‹æ‰€ä»¥éœ€è¦ç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨ä¸´æ—¶è¡¨ä¸Šåšæ’åºæ“ä½œï¼Œ<strong>å…¶åŸå› æ˜¯åŸæ¥çš„æ•°æ®éƒ½æ˜¯æ— åºçš„ã€‚</strong></p><p>ä½ å¯ä»¥è®¾æƒ³ä¸‹ï¼Œå¦‚æœèƒ½å¤Ÿä¿è¯ä»cityè¿™ä¸ªç´¢å¼•ä¸Šå–å‡ºæ¥çš„è¡Œï¼Œå¤©ç„¶å°±æ˜¯æŒ‰ç…§nameé€’å¢æ’åºçš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨å†æ’åºäº†å‘¢ï¼Ÿ</p><p>ç¡®å®æ˜¯è¿™æ ·çš„ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå¸‚æ°‘è¡¨ä¸Šåˆ›å»ºä¸€ä¸ªcityå’Œnameçš„è”åˆç´¢å¼•ï¼Œå¯¹åº”çš„SQLè¯­å¥æ˜¯ï¼š</p><pre><code>alter table t add index city_user(city, name);
</code></pre><p>ä½œä¸ºä¸cityç´¢å¼•çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/f9/bf/f980201372b676893647fb17fac4e2bf.png" alt=""></p><center><span class="reference">å›¾7 cityå’Œnameè”åˆç´¢å¼•ç¤ºæ„å›¾</span></center><p>åœ¨è¿™ä¸ªç´¢å¼•é‡Œé¢ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ç”¨æ ‘æœç´¢çš„æ–¹å¼å®šä½åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™çš„è®°å½•ï¼Œå¹¶ä¸”é¢å¤–ç¡®ä¿äº†ï¼Œæ¥ä¸‹æ¥æŒ‰é¡ºåºå–â€œä¸‹ä¸€æ¡è®°å½•â€çš„éå†è¿‡ç¨‹ä¸­ï¼Œåªè¦cityçš„å€¼æ˜¯æ­å·ï¼Œnameçš„å€¼å°±ä¸€å®šæ˜¯æœ‰åºçš„ã€‚</p><p>è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹çš„æµç¨‹å°±å˜æˆäº†ï¼š</p><ol>
<li>
<p>ä»ç´¢å¼•(city,name)æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„ä¸»é”®idï¼›</p>
</li>
<li>
<p>åˆ°ä¸»é”®idç´¢å¼•å–å‡ºæ•´è¡Œï¼Œå–nameã€cityã€ageä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p>
</li>
<li>
<p>ä»ç´¢å¼•(city,name)å–ä¸‹ä¸€ä¸ªè®°å½•ä¸»é”®idï¼›</p>
</li>
<li>
<p>é‡å¤æ­¥éª¤2ã€3ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬1000æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³city='æ­å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</p>
</li>
</ol><p><img src="https://static001.geekbang.org/resource/image/3f/92/3f590c3a14f9236f2d8e1e2cb9686692.jpg" alt=""></p><center><span class="reference">å›¾8 å¼•å…¥(city,name)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿‡ç¨‹ä¸éœ€è¦ä¸´æ—¶è¡¨ï¼Œä¹Ÿä¸éœ€è¦æ’åºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨explainçš„ç»“æœæ¥å°è¯ä¸€ä¸‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/fc/8a/fc53de303811ba3c46d344595743358a.png" alt=""></p><center><span class="reference">å›¾9 å¼•å…¥(city,name)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span></center><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒExtraå­—æ®µä¸­æ²¡æœ‰Using filesortäº†ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦æ’åºäº†ã€‚è€Œä¸”ç”±äº(city,name)è¿™ä¸ªè”åˆç´¢å¼•æœ¬èº«æœ‰åºï¼Œæ‰€ä»¥è¿™ä¸ªæŸ¥è¯¢ä¹Ÿä¸ç”¨æŠŠ4000è¡Œå…¨éƒ½è¯»ä¸€éï¼Œåªè¦æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å‰1000æ¡è®°å½•å°±å¯ä»¥é€€å‡ºäº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œåªéœ€è¦æ‰«æ1000æ¬¡ã€‚</p><p>æ—¢ç„¶è¯´åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬å†å¾€å‰è®¨è®ºï¼Œ<strong>è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæµç¨‹æœ‰æ²¡æœ‰å¯èƒ½è¿›ä¸€æ­¥ç®€åŒ–å‘¢ï¼Ÿ</strong>ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—ï¼Œæˆ‘åœ¨ç¬¬5ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/69636">ã€Š æ·±å…¥æµ…å‡ºç´¢å¼•ï¼ˆä¸‹ï¼‰ã€‹</a>ä¸­ï¼Œå’Œä½ ä»‹ç»çš„è¦†ç›–ç´¢å¼•ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†ç¨å¾®å¤ä¹ ä¸€ä¸‹ã€‚<strong>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ï¼Œç´¢å¼•ä¸Šçš„ä¿¡æ¯è¶³å¤Ÿæ»¡è¶³æŸ¥è¯¢è¯·æ±‚ï¼Œä¸éœ€è¦å†å›åˆ°ä¸»é”®ç´¢å¼•ä¸Šå»å–æ•°æ®ã€‚</strong></p><p>æŒ‰ç…§è¦†ç›–ç´¢å¼•çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªcityã€nameå’Œageçš„è”åˆç´¢å¼•ï¼Œå¯¹åº”çš„SQLè¯­å¥å°±æ˜¯ï¼š</p><pre><code>alter table t add index city_user_age(city, name, age);
</code></pre><p>è¿™æ—¶ï¼Œå¯¹äºcityå­—æ®µçš„å€¼ç›¸åŒçš„è¡Œæ¥è¯´ï¼Œè¿˜æ˜¯æŒ‰ç…§nameå­—æ®µçš„å€¼é€’å¢æ’åºçš„ï¼Œæ­¤æ—¶çš„æŸ¥è¯¢è¯­å¥ä¹Ÿå°±ä¸å†éœ€è¦æ’åºäº†ã€‚è¿™æ ·æ•´ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†ï¼š</p><ol>
<li>
<p>ä»ç´¢å¼•(city,name,age)æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³city='æ­å·â€™æ¡ä»¶çš„è®°å½•ï¼Œå–å‡ºå…¶ä¸­çš„cityã€nameå’Œageè¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p>
</li>
<li>
<p>ä»ç´¢å¼•(city,name,age)å–ä¸‹ä¸€ä¸ªè®°å½•ï¼ŒåŒæ ·å–å‡ºè¿™ä¸‰ä¸ªå­—æ®µçš„å€¼ï¼Œä½œä¸ºç»“æœé›†çš„ä¸€éƒ¨åˆ†ç›´æ¥è¿”å›ï¼›</p>
</li>
<li>
<p>é‡å¤æ‰§è¡Œæ­¥éª¤2ï¼Œç›´åˆ°æŸ¥åˆ°ç¬¬1000æ¡è®°å½•ï¼Œæˆ–è€…æ˜¯ä¸æ»¡è¶³city='æ­å·â€™æ¡ä»¶æ—¶å¾ªç¯ç»“æŸã€‚</p>
</li>
</ol><p><img src="https://static001.geekbang.org/resource/image/df/d6/df4b8e445a59c53df1f2e0f115f02cd6.jpg" alt=""></p><center><span class="reference">å›¾10 å¼•å…¥(city,name,age)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹</span></center><p>ç„¶åï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹explainçš„ç»“æœã€‚</p><p><img src="https://static001.geekbang.org/resource/image/9e/23/9e40b7b8f0e3f81126a9171cc22e3423.png" alt=""></p><center><span class="reference">å›¾11 å¼•å…¥(city,name,age)è”åˆç´¢å¼•åï¼ŒæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè®¡åˆ’</span></center><p>å¯ä»¥çœ‹åˆ°ï¼ŒExtraå­—æ®µé‡Œé¢å¤šäº†â€œUsing indexâ€ï¼Œè¡¨ç¤ºçš„å°±æ˜¯ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œæ€§èƒ½ä¸Šä¼šå¿«å¾ˆå¤šã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯è¯´è¦ä¸ºäº†æ¯ä¸ªæŸ¥è¯¢èƒ½ç”¨ä¸Šè¦†ç›–ç´¢å¼•ï¼Œå°±è¦æŠŠè¯­å¥ä¸­æ¶‰åŠçš„å­—æ®µéƒ½å»ºä¸Šè”åˆç´¢å¼•ï¼Œæ¯•ç«Ÿç´¢å¼•è¿˜æ˜¯æœ‰ç»´æŠ¤ä»£ä»·çš„ã€‚è¿™æ˜¯ä¸€ä¸ªéœ€è¦æƒè¡¡çš„å†³å®šã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†MySQLé‡Œé¢order byè¯­å¥çš„å‡ ç§ç®—æ³•æµç¨‹ã€‚</p><p>åœ¨å¼€å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œä½ æ€»æ˜¯ä¸å¯é¿å…åœ°ä¼šä½¿ç”¨åˆ°order byè¯­å¥ã€‚ä½ å¿ƒé‡Œè¦æ¸…æ¥šæ¯ä¸ªè¯­å¥çš„æ’åºé€»è¾‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œè¿˜è¦èƒ½å¤Ÿåˆ†æå‡ºåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œå¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—ï¼Œè¿™æ ·æ‰èƒ½åšåˆ°ä¸‹ç¬”å¦‚æœ‰ç¥ï¼Œä¸çŠ¯ä½çº§é”™è¯¯ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>å‡è®¾ä½ çš„è¡¨é‡Œé¢å·²ç»æœ‰äº†city_name(city, name)è¿™ä¸ªè”åˆç´¢å¼•ï¼Œç„¶åä½ è¦æŸ¥æ­å·å’Œè‹å·ä¸¤ä¸ªåŸå¸‚ä¸­æ‰€æœ‰çš„å¸‚æ°‘çš„å§“åï¼Œå¹¶ä¸”æŒ‰åå­—æ’åºï¼Œæ˜¾ç¤ºå‰100æ¡è®°å½•ã€‚å¦‚æœSQLæŸ¥è¯¢è¯­å¥æ˜¯è¿™ä¹ˆå†™çš„ ï¼š</p><pre><code>mysql&gt; select * from t where city in ('æ­å·',&quot;è‹å·&quot;) order by name limit 100;
</code></pre><p>é‚£ä¹ˆï¼Œè¿™ä¸ªè¯­å¥æ‰§è¡Œçš„æ—¶å€™ä¼šæœ‰æ’åºè¿‡ç¨‹å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä¸šåŠ¡ç«¯ä»£ç ç”±ä½ æ¥å¼€å‘ï¼Œéœ€è¦å®ç°ä¸€ä¸ªåœ¨æ•°æ®åº“ç«¯ä¸éœ€è¦æ’åºçš„æ–¹æ¡ˆï¼Œä½ ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>è¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœæœ‰åˆ†é¡µéœ€æ±‚ï¼Œè¦æ˜¾ç¤ºç¬¬101é¡µï¼Œä¹Ÿå°±æ˜¯è¯´è¯­å¥æœ€åè¦æ”¹æˆ â€œlimit 10000,100â€ï¼Œ ä½ çš„å®ç°æ–¹æ³•åˆä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„æ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œå½“MySQLå»æ›´æ–°ä¸€è¡Œï¼Œä½†æ˜¯è¦ä¿®æ”¹çš„å€¼è·ŸåŸæ¥çš„å€¼æ˜¯ç›¸åŒçš„ï¼Œè¿™æ—¶å€™MySQLä¼šçœŸçš„å»æ‰§è¡Œä¸€æ¬¡ä¿®æ”¹å—ï¼Ÿè¿˜æ˜¯çœ‹åˆ°å€¼ç›¸åŒå°±ç›´æ¥è¿”å›å‘¢ï¼Ÿ</p><p>è¿™æ˜¯ç¬¬ä¸€æ¬¡æˆ‘ä»¬è¯¾åé—®é¢˜çš„ä¸‰ä¸ªé€‰é¡¹éƒ½æœ‰åŒå­¦é€‰çš„ï¼Œæ‰€ä»¥æˆ‘è¦å’Œä½ éœ€è¦è¯¦ç»†è¯´æ˜ä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQLè¯»å‡ºæ•°æ®ï¼Œå‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ï¼Œæ‰§è¡Œç»“æŸã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé”å®éªŒæ¥ç¡®è®¤ã€‚</p><p>å‡è®¾ï¼Œå½“å‰è¡¨té‡Œçš„å€¼æ˜¯(1,2)ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/6d/90/6d9d8837560d01b57d252c470157ea90.png" alt=""></p><center><span class="reference">å›¾12 é”éªŒè¯æ–¹å¼</span></center><p>session Bçš„update è¯­å¥è¢«blockedäº†ï¼ŒåŠ é”è¿™ä¸ªåŠ¨ä½œæ˜¯InnoDBæ‰èƒ½åšçš„ï¼Œæ‰€ä»¥æ’é™¤é€‰é¡¹1ã€‚</p><p>ç¬¬äºŒä¸ªé€‰é¡¹æ˜¯ï¼ŒMySQLè°ƒç”¨äº†InnoDBå¼•æ“æä¾›çš„æ¥å£ï¼Œä½†æ˜¯å¼•æ“å‘ç°å€¼ä¸åŸæ¥ç›¸åŒï¼Œä¸æ›´æ–°ï¼Œç›´æ¥è¿”å›ã€‚æœ‰æ²¡æœ‰è¿™ç§å¯èƒ½å‘¢ï¼Ÿè¿™é‡Œæˆ‘ç”¨ä¸€ä¸ªå¯è§æ€§å®éªŒæ¥ç¡®è®¤ã€‚</p><p>å‡è®¾å½“å‰è¡¨é‡Œçš„å€¼æ˜¯(1,2)ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/44/96/441682b64a3f5dd50f35b12ca4b87c96.png" alt=""></p><center><span class="reference">å›¾13 å¯è§æ€§éªŒè¯æ–¹å¼</span></center><p>session Açš„ç¬¬äºŒä¸ªselect è¯­å¥æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆå¿«ç…§è¯»)ï¼Œå®ƒæ˜¯ä¸èƒ½çœ‹è§session Bçš„æ›´æ–°çš„ã€‚</p><p>ç°åœ¨å®ƒè¿”å›çš„æ˜¯(1,3)ï¼Œè¡¨ç¤ºå®ƒçœ‹è§äº†æŸä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åªèƒ½æ˜¯session Aè‡ªå·±çš„updateè¯­å¥åšæ›´æ–°çš„æ—¶å€™ç”Ÿæˆã€‚ï¼ˆå¦‚æœä½ å¯¹è¿™ä¸ªé€»è¾‘æœ‰ç–‘æƒ‘çš„è¯ï¼Œå¯ä»¥å›é¡¾ä¸‹ç¬¬8ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/70562">ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ï¼‰</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ŠæœŸæ€è€ƒé¢˜çš„ç­”æ¡ˆåº”è¯¥æ˜¯é€‰é¡¹3ï¼Œå³ï¼šInnoDBè®¤çœŸæ‰§è¡Œäº†â€œæŠŠè¿™ä¸ªå€¼ä¿®æ”¹æˆ(1,2)"è¿™ä¸ªæ“ä½œï¼Œè¯¥åŠ é”çš„åŠ é”ï¼Œè¯¥æ›´æ–°çš„æ›´æ–°ã€‚</p><p>ç„¶åä½ ä¼šè¯´ï¼ŒMySQLæ€ä¹ˆè¿™ä¹ˆç¬¨ï¼Œå°±ä¸ä¼šæ›´æ–°å‰åˆ¤æ–­ä¸€ä¸‹å€¼æ˜¯ä¸æ˜¯ç›¸åŒå—ï¼Ÿå¦‚æœåˆ¤æ–­ä¸€ä¸‹ï¼Œä¸å°±ä¸ç”¨æµªè´¹InnoDBæ“ä½œï¼Œå¤šå»æ›´æ–°ä¸€æ¬¡äº†ï¼Ÿ</p><p>å…¶å®MySQLæ˜¯ç¡®è®¤äº†çš„ã€‚åªæ˜¯åœ¨è¿™ä¸ªè¯­å¥é‡Œé¢ï¼ŒMySQLè®¤ä¸ºè¯»å‡ºæ¥çš„å€¼ï¼Œåªæœ‰ä¸€ä¸ªç¡®å®šçš„ (id=1), è€Œè¦å†™çš„æ˜¯(a=3)ï¼Œåªä»è¿™ä¸¤ä¸ªä¿¡æ¯æ˜¯çœ‹ä¸å‡ºæ¥â€œä¸éœ€è¦ä¿®æ”¹â€çš„ã€‚</p><p>ä½œä¸ºéªŒè¯ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/63/c1/63dd6df32dacdb827d256e5acb9837c1.png" alt=""></p><center><span class="reference">å›¾14 å¯è§æ€§éªŒè¯æ–¹å¼--å¯¹ç…§</span></center><p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p><p>ä¸Šé¢æˆ‘ä»¬çš„éªŒè¯ç»“æœéƒ½æ˜¯åœ¨binlog_format=statementæ ¼å¼ä¸‹è¿›è¡Œçš„ã€‚</p><p>@didiren è¡¥å……äº†ä¸€ä¸ªcaseï¼Œ å¦‚æœæ˜¯binlog_format=row å¹¶ä¸”binlog_row_image=FULLçš„æ—¶å€™ï¼Œç”±äºMySQLéœ€è¦åœ¨binlogé‡Œé¢è®°å½•æ‰€æœ‰çš„å­—æ®µï¼Œæ‰€ä»¥åœ¨è¯»æ•°æ®çš„æ—¶å€™å°±ä¼šæŠŠæ‰€æœ‰æ•°æ®éƒ½è¯»å‡ºæ¥äº†ã€‚</p><p>æ ¹æ®ä¸Šé¢è¯´çš„è§„åˆ™ï¼Œâ€œæ—¢ç„¶è¯»äº†æ•°æ®ï¼Œå°±ä¼šåˆ¤æ–­â€ï¼Œ å› æ­¤åœ¨è¿™æ—¶å€™ï¼Œselect * from t where id=1ï¼Œç»“æœå°±æ˜¯â€œè¿”å› (1,2)â€ã€‚</p><p>åŒç†ï¼Œå¦‚æœæ˜¯binlog_row_image=NOBLOB, ä¼šè¯»å‡ºé™¤blob å¤–çš„æ‰€æœ‰å­—æ®µï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œç»“æœè¿˜æ˜¯â€œè¿”å› (1,2)â€ã€‚</p><p>å¯¹åº”çš„ä»£ç å¦‚å›¾15æ‰€ç¤ºã€‚è¿™æ˜¯MySQL 5.6ç‰ˆæœ¬å¼•å…¥çš„ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘æ²¡æœ‰çœ‹è¿‡ã€‚æ‰€ä»¥ï¼Œç‰¹æ­¤è¯´æ˜ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/d4/89/d413b9235d56c62f9829750a68b06b89.png" alt=""></p><center><span class="reference">å›¾15 binlog_row_image=FULLè¯»å­—æ®µé€»è¾‘</span></center><p>ç±»ä¼¼çš„ï¼Œ@mahonebags åŒå­¦æåˆ°äº†timestampå­—æ®µçš„é—®é¢˜ã€‚ç»“è®ºæ˜¯ï¼šå¦‚æœè¡¨ä¸­æœ‰timestampå­—æ®µè€Œä¸”è®¾ç½®äº†è‡ªåŠ¨æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆæ›´æ–°â€œåˆ«çš„å­—æ®µâ€çš„æ—¶å€™ï¼ŒMySQLä¼šè¯»å…¥æ‰€æœ‰æ¶‰åŠçš„å­—æ®µï¼Œè¿™æ ·é€šè¿‡åˆ¤æ–­ï¼Œå°±ä¼šå‘ç°ä¸éœ€è¦ä¿®æ”¹ã€‚</p><p>è¿™ä¸¤ä¸ªç‚¹æˆ‘ä¼šåœ¨åé¢è®²æ›´æ–°æ€§èƒ½çš„æ–‡ç« ä¸­å†å±•å¼€ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@Gavin ã€@melonã€@é˜¿å»º ç­‰åŒå­¦æåˆ°äº†é”éªŒè¯æ³•ï¼›<br>
@éƒ­æ±Ÿä¼Ÿ åŒå­¦æåˆ°äº†ä¸¤ä¸ªç‚¹ï¼Œéƒ½éå¸¸å¥½ï¼Œæœ‰å»å®é™…éªŒè¯ã€‚ç»“è®ºæ˜¯è¿™æ ·çš„ï¼š<br>
ç¬¬ä¸€ï¼Œhexdumpçœ‹å‡ºæ¥æ²¡æ”¹åº”è¯¥æ˜¯WALæœºåˆ¶ç”Ÿæ•ˆäº†ï¼Œè¦è¿‡ä¸€ä¼šå„¿ï¼Œæˆ–è€…æŠŠåº“shutdownçœ‹çœ‹ã€‚<br>
ç¬¬äºŒï¼Œbinlogæ²¡å†™æ˜¯MySQL Serverå±‚çŸ¥é“è¡Œçš„å€¼æ²¡å˜ï¼Œæ‰€ä»¥æ•…æ„ä¸å†™çš„ï¼Œè¿™ä¸ªæ˜¯åœ¨rowæ ¼å¼ä¸‹çš„ç­–ç•¥ã€‚ä½ å¯ä»¥æŠŠbinlog_format æ”¹æˆstatementå†éªŒè¯ä¸‹ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">å›ç­”ä¸‹@å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜:<br>é—®é¢˜ä¸€ï¼š<br>1)æ— æ¡ä»¶æŸ¥è¯¢å¦‚æœåªæœ‰order by create_time,å³ä¾¿create_timeä¸Šæœ‰ç´¢å¼•,ä¹Ÿä¸ä¼šä½¿ç”¨åˆ°ã€‚<br>å› ä¸ºä¼˜åŒ–å™¨è®¤ä¸ºèµ°äºŒçº§ç´¢å¼•å†å»å›è¡¨æˆæœ¬æ¯”å…¨è¡¨æ‰«ææ’åºæ›´é«˜ã€‚<br>æ‰€ä»¥é€‰æ‹©èµ°å…¨è¡¨æ‰«æ,ç„¶åæ ¹æ®è€å¸ˆè®²çš„ä¸¤ç§æ–¹å¼é€‰æ‹©ä¸€ç§æ¥æ’åº<br>2)æ— æ¡ä»¶æŸ¥è¯¢ä½†æ˜¯æ˜¯order by create_time limit m.å¦‚æœmå€¼è¾ƒå°,æ˜¯å¯ä»¥èµ°ç´¢å¼•çš„.<br>å› ä¸ºä¼˜åŒ–å™¨è®¤ä¸ºæ ¹æ®ç´¢å¼•æœ‰åºæ€§å»å›è¡¨æŸ¥æ•°æ®,ç„¶åå¾—åˆ°mæ¡æ•°æ®,å°±å¯ä»¥ç»ˆæ­¢å¾ªç¯,é‚£ä¹ˆæˆæœ¬æ¯”å…¨è¡¨æ‰«æå°,åˆ™é€‰æ‹©èµ°äºŒçº§ç´¢å¼•ã€‚<br>å³ä¾¿æ²¡æœ‰äºŒçº§ç´¢å¼•,mysqlé’ˆå¯¹order by limitä¹Ÿåšäº†ä¼˜åŒ–,é‡‡ç”¨å †æ’åºã€‚è¿™éƒ¨åˆ†è€å¸ˆæ˜å¤©ä¼šè®²<br><br>é—®é¢˜äºŒ:<br>å¦‚æœæ˜¯group by a,aä¸Šä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ,æ˜¯èµ°rowidæ’åºã€‚<br>å¦‚æœæ˜¯group by limit,ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ,æ˜¯èµ°å †æ’åº<br>å¦‚æœæ˜¯åªæœ‰group by a,aä¸Šæœ‰ç´¢å¼•çš„æƒ…å†µ,åˆæ ¹æ®é€‰å–å€¼ä¸åŒ,ç´¢å¼•çš„æ‰«ææ–¹å¼åˆæœ‰ä¸åŒ<br>select * from t group by a  --èµ°çš„æ˜¯ç´¢å¼•å…¨æ‰«æ,è‡³äºè¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©èµ°ç´¢å¼•å…¨æ‰«æ,è¿˜éœ€è¦è€å¸ˆè§£æƒ‘ä¸‹<br>select a from t group by a  --èµ°çš„æ˜¯ç´¢å¼•æ¾æ•£æ‰«æ,ä¹Ÿå°±è¯´åªéœ€è¦æ‰«ææ¯ç»„çš„ç¬¬ä¸€è¡Œæ•°æ®å³å¯,ä¸ç”¨æ‰«ææ¯ä¸€è¡Œçš„å€¼<br><br>é—®é¢˜ä¸‰:<br>bigintå’ŒintåŠ æ•°å­—éƒ½ä¸å½±å“èƒ½å­˜å‚¨çš„å€¼ã€‚<br>bigint(1)å’Œbigint(19)éƒ½èƒ½å­˜å‚¨2^64-1èŒƒå›´å†…çš„å€¼,intæ˜¯2^32-1ã€‚åªæ˜¯æœ‰äº›å‰ç«¯ä¼šæ ¹æ®æ‹¬å·é‡Œæ¥æˆªå–æ˜¾ç¤ºè€Œå·²ã€‚å»ºè®®ä¸åŠ varchar()å°±å¿…é¡»å¸¦,å› ä¸ºvarchar()æ‹¬å·é‡Œçš„æ•°å­—ä»£è¡¨èƒ½å­˜å¤šå°‘å­—ç¬¦ã€‚å‡è®¾varchar(2),å°±åªèƒ½å­˜ä¸¤ä¸ªå­—ç¬¦,ä¸ç®¡æ˜¯ä¸­æ–‡è¿˜æ˜¯è‹±æ–‡ã€‚ç›®å‰æ¥çœ‹varchar()è¿™ä¸ªå€¼å¯ä»¥è®¾å¾—ç¨ç¨å¤§ç‚¹,å› ä¸ºå†…å­˜æ˜¯æŒ‰ç…§å®é™…çš„å¤§å°æ¥åˆ†é…å†…å­˜ç©ºé—´çš„,ä¸æ˜¯æŒ‰ç…§å€¼æ¥é¢„åˆ†é…çš„ã€‚<br><br>è€å¸ˆæˆ‘æœ‰å‡ ä¸ªé—®é¢˜:<br>1.æˆ‘è¿˜æ˜¯æƒ³åœ¨ç¡®è®¤ä¹‹å‰é—®çš„é—®é¢˜ã€‚ä¸€ä¸ªé•¿è¿æ¥,ä¸€æ¡sqlç”³è¯·äº†sort_buffer_sizeç­‰ä¸€ç³»åˆ—çš„ä¼šè¯çº§åˆ«çš„å†…å­˜,sqlæˆåŠŸæ‰§è¡Œå®Œ,è¯¥è¿æ¥å˜ä¸ºsleepçŠ¶æ€ã€‚è¿™äº›å†…å­˜åªæ˜¯å†…å®¹ä¼šè¢«æƒ…å†µ,ä½†æ˜¯å ç”¨çš„å†…å­˜ç©ºé—´ä¸ä¼šé‡Šæ”¾?<br>2.å‡è®¾è¦ç»™aå€¼åŠ 1,æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å–a=1çš„è¡Œ,ç„¶åæ‰§è¡Œå™¨ç»™a+1,åœ¨è°ƒç”¨æ¥å£å†™å…¥a+1äº†æ•°æ®ã€‚é‚£ä¹ˆåŠ é”ä¸åº”è¯¥æ˜¯åœ¨æ‰§è¡Œå™¨ç¬¬ä¸€æ¬¡å»å–æ•°æ®æ—¶ï¼Œå¼•æ“å±‚å°±åŠ è¯¥åŠ çš„é”ï¼Ÿä¸ºä»€ä¹ˆè¦ç­‰åˆ°ç¬¬äºŒæ¬¡è°ƒç”¨å†™å…¥æ•°æ®æ—¶,æ‰åŠ é”ã€‚ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ä¹‹é—´,éš¾é“ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡ä¿®æ”¹å—ï¼Ÿå¦‚æœæ²¡æœ‰é”ä¿è¯<br>3.å§‹ç»ˆæ²¡å¤ªæ˜ç™½å †æ’åºæ˜¯é‡‡ç”¨çš„ä»€ä¹ˆç®—æ³•ä½¿å¾—åªéœ€è¦å¯¹limitçš„æ•°æ®è¿›è¡Œæ’åºå°±å¯ä»¥,è€Œä¸æ˜¯æ’åºæ‰€æœ‰çš„æ•°æ®åœ¨å–å‰mæ¡ã€‚--ä¸è¿‡è¿™é‡ŒæœŸå¾…æ˜å¤©çš„æ–‡ç«  <br></div>
                            <span class="time">2018-12-20 17:17</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜ï¼š<br>é—®é¢˜1:ä½ å›ç­”å¾—æ¯”æˆ‘å›å¤çš„ç­”æ¡ˆè¿˜å¥½ï¼ğŸ‘ğŸ¿<br>é—®é¢˜2:è¿™ä¸ªåé¢æˆ‘ä»¬å±•å¼€å“ˆï¼Œè¦é…å›¾æ‰èƒ½è¯´å¾—æ¸…ğŸ˜„<br>é—®é¢˜3:å›ç­”å¾—ä¹Ÿå¾ˆå¥½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯255è¿™ä¸ªè¾¹ç•Œã€‚å°äº255éƒ½éœ€è¦ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œè¶…è¿‡255å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚<br><br>ä½ çš„é—®é¢˜ï¼š#å¥½é—®é¢˜_#<br>1. æ’åºç›¸å…³çš„å†…å­˜åœ¨æ’åºåå°±freeæ‰è¿˜ç»™ç³»ç»Ÿäº†<br>2. è¯»çš„æ—¶å€™åŠ äº†å†™é”çš„<br>3. å †æ’åºè¦è¯»æ‰€æœ‰è¡Œçš„ï¼Œåªè¯»ä¸€æ¬¡ï¼Œæˆ‘ä¼°è®¡ä½ å·²ç»ç†è§£å¯¹äº†ğŸ˜„<br><br></p>
                                <p class="reply-time">2018-12-20 18:52</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/eb/20/a02c4f61.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">didiren</span>
                            </div>
                            <div class="bd">åˆšæ‰åˆæµ‹äº†ä¸€ä¸‹ï¼Œåœ¨binlog-row-image=fullçš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒæ¬¡updateæ˜¯ä¸å†™redologçš„ï¼Œè¯´æ˜updateå¹¶æ²¡æœ‰å‘ç”Ÿ<br>è¿™æ ·æˆ‘å°±ç†è§£äº†ï¼Œå½“fullæ—¶ï¼Œmysqléœ€è¦è¯»åˆ°åœ¨æ›´æ–°æ—¶è¯»åˆ°aå€¼ï¼Œæ‰€ä»¥ä¼šåˆ¤æ–­aå€¼ä¸å˜ï¼Œä¸éœ€è¦æ›´æ–°ï¼Œä¸ä½ ç»™å‡ºçš„update t set a=3 where id=1 and a=3åŸç†ç›¸åŒï¼Œä½†binlog-row-imageä¼šå½±å“æŸ¥è¯¢ç»“æœè¿˜æ˜¯ä¼šè®©äººåƒä¸€æƒŠ <br></div>
                            <span class="time">2018-12-19 17:24</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„ã€‚<br><br>è¿™ä¸ªæˆ‘ä¹Ÿç›²ç‚¹äº†ã€‚<br><br>ä½†æ˜¯ç»†æƒ³MySQL é€‰æ‹©è¿™ä¸ªç­–ç•¥åˆæ˜¯åˆç†çš„ã€‚<br><br>æˆ‘éœ€è¦å†æ›´æ–°ä¸€ä¸‹ä¸“æ å†…å®¹</p>
                                <p class="reply-time">2018-12-19 19:03</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">null</span>
                            </div>
                            <div class="bd">re: é—®é¢˜3:å›ç­”å¾—ä¹Ÿå¾ˆå¥½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯255è¿™ä¸ªè¾¹ç•Œã€‚å°äº255éƒ½éœ€è¦ä¸€ä¸ªå­—èŠ‚è®°å½•é•¿åº¦ï¼Œè¶…è¿‡255å°±éœ€è¦ä¸¤ä¸ªå­—èŠ‚<br><br>11 æœˆè¿‡æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆï¼Œæ€»ç›‘ç°åœºæŠ›äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å…³äº varchar 255 çš„ã€‚ç°åœ¨å›çœ‹ï¼Œæœ¨æœ‰äººå›ç­”åˆ°ç‚¹ä¸Šï¼Œéƒ½è¯´æ˜¯å†å²åŸå› ã€‚<br>ä¸‹å›å†é—®ï¼Œå°±å¯ä»¥åˆ†äº«è¿™ä¸€ç‚¹äº†ã€‚ê‰‚ à³­(ËµÂ¯Ì´Í’ê‡´Â¯Ì´Í’Ëµ)à±¨â€å“‡å“ˆå“ˆï½ <br></div>
                            <span class="time">2018-12-21 09:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æœ€æ€•çš„å›ç­”â€œå†å²åŸå› â€ã€â€œå¤§å®¶éƒ½è¿™ä¹ˆåšçš„æ‰€ä»¥â€¦â€ã€â€œåˆ«äººè¦æ±‚çš„â€ ğŸ˜„</p>
                                <p class="reply-time">2018-12-21 10:41</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è€æ¨åŒå¿—</span>
                            </div>
                            <div class="bd">1)<br>mysql&gt; select * from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 100;<br>éœ€è¦æ’åº<br>åŸå› æ˜¯ç´¢å¼•é¡ºåºåŸå¸‚ã€åç§° ä¸ å•ç‹¬æŒ‰nameæ’åºçš„é¡ºåºä¸ä¸€è‡´ã€‚<br><br>2ï¼‰å¦‚æœä¸æƒ³mysqlæ’åº<br>æ–¹æ¡ˆa<br>å¯ä»¥æ‰§è¡Œä¸¤æ¡è¯­å¥<br>select * from t where city = &#39;æ­å·&#39;  limit 100;<br>select * from t where city = &#39;è‹å·&#39;  limit 100;<br>ç„¶åæŠŠ200æ¡è®°å½•åœ¨javaä¸­æ’åºã€‚<br>æ–¹æ¡ˆb<br>åˆ†åˆ«å–å‰100ï¼Œç„¶ååœ¨æ•°æ®ç«¯å¯¹200æ¡æ•°æ®è¿›è¡Œæ’åºã€‚å¯ä»¥sort bufferå°±å¯ä»¥å®Œæˆæ’åºäº†ã€‚<br>å°‘äº†ä¸€æ¬¡åº”ç”¨ç¨‹åºä¸æ•°æ®åº“çš„ç½‘ç»œäº¤äº’<br>select * from (<br>	select * from t where city = &#39;æ­å·&#39;  limit 100<br>	union all<br>  select * from t where city = &#39;è‹å·&#39;  limit 100<br>) as tt order by name limit 100<br><br><br>3ï¼‰å¯¹åˆ†é¡µçš„ä¼˜åŒ–ã€‚<br>  æ²¡æœ‰ç‰¹åˆ«å¥½çš„åŠæ³•ã€‚å¦‚æœä¸šåŠ¡å…è®¸ä¸æä¾›æ’åºåŠŸèƒ½ï¼Œä¸æä¾›æŸ¥è¯¢æœ€åä¸€é¡µï¼Œåªèƒ½ä¸€é¡µä¸€é¡µçš„ç¿»ï¼ŒåŸºæœ¬ä¸Šå‰å‡ é¡µçš„æ•°æ®å·²ç»æ»¡è¶³å®¢æˆ·éœ€æ±‚ã€‚<br>  ä¸ºäº†æ„ä¹‰ä¸å¤§çš„åŠŸèƒ½ä¼˜åŒ–ï¼Œå¯èƒ½ä¼šå¾—ä¸å¿å¤±ã€‚<br>  å¦‚æœä¸€å®šè¦ä¼˜åŒ–å¯ä»¥ select id from t where city in (&#39;æ­å·&#39;,&quot; è‹å· &quot;) order by name limit 10000,100<br>  å› ä¸ºæœ‰city\nameç´¢å¼•ï¼Œä¸Šé¢çš„è¯­å¥èµ°è¦†ç›–ç´¢å¼•å°±å¯ä»¥å®Œæˆï¼Œä¸ç”¨å›è¡¨ã€‚<br>  æœ€åä½¿ç”¨ select * from t where id in (); å–å¾—ç»“æœ<br>  å¯¹äºè¿™ä¸ªä¼˜åŒ–æ–¹æ³•ï¼Œæˆ‘ä¸å¥½ç¡®å®šçš„æ˜¯ä¸´ç•Œç‚¹ï¼Œå‰å‡ é¡µç›´æ¥æŸ¥è¯¢å°±å¯ä»¥ï¼Œæœ€åå‡ é¡µä½¿ç”¨è¿™ä¸ªä¼˜åŒ–æ–¹æ³•ã€‚<br>  ä½†æ˜¯ä¸­é—´çš„é¡µç åº”è¯¥æ€ä¹ˆé€‰æ‹©ä¸å¤ªæ¸…æ¥š<br>   <br></div>
                            <span class="time">2018-12-19 10:04</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä»ä¸šåŠ¡ä¸Šç æ‰åŠŸèƒ½ï¼Œè¿™ä¸ªæ„è¯†å¾ˆå¥½ğŸ‘ŒğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-19 12:28</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f7/95/3ebafd36.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ³¢æ³¢</span>
                            </div>
                            <div class="bd">ç¬”è®°:<br>1.MySQLä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€ä¸ªå†…å­˜ï¼ˆsort_bufferï¼‰ç”¨äºæ’åºè¯¥å†…å­˜å¤§å°ä¸ºsort_buffer_size<br>  1&gt;å¦‚æœæ’åºçš„æ•°æ®é‡å°äºsort_buffer_sizeï¼Œæ’åºå°†ä¼šåœ¨å†…å­˜ä¸­å®Œæˆ<br>  2&gt;å¦‚æœæ’åºæ•°æ®é‡å¾ˆå¤§ï¼Œå†…å­˜ä¸­æ— æ³•å­˜ä¸‹è¿™ä¹ˆå¤šæ•°æ®ï¼Œåˆ™ä¼šä½¿ç”¨ç£ç›˜ä¸´æ—¶æ–‡ä»¶æ¥è¾…åŠ©æ’åºï¼Œä¹Ÿç§°å¤–éƒ¨æ’åº<br>  3&gt;åœ¨ä½¿ç”¨å¤–éƒ¨æ’åºæ—¶ï¼ŒMySQLä¼šåˆ†æˆå¥½å‡ ä»½å•ç‹¬çš„ä¸´æ—¶æ–‡ä»¶ç”¨æ¥å­˜æ”¾æ’åºåçš„æ•°æ®ï¼Œç„¶ååœ¨å°†è¿™äº›æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¤§æ–‡ä»¶<br><br><br>2.mysqlä¼šé€šè¿‡éå†ç´¢å¼•å°†æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¯»å–åˆ°sort_bufferï¼Œå¹¶ä¸”æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œå¿«é€Ÿæ’åº<br>	1&gt;å¦‚æœæŸ¥è¯¢çš„å­—æ®µä¸åŒ…å«åœ¨è¾…åŠ©ç´¢å¼•ä¸­ï¼Œéœ€è¦æŒ‰ç…§è¾…åŠ©ç´¢å¼•è®°å½•çš„ä¸»é”®è¿”å›èšé›†ç´¢å¼•å–å‡ºæ‰€éœ€å­—æ®µ<br>  	2&gt;è¯¥æ–¹å¼ä¼šé€ æˆéšæœºIOï¼Œåœ¨MySQL5.6æä¾›äº†MRRçš„æœºåˆ¶ï¼Œä¼šå°†è¾…åŠ©ç´¢å¼•åŒ¹é…è®°å½•çš„ä¸»é”®å–å‡ºæ¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ’åºï¼Œç„¶ååœ¨å›è¡¨<br> 	3&gt;æŒ‰ç…§æƒ…å†µå»ºç«‹è”åˆç´¢å¼•æ¥é¿å…æ’åºæ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå…è®¸çš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å»ºç«‹è¦†ç›–ç´¢å¼•æ¥é¿å…å›è¡¨<br><br>å…¨å­—æ®µæ’åº<br>1.é€šè¿‡ç´¢å¼•å°†æ‰€éœ€çš„å­—æ®µå…¨éƒ¨è¯»å–åˆ°sort_bufferä¸­<br>2.æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œæ’åº<br>3.å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯<br><br><br>ç¼ºç‚¹ï¼š<br>1.é€ æˆsort_bufferä¸­å­˜æ”¾ä¸ä¸‹å¾ˆå¤šæ•°æ®ï¼Œå› ä¸ºé™¤äº†æ’åºå­—æ®µè¿˜å­˜æ”¾å…¶ä»–å­—æ®µï¼Œå¯¹sort_bufferçš„åˆ©ç”¨æ•ˆç‡ä¸é«˜<br>2.å½“æ‰€éœ€æ’åºæ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šçš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ’åºæ€§èƒ½ä¹Ÿä¼šå¾ˆå·®<br><br>ä¼˜ç‚¹ï¼šMySQLè®¤ä¸ºå†…å­˜è¶³å¤Ÿå¤§æ—¶ä¼šä¼˜å…ˆé€‰æ‹©å…¨å­—æ®µæ’åºï¼Œå› ä¸ºè¿™ç§æ–¹å¼æ¯”rowid æ’åºé¿å…äº†ä¸€æ¬¡å›è¡¨æ“ä½œ<br><br><br>rowidæ’åº<br>1.é€šè¿‡æ§åˆ¶æ’åºçš„è¡Œæ•°æ®çš„é•¿åº¦æ¥è®©sort_bufferä¸­å°½å¯èƒ½å¤šçš„å­˜æ”¾æ•°æ®ï¼Œmax_length_for_sort_data<br>2.åªå°†éœ€è¦æ’åºçš„å­—æ®µå’Œä¸»é”®è¯»å–åˆ°sort_bufferä¸­ï¼Œå¹¶æŒ‰ç…§æ’åºå­—æ®µè¿›è¡Œæ’åº<br>3.æŒ‰ç…§æ’åºåçš„é¡ºåºï¼Œå–idè¿›è¡Œå›è¡¨å–å‡ºæƒ³è¦è·å–çš„æ•°æ®<br>4.å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯<br><br>ä¼˜ç‚¹ï¼šæ›´å¥½çš„åˆ©ç”¨å†…å­˜çš„sort_bufferè¿›è¡Œæ’åºæ“ä½œï¼Œå°½é‡å‡å°‘å¯¹ç£ç›˜çš„è®¿é—®<br><br>ç¼ºç‚¹ï¼šå›è¡¨çš„æ“ä½œæ˜¯éšæœºIOï¼Œä¼šé€ æˆå¤§é‡çš„éšæœºè¯»ï¼Œä¸ä¸€å®šå°±æ¯”å…¨å­—æ®µæ’åºå‡å°‘å¯¹ç£ç›˜çš„è®¿é—®<br><br><br>3.æŒ‰ç…§æ’åºçš„ç»“æœè¿”å›å®¢æˆ·æ‰€å–è¡Œæ•° <br></div>
                            <span class="time">2018-12-19 13:33</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-21 14:11</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/1d/13/31ea1b0b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å³°</span>
                            </div>
                            <div class="bd">ç”±äºcityæœ‰ä¸¤ä¸ªå€¼ï¼Œç›¸å½“äºåŒ¹é…åˆ°äº†ç´¢å¼•æ ‘çš„ä¸¤æ®µåŒºåŸŸï¼Œè™½ç„¶å„è‡ªéƒ½æ˜¯æŒ‰nameæ’åºï¼Œä½†æ•´ä½“éœ€è¦åšä¸€æ¬¡å½’å¹¶ï¼Œå½“ç„¶åªæ˜¯limit100ï¼Œæ‰€ä»¥å¤Ÿæ•°å°±è¡Œã€‚å†ç„¶åå¦‚æœéœ€è¦ä¸åšæ’åºï¼Œä¸šåŠ¡ç«¯å°±æŒ‰cityä¸åŒçš„å–å€¼æŸ¥è¯¢ä¸¤æ¬¡ï¼Œæ¯æ¬¡éƒ½limit100ï¼Œç„¶åä¸šåŠ¡ç«¯åšå½’å¹¶å¤„ç†å–½ã€‚å†ç„¶åè¦åšåˆ†é¡µçš„è¯ï¼Œå¥½å§ï¼Œæˆ‘çš„æ€è·¯æ˜¯å…ˆæ•´å‡ºä¸€å¼ ä¸´æ—¶çš„ç»“æœè¡¨ï¼Œcreate table as select rownumber,* from t where city=x order by name(å†™çš„ä¸å¯¹å“ˆï¼Œåªæ˜¯è¡¨è¾¾æ„æ€ï¼Œrownumberä¸ºè¡Œæ•°,å¹¶ä¸ºä¸»é”®)ç„¶åç›´æ¥ä»è¿™å¼ è¡¨ä¸­æŒ‰rownumberè¿›è¡Œåˆ†é¡µæŸ¥è¯¢å°±å¥½ã€‚ <br></div>
                            <span class="time">2018-12-19 08:31</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åˆ†é¡µè¿™ä¸ªå†è€ƒè™‘è€ƒè™‘å“ˆğŸ˜„</p>
                                <p class="reply-time">2018-12-19 09:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e2/9d/fbbd4611.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">cyberbit</span>
                            </div>
                            <div class="bd"><br>1.ä¸ä¼šæœ‰æ’åºï¼Œè¿™ç§æƒ…å†µå±äºã€Šé«˜æ€§èƒ½mysqlã€‹é‡Œæåˆ°çš„â€œinæŠ€æ³•â€ï¼Œç¬¦åˆç´¢å¼•çš„æœ€å·¦åŸåˆ™ï¼Œæ˜¯2ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨åˆ°å³è¾¹çš„ç´¢å¼•åˆ—ã€‚<br>2.åˆ†é¡µæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨å»¶è¿Ÿå…³è”æ¥ä¼˜åŒ–ï¼š<br>select * from t join <br>(select id from t where city in(&#39;æ­å·&#39;,&#39;è‹å·&#39;) order by name limit 10000,100) t_id<br>on t.id=t_id.id;<br><br> <br></div>
                            <span class="time">2018-12-19 11:54</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å°˜å°</span>
                            </div>
                            <div class="bd">è¯·é—®ï¼Œç¬¬7æ­¥ä¸­éå†æ’åºç»“æœï¼Œå–å‰ 1000 è¡Œï¼Œå¹¶æŒ‰ç…§ id çš„å€¼å›åˆ°åŸè¡¨ä¸­å–å‡º cityã€name å’Œ age ä¸‰ä¸ªå­—æ®µè¿”å›ç»™å®¢æˆ·ç«¯ï¼šè¿™é‡Œä¼šæŠŠidå†è¿›è¡Œæ’åºå—ï¼Ÿè½¬éšæœºioä¸ºé¡ºåºioï¼Ÿ <br></div>
                            <span class="time">2018-12-19 01:30</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¦æ˜¯æ’åºå°±ç»“æœä¸ç¬¦åˆorder by çš„è¯­ä¹‰é€»è¾‘äº†â€¦</p>
                                <p class="reply-time">2018-12-19 09:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/4f/fb/f0c5c4cf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">èµµæµ·äº®</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œå…¨å­—æ®µæ’åºé‚£ä¸€èŠ‚ï¼Œæˆ‘åšäº†å®éªŒï¼Œæˆ‘çš„æ’åºç¼“å­˜å¤§å°æ˜¯1Mï¼Œ examined rows æ˜¯7715892ï¼ŒæŸ¥è¯¢çš„ä¸‰ä¸ªå­—æ®µéƒ½æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœè¿™äº›æ•°æ®éƒ½æ”¾åˆ°ç¼“å­˜åº”è¯¥éœ€è¦ï¼ˆ4+8+11ï¼‰*7715892ç­‰äº160Mï¼Œä½†æ˜¯æˆ‘çœ‹äº†éƒ½æ²¡æœ‰ç”¨åˆ°ä¸´æ—¶è¡¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<br><br>CREATE TABLE `phone_call_logs` (<br>  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®ID&#39;,<br>  `city_id` int(11) NOT NULL DEFAULT &#39;11&#39;,<br>  `call_sender` varchar(40) DEFAULT NULL COMMENT &#39;ç”µè¯ä¸»å«å·ç &#39;,<br>  `phone_id` bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;æ‰‹æœºid&#39;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_city` (`city_id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=64551193;<br>----------------sort_buffer_size=1M----------------------------<br>root:(none)&gt; show variables like &#39;sort_buffer_size&#39;;<br>+------------------+---------+<br>| Variable_name    | Value   |<br>+------------------+---------+<br>| sort_buffer_size | 1048576 |<br>+------------------+---------+<br>1 row in set (0.00 sec)<br>---------------æŸ¥è¯¢sql---------------------<br> select city_id,phone_id,call_sender from phone_call_logs where city_id=11 order by phone_id desc limit 1000;<br><br><br>-----------------------æ‰§è¡Œè®¡åˆ’ç»“æœ---------------------------------------------<br><br>  &quot;filesort_priority_queue_optimization&quot;: {<br>              &quot;limit&quot;: 1000,<br>              &quot;rows_estimate&quot;: 146364461,<br>              &quot;row_size&quot;: 146,<br>              &quot;memory_available&quot;: 1048576,<br>              &quot;chosen&quot;: true<br>            },<br>            &quot;filesort_execution&quot;: [<br>            ],<br>            &quot;filesort_summary&quot;: {<br>              &quot;rows&quot;: 1001,<br>              &quot;examined_rows&quot;: 7715892,<br>              &quot;number_of_tmp_files&quot;: 0,<br>              &quot;sort_buffer_size&quot;: 154160,<br>              &quot;sort_mode&quot;: &quot;&lt;sort_key, additional_fields&gt;&quot;<br> <br></div>
                            <span class="time">2018-12-19 19:41</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œæ˜å¤©è§ ğŸ˜<br>ï¼ˆæ˜å¤©çš„ä¸€ç¯‡ä¹Ÿæ˜¯è·Ÿæ’åºæœ‰å…³çš„å“¦ï¼‰</p>
                                <p class="reply-time">2018-12-20 00:29</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/eb/20/a02c4f61.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">didiren</span>
                            </div>
                            <div class="bd">æ„Ÿè°¢ï¼é’ˆå¯¹æˆ‘ä¹‹å‰æå‡ºçš„ç–‘é—®ï¼Œæˆ‘åˆè¯¦ç»†çš„åšäº†å®éªŒï¼Œå‘ç°ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œæˆ‘æ„Ÿè§‰æ˜¯ä¸ªbugï¼Œå¸Œæœ›è§£ç­”<br># SessionA<br>mysql&gt; show variables like &#39;%binlog_row_image%&#39;;<br>| Variable_name    | Value |<br>| binlog_row_image | FULL  |<br>mysql&gt; create table t (id int not null primary key auto_increment,<br>    -&gt; a int default null)<br>    -&gt; engine=innodb;<br>mysql&gt; insert into t values(1,2);<br>mysql&gt; set tx_isolation = &#39;repeatable-read&#39;;<br>mysql&gt; begin;<br>mysql&gt; select * from t where id = 1;<br>| id | a    |<br>|  1 |    2 |<br>æ­¤æ—¶åœ¨å¦ä¸€ä¸ªSessionBæ‰§è¡Œupdate t set a=3 where id = 1;æˆåŠŸæ›´æ–°ä¸€æ¡è®°å½•ã€‚é€šè¿‡show engine innodb statusçœ‹ï¼ŒLog sequence number 2573458<br>ç„¶ååœ¨SessionAç»§ç»­ã€‚ã€‚<br>mysql&gt; update t set a=3 where id = 1;<br>Rows matched: 1  Changed: 0  Warnings: 0<br>Log sequence number 2573467<br>mysql&gt; select * from t where id = 1;<br>| id | a    |<br>|  1 |    2 |<br><br>è¿™é‡Œä¸ä½ ç»™å‡ºçš„ç­”æ¡ˆé‡Œçš„å®éªŒç»“æœä¸åŒ<br>å¯ä»¥çœ‹åˆ°redologæ˜¯è®°å½•äº†ç¬¬äºŒæ¬¡çš„updateçš„ï¼Œä½†æ˜¯selectå´æ²¡æœ‰çœ‹åˆ°æ›´æ–°åçš„å€¼ï¼Œäºæ˜¯æˆ‘åˆæ¢äº†ä¸€ä¸ªå¹³æ—¶æµ‹è¯•ç”¨çš„å®ä¾‹ï¼ŒåŒæ ·çš„æ­¥éª¤å´å¾—åˆ°äº†ä¸ä½ çš„ç­”æ¡ˆç›¸åŒçš„ç»“æœ<br>ç„¶åæˆ‘å¯¹æ¯”äº†2ä¸ªå®ä¾‹çš„å‚æ•°ï¼Œå‘ç°å½“binlog-row-image=minimalæ—¶ç¬¬äºŒæ¬¡æŸ¥è¯¢ç»“æœa=3ï¼Œå½“binlog-row-image=fullæ—¶ç¬¬äºŒæ¬¡æŸ¥è¯¢ç»“æœa=2ï¼Œè€Œä¸”ä¸è®ºå“ªä¸ªå‚æ•°ï¼Œredologéƒ½ä¼šå› ä¸ºSessionAçš„updateå¢é•¿ï¼Œè¯´æ˜redologéƒ½åšäº†è®°å½•ï¼Œupdateæ˜¯å‘ç”Ÿäº†çš„ï¼Œä½†æ˜¯binlog-row-imageå‚æ•°ä¼šå½±å“æŸ¥è¯¢ç»“æœï¼Œéš¾ä»¥ç†è§£ï¼Œæˆ‘ç”¨çš„mysqlç‰ˆæœ¬æ˜¯å®˜æ–¹çš„5.7.13<br><br>ä¸‹é¢æ˜¯binlog-row-image = minimalçš„å®éªŒç»“æœ<br>mysql&gt; set  binlog_row_image=MINIMAL;<br>mysql&gt; drop table t;<br>mysql&gt; create table t (id int not null primary key auto_increment,<br>    -&gt; a int default null)<br>    -&gt; engine=innodb;<br>insert into t values(1,2);<br>mysql&gt; insert into t values(1,2);<br>mysql&gt; set tx_isolation = &#39;repeatable-read&#39;;<br>mysql&gt; begin;<br>mysql&gt; select * from t where id = 1;<br>| id | a    |<br>|  1 |    2 |<br>æ­¤æ—¶åœ¨å¦ä¸€ä¸ªSessionBæ‰§è¡Œupdate t set a=3 where id = 1;æˆåŠŸæ›´æ–°ä¸€æ¡è®°å½•ã€‚<br>mysql&gt; update t set a=3 where id = 1;<br>Rows matched: 1  Changed: 0  Warnings: 0<br>mysql&gt; select * from t where id = 1; <br>| id | a    |<br>|  1 |    3 | <br></div>
                            <span class="time">2018-12-19 17:01</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ï¼ï¼ï¼<br><br>ä½ è¯´çš„å¯¹<br><br>æˆ‘éªŒè¯çš„æ˜¯statementæ ¼å¼ã€‚<br><br>MySQL çœ‹æ¥é€‰äº†ä¸é”™å§è·¯å¾„ã€‚<br><br>è¿™ä¸ªæˆ‘ä¹‹å‰çœŸä¸çŸ¥é“ğŸ˜“<br><br>å¤šè°¢<br><br><br></p>
                                <p class="reply-time">2018-12-19 19:02</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e1/e7/d1b2e914.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ˜äº®</span>
                            </div>
                            <div class="bd">éœ€è¦æ’åºï¼Œå¯ä»¥å°†åŸæ¥çš„ç´¢å¼•ä¸­nameå­—æ®µæ”¾å‰é¢ï¼Œcityå­—æ®µæ”¾åé¢ï¼Œæ¥å»ºç´¢å¼•å°±å¯ä»¥äº† <br></div>
                            <span class="time">2018-12-19 08:08</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™æ ·ä¸å¤ªå¥½å“ˆï¼Œå˜æˆå…¨ç´¢å¼•æ‰«æäº†</p>
                                <p class="reply-time">2018-12-19 09:36</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/36/ec/ca162d6b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">edcSam</span>
                            </div>
                            <div class="bd">ç±»å¦‚å›¾äºŒçš„ç´¢å¼•å›¾ï¼Œæˆ‘ä¸€ç›´æœ‰ä¸€ä¸ªå›°æƒ‘ã€‚cityçš„ç´¢å¼•å›¾ä¸Šï¼Œæœ‰å°ä¸€äº›çš„é•¿æ–¹å½¢å’Œå¤§ä¸€äº›çš„é•¿æ–¹å½¢ã€‚æœ‰æ—¶å€™ç®­å¤´æºè‡ªäºå°é•¿æ–¹å½¢ï¼Œæœ‰äº›ç®­å¤´åˆæºè‡ªäºå¤§é•¿æ–¹å½¢ã€‚è¿™ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ <br></div>
                            <span class="time">2019-01-12 09:34</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åŸæ„æ˜¯è¦å®½çš„è¡¨ç¤ºæ•°æ®é¡¹ï¼Œçª„çš„è¡¨ç¤ºæŒ‡é’ˆ<br>æˆ‘ä»¬ä¿®æ”¹ä¸‹å›¾å“ˆï¼Œä¸å®¹æ˜“å¼•èµ·ç–‘é—®ã€‚<br>ğŸ‘ç»†è‡´</p>
                                <p class="reply-time">2019-01-12 12:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å”åä¹‹</span>
                            </div>
                            <div class="bd">1ï¼šç”¨@cyberbit æä¾›çš„æ–¹å¼ï¼Œæ‰§è¡Œè®¡åˆ’æ˜¯ä¸ä¼šä½¿ç”¨åˆ°æ’åºï¼Œä½†æ‰§è¡Œæ—¶é—´æ¯”ä½¿ç”¨æ’åºæ¶ˆè€—çš„å¤šï¼›<br>2ï¼šåˆ†é¡µlimitè¿‡å¤§æ—¶ä¼šå¯¼è‡´å¤§é‡æ’åºï¼Œå¯ä»¥è®°å½•ä¸Šä¸€é¡µæœ€åçš„IDï¼Œä¸‹ä¸€é¡µæŸ¥è¯¢æ¡ä»¶å¸¦ä¸Š where  ID&gt;ä¸Šä¸€é¡µæœ€åID limit 100 <br></div>
                            <span class="time">2019-01-09 14:56</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1.  ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ<br>2. å¯¹çš„</p>
                                <p class="reply-time">2019-01-10 19:27</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">felix</span>
                            </div>
                            <div class="bd">MySQLå¯¹limitæœ‰ä»€ä¹ˆä¼˜åŒ–å—ï¼Ÿæ˜¯åªèƒ½é…åˆç´¢å¼•ä½¿ç”¨å—ï¼Ÿè°¢è°¢ <br></div>
                            <span class="time">2019-01-04 09:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ²¡æœ‰ä¸€å®šè¦é…åˆç´¢å¼•å“¦<br><br>ä¸‹ä¸€ç¯‡æœ‰è®²åˆ°ä¸€ä¸ªlimit æ’åºä¼˜åŒ–</p>
                                <p class="reply-time">2019-01-04 09:38</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/43/2f/4ff46e78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ğŸ’ åˆ˜ä¼šä¿ŠğŸ’</span>
                            </div>
                            <div class="bd">æ¥ä¸Šä¸€æ¬¡çš„ç•™è¨€ã€‚è°¢è°¢è€å¸ˆçš„å›å¤ï¼Œæ˜¨å¤©æ‰¾åˆ°åŸå› äº†ï¼Œå› ä¸ºæˆ‘é€ çš„æ€»æ•°æ®åªæœ‰6æ¡ï¼Œä½¿ç”¨select city,name,age from t where city=&#39;æ­å·&#39; order by name limit 1000çš„æ—¶å€™ï¼Œä½¿ç”¨explainåˆ†æçš„ç»“æœä¸­ï¼Œtypeä¸ºALLï¼Œä¼˜åŒ–å™¨è®¤ä¸º6æ¡æ•°æ®èµ°å…¨è¡¨æ‰«ææ¯”ç”¨cityç´¢å¼•å†å›è¡¨çš„æ–¹å¼å¿«ï¼Œæ‰€ä»¥æ²¡æœ‰èµ°cityç´¢å¼•ï¼Œçœ‹åˆ°çš„ç»“æœé‡Œexamined_rowså°±æ˜¯æ€»çš„6æ¡æ•°æ®äº†ï¼Œæˆ‘ç”¨äº†force index(city)ç»“æœå°±è·Ÿæ‚¨çš„ä¸€æ ·äº†ã€‚ä¸å¥½æ„æ€è€å¸ˆï¼Œæˆ‘æ˜¯ä¸ªå¼€å‘ï¼Œæ•°æ®åº“çš„ä¸€äº›å‚æ•°å’ŒçŸ¥è¯†ä¸å¤ªç†Ÿæ‚‰ï¼Œæäº†ä¸€äº›å¼±æ™ºé—®é¢˜è¯·æ‚¨è§è°…ã€‚ <br></div>
                            <span class="time">2019-01-03 08:38</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content"><br>æŠŠé—®é¢˜æè¿°æ¸…æ¥šå¤§å®¶å°±å…±åŒå­¦ä¹ åˆ°å•¦ğŸ˜„<br>ğŸ¤</p>
                                <p class="reply-time">2019-01-03 10:03</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/43/2f/4ff46e78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ğŸ’ åˆ˜ä¼šä¿ŠğŸ’</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæˆ‘ä½¿ç”¨é‚£ä¸€æ¡å»ºè¡¨è¯­å¥å’ŒæŸ¥è¯¢è¯­å¥ï¼Œæœ€åä½¿ç”¨explainå¾—å‡ºçš„ç»“æœæ˜¯using whereï¼›using filesortï¼Œç„¶åæˆ‘å‘ç°select * from information_schema.optimizer_trace\G;å¾—åˆ°çš„ç»“æœæ˜¯ <br>&quot;filesort_summary&quot;: {<br>              &quot;rows&quot;: 4,<br>              &quot;examined_rows&quot;: 6,<br>              &quot;number_of_tmp_files&quot;: 0,<br>              &quot;sort_buffer_size&quot;: 71880,<br>              &quot;sort_mode&quot;: &quot;&lt;sort_key, packed_additional_fields&gt;&quot;<br>            }<br>è¡¨é‡Œåªæœ‰4æ¡ç¬¦åˆçš„æ•°æ®ï¼Œæˆ‘æ²¡ææ‡‚ä¸ºä»€ä¹ˆexamined_rowsæ˜¯6ï¼Œå› ä¸º6æ˜¯æ€»æ•°æ®é‡ä¸º6æ¡ã€‚ <br></div>
                            <span class="time">2019-01-02 16:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å“ªä¸ªæŸ¥è¯¢è¯­å¥â€¦</p>
                                <p class="reply-time">2019-01-02 17:38</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/bd/ed/95e8a314.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¿‡å»ã€ä»Šæ—¥</span>
                            </div>
                            <div class="bd">è¿›è¡Œæ’åºåçš„ä¸´æ—¶æ–‡ä»¶åˆ†æˆå‡ ä»½æ˜¯å’Œsort_buffer_sizeæœ‰å…³ï¼Œé‚£æ•°æ®åº“è®¾ç½®è¿™ä¸ªå€¼ä¼šä¸ä¼šè¶Šå¤§è¶Šå¥½ï¼Ÿ <br></div>
                            <span class="time">2018-12-31 18:25</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜<br><br>ä¸èƒ½å“¦ï¼Œå¹¶å‘èµ·æ¥çš„æ—¶å€™å†…å­˜å ç”¨è¿‡å¤§ï¼Œä¼šåˆ°è‡ªå·±ç³»ç»ŸOOMçš„</p>
                                <p class="reply-time">2018-12-31 20:29</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/ee/49/8c1e831f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å´é¸¿è¾¾</span>
                            </div>
                            <div class="bd">æ³¢æ³¢å¯æ˜¯ç™¾åº¦dbağŸ˜ <br></div>
                            <span class="time">2018-12-28 22:02</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é¢æ„Ÿè§‰ä½ çŸ¥é“äº›ä»€ä¹ˆğŸ˜„</p>
                                <p class="reply-time">2018-12-28 22:44</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e9/ab/37903736.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">J!</span>
                            </div>
                            <div class="bd">order by ä¸»é”® desc limit 1ä¹Ÿä¼šç´¢å¼•å…¨è¡¨ï¼Ÿ <br></div>
                            <span class="time">2018-12-27 21:16</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç´¢å¼•å…¨è¡¨æ˜¯ä»€ä¹ˆæ„æ€</p>
                                <p class="reply-time">2018-12-27 22:11</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/75/d9/24786b20.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å°å²­å“¥</span>
                            </div>
                            <div class="bd">ä¸ºä»€ä¹ˆå»ºç«‹ç»„åˆç´¢å¼•ä¹‹åä¼šå¤©ç„¶çš„æŒ‰ç…§nameé€’å¢æ’åºå‘¢ <br></div>
                            <span class="time">2018-12-26 07:14</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å› ä¸ºç´¢å¼•è¦æ±‚â€œæœ‰åºâ€</p>
                                <p class="reply-time">2018-12-26 09:56</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>