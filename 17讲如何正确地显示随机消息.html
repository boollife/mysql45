<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                17è®²å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/46/13/46b64dc5812a178e90ed2b05f66f5c13.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="17è®²å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="17è®²å¦‚ä½•æ­£ç¡®åœ°æ˜¾ç¤ºéšæœºæ¶ˆæ¯.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œä¸ºä½ è®²è§£å®Œorder byè¯­å¥çš„å‡ ç§æ‰§è¡Œæ¨¡å¼åï¼Œå°±æƒ³åˆ°äº†ä¹‹å‰ä¸€ä¸ªåšè‹±è¯­å­¦ä¹ Appçš„æœ‹å‹ç¢°åˆ°è¿‡çš„ä¸€ä¸ªæ€§èƒ½é—®é¢˜ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°±ä»è¿™ä¸ªæ€§èƒ½é—®é¢˜è¯´èµ·ï¼Œå’Œä½ è¯´è¯´MySQLä¸­çš„å¦å¤–ä¸€ç§æ’åºéœ€æ±‚ï¼Œå¸Œæœ›èƒ½å¤ŸåŠ æ·±ä½ å¯¹MySQLæ’åºé€»è¾‘çš„ç†è§£ã€‚</p><p>è¿™ä¸ªè‹±è¯­å­¦ä¹ Appé¦–é¡µæœ‰ä¸€ä¸ªéšæœºæ˜¾ç¤ºå•è¯çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®æ¯ä¸ªç”¨æˆ·çš„çº§åˆ«æœ‰ä¸€ä¸ªå•è¯è¡¨ï¼Œç„¶åè¿™ä¸ªç”¨æˆ·æ¯æ¬¡è®¿é—®é¦–é¡µçš„æ—¶å€™ï¼Œéƒ½ä¼šéšæœºæ»šåŠ¨æ˜¾ç¤ºä¸‰ä¸ªå•è¯ã€‚ä»–ä»¬å‘ç°éšç€å•è¯è¡¨å˜å¤§ï¼Œé€‰å•è¯è¿™ä¸ªé€»è¾‘å˜å¾—è¶Šæ¥è¶Šæ…¢ï¼Œç”šè‡³å½±å“åˆ°äº†é¦–é¡µçš„æ‰“å¼€é€Ÿåº¦ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœè®©ä½ æ¥è®¾è®¡è¿™ä¸ªSQLè¯­å¥ï¼Œä½ ä¼šæ€ä¹ˆå†™å‘¢ï¼Ÿ</p><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘å¯¹è¿™ä¸ªä¾‹å­è¿›è¡Œäº†ç®€åŒ–ï¼šå»æ‰æ¯ä¸ªçº§åˆ«çš„ç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„å•è¯è¡¨è¿™ä¸ªé€»è¾‘ï¼Œç›´æ¥å°±æ˜¯ä»ä¸€ä¸ªå•è¯è¡¨ä¸­éšæœºé€‰å‡ºä¸‰ä¸ªå•è¯ã€‚è¿™ä¸ªè¡¨çš„å»ºè¡¨è¯­å¥å’Œåˆå§‹æ•°æ®çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>mysql&gt; CREATE TABLE `words` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `word` varchar(64) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

delimiter ;;
create procedure idata()
begin
  declare i int;
  set i=0;
  while i&lt;10000 do
    insert into words(word) values(concat(char(97+(i div 1000)), char(97+(i % 1000 div 100)), char(97+(i % 100 div 10)), char(97+(i % 10))));
    set i=i+1;
  end while;
end;;
delimiter ;

call idata();
</code></pre><p>ä¸ºäº†ä¾¿äºé‡åŒ–è¯´æ˜ï¼Œæˆ‘åœ¨è¿™ä¸ªè¡¨é‡Œé¢æ’å…¥äº†10000è¡Œè®°å½•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·çœ‹çœ‹è¦éšæœºé€‰æ‹©3ä¸ªå•è¯ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•å®ç°ï¼Œå­˜åœ¨ä»€ä¹ˆé—®é¢˜ä»¥åŠå¦‚ä½•æ”¹è¿›ã€‚</p><h1>å†…å­˜ä¸´æ—¶è¡¨</h1><p>é¦–å…ˆï¼Œä½ ä¼šæƒ³åˆ°ç”¨order by rand()æ¥å®ç°è¿™ä¸ªé€»è¾‘ã€‚</p><pre><code>mysql&gt; select word from words order by rand() limit 3;
</code></pre><p>è¿™ä¸ªè¯­å¥çš„æ„æ€å¾ˆç›´ç™½ï¼Œéšæœºæ’åºå–å‰3ä¸ªã€‚è™½ç„¶è¿™ä¸ªSQLè¯­å¥å†™æ³•å¾ˆç®€å•ï¼Œä½†æ‰§è¡Œæµç¨‹å´æœ‰ç‚¹å¤æ‚çš„ã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»¬å…ˆç”¨explainå‘½ä»¤æ¥çœ‹çœ‹è¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæƒ…å†µã€‚</p><p><img src="https://static001.geekbang.org/resource/image/59/50/59a4fb0165b7ce1184e41f2d061ce350.png" alt=""></p><center><span class="reference">å›¾1 ä½¿ç”¨explainå‘½ä»¤æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œæƒ…å†µ</span></center><p>Extraå­—æ®µæ˜¾ç¤ºUsing temporaryï¼Œè¡¨ç¤ºçš„æ˜¯éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ï¼›Using filesortï¼Œè¡¨ç¤ºçš„æ˜¯éœ€è¦æ‰§è¡Œæ’åºæ“ä½œã€‚</p><p>å› æ­¤è¿™ä¸ªExtraçš„æ„æ€å°±æ˜¯ï¼Œéœ€è¦ä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä¸´æ—¶è¡¨ä¸Šæ’åºã€‚</p><p>è¿™é‡Œï¼Œä½ å¯ä»¥å…ˆå›é¡¾ä¸€ä¸‹<a href="https://time.geekbang.org/column/article/73479">ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­å…¨å­—æ®µæ’åºå’Œrowidæ’åºçš„å†…å®¹ã€‚æˆ‘æŠŠä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸¤ä¸ªæµç¨‹å›¾è´´è¿‡æ¥ï¼Œæ–¹ä¾¿ä½ å¤ä¹ ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/6c/72/6c821828cddf46670f9d56e126e3e772.jpg" alt=""></p><center><span class="reference">å›¾2 å…¨å­—æ®µæ’åº</span></center><p><img src="https://static001.geekbang.org/resource/image/dc/6d/dc92b67721171206a302eb679c83e86d.jpg" alt=""></p><center>å›¾3 rowidæ’åº</center><p>ç„¶åï¼Œæˆ‘å†é—®ä½ ä¸€ä¸ªé—®é¢˜ï¼Œä½ è§‰å¾—å¯¹äºä¸´æ—¶å†…å­˜è¡¨çš„æ’åºæ¥è¯´ï¼Œå®ƒä¼šé€‰æ‹©å“ªä¸€ç§ç®—æ³•å‘¢ï¼Ÿå›é¡¾ä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸€ä¸ªç»“è®ºï¼š<strong>å¯¹äºInnoDBè¡¨æ¥è¯´</strong>ï¼Œæ‰§è¡Œå…¨å­—æ®µæ’åºä¼šå‡å°‘ç£ç›˜è®¿é—®ï¼Œå› æ­¤ä¼šè¢«ä¼˜å…ˆé€‰æ‹©ã€‚</p><p>æˆ‘å¼ºè°ƒäº†â€œInnoDBè¡¨â€ï¼Œä½ è‚¯å®šæƒ³åˆ°äº†ï¼Œ<strong>å¯¹äºå†…å­˜è¡¨ï¼Œå›è¡¨è¿‡ç¨‹åªæ˜¯ç®€å•åœ°æ ¹æ®æ•°æ®è¡Œçš„ä½ç½®ï¼Œç›´æ¥è®¿é—®å†…å­˜å¾—åˆ°æ•°æ®ï¼Œæ ¹æœ¬ä¸ä¼šå¯¼è‡´å¤šè®¿é—®ç£ç›˜</strong>ã€‚ä¼˜åŒ–å™¨æ²¡æœ‰äº†è¿™ä¸€å±‚é¡¾è™‘ï¼Œé‚£ä¹ˆå®ƒä¼šä¼˜å…ˆè€ƒè™‘çš„ï¼Œå°±æ˜¯ç”¨äºæ’åºçš„è¡Œè¶Šå°‘è¶Šå¥½äº†ï¼Œæ‰€ä»¥ï¼ŒMySQLè¿™æ—¶å°±ä¼šé€‰æ‹©rowidæ’åºã€‚</p><p>ç†è§£äº†è¿™ä¸ªç®—æ³•é€‰æ‹©çš„é€»è¾‘ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚åŒæ—¶ï¼Œé€šè¿‡ä»Šå¤©çš„è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥å°è¯•åˆ†æä¸€ä¸‹è¯­å¥çš„æ‰«æè¡Œæ•°ã€‚</p><p>è¿™æ¡è¯­å¥çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ã€‚è¿™ä¸ªä¸´æ—¶è¡¨ä½¿ç”¨çš„æ˜¯memoryå¼•æ“ï¼Œè¡¨é‡Œæœ‰ä¸¤ä¸ªå­—æ®µï¼Œç¬¬ä¸€ä¸ªå­—æ®µæ˜¯doubleç±»å‹ï¼Œä¸ºäº†åé¢æè¿°æ–¹ä¾¿ï¼Œè®°ä¸ºå­—æ®µRï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯varchar(64)ç±»å‹ï¼Œè®°ä¸ºå­—æ®µWã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªè¡¨æ²¡æœ‰å»ºç´¢å¼•ã€‚</p>
</li>
<li>
<p>ä»wordsè¡¨ä¸­ï¼ŒæŒ‰ä¸»é”®é¡ºåºå–å‡ºæ‰€æœ‰çš„wordå€¼ã€‚å¯¹äºæ¯ä¸€ä¸ªwordå€¼ï¼Œè°ƒç”¨rand()å‡½æ•°ç”Ÿæˆä¸€ä¸ªå¤§äº0å°äº1çš„éšæœºå°æ•°ï¼Œå¹¶æŠŠè¿™ä¸ªéšæœºå°æ•°å’Œwordåˆ†åˆ«å­˜å…¥ä¸´æ—¶è¡¨çš„Rå’ŒWå­—æ®µä¸­ï¼Œåˆ°æ­¤ï¼Œæ‰«æè¡Œæ•°æ˜¯10000ã€‚</p>
</li>
<li>
<p>ç°åœ¨ä¸´æ—¶è¡¨æœ‰10000è¡Œæ•°æ®äº†ï¼Œæ¥ä¸‹æ¥ä½ è¦åœ¨è¿™ä¸ªæ²¡æœ‰ç´¢å¼•çš„å†…å­˜ä¸´æ—¶è¡¨ä¸Šï¼ŒæŒ‰ç…§å­—æ®µRæ’åºã€‚</p>
</li>
<li>
<p>åˆå§‹åŒ– sort_bufferã€‚sort_bufferä¸­æœ‰ä¸¤ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯doubleç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜¯æ•´å‹ã€‚</p>
</li>
<li>
<p>ä»å†…å­˜ä¸´æ—¶è¡¨ä¸­ä¸€è¡Œä¸€è¡Œåœ°å–å‡ºRå€¼å’Œä½ç½®ä¿¡æ¯ï¼ˆæˆ‘åé¢ä¼šå’Œä½ è§£é‡Šè¿™é‡Œä¸ºä»€ä¹ˆæ˜¯â€œä½ç½®ä¿¡æ¯â€ï¼‰ï¼Œåˆ†åˆ«å­˜å…¥sort_bufferä¸­çš„ä¸¤ä¸ªå­—æ®µé‡Œã€‚è¿™ä¸ªè¿‡ç¨‹è¦å¯¹å†…å­˜ä¸´æ—¶è¡¨åšå…¨è¡¨æ‰«æï¼Œæ­¤æ—¶æ‰«æè¡Œæ•°å¢åŠ 10000ï¼Œå˜æˆäº†20000ã€‚</p>
</li>
<li>
<p>åœ¨sort_bufferä¸­æ ¹æ®Rçš„å€¼è¿›è¡Œæ’åºã€‚æ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰æ¶‰åŠåˆ°è¡¨æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå¢åŠ æ‰«æè¡Œæ•°ã€‚</p>
</li>
<li>
<p>æ’åºå®Œæˆåï¼Œå–å‡ºå‰ä¸‰ä¸ªç»“æœçš„ä½ç½®ä¿¡æ¯ï¼Œä¾æ¬¡åˆ°å†…å­˜ä¸´æ—¶è¡¨ä¸­å–å‡ºwordå€¼ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè®¿é—®äº†è¡¨çš„ä¸‰è¡Œæ•°æ®ï¼Œæ€»æ‰«æè¡Œæ•°å˜æˆäº†20003ã€‚</p>
</li>
</ol><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow logï¼‰æ¥éªŒè¯ä¸€ä¸‹æˆ‘ä»¬åˆ†æå¾—åˆ°çš„æ‰«æè¡Œæ•°æ˜¯å¦æ­£ç¡®ã€‚</p><pre><code># Query_time: 0.900376  Lock_time: 0.000347 Rows_sent: 3 Rows_examined: 20003
SET timestamp=1541402277;
select word from words order by rand() limit 3;
</code></pre><p>å…¶ä¸­ï¼ŒRows_examinedï¼š20003å°±è¡¨ç¤ºè¿™ä¸ªè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰«æäº†20003è¡Œï¼Œä¹Ÿå°±éªŒè¯äº†æˆ‘ä»¬åˆ†æå¾—å‡ºçš„ç»“è®ºã€‚</p><p>è¿™é‡Œæ’ä¸€å¥é¢˜å¤–è¯ï¼Œåœ¨å¹³æ—¶å­¦ä¹ æ¦‚å¿µçš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥ç»å¸¸è¿™æ ·åšï¼Œå…ˆé€šè¿‡åŸç†åˆ†æç®—å‡ºæ‰«æè¡Œæ•°ï¼Œç„¶åå†é€šè¿‡æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ¥éªŒè¯è‡ªå·±çš„ç»“è®ºã€‚æˆ‘è‡ªå·±å°±æ˜¯ç»å¸¸è¿™ä¹ˆåšï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆæœ‰è¶£ï¼Œåˆ†æå¯¹äº†å¼€å¿ƒï¼Œåˆ†æé”™äº†ä½†æ˜¯å¼„æ¸…æ¥šäº†ä¹Ÿå¾ˆå¼€å¿ƒã€‚</p><p>ç°åœ¨ï¼Œæˆ‘æ¥æŠŠå®Œæ•´çš„æ’åºæ‰§è¡Œæµç¨‹å›¾ç”»å‡ºæ¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/2a/fc/2abe849faa7dcad0189b61238b849ffc.png" alt=""></p><center><span class="reference">å›¾4 éšæœºæ’åºå®Œæ•´æµç¨‹å›¾1</span></center><p>å›¾ä¸­çš„poså°±æ˜¯ä½ç½®ä¿¡æ¯ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å¥‡æ€ªï¼Œè¿™é‡Œçš„â€œä½ç½®ä¿¡æ¯â€æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹InnoDBè¡¨æ’åºçš„æ—¶å€™ï¼Œæ˜æ˜ç”¨çš„è¿˜æ˜¯IDå­—æ®µã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦å›åˆ°ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µï¼š<strong>MySQLçš„è¡¨æ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•æ¥å®šä½â€œä¸€è¡Œæ•°æ®â€çš„ã€‚</strong></p><p>åœ¨å‰é¢<a href="https://time.geekbang.org/column/article/69236">ç¬¬4</a>å’Œ<a href="https://time.geekbang.org/column/article/69636">ç¬¬5</a>ç¯‡ä»‹ç»ç´¢å¼•çš„æ–‡ç« ä¸­ï¼Œæœ‰å‡ ä½åŒå­¦é—®åˆ°ï¼Œå¦‚æœæŠŠä¸€ä¸ªInnoDBè¡¨çš„ä¸»é”®åˆ æ‰ï¼Œæ˜¯ä¸æ˜¯å°±æ²¡æœ‰ä¸»é”®ï¼Œå°±æ²¡åŠæ³•å›è¡¨äº†ï¼Ÿ</p><p>å…¶å®ä¸æ˜¯çš„ã€‚å¦‚æœä½ åˆ›å»ºçš„è¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–è€…æŠŠä¸€ä¸ªè¡¨çš„ä¸»é”®åˆ æ‰äº†ï¼Œé‚£ä¹ˆInnoDBä¼šè‡ªå·±ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º6å­—èŠ‚çš„rowidæ¥ä½œä¸ºä¸»é”®ã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯æ’åºæ¨¡å¼é‡Œé¢ï¼Œrowidåå­—çš„æ¥å†ã€‚å®é™…ä¸Šå®ƒè¡¨ç¤ºçš„æ˜¯ï¼šæ¯ä¸ªå¼•æ“ç”¨æ¥å”¯ä¸€æ ‡è¯†æ•°æ®è¡Œçš„ä¿¡æ¯ã€‚</p><ul>
<li>å¯¹äºæœ‰ä¸»é”®çš„InnoDBè¡¨æ¥è¯´ï¼Œè¿™ä¸ªrowidå°±æ˜¯ä¸»é”®IDï¼›</li>
<li>å¯¹äºæ²¡æœ‰ä¸»é”®çš„InnoDBè¡¨æ¥è¯´ï¼Œè¿™ä¸ªrowidå°±æ˜¯ç”±ç³»ç»Ÿç”Ÿæˆçš„ï¼›</li>
<li>MEMORYå¼•æ“ä¸æ˜¯ç´¢å¼•ç»„ç»‡è¡¨ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œé¢ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚å› æ­¤ï¼Œè¿™ä¸ªrowidå…¶å®å°±æ˜¯æ•°ç»„çš„ä¸‹æ ‡ã€‚</li>
</ul><p>åˆ°è¿™é‡Œï¼Œæˆ‘æ¥ç¨å¾®å°ç»“ä¸€ä¸‹ï¼š<strong>order by rand()ä½¿ç”¨äº†å†…å­˜ä¸´æ—¶è¡¨ï¼Œå†…å­˜ä¸´æ—¶è¡¨æ’åºçš„æ—¶å€™ä½¿ç”¨äº†rowidæ’åºæ–¹æ³•ã€‚</strong></p><h1>ç£ç›˜ä¸´æ—¶è¡¨</h1><p>é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰çš„ä¸´æ—¶è¡¨éƒ½æ˜¯å†…å­˜è¡¨å‘¢ï¼Ÿ</p><p>å…¶å®ä¸æ˜¯çš„ã€‚tmp_table_sizeè¿™ä¸ªé…ç½®é™åˆ¶äº†å†…å­˜ä¸´æ—¶è¡¨çš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯16Mã€‚å¦‚æœä¸´æ—¶è¡¨å¤§å°è¶…è¿‡äº†tmp_table_sizeï¼Œé‚£ä¹ˆå†…å­˜ä¸´æ—¶è¡¨å°±ä¼šè½¬æˆç£ç›˜ä¸´æ—¶è¡¨ã€‚</p><p>ç£ç›˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„å¼•æ“é»˜è®¤æ˜¯InnoDBï¼Œæ˜¯ç”±å‚æ•°internal_tmp_disk_storage_engineæ§åˆ¶çš„ã€‚</p><p>å½“ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨çš„æ—¶å€™ï¼Œå¯¹åº”çš„å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰æ˜¾å¼ç´¢å¼•çš„InnoDBè¡¨çš„æ’åºè¿‡ç¨‹ã€‚</p><p>ä¸ºäº†å¤ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘æŠŠtmp_table_sizeè®¾ç½®æˆ1024ï¼ŒæŠŠsort_buffer_sizeè®¾ç½®æˆ 32768, æŠŠ max_length_for_sort_data è®¾ç½®æˆ16ã€‚</p><pre><code>set tmp_table_size=1024;
set sort_buffer_size=32768;
set max_length_for_sort_data=16;
/* æ‰“å¼€ optimizer_traceï¼Œåªå¯¹æœ¬çº¿ç¨‹æœ‰æ•ˆ */
SET optimizer_trace='enabled=on'; 

/* æ‰§è¡Œè¯­å¥ */
select word from words order by rand() limit 3;

/* æŸ¥çœ‹ OPTIMIZER_TRACE è¾“å‡º */
SELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\G
</code></pre><p><img src="https://static001.geekbang.org/resource/image/78/ab/78d2db9a4fdba81feadccf6e878b4aab.png" alt=""></p><center><span class="reference">å›¾5 OPTIMIZER_TRACEéƒ¨åˆ†ç»“æœ</span></center><p>ç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™æ¬¡OPTIMIZER_TRACEçš„ç»“æœã€‚</p><p>å› ä¸ºå°†max_length_for_sort_dataè®¾ç½®æˆ16ï¼Œå°äºwordå­—æ®µçš„é•¿åº¦å®šä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°sort_modeé‡Œé¢æ˜¾ç¤ºçš„æ˜¯rowidæ’åºï¼Œè¿™ä¸ªæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œå‚ä¸æ’åºçš„æ˜¯éšæœºå€¼Rå­—æ®µå’Œrowidå­—æ®µç»„æˆçš„è¡Œã€‚</p><p>è¿™æ—¶å€™ä½ å¯èƒ½å¿ƒç®—äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸å¯¹ã€‚Rå­—æ®µå­˜æ”¾çš„éšæœºå€¼å°±8ä¸ªå­—èŠ‚ï¼Œrowidæ˜¯6ä¸ªå­—èŠ‚ï¼ˆè‡³äºä¸ºä»€ä¹ˆæ˜¯6å­—èŠ‚ï¼Œå°±ç•™ç»™ä½ è¯¾åæ€è€ƒå§ï¼‰ï¼Œæ•°æ®æ€»è¡Œæ•°æ˜¯10000ï¼Œè¿™æ ·ç®—å‡ºæ¥å°±æœ‰140000å­—èŠ‚ï¼Œè¶…è¿‡äº†sort_buffer_size å®šä¹‰çš„ 32768å­—èŠ‚äº†ã€‚ä½†æ˜¯ï¼Œnumber_of_tmp_filesçš„å€¼å±…ç„¶æ˜¯0ï¼Œéš¾é“ä¸éœ€è¦ç”¨ä¸´æ—¶æ–‡ä»¶å—ï¼Ÿ</p><p>è¿™ä¸ªSQLè¯­å¥çš„æ’åºç¡®å®æ²¡æœ‰ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œé‡‡ç”¨æ˜¯MySQL 5.6ç‰ˆæœ¬å¼•å…¥çš„ä¸€ä¸ªæ–°çš„æ’åºç®—æ³•ï¼Œå³ï¼šä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹ä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶çš„ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯å½’å¹¶æ’åºç®—æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•ã€‚</p><p>å…¶å®ï¼Œæˆ‘ä»¬ç°åœ¨çš„SQLè¯­å¥ï¼Œåªéœ€è¦å–Rå€¼æœ€å°çš„3ä¸ªrowidã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨å½’å¹¶æ’åºç®—æ³•çš„è¯ï¼Œè™½ç„¶æœ€ç»ˆä¹Ÿèƒ½å¾—åˆ°å‰3ä¸ªå€¼ï¼Œä½†æ˜¯è¿™ä¸ªç®—æ³•ç»“æŸåï¼Œå·²ç»å°†10000è¡Œæ•°æ®éƒ½æ’å¥½åºäº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåé¢çš„9997è¡Œä¹Ÿæ˜¯æœ‰åºçš„äº†ã€‚ä½†ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢å¹¶ä¸éœ€è¦è¿™äº›æ•°æ®æ˜¯æœ‰åºçš„ã€‚æ‰€ä»¥ï¼Œæƒ³ä¸€ä¸‹å°±æ˜ç™½äº†ï¼Œè¿™æµªè´¹äº†éå¸¸å¤šçš„è®¡ç®—é‡ã€‚</p><p>è€Œä¼˜å…ˆé˜Ÿåˆ—ç®—æ³•ï¼Œå°±å¯ä»¥ç²¾ç¡®åœ°åªå¾—åˆ°ä¸‰ä¸ªæœ€å°å€¼ï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol>
<li>å¯¹äºè¿™10000ä¸ªå‡†å¤‡æ’åºçš„(R,rowid)ï¼Œå…ˆå–å‰ä¸‰è¡Œï¼Œæ„é€ æˆä¸€ä¸ªå †ï¼›</li>
</ol><p>ï¼ˆå¯¹æ•°æ®ç»“æ„å°è±¡æ¨¡ç³Šçš„åŒå­¦ï¼Œå¯ä»¥å…ˆè®¾æƒ³æˆè¿™æ˜¯ä¸€ä¸ªç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆçš„æ•°ç»„ï¼‰</p><ol>
<li>
<p>å–ä¸‹ä¸€ä¸ªè¡Œ(Râ€™,rowidâ€™)ï¼Œè·Ÿå½“å‰å †é‡Œé¢æœ€å¤§çš„Ræ¯”è¾ƒï¼Œå¦‚æœRâ€™å°äºRï¼ŒæŠŠè¿™ä¸ª(R,rowid)ä»å †ä¸­å»æ‰ï¼Œæ¢æˆ(Râ€™,rowidâ€™)ï¼›</p>
</li>
<li>
<p>é‡å¤ç¬¬2æ­¥ï¼Œç›´åˆ°ç¬¬10000ä¸ª(Râ€™,rowidâ€™)å®Œæˆæ¯”è¾ƒã€‚</p>
</li>
</ol><p>è¿™é‡Œæˆ‘ç®€å•ç”»äº†ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—æ’åºè¿‡ç¨‹çš„ç¤ºæ„å›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/e9/97/e9c29cb20bf9668deba8981e444f6897.png" alt=""></p><center><span class="reference">å›¾6 ä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•ç¤ºä¾‹</span></center><p>å›¾6æ˜¯æ¨¡æ‹Ÿ6ä¸ª(R,rowid)è¡Œï¼Œé€šè¿‡ä¼˜å…ˆé˜Ÿåˆ—æ’åºæ‰¾åˆ°æœ€å°çš„ä¸‰ä¸ªRå€¼çš„è¡Œçš„è¿‡ç¨‹ã€‚æ•´ä¸ªæ’åºè¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æœ€å¿«åœ°æ‹¿åˆ°å½“å‰å †çš„æœ€å¤§å€¼ï¼Œæ€»æ˜¯ä¿æŒæœ€å¤§å€¼åœ¨å †é¡¶ï¼Œå› æ­¤è¿™æ˜¯ä¸€ä¸ªæœ€å¤§å †ã€‚</p><p>å›¾5çš„OPTIMIZER_TRACEç»“æœä¸­ï¼Œfilesort_priority_queue_optimizationè¿™ä¸ªéƒ¨åˆ†çš„chosen=trueï¼Œå°±è¡¨ç¤ºä½¿ç”¨äº†ä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦ä¸´æ—¶æ–‡ä»¶ï¼Œå› æ­¤å¯¹åº”çš„number_of_tmp_filesæ˜¯0ã€‚</p><p>è¿™ä¸ªæµç¨‹ç»“æŸåï¼Œæˆ‘ä»¬æ„é€ çš„å †é‡Œé¢ï¼Œå°±æ˜¯è¿™ä¸ª10000è¡Œé‡Œé¢Rå€¼æœ€å°çš„ä¸‰è¡Œã€‚ç„¶åï¼Œä¾æ¬¡æŠŠå®ƒä»¬çš„rowidå–å‡ºæ¥ï¼Œå»ä¸´æ—¶è¡¨é‡Œé¢æ‹¿åˆ°wordå­—æ®µï¼Œè¿™ä¸ªè¿‡ç¨‹å°±è·Ÿä¸Šä¸€ç¯‡æ–‡ç« çš„rowidæ’åºçš„è¿‡ç¨‹ä¸€æ ·äº†ã€‚</p><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ä¸Šé¢ä¸€ç¯‡æ–‡ç« çš„SQLæŸ¥è¯¢è¯­å¥ï¼š</p><pre><code>select city,name,age from t where city='æ­å·' order by name limit 1000  ;
</code></pre><p>ä½ å¯èƒ½ä¼šé—®ï¼Œè¿™é‡Œä¹Ÿç”¨åˆ°äº†limitï¼Œä¸ºä»€ä¹ˆæ²¡ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ’åºç®—æ³•å‘¢ï¼ŸåŸå› æ˜¯ï¼Œè¿™æ¡SQLè¯­å¥æ˜¯limit 1000ï¼Œå¦‚æœä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ç®—æ³•çš„è¯ï¼Œéœ€è¦ç»´æŠ¤çš„å †çš„å¤§å°å°±æ˜¯1000è¡Œçš„(name,rowid)ï¼Œè¶…è¿‡äº†æˆ‘è®¾ç½®çš„sort_buffer_sizeå¤§å°ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•ã€‚</p><p>æ€»ä¹‹ï¼Œä¸è®ºæ˜¯ä½¿ç”¨å“ªç§ç±»å‹çš„ä¸´æ—¶è¡¨ï¼Œorder by rand()è¿™ç§å†™æ³•éƒ½ä¼šè®©è®¡ç®—è¿‡ç¨‹éå¸¸å¤æ‚ï¼Œéœ€è¦å¤§é‡çš„æ‰«æè¡Œæ•°ï¼Œå› æ­¤æ’åºè¿‡ç¨‹çš„èµ„æºæ¶ˆè€—ä¹Ÿä¼šå¾ˆå¤§ã€‚</p><p>å†å›åˆ°æˆ‘ä»¬æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼Œæ€ä¹ˆæ­£ç¡®åœ°éšæœºæ’åºå‘¢ï¼Ÿ</p><h1>éšæœºæ’åºæ–¹æ³•</h1><p>æˆ‘ä»¬å…ˆæŠŠé—®é¢˜ç®€åŒ–ä¸€ä¸‹ï¼Œå¦‚æœåªéšæœºé€‰æ‹©1ä¸ªwordå€¼ï¼Œå¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿæ€è·¯ä¸Šæ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>å–å¾—è¿™ä¸ªè¡¨çš„ä¸»é”®idçš„æœ€å¤§å€¼Må’Œæœ€å°å€¼N;</p>
</li>
<li>
<p>ç”¨éšæœºå‡½æ•°ç”Ÿæˆä¸€ä¸ªæœ€å¤§å€¼åˆ°æœ€å°å€¼ä¹‹é—´çš„æ•° X = (M-N)*rand() + N;</p>
</li>
<li>
<p>å–ä¸å°äºXçš„ç¬¬ä¸€ä¸ªIDçš„è¡Œã€‚</p>
</li>
</ol><p>æˆ‘ä»¬æŠŠè¿™ä¸ªç®—æ³•ï¼Œæš‚æ—¶ç§°ä½œéšæœºç®—æ³•1ã€‚è¿™é‡Œï¼Œæˆ‘ç›´æ¥ç»™ä½ è´´ä¸€ä¸‹æ‰§è¡Œè¯­å¥çš„åºåˆ—:</p><pre><code>mysql&gt; select max(id),min(id) into @M,@N from t ;
set @X= floor((@M-@N+1)*rand() + @N);
select * from t where id &gt;= @X limit 1;
</code></pre><p>è¿™ä¸ªæ–¹æ³•æ•ˆç‡å¾ˆé«˜ï¼Œå› ä¸ºå–max(id)å’Œmin(id)éƒ½æ˜¯ä¸éœ€è¦æ‰«æç´¢å¼•çš„ï¼Œè€Œç¬¬ä¸‰æ­¥çš„selectä¹Ÿå¯ä»¥ç”¨ç´¢å¼•å¿«é€Ÿå®šä½ï¼Œå¯ä»¥è®¤ä¸ºå°±åªæ‰«æäº†3è¡Œã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªç®—æ³•æœ¬èº«å¹¶ä¸ä¸¥æ ¼æ»¡è¶³é¢˜ç›®çš„éšæœºè¦æ±‚ï¼Œå› ä¸ºIDä¸­é—´å¯èƒ½æœ‰ç©ºæ´ï¼Œå› æ­¤é€‰æ‹©ä¸åŒè¡Œçš„æ¦‚ç‡ä¸ä¸€æ ·ï¼Œä¸æ˜¯çœŸæ­£çš„éšæœºã€‚</p><p>æ¯”å¦‚ä½ æœ‰4ä¸ªidï¼Œåˆ†åˆ«æ˜¯1ã€2ã€4ã€5ï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå–åˆ° id=4çš„è¿™ä¸€è¡Œçš„æ¦‚ç‡æ˜¯å–å¾—å…¶ä»–è¡Œæ¦‚ç‡çš„ä¸¤å€ã€‚</p><p>å¦‚æœè¿™å››è¡Œçš„idåˆ†åˆ«æ˜¯1ã€2ã€40000ã€40001å‘¢ï¼Ÿè¿™ä¸ªç®—æ³•åŸºæœ¬å°±èƒ½å½“bugæ¥çœ‹å¾…äº†ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†å¾—åˆ°ä¸¥æ ¼éšæœºçš„ç»“æœï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæµç¨‹:</p><ol>
<li>
<p>å–å¾—æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œå¹¶è®°ä¸ºCã€‚</p>
</li>
<li>
<p>å–å¾— Y = floor(C * rand())ã€‚ floorå‡½æ•°åœ¨è¿™é‡Œçš„ä½œç”¨ï¼Œå°±æ˜¯å–æ•´æ•°éƒ¨åˆ†ã€‚</p>
</li>
<li>
<p>å†ç”¨limit Y,1 å–å¾—ä¸€è¡Œã€‚</p>
</li>
</ol><p>æˆ‘ä»¬æŠŠè¿™ä¸ªç®—æ³•ï¼Œç§°ä¸ºéšæœºç®—æ³•2ã€‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œå°±æ˜¯ä¸Šé¢æµç¨‹çš„æ‰§è¡Œè¯­å¥çš„åºåˆ—ã€‚</p><pre><code>mysql&gt; select count(*) into @C from t;
set @Y = floor(@C * rand());
set @sql = concat(&quot;select * from t limit &quot;, @Y, &quot;,1&quot;);
prepare stmt from @sql;
execute stmt;
DEALLOCATE prepare stmt;
</code></pre><p>ç”±äºlimit åé¢çš„å‚æ•°ä¸èƒ½ç›´æ¥è·Ÿå˜é‡ï¼Œæ‰€ä»¥æˆ‘åœ¨ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨äº†prepare+executeçš„æ–¹æ³•ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠæ‹¼æ¥SQLè¯­å¥çš„æ–¹æ³•å†™åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œä¼šæ›´ç®€å•äº›ã€‚</p><p>è¿™ä¸ªéšæœºç®—æ³•2ï¼Œè§£å†³äº†ç®—æ³•1é‡Œé¢æ˜æ˜¾çš„æ¦‚ç‡ä¸å‡åŒ€é—®é¢˜ã€‚</p><p>MySQLå¤„ç†limit Y,1 çš„åšæ³•å°±æ˜¯æŒ‰é¡ºåºä¸€ä¸ªä¸€ä¸ªåœ°è¯»å‡ºæ¥ï¼Œä¸¢æ‰å‰Yä¸ªï¼Œç„¶åæŠŠä¸‹ä¸€ä¸ªè®°å½•ä½œä¸ºè¿”å›ç»“æœï¼Œå› æ­¤è¿™ä¸€æ­¥éœ€è¦æ‰«æY+1è¡Œã€‚å†åŠ ä¸Šï¼Œç¬¬ä¸€æ­¥æ‰«æçš„Cè¡Œï¼Œæ€»å…±éœ€è¦æ‰«æC+Y+1è¡Œï¼Œæ‰§è¡Œä»£ä»·æ¯”éšæœºç®—æ³•1çš„ä»£ä»·è¦é«˜ã€‚</p><p>å½“ç„¶ï¼Œéšæœºç®—æ³•2è·Ÿç›´æ¥order by rand()æ¯”èµ·æ¥ï¼Œæ‰§è¡Œä»£ä»·è¿˜æ˜¯å°å¾ˆå¤šçš„ã€‚</p><p>ä½ å¯èƒ½é—®äº†ï¼Œå¦‚æœæŒ‰ç…§è¿™ä¸ªè¡¨æœ‰10000è¡Œæ¥è®¡ç®—çš„è¯ï¼ŒC=10000ï¼Œè¦æ˜¯éšæœºåˆ°æ¯”è¾ƒå¤§çš„Yå€¼ï¼Œé‚£æ‰«æè¡Œæ•°ä¹Ÿè·Ÿ20000å·®ä¸å¤šäº†ï¼Œæ¥è¿‘order by rand()çš„æ‰«æè¡Œæ•°ï¼Œä¸ºä»€ä¹ˆè¯´éšæœºç®—æ³•2çš„ä»£ä»·è¦å°å¾ˆå¤šå‘¢ï¼Ÿæˆ‘å°±æŠŠè¿™ä¸ªé—®é¢˜ç•™ç»™ä½ å»è¯¾åæ€è€ƒå§ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†çœ‹çœ‹ï¼Œå¦‚æœæˆ‘ä»¬æŒ‰ç…§éšæœºç®—æ³•2çš„æ€è·¯ï¼Œè¦éšæœºå–3ä¸ªwordå€¼å‘¢ï¼Ÿä½ å¯ä»¥è¿™ä¹ˆåšï¼š</p><ol>
<li>
<p>å–å¾—æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œè®°ä¸ºCï¼›</p>
</li>
<li>
<p>æ ¹æ®ç›¸åŒçš„éšæœºæ–¹æ³•å¾—åˆ°Y1ã€Y2ã€Y3ï¼›</p>
</li>
<li>
<p>å†æ‰§è¡Œä¸‰ä¸ªlimit Y, 1è¯­å¥å¾—åˆ°ä¸‰è¡Œæ•°æ®ã€‚</p>
</li>
</ol><p>æˆ‘ä»¬æŠŠè¿™ä¸ªç®—æ³•ï¼Œç§°ä½œéšæœºç®—æ³•3ã€‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œå°±æ˜¯ä¸Šé¢æµç¨‹çš„æ‰§è¡Œè¯­å¥çš„åºåˆ—ã€‚</p><pre><code>mysql&gt; select count(*) into @C from t;
set @Y1 = floor(@C * rand());
set @Y2 = floor(@C * rand());
set @Y3 = floor(@C * rand());
select * from t limit @Y1ï¼Œ1ï¼› //åœ¨åº”ç”¨ä»£ç é‡Œé¢å–Y1ã€Y2ã€Y3å€¼ï¼Œæ‹¼å‡ºSQLåæ‰§è¡Œ
select * from t limit @Y2ï¼Œ1ï¼›
select * from t limit @Y3ï¼Œ1ï¼›
</code></pre><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘æ˜¯å€Ÿç€éšæœºæ’åºçš„éœ€æ±‚ï¼Œè·Ÿä½ ä»‹ç»äº†MySQLå¯¹ä¸´æ—¶è¡¨æ’åºçš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>å¦‚æœä½ ç›´æ¥ä½¿ç”¨order by rand()ï¼Œè¿™ä¸ªè¯­å¥éœ€è¦Using temporary å’Œ Using filesortï¼ŒæŸ¥è¯¢çš„æ‰§è¡Œä»£ä»·å¾€å¾€æ˜¯æ¯”è¾ƒå¤§çš„ã€‚æ‰€ä»¥ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™ä½ è¦é‡é¿å¼€è¿™ç§å†™æ³•ã€‚</p><p>ä»Šå¤©çš„ä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬ä¸æ˜¯ä»…ä»…åœ¨æ•°æ®åº“å†…éƒ¨è§£å†³é—®é¢˜ï¼Œè¿˜ä¼šè®©åº”ç”¨ä»£ç é…åˆæ‹¼æ¥SQLè¯­å¥ã€‚åœ¨å®é™…åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒè§„èŒƒçš„ç”¨æ³•å°±æ˜¯ï¼šå°½é‡å°†ä¸šåŠ¡é€»è¾‘å†™åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œè®©æ•°æ®åº“åªåšâ€œè¯»å†™æ•°æ®â€çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿™ç±»æ–¹æ³•çš„åº”ç”¨è¿˜æ˜¯æ¯”è¾ƒå¹¿æ³›çš„ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>ä¸Šé¢çš„éšæœºç®—æ³•3çš„æ€»æ‰«æè¡Œæ•°æ˜¯ C+(Y1+1)+(Y2+1)+(Y3+1)ï¼Œå®é™…ä¸Šå®ƒè¿˜æ˜¯å¯ä»¥ç»§ç»­ä¼˜åŒ–ï¼Œæ¥è¿›ä¸€æ­¥å‡å°‘æ‰«æè¡Œæ•°çš„ã€‚</p><p>æˆ‘çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä½ æ˜¯è¿™ä¸ªéœ€æ±‚çš„å¼€å‘äººå‘˜ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Œæ¥å‡å°‘æ‰«æè¡Œæ•°å‘¢ï¼Ÿè¯´è¯´ä½ çš„æ–¹æ¡ˆï¼Œå¹¶è¯´æ˜ä½ çš„æ–¹æ¡ˆéœ€è¦çš„æ‰«æè¡Œæ•°ã€‚</p><p>ä½ å¯ä»¥æŠŠä½ çš„è®¾è®¡å’Œç»“è®ºå†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾å’Œä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œselect * from t where city in (â€œæ­å·â€," è‹å· ") order by name limit 100;è¿™ä¸ªSQLè¯­å¥æ˜¯å¦éœ€è¦æ’åºï¼Ÿæœ‰ä»€ä¹ˆæ–¹æ¡ˆå¯ä»¥é¿å…æ’åºï¼Ÿ</p><p>è™½ç„¶æœ‰(city,name)è”åˆç´¢å¼•ï¼Œå¯¹äºå•ä¸ªcityå†…éƒ¨ï¼Œnameæ˜¯é€’å¢çš„ã€‚ä½†æ˜¯ç”±äºè¿™æ¡SQLè¯­å¥ä¸æ˜¯è¦å•ç‹¬åœ°æŸ¥ä¸€ä¸ªcityçš„å€¼ï¼Œè€Œæ˜¯åŒæ—¶æŸ¥äº†"æ­å·"å’Œ" è‹å· "ä¸¤ä¸ªåŸå¸‚ï¼Œå› æ­¤æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„nameå°±ä¸æ˜¯é€’å¢çš„äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡SQLè¯­å¥éœ€è¦æ’åºã€‚</p><p>é‚£æ€ä¹ˆé¿å…æ’åºå‘¢ï¼Ÿ</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬è¦ç”¨åˆ°(city,name)è”åˆç´¢å¼•çš„ç‰¹æ€§ï¼ŒæŠŠè¿™ä¸€æ¡è¯­å¥æ‹†æˆä¸¤æ¡è¯­å¥ï¼Œæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol>
<li>
<p>æ‰§è¡Œselect * from t where city=â€œæ­å·â€ order by name limit 100; è¿™ä¸ªè¯­å¥æ˜¯ä¸éœ€è¦æ’åºçš„ï¼Œå®¢æˆ·ç«¯ç”¨ä¸€ä¸ªé•¿åº¦ä¸º100çš„å†…å­˜æ•°ç»„Aä¿å­˜ç»“æœã€‚</p>
</li>
<li>
<p>æ‰§è¡Œselect * from t where city=â€œè‹å·â€ order by name limit 100; ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œå‡è®¾ç»“æœè¢«å­˜è¿›äº†å†…å­˜æ•°ç»„Bã€‚</p>
</li>
<li>
<p>ç°åœ¨Aå’ŒBæ˜¯ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼Œç„¶åä½ å¯ä»¥ç”¨å½’å¹¶æ’åºçš„æ€æƒ³ï¼Œå¾—åˆ°nameæœ€å°çš„å‰100å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»“æœäº†ã€‚</p>
</li>
</ol><p>å¦‚æœæŠŠè¿™æ¡SQLè¯­å¥é‡Œâ€œlimit 100â€æ”¹æˆâ€œlimit 10000,100â€çš„è¯ï¼Œå¤„ç†æ–¹å¼å…¶å®ä¹Ÿå·®ä¸å¤šï¼Œå³ï¼šè¦æŠŠä¸Šé¢çš„ä¸¤æ¡è¯­å¥æ”¹æˆå†™ï¼š</p><pre><code>select * from t where city=&quot;æ­å·&quot; order by name limit 10100; 
</code></pre><p>å’Œ</p><pre><code> select * from t where city=&quot;è‹å·&quot; order by name limit 10100ã€‚
</code></pre><p>è¿™æ—¶å€™æ•°æ®é‡è¾ƒå¤§ï¼Œå¯ä»¥åŒæ—¶èµ·ä¸¤ä¸ªè¿æ¥ä¸€è¡Œè¡Œè¯»ç»“æœï¼Œç”¨å½’å¹¶æ’åºç®—æ³•æ‹¿åˆ°è¿™ä¸¤ä¸ªç»“æœé›†é‡Œï¼ŒæŒ‰é¡ºåºå–ç¬¬10001~10100çš„nameå€¼ï¼Œå°±æ˜¯éœ€è¦çš„ç»“æœäº†ã€‚</p><p>å½“ç„¶è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æŸå¤±ï¼Œå°±æ˜¯ä»æ•°æ®åº“è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®é‡å˜å¤§äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœæ•°æ®çš„å•è¡Œæ¯”è¾ƒå¤§çš„è¯ï¼Œå¯ä»¥è€ƒè™‘æŠŠè¿™ä¸¤æ¡SQLè¯­å¥æ”¹æˆä¸‹é¢è¿™ç§å†™æ³•ï¼š</p><pre><code>select id,name from t where city=&quot;æ­å·&quot; order by name limit 10100; 
</code></pre><p>å’Œ</p><pre><code>select id,name from t where city=&quot;è‹å·&quot; order by name limit 10100ã€‚
</code></pre><p>ç„¶åï¼Œå†ç”¨å½’å¹¶æ’åºçš„æ–¹æ³•å–å¾—æŒ‰nameé¡ºåºç¬¬10001~10100çš„nameã€idçš„å€¼ï¼Œç„¶åæ‹¿ç€è¿™100ä¸ªidåˆ°æ•°æ®åº“ä¸­å»æŸ¥å‡ºæ‰€æœ‰è®°å½•ã€‚</p><p>ä¸Šé¢è¿™äº›æ–¹æ³•ï¼Œéœ€è¦ä½ æ ¹æ®æ€§èƒ½éœ€æ±‚å’Œå¼€å‘çš„å¤æ‚åº¦åšå‡ºæƒè¡¡ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>è¯„è®ºåŒºå¾ˆå¤šåŒå­¦éƒ½æåˆ°ä¸èƒ½æ’åºï¼Œè¯´æ˜å„ä½å¯¹ç´¢å¼•çš„å­˜å‚¨éƒ½ç†è§£å¯¹äº†ã€‚<br>
@å³° åŒå­¦æåˆ°äº†å½’å¹¶æ’åºï¼Œæ˜¯æˆ‘ä»¬è¿™ä¸ªé—®é¢˜è§£æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼›<br>
@è€æ¨åŒå¿— çš„å›ç­”ä¸­æåˆ°äº†â€œä»ä¸šåŠ¡ä¸Šç æ‰åŠŸèƒ½â€ï¼Œè¿™ä¸ªä¹Ÿç¡®å®æ˜¯åœ¨ä¸šåŠ¡è®¾è®¡ä¸­å¯ä»¥è€ƒè™‘çš„ä¸€ä¸ªæ–¹å‘ï¼›<br>
@æŸã€äºº å¸®å¿™å›ç­”äº†@å‘æ¡æ©™å­åŒå­¦çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¯¹é—®é¢˜ä¸€çš„å›ç­”ï¼Œéå¸¸ç²¾å½©ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è€æ¨åŒå¿—</span>
                            </div>
                            <div class="bd">å¯¹åº”å•è¯è¿™ç§æ€»é‡ä¸æ˜¯å¾ˆå¤šçš„æ•°æ®ï¼Œç¬¬ä¸€æ„Ÿè§‰åº”è¯¥è£…jdkç¼“å­˜æˆ–è€…redisç¼“å­˜ã€‚ç”±äºéœ€è¦éšæœºè®¿é—®ï¼Œæ•°ç»„æ¯”è¾ƒå¥½ã€‚å‡å¦‚ä¸€ä¸ªå•è¯å¹³å‡10ä¸ªå­—èŠ‚ï¼Œ10*10000ï¼Œä¸åˆ°1Må°±è£…ä¸‹äº†ã€‚<br>å¦‚æœä¸€å®šè¦ç”¨æ•°æ®åº“æ¥åšï¼Œè€å¸ˆçš„æ–¹æ¡ˆ1æ¯”è¾ƒå¥½ï¼Œç©ºæ´çš„é—®é¢˜ï¼Œå¦‚æœå•è¯åº“ä¸å˜ï¼Œå¯ä»¥åœ¨ä¸Šçº¿å‰æ•´ç†æ•°æ®ï¼ŒæŠŠç©ºæ´å¤„ç†è°ƒã€‚æ¯”å¦‚ï¼šåŸæ¥å•è¯å­˜åœ¨Aè¡¨ï¼Œæ–°å»ºBè¡¨  ï¼Œæ‰§è¡Œ insert into B(word) select word from A.   Bçš„idæ˜¯è‡ªå¢çš„ï¼Œå°±ä¼šç”Ÿæˆè¿ç»­çš„ä¸»é”®ã€‚å½“ç„¶å¦‚æœAè¡¨å†™æ¯”è¾ƒé¢‘ç¹ï¼Œä¸”æ•°æ®é‡è¾ƒå¤§ï¼Œä¸šåŠ¡ä¸Šç¦ç”¨ è¿™ç§å†™æ³•ï¼ŒRRçš„éš”ç¦»çº§åˆ«ä¼šé”Aè¡¨ <br> <br></div>
                            <span class="time">2018-12-21 10:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é‡æ–°æ•´ç†è¡¨è¿™ä¸ªæ€è·¯å¾ˆèµğŸ‘ğŸ¿<br><br>çœ‹å¾—å‡ºä½ æ˜¯ä¸šåŠ¡ç»éªŒå¾ˆä¸°å¯Œå•Šï¼Œè¿™å‡ æ¬¡é—®é¢˜ï¼Œå¯¹åº•å±‚å®ç°å’Œä¸šåŠ¡åŠŸèƒ½çš„å¹³è¡¡ï¼Œè€ƒè™‘ç‚¹å¾ˆä¸é”™</p>
                                <p class="reply-time">2018-12-21 10:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/82/e3/d9285284.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é›ªä¸­é¼ [æ‚ é—²]</span>
                            </div>
                            <div class="bd">å¦‚æœæŒ‰ç…§ä¸šåŠ¡éœ€æ±‚ï¼Œéšæœºå–ä¸‰ä¸ªï¼Œæ•°æ®åº“è¿˜åœ¨è®¾è®¡é˜¶æ®µ,å¯ä»¥å¢åŠ ä¸€ä¸ªä¸»é”®å­—æ®µ,ç”¨æ¥è®°å½•æ¯è¡Œè®°å½•çš„rowidï¼Œè¿™æ ·ä¸€ä¸‡è¡Œï¼Œé‚£å°±æ˜¯è¿ç»­çš„ä¸€ä¸‡ï¼Œç„¶åéšæœºï¼Œç”¨è¯¥éšæœºrowidå›è¡¨æŸ¥è¯¢è¯¥è¡Œè®°å½• <br></div>
                            <span class="time">2018-12-21 08:59</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™ä¸ªä¹Ÿæ˜¯ä¸ªå¥½æ–¹æ³•ï¼Œå°±æ˜¯ç¡®ä¿è¿ç»­ï¼Œå¯ä»¥å¿«é€Ÿçš„å¾—åˆ°Cå’Œå‡ ä¸ªåç§»é‡</p>
                                <p class="reply-time">2018-12-21 11:08</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/4f/60/049a20e9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å´å®‡æ™¨</span>
                            </div>
                            <div class="bd">æˆ‘è§‰å¾—å¯ä»¥æŒ‰Yæ’ä¸ªåºï¼Œç¬¬ä¸€æ¡å–å®Œï¼Œæ‹¿åˆ°å¯¹åº”idï¼Œç„¶åæœ‰ä¸€æ¡è¯­å¥å°±æ˜¯where idå¤§äºxxxï¼Œlimit y2-y1ï¼Œ1 <br></div>
                            <span class="time">2018-12-21 08:00</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æŠ“ä½äº†å…³é”®ç‚¹ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-21 11:15</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLE4LYb3jrH63ZV98Zpc8DompwDgb1O3nffMoZCmiaibauRyEFv6NDNsST9RWxZExvMLMWb50zaanoQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ…§é‘«coming</span>
                            </div>
                            <div class="bd">åˆåˆ°å‘¨äº”äº†ï¼Œå¼€å¿ƒğŸ˜œ <br></div>
                            <span class="time">2018-12-21 08:04</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">HuaMax</span>
                            </div>
                            <div class="bd">å‡è®¾Y1ï¼ŒY2ï¼ŒY3æ˜¯ç”±å°åˆ°å¤§çš„ä¸‰ä¸ªæ•°ï¼Œåˆ™å¯ä»¥ä¼˜åŒ–æˆè¿™æ ·ï¼Œè¿™æ ·æ‰«æè¡Œæ•°ä¸ºY3<br>id1 = select * from t limit @Y1ï¼Œ1ï¼›<br>id2= select * from t where id &gt; id1 limit @Y2-@Y1ï¼Œ1ï¼›<br>select * from t where id &gt; id2 limit @Y3 - @Y2ï¼Œ1ï¼› <br></div>
                            <span class="time">2018-12-21 17:47</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-21 21:15</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/6e/10/05f19719.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">freesia</span>
                            </div>
                            <div class="bd">ä»ä¸Šä¸€è®²åˆ°è¿™ä¸€è®²ï¼Œæˆ‘å‘ç°è€å¸ˆåœ¨å¤„ç†é—®é¢˜æ—¶ï¼Œæå‡ºçš„æ–¹æ³•å°±ä¸å†æ˜¯å•çº¯ä¾é MySQLè§£å†³ï¼Œå› ä¸ºå¯èƒ½ä¼šè€—è´¹å¾ˆå¤šèµ„æºï¼Œè€Œæ˜¯æŠŠé—®é¢˜åˆ†æ‹…ä¸€éƒ¨åˆ†åˆ°å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯æ‹¿åˆ°æ•°æ®åå†æ’åºï¼Œæˆ–è€…å®¢æˆ·ç«¯äº§ç”Ÿéšæœºæ•°å†åˆ°MySQLä¸­å»æŸ¥è¯¢ã€‚ <br></div>
                            <span class="time">2018-12-23 17:57</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯å—¯ï¼ŒMySQL çš„ä»£ç å’Œä¸šåŠ¡ä»£ç éƒ½æ˜¯ä»£ç ğŸ˜„ é…åˆèµ·æ¥ç”¨</p>
                                <p class="reply-time">2018-12-23 22:13</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/50/99/d69363ab.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æçš®çš®çš®çš®çš®</span>
                            </div>
                            <div class="bd">æˆ‘ç»å¸¸åœ¨æ–‡ä¸­çœ‹åˆ°å¤šä¸ªäº‹åŠ¡çš„æ‰§è¡Œæ—¶åºã€‚çº¿ä¸‹åšå®éªŒçš„æ—¶å€™ï¼Œæ˜¯æ€ä¹ˆä¿è¯èƒ½æŒ‰è¿™ä¸ªæ—¶åºæ‰§è¡Œå‘¢ï¼Ÿ <br></div>
                            <span class="time">2018-12-21 20:01</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¼€ä¸¤ä¸ªçª—å£ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œå‘½ä»¤å“¦</p>
                                <p class="reply-time">2018-12-21 20:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/34/3d/041f831f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å²æœˆå®‰ç„¶</span>
                            </div>
                            <div class="bd">ä¸ºä»€ä¹ˆéšæœºç®—æ³•2æ¯”order by rand()çš„ä»£ä»·å°å¾ˆå¤šï¼Ÿ<br>å› ä¸ºéšæœºç®—æ³•2è¿›è¡Œlimitè·å–æ•°æ®çš„æ—¶å€™æ˜¯æ ¹æ®ä¸»é”®æ’åºè·å–çš„ï¼Œä¸»é”®å¤©ç„¶ç´¢å¼•æ’åºã€‚è·å–åˆ°ç¬¬9999æ¡çš„æ•°æ®ä¹Ÿè¿œæ¯”order by rand()æ–¹æ³•çš„ç»„æˆä¸´æ—¶è¡¨Rå­—æ®µæ’åºå†è·å–rowidä»£ä»·å°çš„å¤šã€‚ <br></div>
                            <span class="time">2018-12-21 11:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¯¹çš„ï¼Œ<br><br>ä½ æ˜¯ç¬¬ä¸€ä¸ªå›ç­”æ­£æ–‡ä¸­é—´é—®é¢˜çš„ğŸ˜„ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2018-12-21 11:57</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è‘£èˆª</span>
                            </div>
                            <div class="bd">å †ç»“æ„ï¼Œå¤§é¡¶æ ‘ï¼Œå°é¡¶æ ‘ï¼ï¼ï¼ <br></div>
                            <span class="time">2018-12-21 11:05</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/03/01/62b32acf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ç‹é£æ´‹</span>
                            </div>
                            <div class="bd">å½’å¹¶æ’åºï¼Œä¼˜å…ˆé˜Ÿåˆ—ï¼Œç®—æ³•æ— å¤„ä¸åœ¨ã€‚ <br></div>
                            <span class="time">2018-12-21 08:05</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¦è¯´ç®—æ³•è¿˜æ˜¯éš”å£ç‹è€å¸ˆè®²çš„ä¸“ä¸šï¼Œè¿™é‡Œå’±ä»¬å°±åªè¿½æ±‚MySQL é‡Œé¢ç”¨åˆ°çš„ï¼Œèƒ½ç»™å¤§å®¶è®²æ˜ç™½å°±è¡Œäº†ğŸ˜„</p>
                                <p class="reply-time">2018-12-21 11:59</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/16/31/ae8adf82.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è·¯è¿‡</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæˆ‘ä¸ºå¿«é€Ÿæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ã€‚æŠŠå‚æ•°ä½ç½®ä¸ºï¼š<br>innodb_flush_log_at_trx_commit=2<br>sync_binlog=0<br>æ‰§è¡Œé©¬ä¸Šå°±ç»“æŸäº†ã€‚å¦åˆ™è¦ç­‰å¾ˆä¹…ã€‚è¯·æ•™è€å¸ˆï¼Œä¸Šé¢ä¿®æ”¹åï¼Œæ•°æ®å’Œlogè¿˜æ²¡æœ‰çœŸæ­£åˆ·åˆ°ç£ç›˜ã€‚è¯·é—®æˆ‘åœ¨å“ªé‡Œå¯ä»¥çœ‹åˆ°ç›¸å…³çš„ä¿¡æ¯ã€‚<br>ä½¿ç”¨show engine innodb status\G çœ‹åˆ°ï¼š<br>0 pending log flushes, 0 pending chkp writes<br>20197 log i&#47;o&#39;s done, 0.00 log i&#47;o&#39;s&#47;second<br>è°¢è°¢ï¼ <br></div>
                            <span class="time">2018-12-22 16:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç¡®å®æ²¡åœ°æ–¹çœ‹ğŸ˜“</p>
                                <p class="reply-time">2018-12-22 22:44</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e2/0b/e3c8765a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é£åŠ¨è‰</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼æ‚¨è¯´çš„åœ¨å»ºäºŒçº§ç´¢å¼•çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯æŠŠä¸»é”®å–å‡ºæ¥æ„é€ äºŒçº§ç´¢å¼•ï¼Œè€Œä¸”è¦è¯»å…¨è¡¨ï¼Œè¿™ä¸ªè¯»å…¨è¡¨æ„æ€æ˜¯ä¸æ˜¯ï¼Œè¯»äº†ä¸»é”®ï¼Œå°±æ„å‘³ç€ä¸»é”®çš„å¶å­èŠ‚ç‚¹ä¹Ÿä¸€èµ·è¯»å‡ºæ¥äº†ï¼Ÿ <br></div>
                            <span class="time">2018-12-22 09:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„</p>
                                <p class="reply-time">2018-12-22 14:07</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/26/1e/adc166df.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ— çœ </span>
                            </div>
                            <div class="bd">ä¸€ç›´æ¯”è¾ƒç–‘æƒ‘ä»€ä¹ˆæƒ…å†µä¸‹ä¼šäº§ç”Ÿä¸´æ—¶è¡¨Using temporaryï¼Œå¸Œæœ›è€å¸ˆæŒ‡ç‚¹ä¸‹ <br></div>
                            <span class="time">2018-12-21 18:29</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æŸ¥è¯¢éœ€è¦ä¸´æ—¶è¡¨ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œéœ€è¦ä¸´æ—¶è¡¨æ¥æ”¾rand()ç»“æœ</p>
                                <p class="reply-time">2018-12-21 21:02</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/0c/75/e7c6c403.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é“¶å¤ª@å·¨ç›Šç§‘æŠ€</span>
                            </div>
                            <div class="bd">è¯·æ•™ä¸‹è€å¸ˆï¼š<br>è¡¨Aæœ‰skuå’Œwarehouseä¸¤ä¸ªå­—æ®µç»„æˆçš„å”¯ä¸€ç´¢å¼•,udx_sku_warehouseï¼Œé«˜å¹¶å‘ä¸‹å®¹æ˜“æ­»é”<br>æ‰§è¡Œçš„è¯­å¥ï¼šupdate A set quantity=quantity+1 where sku=xx and warehouse=xx<br>æŸ¥çœ‹æ­»é”çš„æ—¥å¿—ï¼šä¸¤ä¸ªäº‹åŠ¡éƒ½åœ¨ç­‰å¾…udx_sku_warehouseçš„Xé”ï¼Œä½†ä¸¤ä¸ªäº‹åŠ¡ä¿®æ”¹çš„å¹¶ä¸æ˜¯åŒä¸€æ¡è®°å½•ï¼Œä¸æ˜¯å¾ˆæ˜ç™½ï¼Œå¯ä»¥è®²è§£ä¸€ä¸‹å—ï¼Ÿå¤šè°¢<br>*** (1) TRANSACTION:<br>TRANSACTION 466841895, ACTIVE 0.021 sec starting index read<br>mysql tables in use 1, locked 1<br>LOCK WAIT 11 lock struct(s), heap size 2936, 9 row lock(s), undo log entries 11<br>LOCK BLOCKING MySQL thread id: 1927379 block 1895984<br>MySQL thread id 1895984, OS thread handle 0x2b2ffed85700, query id 783954740 10.27.8.222 oms updating<br>UPDATE oms_stock<br>    SET quantity = quantity + -1<br>    WHERE sku_id = 13978218638755841<br>      AND virtual_warehouse_id = 13867758969455616<br>*** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 297 page no 89 n bits 424 index `udx_sku_id_warehouse_id` of table `oms_biz`.`oms_stock` trx id 466841895 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 18 PHYSICAL RECORD: n_fields 3; compact format; info bits 0<br><br>*** (2) TRANSACTION:<br>TRANSACTION 466841901, ACTIVE 0.015 sec starting index read<br>mysql tables in use 1, locked 1<br>11 lock struct(s), heap size 2936, 8 row lock(s), undo log entries 9<br>MySQL thread id 1927379, OS thread handle 0x2b2f97440700, query id 783954758 10.27.8.222 oms updating<br>UPDATE oms_stock<br>    SET quantity = quantity + -1<br>    WHERE sku_id = 1809040003028<br>      AND virtual_warehouse_id = 13867758969455616<br>*** (2) HOLDS THE LOCK(S):<br>RECORD LOCKS space id 297 page no 89 n bits 424 index `udx_sku_id_warehouse_id` of table `oms_biz`.`oms_stock` trx id 466841901 lock_mode X locks rec but not gap<br>Record lock, heap no 18 PHYSICAL RECORD: n_fields 3; compact format; info bits 0<br><br>*** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 297 page no 74 n bits 400 index `udx_sku_id_warehouse_id` of table `oms_biz`.`oms_stock` trx id 466841901 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 12 PHYSICAL RECORD: n_fields 3; compact format; info bits 0 <br></div>
                            <span class="time">2018-12-21 17:25</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ ä¸€ä¸ªäº‹åŠ¡é‡Œé¢æ˜¯ä¸æ˜¯ä¸æ­¢ä¸€ä¸ªè¿™æ ·çš„update è¯­å¥?</p>
                                <p class="reply-time">2018-12-21 22:15</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/92/ef/55a09708.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">penelopewu</span>
                            </div>
                            <div class="bd">è¿è¡Œè€å¸ˆç»™çš„å­˜å‚¨è¿‡ç¨‹ç‰¹åˆ«æ…¢ï¼Œæ€ä¹ˆæ’æŸ¥åŸå› å‘¢ï¼Œmysqlç‰ˆæœ¬æ˜¯8.0.13 <br></div>
                            <span class="time">2018-12-21 15:56</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æŠŠinnodb_flush_at_trx_commitè®¾ç½®æˆ2ï¼Œsync_binlogè®¾ç½®æˆ1000çœ‹çœ‹</p>
                                <p class="reply-time">2018-12-21 21:18</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å€ªå¤§äºº</span>
                            </div>
                            <div class="bd">è¯¾åé¢˜å¯ä»¥åœ¨éšæœºå‡ºY1ã€Y2ã€Y3åï¼Œç®—å‡ºYmaxã€Ymin<br>å†ç”¨ select id from t limit Yminï¼Œ(Ymax - Ymin)ï¼›<br>å¾—åˆ°idé›†åç®—å‡ºY1ã€Y2ã€Y3å¯¹åº”çš„ä¸‰ä¸ªid<br>æœ€å  select * from t where id in (id1, id2, id3)<br>è¿™æ ·æ‰«æçš„è¡Œæ•°åº”è¯¥æ˜¯C+Ymax+3 <br></div>
                            <span class="time">2018-12-21 11:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ¼‚äº®</p>
                                <p class="reply-time">2018-12-21 11:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œå›é¡¾è¿™ç¯‡çš„æ—¶å€™çªç„¶æœ‰ä¸ªç–‘æƒ‘ã€‚<br>æ‰§è¡Œå™¨åªæ˜¯è°ƒå¼•æ“æ¥å£è·å–ç»“æœï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºorder byçš„æ’åºè¿‡ç¨‹åº”è¯¥æ˜¯åœ¨æ‰§è¡Œå™¨æ‰§è¡Œçš„å§ï¼Ÿå†…å­˜ä¸´æ—¶è¡¨ä½¿ç”¨çš„memoryå¼•æ“ï¼Œåº”è¯¥ä¹Ÿæ˜¯åœ¨serverç«¯ï¼Œè€Œç£ç›˜ä¸´æ—¶è¡¨åº”è¯¥æ˜¯innodbå†…éƒ¨ã€‚<br>æˆ‘è¿™ä¹ˆç†è§£å¯¹å—ï¼Ÿè¿˜æ˜¯è¯´æ•´ä¸ªæ’åºè¿‡ç¨‹å…¨éƒ¨éƒ½åœ¨innodbå†…éƒ¨æ‰§è¡Œï¼Ÿ<br>å¯¹æ­¤çªç„¶æœ‰ç‚¹ç–‘æƒ‘â€¦â€¦â€¦ <br></div>
                            <span class="time">2018-12-29 11:21</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">mysqlçš„æ‰§è¡Œè¿‡ç¨‹éƒ½æ˜¯ç”±æ‰§è¡Œå™¨æ¥è°ƒåº¦çš„<br><br>ä¸è®ºåˆ›å»ºmemoryä¸´æ—¶è¡¨è¿˜æ˜¯innodbä¸´æ—¶è¡¨ï¼Œéƒ½æ˜¯æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„åˆ›å»ºè¡¨æ¥å£å®ç°çš„<br><br>å†™æ•°æ®å’Œè¯»æ•°æ®ä¹Ÿæ˜¯<br><br>æ’åºè¿™ä¸ªæ“ä½œï¼Œæ˜¯åœ¨serverå±‚åšçš„</p>
                                <p class="reply-time">2018-12-30 10:00</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆæ‚¨å¥½ï¼Œè¿™ç¯‡çš„order by rand()ç”¨åˆ°äº†ä¸´æ—¶è¡¨ã€‚<br>é‚£ä¹ˆåµŒå¥—çš„sqlè¯­å¥ï¼š<br>select * from (select * from t1 where ...) t2 where .....<br>æ‹¬å·å†…éƒ¨æŸ¥è¯¢å‡ºçš„ç»“æœé›†æ˜¯ä¸æ˜¯ä¹Ÿä¼šä»¥ ä¸´æ—¶è¡¨çš„å½¢å¼ å­˜åœ¨ï¼Ÿ?å¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸´æ—¶è¡¨æ˜¯ä¸æ˜¯ä¹Ÿå­˜å‚¨åœ¨innodbå†…éƒ¨å‘€ï¼Œç­‰å¾…äº‹åŠ¡ç»“æŸåå†æ¸…ç©ºï¼Ÿï¼Ÿ <br></div>
                            <span class="time">2018-12-27 10:50</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å­æŸ¥è¯¢ä¸ä¸€å®šä¼šéœ€è¦ä¸´æ—¶è¡¨ï¼Œä½ è¦çœ‹explainçš„ç»“æœå“ˆ<br><br>å¦‚æœéœ€è¦ä¸´æ—¶è¡¨ï¼Œè¿˜è¦å†çœ‹ä¸´æ—¶è¡¨å¤§å°ï¼Œå°çš„ç”¨memoryå¼•æ“ï¼Œå¤§çš„ç”¨innodb </p>
                                <p class="reply-time">2018-12-27 17:45</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/14/5d/3870280f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æå®¢ç«¥</span>
                            </div>
                            <div class="bd">ä¸ŠæœŸé—®é¢˜ï¼Œè™½ç„¶æƒ³åˆ°å½’å¹¶æ’åºï¼Œä½†æ˜¯æ²¡è§‰å¾—ä¼šæ‰‹åŠ¨é‡æ–°æ’åºï¼Œä»¥ä¸ºä¼šæœ‰åŠæ³•ä»sqlä¸‹æ‰‹ï¼Œå“ˆå“ˆã€‚<br>å¯¹å½’å¹¶æ’åºï¼Œæˆ‘è®¤ä¸ºå¯ä»¥select * from table limit 100 offset 10000ï¼Œå†è®¡ç®—ï¼Œé€Ÿåº¦æ›´å¿«ã€‚ <br></div>
                            <span class="time">2018-12-25 15:56</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é«˜æ•</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæ€æ ·è®©mysqlä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ’åºæ³•è€Œä¸ä½¿ç”¨å½’å¹¶æ’åºç®—æ³•å‘¢ï¼Ÿ <br></div>
                            <span class="time">2018-12-25 09:57</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ’åºå†…å­˜è®¾å¤§ç‚¹ğŸ˜„ </p>
                                <p class="reply-time">2018-12-25 13:27</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>