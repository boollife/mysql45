<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                21è®²ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤š
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/be/04/bef7889aea4e542f24747e0aba819e04.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="21è®²ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤š.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="21è®²ä¸ºä»€ä¹ˆæˆ‘åªæ”¹ä¸€è¡Œçš„è¯­å¥ï¼Œé”è¿™ä¹ˆå¤š.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†é—´éš™é”å’Œnext-key lockçš„æ¦‚å¿µï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¯´æ˜åŠ é”è§„åˆ™ã€‚é—´éš™é”çš„æ¦‚å¿µç†è§£èµ·æ¥ç¡®å®æœ‰ç‚¹å„¿éš¾ï¼Œå°¤å…¶åœ¨é…åˆä¸Šè¡Œé”ä»¥åï¼Œå¾ˆå®¹æ˜“åœ¨åˆ¤æ–­æ˜¯å¦ä¼šå‡ºç°é”ç­‰å¾…çš„é—®é¢˜ä¸ŠçŠ¯é”™ã€‚</p><p>æ‰€ä»¥ä»Šå¤©ï¼Œæˆ‘ä»¬å°±å…ˆä»è¿™ä¸ªåŠ é”è§„åˆ™å¼€å§‹å§ã€‚</p><p>é¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œè¿™äº›åŠ é”è§„åˆ™æˆ‘æ²¡åœ¨åˆ«çš„åœ°æ–¹çœ‹åˆ°è¿‡æœ‰ç±»ä¼¼çš„æ€»ç»“ï¼Œä»¥å‰æˆ‘è‡ªå·±åˆ¤æ–­çš„æ—¶å€™éƒ½æ˜¯æƒ³ç€ä»£ç é‡Œé¢çš„å®ç°æ¥è„‘è¡¥çš„ã€‚è¿™æ¬¡ä¸ºäº†æ€»ç»“æˆä¸çœ‹ä»£ç çš„åŒå­¦ä¹Ÿèƒ½ç†è§£çš„è§„åˆ™ï¼Œæ˜¯æˆ‘åˆé‡æ–°åˆ·äº†ä»£ç ä¸´æ—¶æ€»ç»“å‡ºæ¥çš„ã€‚æ‰€ä»¥ï¼Œ<strong>è¿™ä¸ªè§„åˆ™æœ‰ä»¥ä¸‹ä¸¤æ¡å‰æè¯´æ˜ï¼š</strong></p><ol>
<li>
<p>MySQLåé¢çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¹å˜åŠ é”ç­–ç•¥ï¼Œæ‰€ä»¥è¿™ä¸ªè§„åˆ™åªé™äºæˆªæ­¢åˆ°ç°åœ¨çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå³5.xç³»åˆ—&lt;=5.7.24ï¼Œ8.0ç³»åˆ— &lt;=8.0.13ã€‚</p>
</li>
<li>
<p>å¦‚æœå¤§å®¶åœ¨éªŒè¯ä¸­æœ‰å‘ç°bad caseçš„è¯ï¼Œè¯·æå‡ºæ¥ï¼Œæˆ‘ä¼šå†è¡¥å……è¿›è¿™ç¯‡æ–‡ç« ï¼Œä½¿å¾—ä¸€èµ·å­¦ä¹ æœ¬ä¸“æ çš„æ‰€æœ‰åŒå­¦éƒ½èƒ½å—ç›Šã€‚</p>
</li>
</ol><p>å› ä¸ºé—´éš™é”åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰æ•ˆï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« æ¥ä¸‹æ¥çš„æè¿°ï¼Œè‹¥æ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œé»˜è®¤æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ã€‚</p><p><strong>æˆ‘æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚</strong></p><ol>
<li>
<p>åŸåˆ™1ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯next-key lockã€‚å¸Œæœ›ä½ è¿˜è®°å¾—ï¼Œnext-key lockæ˜¯å‰å¼€åé—­åŒºé—´ã€‚</p>
</li>
<li>
<p>åŸåˆ™2ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚</p>
</li>
<li>
<p>ä¼˜åŒ–1ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºè¡Œé”ã€‚</p>
</li>
<li>
<p>ä¼˜åŒ–2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key locké€€åŒ–ä¸ºé—´éš™é”ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªbugï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚</p>
</li>
</ol><!-- [[[read_end]]] --><p>æˆ‘è¿˜æ˜¯ä»¥ä¸Šç¯‡æ–‡ç« çš„è¡¨tä¸ºä¾‹ï¼Œå’Œä½ è§£é‡Šä¸€ä¸‹è¿™äº›è§„åˆ™ã€‚è¡¨tçš„å»ºè¡¨è¯­å¥å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ã€‚</p><pre><code>CREATE TABLE `t` (
  `id` int(11) NOT NULL,
  `c` int(11) DEFAULT NULL,
  `d` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `c` (`c`)
) ENGINE=InnoDB;

insert into t values(0,0,0),(5,5,5),
(10,10,10),(15,15,15),(20,20,20),(25,25,25);
</code></pre><p>æ¥ä¸‹æ¥çš„ä¾‹å­åŸºæœ¬éƒ½æ˜¯é…åˆç€å›¾ç‰‡è¯´æ˜çš„ï¼Œæ‰€ä»¥æˆ‘å»ºè®®ä½ å¯ä»¥å¯¹ç…§ç€æ–‡ç¨¿çœ‹ï¼Œæœ‰äº›ä¾‹å­å¯èƒ½ä¼šâ€œæ¯ä¸‰è§‚â€ï¼Œä¹Ÿå»ºè®®ä½ è¯»å®Œæ–‡ç« åäº²æ‰‹å®è·µä¸€ä¸‹ã€‚</p><h1>æ¡ˆä¾‹ä¸€ï¼šç­‰å€¼æŸ¥è¯¢é—´éš™é”</h1><p>ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯å…³äºç­‰å€¼æ¡ä»¶æ“ä½œé—´éš™ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/58/6c/585dfa8d0dd71171a6fa16bed4ba816c.png" alt=""></p><center><span class="reference">å›¾1 ç­‰å€¼æŸ¥è¯¢çš„é—´éš™é”</span></center><p>ç”±äºè¡¨tä¸­æ²¡æœ‰id=7çš„è®°å½•ï¼Œæ‰€ä»¥ç”¨æˆ‘ä»¬ä¸Šé¢æåˆ°çš„åŠ é”è§„åˆ™åˆ¤æ–­ä¸€ä¸‹çš„è¯ï¼š</p><ol>
<li>
<p>æ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼Œsession AåŠ é”èŒƒå›´å°±æ˜¯(5,10]ï¼›</p>
</li>
<li>
<p>åŒæ—¶æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢(id=7)ï¼Œè€Œid=10ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œnext-key locké€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯(5,10)ã€‚</p>
</li>
</ol><p>æ‰€ä»¥ï¼Œsession Bè¦å¾€è¿™ä¸ªé—´éš™é‡Œé¢æ’å…¥id=8çš„è®°å½•ä¼šè¢«é”ä½ï¼Œä½†æ˜¯session Cä¿®æ”¹id=10è¿™è¡Œæ˜¯å¯ä»¥çš„ã€‚</p><h1>æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼é”</h1><p>ç¬¬äºŒä¸ªä¾‹å­æ˜¯å…³äºè¦†ç›–ç´¢å¼•ä¸Šçš„é”ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/46/65/465990fe8f6b418ca3f9992bd1bb5465.png" alt=""></p><center><span class="reference">å›¾2 åªåŠ åœ¨éå”¯ä¸€ç´¢å¼•ä¸Šçš„é”</span></center><p>çœ‹åˆ°è¿™ä¸ªä¾‹å­ï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§â€œè¯¥é”çš„ä¸é”ï¼Œä¸è¯¥é”çš„ä¹±é”â€çš„æ„Ÿè§‰ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å§ã€‚</p><p>è¿™é‡Œsession Aè¦ç»™ç´¢å¼•cä¸Šc=5çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”ã€‚</p><ol>
<li>
<p>æ ¹æ®åŸåˆ™1ï¼ŒåŠ é”å•ä½æ˜¯next-key lockï¼Œå› æ­¤ä¼šç»™(0,5]åŠ ä¸Šnext-key lockã€‚</p>
</li>
<li>
<p>è¦æ³¨æ„cæ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤ä»…è®¿é—®c=5è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„ï¼Œéœ€è¦å‘å³éå†ï¼ŒæŸ¥åˆ°c=10æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™(5,10]åŠ next-key lockã€‚</p>
</li>
<li>
<p>ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ–2ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³c=5è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é”(5,10)ã€‚</p>
</li>
<li>
<p>æ ¹æ®åŸåˆ™2 ï¼Œ<strong>åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”</strong>ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆsession Bçš„updateè¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆã€‚</p>
</li>
</ol><p>ä½†session Cè¦æ’å…¥ä¸€ä¸ª(7,7,7)çš„è®°å½•ï¼Œå°±ä¼šè¢«session Açš„é—´éš™é”(5,10)é”ä½ã€‚</p><p>éœ€è¦æ³¨æ„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œlock in share modeåªé”è¦†ç›–ç´¢å¼•ï¼Œä½†æ˜¯å¦‚æœæ˜¯for updateå°±ä¸ä¸€æ ·äº†ã€‚ æ‰§è¡Œ for updateæ—¶ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºä½ æ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ã€‚</p><p>è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼›åŒæ—¶ï¼Œå®ƒç»™æˆ‘ä»¬çš„æŒ‡å¯¼æ˜¯ï¼Œå¦‚æœä½ è¦ç”¨lock in share modeæ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œåœ¨æŸ¥è¯¢å­—æ®µä¸­åŠ å…¥ç´¢å¼•ä¸­ä¸å­˜åœ¨çš„å­—æ®µã€‚æ¯”å¦‚ï¼Œå°†session Açš„æŸ¥è¯¢è¯­å¥æ”¹æˆselect d from t where c=5 lock in share modeã€‚ä½ å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹æ•ˆæœã€‚</p><h1>æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´é”</h1><p>ç¬¬ä¸‰ä¸ªä¾‹å­æ˜¯å…³äºèŒƒå›´æŸ¥è¯¢çš„ã€‚</p><p>ä¸¾ä¾‹ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼šå¯¹äºæˆ‘ä»¬è¿™ä¸ªè¡¨tï¼Œä¸‹é¢è¿™ä¸¤æ¡æŸ¥è¯¢è¯­å¥ï¼ŒåŠ é”èŒƒå›´ç›¸åŒå—ï¼Ÿ</p><pre><code>mysql&gt; select * from t where id=10 for update;
mysql&gt; select * from t where id&gt;=10 and id&lt;11 for update;
</code></pre><p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œidå®šä¹‰ä¸ºintç±»å‹ï¼Œè¿™ä¸¤ä¸ªè¯­å¥å°±æ˜¯ç­‰ä»·çš„å§ï¼Ÿå…¶å®ï¼Œå®ƒä»¬å¹¶ä¸å®Œå…¨ç­‰ä»·ã€‚</p><p>åœ¨é€»è¾‘ä¸Šï¼Œè¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°±è®©session Aæ‰§è¡Œç¬¬äºŒä¸ªæŸ¥è¯¢è¯­å¥ï¼Œæ¥çœ‹çœ‹åŠ é”æ•ˆæœã€‚</p><p><img src="https://static001.geekbang.org/resource/image/30/80/30b839bf941f109b04f1a36c302aea80.png" alt=""></p><center><span class="reference">å›¾3 ä¸»é”®ç´¢å¼•ä¸ŠèŒƒå›´æŸ¥è¯¢çš„é”</span></center><p>ç°åœ¨æˆ‘ä»¬å°±ç”¨å‰é¢æåˆ°çš„åŠ é”è§„åˆ™ï¼Œæ¥åˆ†æä¸€ä¸‹session A ä¼šåŠ ä»€ä¹ˆé”å‘¢ï¼Ÿ</p><ol>
<li>
<p>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªid=10çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯next-key lock(5,10]ã€‚ æ ¹æ®ä¼˜åŒ–1ï¼Œ ä¸»é”®idä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº†id=10è¿™ä¸€è¡Œçš„è¡Œé”ã€‚</p>
</li>
<li>
<p>èŒƒå›´æŸ¥æ‰¾å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ°id=15è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œå› æ­¤éœ€è¦åŠ next-key lock(10,15]ã€‚</p>
</li>
</ol><p>æ‰€ä»¥ï¼Œsession Aè¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé”id=10å’Œnext-key lock(10,15]ã€‚è¿™æ ·ï¼Œsession Bå’Œsession Cçš„ç»“æœä½ å°±èƒ½ç†è§£äº†ã€‚</p><p>è¿™é‡Œä½ éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé¦–æ¬¡session Aå®šä½æŸ¥æ‰¾id=10çš„è¡Œçš„æ—¶å€™ï¼Œæ˜¯å½“åšç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ°id=15çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­ã€‚</p><h1>æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´é”</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸¤ä¸ªèŒƒå›´æŸ¥è¯¢åŠ é”çš„ä¾‹å­ï¼Œä½ å¯ä»¥å¯¹ç…§ç€æ¡ˆä¾‹ä¸‰æ¥çœ‹ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯ï¼Œæ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„whereéƒ¨åˆ†ç”¨çš„æ˜¯å­—æ®µcã€‚</p><p><img src="https://static001.geekbang.org/resource/image/73/7a/7381475e9e951628c9fc907f5a57697a.png" alt=""></p><center><span class="reference">å›¾4 éå”¯ä¸€ç´¢å¼•èŒƒå›´é”</span></center><p>è¿™æ¬¡session Aç”¨å­—æ®µcæ¥åˆ¤æ–­ï¼ŒåŠ é”è§„åˆ™è·Ÿæ¡ˆä¾‹ä¸‰å”¯ä¸€çš„ä¸åŒæ˜¯ï¼šåœ¨ç¬¬ä¸€æ¬¡ç”¨c=10å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼•cä¸ŠåŠ äº†(5,10]è¿™ä¸ªnext-key lockåï¼Œç”±äºç´¢å¼•cæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ï¼Œå› æ­¤æœ€ç»ˆsesion AåŠ çš„é”æ˜¯ï¼Œç´¢å¼•cä¸Šçš„(5,10] å’Œ(10,15] è¿™ä¸¤ä¸ªnext-key lockã€‚</p><p>æ‰€ä»¥ä»ç»“æœä¸Šæ¥çœ‹ï¼Œsesson Bè¦æ’å…¥ï¼ˆ8,8,8)çš„è¿™ä¸ªinsertè¯­å¥æ—¶å°±è¢«å µä½äº†ã€‚</p><p>è¿™é‡Œéœ€è¦æ‰«æåˆ°c=15æ‰åœæ­¢æ‰«æï¼Œæ˜¯åˆç†çš„ï¼Œå› ä¸ºInnoDBè¦æ‰«åˆ°c=15ï¼Œæ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åæ‰¾äº†ã€‚</p><h1>æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é”bug</h1><p>å‰é¢çš„å››ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å·²ç»ç”¨åˆ°äº†åŠ é”è§„åˆ™ä¸­çš„ä¸¤ä¸ªåŸåˆ™å’Œä¸¤ä¸ªä¼˜åŒ–ï¼Œæ¥ä¸‹æ¥å†çœ‹ä¸€ä¸ªå…³äºåŠ é”è§„åˆ™ä¸­bugçš„æ¡ˆä¾‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/b1/6d/b105f8c4633e8d3a84e6422b1b1a316d.png" alt=""></p><center><span class="reference">å›¾5 å”¯ä¸€ç´¢å¼•èŒƒå›´é”çš„bug</span></center><p>session Aæ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™1çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼•idä¸ŠåªåŠ (10,15]è¿™ä¸ªnext-key lockï¼Œå¹¶ä¸”å› ä¸ºidæ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ°id=15è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†ã€‚</p><p>ä½†æ˜¯å®ç°ä¸Šï¼ŒInnoDBä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯id=20ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼•idä¸Šçš„(15,20]è¿™ä¸ªnext-key lockä¹Ÿä¼šè¢«é”ä¸Šã€‚</p><p>æ‰€ä»¥ä½ çœ‹åˆ°äº†ï¼Œsession Bè¦æ›´æ–°id=20è¿™ä¸€è¡Œï¼Œæ˜¯ä¼šè¢«é”ä½çš„ã€‚åŒæ ·åœ°ï¼Œsession Cè¦æ’å…¥id=16çš„ä¸€è¡Œï¼Œä¹Ÿä¼šè¢«é”ä½ã€‚</p><p>ç…§ç†è¯´ï¼Œè¿™é‡Œé”ä½id=20è¿™ä¸€è¡Œçš„è¡Œä¸ºï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å› ä¸ºæ‰«æåˆ°id=15ï¼Œå°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åå†æ‰¾äº†ã€‚ä½†å®ç°ä¸Šè¿˜æ˜¯è¿™ä¹ˆåšäº†ï¼Œå› æ­¤æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ªbugã€‚</p><p>æˆ‘ä¹Ÿæ›¾æ‰¾ç¤¾åŒºçš„ä¸“å®¶è®¨è®ºè¿‡ï¼Œå®˜æ–¹bugç³»ç»Ÿä¸Šä¹Ÿæœ‰æåˆ°ï¼Œä½†æ˜¯å¹¶æœªè¢«verifiedã€‚æ‰€ä»¥ï¼Œè®¤ä¸ºè¿™æ˜¯bugè¿™ä¸ªäº‹å„¿ï¼Œä¹Ÿåªèƒ½ç®—æˆ‘çš„ä¸€å®¶ä¹‹è¨€ï¼Œå¦‚æœä½ æœ‰å…¶ä»–è§è§£çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ æå‡ºæ¥ã€‚</p><h1>æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨"ç­‰å€¼"çš„ä¾‹å­</h1><p>æ¥ä¸‹æ¥çš„ä¾‹å­ï¼Œæ˜¯ä¸ºäº†æ›´å¥½åœ°è¯´æ˜â€œé—´éš™â€è¿™ä¸ªæ¦‚å¿µã€‚è¿™é‡Œï¼Œæˆ‘ç»™è¡¨tæ’å…¥ä¸€æ¡æ–°è®°å½•ã€‚</p><pre><code>mysql&gt; insert into t values(30,10,30);
</code></pre><p>æ–°æ’å…¥çš„è¿™ä¸€è¡Œc=10ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨è¡¨é‡Œæœ‰ä¸¤ä¸ªc=10çš„è¡Œã€‚é‚£ä¹ˆï¼Œè¿™æ—¶å€™ç´¢å¼•cä¸Šçš„é—´éš™æ˜¯ä»€ä¹ˆçŠ¶æ€äº†å‘¢ï¼Ÿä½ è¦çŸ¥é“ï¼Œç”±äºéå”¯ä¸€ç´¢å¼•ä¸ŠåŒ…å«ä¸»é”®çš„å€¼ï¼Œæ‰€ä»¥æ˜¯ä¸å¯èƒ½å­˜åœ¨â€œç›¸åŒâ€çš„ä¸¤è¡Œçš„ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/c1/59/c1fda36c1502606eb5be3908011ba159.png" alt=""></p><center><span class="reference">å›¾6 éå”¯ä¸€ç´¢å¼•ç­‰å€¼çš„ä¾‹å­</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æœ‰ä¸¤ä¸ªc=10ï¼Œä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼idæ˜¯ä¸åŒçš„ï¼ˆåˆ†åˆ«æ˜¯10å’Œ30ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ªc=10çš„è®°å½•ä¹‹é—´ï¼Œä¹Ÿæ˜¯æœ‰é—´éš™çš„ã€‚</p><p>å›¾ä¸­æˆ‘ç”»å‡ºäº†ç´¢å¼•cä¸Šçš„ä¸»é”®idã€‚ä¸ºäº†è·Ÿé—´éš™é”çš„å¼€åŒºé—´å½¢å¼è¿›è¡ŒåŒºåˆ«ï¼Œæˆ‘ç”¨(c=10,id=30)è¿™æ ·çš„å½¢å¼ï¼Œæ¥è¡¨ç¤ºç´¢å¼•ä¸Šçš„ä¸€è¡Œã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ¡ˆä¾‹å…­ã€‚</p><p>è¿™æ¬¡æˆ‘ä»¬ç”¨deleteè¯­å¥æ¥éªŒè¯ã€‚æ³¨æ„ï¼Œdeleteè¯­å¥åŠ é”çš„é€»è¾‘ï¼Œå…¶å®è·Ÿselect ... for update æ˜¯ç±»ä¼¼çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘åœ¨æ–‡ç« å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ªâ€œåŸåˆ™â€ã€ä¸¤ä¸ªâ€œä¼˜åŒ–â€å’Œä¸€ä¸ªâ€œbugâ€ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/b5/78/b55fb0a1cac3500b60e1cf9779d2da78.png" alt=""></p><center><span class="reference">å›¾7 delete ç¤ºä¾‹</span></center><p>è¿™æ—¶ï¼Œsession Aåœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ªc=10çš„è®°å½•ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®åŸåˆ™1ï¼Œè¿™é‡ŒåŠ çš„æ˜¯(c=5,id=5)åˆ°(c=10,id=10)è¿™ä¸ªnext-key lockã€‚</p><p>ç„¶åï¼Œsession Aå‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ°(c=15,id=15)è¿™ä¸€è¡Œï¼Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ–2ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ(c=10,id=10) åˆ° (c=15,id=15)çš„é—´éš™é”ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªdeleteè¯­å¥åœ¨ç´¢å¼•cä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ã€‚<br>
<img src="https://static001.geekbang.org/resource/image/bb/24/bb0ad92483d71f0dcaeeef278f89cb24.png" alt=""></p><center><span class="reference">å›¾8 deleteåŠ é”æ•ˆæœç¤ºä¾‹</span></center><p>è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³(c=5,id=5)å’Œ(c=15,id=15)è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”ã€‚</p><h1>æ¡ˆä¾‹ä¸ƒï¼šlimit è¯­å¥åŠ é”</h1><p>ä¾‹å­6ä¹Ÿæœ‰ä¸€ä¸ªå¯¹ç…§æ¡ˆä¾‹ï¼Œåœºæ™¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/af/2e/afc3a08ae7a254b3251e41b2a6dae02e.png" alt=""></p><center><span class="reference">å›¾9 limit è¯­å¥åŠ é”</span></center><p>è¿™ä¸ªä¾‹å­é‡Œï¼Œsession Açš„deleteè¯­å¥åŠ äº† limit 2ã€‚ä½ çŸ¥é“è¡¨té‡Œc=10çš„è®°å½•å…¶å®åªæœ‰ä¸¤æ¡ï¼Œå› æ­¤åŠ ä¸åŠ limit 2ï¼Œåˆ é™¤çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åŠ é”çš„æ•ˆæœå´ä¸åŒã€‚å¯ä»¥çœ‹åˆ°ï¼Œsession Bçš„insertè¯­å¥æ‰§è¡Œé€šè¿‡äº†ï¼Œè·Ÿæ¡ˆä¾‹å…­çš„ç»“æœä¸åŒã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ¡ˆä¾‹ä¸ƒé‡Œçš„deleteè¯­å¥æ˜ç¡®åŠ äº†limit 2çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ°(c=10, id=30)è¿™ä¸€è¡Œä¹‹åï¼Œæ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚</p><p>å› æ­¤ï¼Œç´¢å¼•cä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»ï¼ˆc=5,id=5)åˆ°ï¼ˆc=10,id=30)è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://static001.geekbang.org/resource/image/e5/d5/e5408ed94b3d44985073255db63bd0d5.png" alt=""></p><center><span class="reference">å›¾10 å¸¦limit 2çš„åŠ é”æ•ˆæœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œ(c=10,id=30ï¼‰ä¹‹åçš„è¿™ä¸ªé—´éš™å¹¶æ²¡æœ‰åœ¨åŠ é”èŒƒå›´é‡Œï¼Œå› æ­¤insertè¯­å¥æ’å…¥c=12æ˜¯å¯ä»¥æ‰§è¡ŒæˆåŠŸçš„ã€‚</p><p>è¿™ä¸ªä¾‹å­å¯¹æˆ‘ä»¬å®è·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯ï¼Œ<strong>åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ limit</strong>ã€‚è¿™æ ·ä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´ã€‚</p><h1>æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­</h1><p>å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ†æçš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§next-key lockçš„é€»è¾‘æ¥åˆ†æçš„ï¼Œå› ä¸ºè¿™æ ·åˆ†ææ¯”è¾ƒæ–¹ä¾¿ã€‚æœ€åæˆ‘ä»¬å†çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼Œç›®çš„æ˜¯è¯´æ˜ï¼šnext-key lockå®é™…ä¸Šæ˜¯é—´éš™é”å’Œè¡Œé”åŠ èµ·æ¥çš„ç»“æœã€‚</p><p>ä½ ä¸€å®šä¼šç–‘æƒ‘ï¼Œè¿™ä¸ªæ¦‚å¿µä¸æ˜¯ä¸€å¼€å§‹å°±è¯´äº†å—ï¼Ÿä¸è¦ç€æ€¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/7b/06/7b911a4c995706e8aa2dd96ff0f36506.png" alt=""></p><center><span class="reference">å›¾11 æ¡ˆä¾‹å…«çš„æ“ä½œåºåˆ—</span></center><p>ç°åœ¨ï¼Œæˆ‘ä»¬æŒ‰æ—¶é—´é¡ºåºæ¥åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ç»“æœã€‚</p><ol>
<li>
<p>session A å¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ lock in share modeï¼Œåœ¨ç´¢å¼•cä¸ŠåŠ äº†next-key lock(5,10] å’Œé—´éš™é”(10,15)ï¼›</p>
</li>
<li>
<p>session B çš„updateè¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼•cä¸ŠåŠ next-key lock(5,10] ï¼Œè¿›å…¥é”ç­‰å¾…ï¼›</p>
</li>
<li>
<p>ç„¶åsession Aè¦å†æ’å…¥(8,8,8)è¿™ä¸€è¡Œï¼Œè¢«session Bçš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼ŒInnoDBè®©session Bå›æ»šã€‚</p>
</li>
</ol><p>ä½ å¯èƒ½ä¼šé—®ï¼Œsession Bçš„next-key lockä¸æ˜¯è¿˜æ²¡ç”³è¯·æˆåŠŸå—ï¼Ÿ</p><p>å…¶å®æ˜¯è¿™æ ·çš„ï¼Œsession Bçš„â€œåŠ next-key lock(5,10] â€æ“ä½œï¼Œå®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œå…ˆæ˜¯åŠ (5,10)çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ c=10çš„è¡Œé”ï¼Œè¿™æ—¶å€™æ‰è¢«é”ä½çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨åˆ†æåŠ é”è§„åˆ™çš„æ—¶å€™å¯ä»¥ç”¨next-key lockæ¥åˆ†æã€‚ä½†æ˜¯è¦çŸ¥é“ï¼Œå…·ä½“æ‰§è¡Œçš„æ—¶å€™ï¼Œæ˜¯è¦åˆ†æˆé—´éš™é”å’Œè¡Œé”ä¸¤æ®µæ¥æ‰§è¡Œçš„ã€‚</p><h1>å°ç»“</h1><p>è¿™é‡Œæˆ‘å†æ¬¡è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸Šé¢çš„æ‰€æœ‰æ¡ˆä¾‹éƒ½æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«(repeatable-read)ä¸‹éªŒè¯çš„ã€‚åŒæ—¶ï¼Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«éµå®ˆä¸¤é˜¶æ®µé”åè®®ï¼Œæ‰€æœ‰åŠ é”çš„èµ„æºï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æäº¤æˆ–è€…å›æ»šçš„æ—¶å€™æ‰é‡Šæ”¾çš„ã€‚</p><p>åœ¨æœ€åçš„æ¡ˆä¾‹ä¸­ï¼Œä½ å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“next-key lockå®é™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®ç°çš„ã€‚å¦‚æœåˆ‡æ¢åˆ°è¯»æäº¤éš”ç¦»çº§åˆ«(read-committed)çš„è¯ï¼Œå°±å¥½ç†è§£äº†ï¼Œè¿‡ç¨‹ä¸­å»æ‰é—´éš™é”çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé”çš„éƒ¨åˆ†ã€‚</p><p>å…¶å®è¯»æäº¤éš”ç¦»çº§åˆ«åœ¨å¤–é”®åœºæ™¯ä¸‹è¿˜æ˜¯æœ‰é—´éš™é”ï¼Œç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬ä»Šå¤©å…ˆä¸å±•å¼€ã€‚</p><p>å¦å¤–ï¼Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼Œå³ï¼šè¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­åŠ ä¸Šçš„è¡Œé”ï¼Œåœ¨è¯­å¥æ‰§è¡Œå®Œæˆåï¼Œå°±è¦æŠŠâ€œä¸æ»¡è¶³æ¡ä»¶çš„è¡Œâ€ä¸Šçš„è¡Œé”ç›´æ¥é‡Šæ”¾äº†ï¼Œä¸éœ€è¦ç­‰åˆ°äº‹åŠ¡æäº¤ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œé”çš„èŒƒå›´æ›´å°ï¼Œé”çš„æ—¶é—´æ›´çŸ­ï¼Œè¿™ä¹Ÿæ˜¯ä¸å°‘ä¸šåŠ¡éƒ½é»˜è®¤ä½¿ç”¨è¯»æäº¤éš”ç¦»çº§åˆ«çš„åŸå› ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘å¸Œæœ›ä½ å­¦è¿‡ä»Šå¤©çš„è¯¾ç¨‹ä»¥åï¼Œå¯ä»¥å¯¹next-key lockçš„æ¦‚å¿µæœ‰æ›´æ¸…æ™°çš„è®¤è¯†ï¼Œå¹¶ä¸”ä¼šç”¨åŠ é”è§„åˆ™å»åˆ¤æ–­è¯­å¥çš„åŠ é”èŒƒå›´ã€‚</p><p>åœ¨ä¸šåŠ¡éœ€è¦ä½¿ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ›´ç»†è‡´åœ°è®¾è®¡æ“ä½œæ•°æ®åº“çš„è¯­å¥ï¼Œè§£å†³å¹»è¯»é—®é¢˜çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°æå‡ç³»ç»Ÿå¹¶è¡Œå¤„ç†äº‹åŠ¡çš„èƒ½åŠ›ã€‚</p><p>ç»è¿‡è¿™ç¯‡æ–‡ç« çš„ä»‹ç»ï¼Œä½ å†çœ‹ä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« æœ€åçš„æ€è€ƒé¢˜ï¼Œå†æ¥å°è¯•åˆ†æä¸€æ¬¡ã€‚</p><p>æˆ‘æŠŠé¢˜ç›®é‡æ–°æè¿°å’Œç®€åŒ–ä¸€ä¸‹ï¼šè¿˜æ˜¯æˆ‘ä»¬åœ¨æ–‡ç« å¼€å¤´åˆå§‹åŒ–çš„è¡¨tï¼Œé‡Œé¢æœ‰6æ¡è®°å½•ï¼Œå›¾12çš„è¯­å¥åºåˆ—ä¸­ï¼Œä¸ºä»€ä¹ˆsession Bçš„insertæ“ä½œï¼Œä¼šè¢«é”ä½å‘¢ï¼Ÿ<br>
<img src="https://static001.geekbang.org/resource/image/3a/1e/3a7578e104612a188a2d574eaa3bd81e.png" alt=""></p><center><span class="reference">å›¾12 é”åˆ†ææ€è€ƒé¢˜</span></center><p>å¦å¤–ï¼Œå¦‚æœä½ æœ‰å…´è¶£å¤šåšä¸€äº›å®éªŒçš„è¯ï¼Œå¯ä»¥è®¾è®¡å¥½è¯­å¥åºåˆ—ï¼Œåœ¨æ‰§è¡Œä¹‹å‰å…ˆè‡ªå·±åˆ†æä¸€ä¸‹ï¼Œç„¶åå®é™…åœ°éªŒè¯ç»“æœæ˜¯å¦è·Ÿä½ çš„åˆ†æä¸€è‡´ã€‚</p><p>å¯¹äºé‚£äº›ä½ è‡ªå·±æ— æ³•è§£é‡Šçš„ç»“æœï¼Œå¯ä»¥å‘åˆ°è¯„è®ºåŒºé‡Œï¼Œåé¢æˆ‘äº‰å–æŒ‘ä¸€äº›æœ‰è¶£çš„æ¡ˆä¾‹åœ¨æ–‡ç« ä¸­åˆ†æã€‚</p><p>ä½ å¯ä»¥æŠŠä½ å…³äºæ€è€ƒé¢˜çš„åˆ†æå†™åœ¨ç•™è¨€åŒºï¼Œä¹Ÿå¯ä»¥åˆ†äº«ä½ è‡ªå·±è®¾è®¡çš„é”éªŒè¯æ–¹æ¡ˆï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾é€‰å–æœ‰è¶£çš„è¯„è®ºè·Ÿå¤§å®¶åˆ†äº«ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h2>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h2><p>ä¸ŠæœŸçš„é—®é¢˜ï¼Œæˆ‘åœ¨æœ¬æœŸç»§ç»­ä½œä¸ºäº†è¯¾åæ€è€ƒé¢˜ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸‹ç¯‡æ–‡ç« å†ä¸€èµ·å…¬å¸ƒâ€œç­”æ¡ˆâ€ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å±•å¼€å›ç­”ä¸€ä¸‹è¯„è®ºåŒºå‡ ä½åŒå­¦çš„é—®é¢˜ã€‚</p><ul>
<li>@ä»¤ç‹å°‘ä¾  è¯´ï¼Œä»¥å‰ä¸€ç›´è®¤ä¸ºé—´éš™é”åªåœ¨äºŒçº§ç´¢å¼•ä¸Šæœ‰ã€‚ç°åœ¨ä½ çŸ¥é“äº†ï¼Œæœ‰é—´éš™çš„åœ°æ–¹å°±å¯èƒ½æœ‰é—´éš™é”ã€‚</li>
<li>@æµªé‡Œç™½æ¡ åŒå­¦é—®ï¼Œå¦‚æœæ˜¯varcharç±»å‹ï¼ŒåŠ é”è§„åˆ™æ˜¯ä»€ä¹ˆæ ·çš„ã€‚<br>
å›ç­”ï¼šå®é™…ä¸Šåœ¨åˆ¤æ–­é—´éš™çš„æ—¶å€™ï¼Œvarcharå’Œintæ˜¯ä¸€æ ·çš„ï¼Œæ’å¥½åºä»¥åï¼Œç›¸é‚»ä¸¤ä¸ªå€¼ä¹‹é—´å°±æœ‰é—´éš™ã€‚</li>
<li>æœ‰å‡ ä½åŒå­¦æåˆ°è¯´ï¼Œä¸Šä¸€ç¯‡æ–‡ç« è‡ªå·±éªŒè¯çš„ç»“æœè·Ÿæ¡ˆä¾‹ä¸€ä¸åŒï¼Œå°±æ˜¯åœ¨session Aæ‰§è¡Œå®Œè¿™ä¸¤ä¸ªè¯­å¥ï¼š</li>
</ul><pre><code>begin;
select * from t where d=5 for update; /*Q1*/
</code></pre><p>ä»¥åï¼Œsession B çš„update å’Œsession Cçš„insert éƒ½ä¼šè¢«å µä½ã€‚è¿™æ˜¯ä¸æ˜¯è·Ÿæ–‡ç« çš„ç»“è®ºçŸ›ç›¾ï¼Ÿ</p><p>å…¶å®ä¸æ˜¯çš„ï¼Œè¿™ä¸ªä¾‹å­ç”¨çš„æ˜¯åè¯å‡è®¾ï¼Œå°±æ˜¯å‡è®¾ä¸å µä½ï¼Œä¼šå‡ºç°é—®é¢˜ï¼›ç„¶åï¼Œæ¨å¯¼å‡ºsession Aéœ€è¦é”æ•´ä¸ªè¡¨æ‰€æœ‰çš„è¡Œå’Œæ‰€æœ‰é—´éš™ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@ æŸã€äºº ã€@éƒ­æ±Ÿä¼Ÿ ä¸¤ä½åŒå­¦å°è¯•åˆ†æäº†ä¸ŠæœŸé—®é¢˜ï¼Œå¹¶ç»™äº†æœ‰å¯å‘æ€§çš„è§£ç­”ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å •è½å¤©ä½¿</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæ‚¨å¥½ã€‚å‡æœŸçš„æ²¡è·Ÿä¸Šï¼Œä»Šå¤©è¡¥åˆ°äº†è¿™èŠ‚è¯¾ï¼Œçœ‹äº†ä¹‹åæœ‰å‡ ç‚¹ä¸æ˜¯å¤ªæ˜ç™½ã€‚æœ›èƒ½è§£ç­”ä¸€ä¸‹ã€‚<br>1. ç´¢å¼•cä¸Šçš„é”ç®—ä¸ç®—æ˜¯è¡Œé”ã€‚å‡å¦‚ç´¢å¼•cä¸Šçš„next-key lockä¸º(0,5] (5,10]ï¼Œé‚£ä¹ˆ5ç®—ä¸ç®—æ˜¯cä¸Šçš„è¡Œé”ï¼Ÿ<br>2. åœ¨æ¡ˆä¾‹å…­ä¸­ï¼Œæ‰§è¡Œ â€œdelete from t where c=10;â€ è¯­å¥ï¼Œç´¢å¼•cä¸Šçš„next-key lockæ˜¯(5,10],(10,10],(10,15)ã€‚é‚£ä¹ˆä¸»é”®ç´¢å¼•ä¸Šçš„é”æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯åªæœ‰è¡Œé”ï¼Œé”ä½çš„æ˜¯ (10,10,10) å’Œ (30,10,30) ä¸¤è¡Œå—ï¼Ÿ<br>3. ä¹Ÿæ˜¯åœ¨æ¡ˆä¾‹å…­ä¸­ï¼Œsession Aä¸å˜ï¼Œåœ¨session Bä¸­æ‰§è¡Œ â€œupdate t_20 set d=50 where c=5;â€ã€â€œupdate t_20 set d=50 where c=15;â€ã€â€œinsert into t_20 values(40,15,40);â€å‡æ‰§è¡ŒæˆåŠŸï¼Œä½†æ‰§è¡Œâ€œinsert into t_20 values(50,5,50);â€ æ—¶ï¼Œå´è¢«é˜»å¡ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…·ä½“æ‰§è¡Œè¯­å¥å¦‚ä¸‹<br>session A<br>mysql&gt; begin;<br>mysql&gt; explain delete from t_20 where c=10;<br>id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra<br>1	DELETE	t_20		range	c	c	5	const	2	100	Using where<br>mysql&gt; delete from t_20 where c=10;<br><br>session B<br>mysql&gt; update t_20 set d=50 where c=5;<br>Query OK, 1 row affected (0.01 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; update t_20 set d=50 where c=15;<br>Query OK, 1 row affected (0.00 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; insert into t_20 values(40,15,40);<br>Query OK, 1 row affected (0.00 sec)<br><br>mysql&gt; explain insert into t_20 values(50,5,50);<br>+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+<br>| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |<br>+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+<br>|  1 | INSERT      | t_20  | NULL       | ALL  | c             | NULL | NULL    | NULL | NULL |     NULL | NULL  |<br>+----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; insert into t_20 values(50,5,50);<br>ï¼ˆblockï¼‰<br><br>æˆ‘ä½¿ç”¨çš„mysqlç‰ˆæœ¬æ˜¯ï¼š5.7.23-0ubuntu0.16.04.1<br>show variablesçš„ç»“æœå¤ªå¤šï¼Œæˆ‘æˆªå–äº†ä¸€éƒ¨åˆ†ï¼Œæˆ–è®¸å¯¹æ‚¨åˆ†ææœ‰å¸®åŠ©ï¼š<br>innodb_version	5.7.23<br>protocol_version	10<br>slave_type_conversions	<br>tls_version	TLSv1,TLSv1.1<br>version	5.7.23-0ubuntu0.16.04.1<br>version_comment	(Ubuntu)<br>version_compile_machine	x86_64<br>version_compile_os	Linux <br></div>
                            <span class="time">2019-01-03 18:40</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. Next-key lock å°±æ˜¯é—´éš™é”â•è¡Œé”ï¼Œæ‰€ä»¥åŒ…å«=5è¿™ä¸€è¡Œ<br>2. å¯¹<br>3. (c=5,id=50)æ˜¯åœ¨è¿™ä¸ªgapé‡Œå“¦ï¼Œä½ è¯•è¯•æ’å…¥(1,5,50)å¯¹æ¯”ä¸€ä¸‹ã€‚å¥½é—®é¢˜</p>
                                <p class="reply-time">2019-01-03 22:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/52/3c/0c71ad7e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¼ ä¸‰</span>
                            </div>
                            <div class="bd">Happy New Year !è¿™ä¸ªä¸“æ ç»å¯¹æ˜¯æå®¢æ—¶é—´æœ€å¥½æˆ‘ä¹°è¿‡æœ€å€¼çš„ä¸“æ ã€‚ <br></div>
                            <span class="time">2018-12-31 15:53</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çº¦ä¹¦äºš</span>
                            </div>
                            <div class="bd">æ—©æ™¨ç¡ä¸ç€æ‰“å¼€æå®¢æ—¶é—´ä¸€çœ‹ï¼Œç«Ÿç„¶æ›´æ–°äº†ã€‚ä»Šå¤©æ˜¯å‘¨æ—¥è€Œä¸”åœ¨å‡æœŸä¸­å“... <br></div>
                            <span class="time">2018-12-31 06:32</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é£é›¨æ— é˜» èŠ‚å‡æ—¥ä¸ä¼‘ï¼ŒåŒ…æ‹¬å…ƒæ—¦å’Œæ˜¥èŠ‚ğŸ˜„</p>
                                <p class="reply-time">2018-12-31 08:48</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">éƒ­æ±Ÿä¼Ÿ</span>
                            </div>
                            <div class="bd">è€å¸ˆè¿™æ¬¡çš„ç•™ä¸‹çš„é—®é¢˜ï¼Œè¯­å¥è·Ÿä¸Šæ¬¡ä¸ä¸€æ ·ï¼Œä¸ŠæœŸé—®é¢˜è¯­å¥æ˜¯select id  from t where c&gt;=15 and c&lt;=20 order by c desc  for update;ï¼›è¿™æ¬¡ç¼ºå°‘äº† order by c desc ï¼Œä¸åŠ descçš„è¯insert into t values(6,6,6);ä¸ä¼šè¢«å µå¡ï¼›<br>æ ¹æ®ä¼˜åŒ–3ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œåœ¨å‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™next-key locké€€åŒ–ä¸ºé—´éš™é”ï¼›<br>é—®é¢˜ä¸­çš„sqlè¯­å¥åŠ äº†desc ï¼Œæ˜¯å‘å·¦æ‰«æï¼Œè¯¥ä¼˜åŒ–ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥ä¸‹é™10æ˜¯é—­åŒºé—´ï¼Œä¸ºäº†é˜²æ­¢cä¸º10çš„è¡ŒåŠ å…¥ï¼Œéœ€è¦é”å®šåˆ°ç´¢å¼•cé”®ï¼ˆ5,5ï¼‰<br>æ­¤ä¾‹ä¸­insert into t values(6,5,6) ä¼šå µå¡ï¼Œinsert into t values(4,5,6) ä¸ä¼šå µå¡ï¼Œ <br></div>
                            <span class="time">2018-12-31 14:11</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å—¯ä½ è¯´çš„å¯¹<br><br>ä¸è¿‡æ˜¯æˆ‘å°‘æ‰“ä¸€ä¸ªè¯äº†ï¼ŒåŠ ä¸Šå»äº†ï¼Œè¦descå“¦<br><br>é‡æ–°åˆ†æä¸‹ğŸ˜„</p>
                                <p class="reply-time">2018-12-31 16:14</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/40/59/f93698ec.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¹¾å¤</span>
                            </div>
                            <div class="bd">æ‚¨å¥½ï¼Œå…³äº&quot;ä¼˜åŒ– 2ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„æ—¶å€™ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚&quot;ï¼Œæˆ‘è§‰å¾—æ”¹ä¸º&quot;ä»ç¬¬ä¸€ä¸ªæ»¡è¶³ç­‰å€¼æ¡ä»¶çš„ç´¢å¼•è®°å½•å¼€å§‹å‘å³éå†åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶è®°å½•ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶è®°å½•ä¸Šçš„next-key lock é€€åŒ–ä¸ºé—´éš™é”&quot;æ›´æ˜ç¡®äº› <br></div>
                            <span class="time">2019-01-01 22:11</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ„Ÿè§‰æ²¡å¤§å·®åˆ«ï¼Œå—¯å—¯ï¼Œç†è§£å°±å¥½ğŸ˜„</p>
                                <p class="reply-time">2019-01-02 00:52</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">HuaMax</span>
                            </div>
                            <div class="bd">é¦–å…ˆè€å¸ˆæ–°å¹´å¿«ä¹ï¼Œå­¦ä¹ ä¸“æ å—ç›Šè‰¯å¤šï¼<br>ä¸ŠæœŸé—®è¿‡è€å¸ˆçš„é—®é¢˜å·²äº†è§£ç­”æ¡ˆï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ã€‚å†å°è¯•å›ç­”é—®é¢˜ã€‚cä¸Šæ˜¯æ™®é€šç´¢å¼•ï¼Œæ ¹æ®åŸåˆ™2ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œåœ¨æŸ¥è¯¢c&gt;=15è¿™ä¸ªæ¡ä»¶æ—¶ï¼Œåœ¨æŸ¥æ‰¾åˆ°15ååŠ é”ï¼ˆ10ï¼Œ15ï¼½ï¼Œç»§ç»­å¾€å³æŸ¥æ‰¾ï¼ŒæŒ‰ç†è¯´ä¸ä¼šé”ä½6è¿™ä¸ªç´¢å¼•å€¼ï¼Œä½†æŸ¥è¯¢è¯­å¥ä¸­åŠ äº†order by c descï¼Œæˆ‘çŒœæƒ³ä¼šä¼˜åŒ–ä¸ºä½¿ç”¨c&lt;=20è¿™æ¡è¯­å¥ï¼ŒæŸ¥æ‰¾åˆ°20åå¾€å·¦æŸ¥æ‰¾ï¼Œè¿™æ ·ä¼šè®¿é—®åˆ°15å·¦è¾¹çš„å€¼10ï¼Œä»è€ŒåŠ é”ï¼ˆ5ï¼Œ10ï¼½ï¼Œä¸çŸ¥æˆ‘ç†è§£å¯¹å¦ï¼Ÿ <br></div>
                            <span class="time">2019-01-01 10:20</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ–°å¹´å¥½<br><br>å¯¹çš„ğŸ‘ğŸ¿</p>
                                <p class="reply-time">2019-01-01 12:04</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Geek_9ca34e</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œä½ å¥½ï¼š<br>æˆ‘ç»ƒä¹ å®ä¾‹çš„æ—¶å€™å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´é” bug<br>begin;<br>select * from t where id&gt;10 and id&lt;=15 for update;<br>1ã€æ‰§è¡Œå¦‚ä¸Šè¯­å¥åŠ é”èŒƒå›´(10,15]å’Œ(15,20]ï¼›<br>2ã€å› ä¸º10æœªåŠ é”ï¼Œæ‰€ä»¥æˆ‘å•ç‹¬å†å¼€ä¸€ä¸ªè¿æ¥ï¼Œæ‰§è¡Œdelete from t where id=10;ä¸ä¼šé”ç­‰å¾…ï¼Œèƒ½æ­£å¸¸åˆ é™¤ï¼›<br>3ã€ä½†æ˜¯æˆ‘å†æ‰§è¡Œinsert into t values(10,10,10); è¯­å¥ä¼šç­‰å¾…ï¼Œæ— æ³•æ­£å¸¸æ‰§è¡Œï¼›<br>4ã€ç»è¿‡åˆ†ææˆ‘å‘ç°ç¬¬ä¸€ä¸ªè¿æ¥æ‰§è¡Œçš„è¯­å¥çš„åŠ é”èŒƒå›´å·²ç»å˜æˆ(5,15]å’Œ(15,20]ï¼Œä»£è¡¨é”è”“å»¶äº†ï¼›è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-09 16:34</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œæˆ‘ä¼šåŠ åˆ°ç­”ç–‘æ–‡ç« ä¸­ï¼Œ<br>Gapæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µ</p>
                                <p class="reply-time">2019-01-09 22:24</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶</span>
                            </div>
                            <div class="bd">session A<br>mysql&gt; select * from t where c&gt;=15 and c&lt;=20 order by c desc lock in share mode;<br>+----+------+------+<br>| id | c    | d    |<br>+----+------+------+<br>| 20 |   20 |   20 |<br>| 15 |   15 |   15 |<br>+----+------+------+<br>2 rows in set (0.00 sec)<br><br>session b<br>mysql&gt; insert into t values(6,6,6);<br>Query OK, 1 row affected (0.00 sec)<br>å¯ä»¥æ’å…¥æˆåŠŸï¼Œæ²¡æœ‰è¢«é”ä½ <br></div>
                            <span class="time">2019-01-01 21:34</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">Explainç»“æœå‘ä¸€ä¸‹ï¼Œè¿˜æœ‰show variables ç»“æœä¹Ÿå‘ä¸‹</p>
                                <p class="reply-time">2019-01-02 00:48</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶</span>
                            </div>
                            <div class="bd">è¿™å’Œåˆ†ä¸¤æ­¥æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ<br>(5,10]å·²ç»æ˜¯è¢«é”ä½ï¼Œåˆ†ä¸åˆ†ä¸¤æ­¥æ¥åŠ é”ï¼Œè¿™ä¸ªé—´éš™å’Œè¡Œé”éƒ½è¢«é”ä½äº†ï¼Œsession båº”è¯¥æ˜¯æ‹¿ä¸åˆ°é”æ‰å¯¹ã€‚ <br></div>
                            <span class="time">2019-01-01 21:24</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e8/5c/561caff2.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é™ˆ</span>
                            </div>
                            <div class="bd">è€å¸ˆåœ¨æ¡ˆåˆ—ä¸€ä¸­update t set d=d+1 where id=7 ä¸­idæ˜¯ä¸»é”®ä¹Ÿæ˜¯å”¯ä¸€ç´¢å¼•ï¼ŒæŒ‰ä¼˜åŒ–1åº”è¯¥é€€åŒ–æˆè¡Œé”æ‰å¯¹ï¼Œä¸ºä»€ä¹ˆinsert into t values(8,8,8)ä¼šè¢«é”ä½ï¼Œæˆ‘æ˜¯é‚£å„¿ç†è§£é”™äº†? <br></div>
                            <span class="time">2019-01-11 18:07</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™ä¸€è¡Œå­˜åœ¨çš„æ—¶å€™æ˜¯è¡Œé”ï¼Œè¿™ä¸€è¡Œä¸å­˜åœ¨ï¼Œé‚£å°±æ˜¯é—´éš™é”å•¦ã€‚<br><br>insert into t values(8,8,8)æ˜¯è¢«ä¸»é”®ä¸Š(5,10)çš„é—´éš™é”é”ä½çš„</p>
                                <p class="reply-time">2019-01-11 19:15</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/09/98/b11c372b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é¸ ç¿±</span>
                            </div>
                            <div class="bd">è€å¸ˆæˆ‘ä»Šå¤©åœ¨å›é¡¾çš„æ—¶å€™åˆæƒ³åˆ°ä¸€ä¸ªæ–°é—®é¢˜ï¼Œä¸ºä»€ä¹ˆRRçº§åˆ«ä¸‹è¦ä»¥next-key lockä½œä¸ºåŠ é”çš„åŸºæœ¬å•ä½å‘¢ï¼Ÿ<br>æ¯”å¦‚è¯´æ¡ˆä¾‹5ä¸­çš„é‚£ä¸ªä¾‹å­ï¼Œæˆ‘å°†å…¶ä¿®æ”¹æˆselect * from t where id &gt; 10 and id &lt; 15 for upadateï¼ŒæŒ‰ç…§åŠ é”è§„åˆ™ï¼Œéœ€è¦å¯¹(10,15]ä¸Šé”ï¼Œé‚£ä¹ˆæŒ‰ç…§é€»è¾‘æ¥çœ‹ï¼Œ15çš„é‚£ä¸ªè¡Œé”å…¶å®æ²¡å¿…è¦çš„ï¼ˆéš¾é“æ˜¯æœ‰å¿…è¦çš„å˜›ï¼Ÿï¼‰ï¼Œæ—¢ç„¶next-key lockæœ¬è´¨ä¹Ÿæ˜¯å…ˆåŠ é—´éš™é”å†åŠ è¡Œé”ï¼Œä¸ºä»€ä¹ˆéè¦æŠŠé‚£ä¸ªè¡Œé”ä¹ŸåŠ ä¸Šï¼Œå°±æ˜¯å› ä¸ºnext-key lockæ˜¯åŠ é”åŸºæœ¬å•ä½å˜›ï¼Ÿ <br></div>
                            <span class="time">2019-01-10 10:55</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä»£ç å®ç°ä¸Šæ˜¯è¿™æ ·å­çš„ã€‚ã€‚</p>
                                <p class="reply-time">2019-01-11 01:14</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/45/9e/57e18908.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¢ä¼Ÿ</span>
                            </div>
                            <div class="bd">æ„Ÿè°¢è€å¸ˆï¼Œç”¨è¿™äº›çŸ¥è¯†æˆåŠŸçš„æ‰¾åˆ°äº†æœ€è¿‘å‡ºç°çš„æ­»é” <br></div>
                            <span class="time">2019-01-10 00:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿ è¿™ç§æ„Ÿè§‰æœ€æ£’</p>
                                <p class="reply-time">2019-01-10 09:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">neptunesong</span>
                            </div>
                            <div class="bd">ä¹‹å‰é—®è¿‡æ‚¨è¿™ç¯‡æ–‡ç« http:&#47;&#47;hedengcheng.com&#47;?p=771ä¸­å…³äº&quot;ä¸€ä¸ªå¤æ‚çš„sql&quot;ä¾‹å­ï¼Œä¸çŸ¥æ‚¨æ˜¯å¦è¿˜è®°å¾—ã€‚æˆ‘æŒ‰ç…§æ‚¨è¯´çš„è¿›è¡Œpubtime=20è¿›è¡Œæµ‹è¯•ï¼Œæ²¡æœ‰å‘ç°è¢«lockä½ï¼Œè¯´æ˜é’ˆå¯¹pubtime&lt;20åŠ çš„æ˜¯gapé”ï¼Œä¸æ˜¯next keyé”ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬æ¡ˆä¾‹4ä¸­åœºæ™¯ä¸€æ ·ï¼Œä½†ç»“æœä¸ä¸€æ ·ã€‚ä¸ç¡®å®šæ˜¯å“ªé‡Œæƒ³é”™äº†ã€‚æ±‚è§£æƒ‘ï¼š) <br></div>
                            <span class="time">2019-01-08 15:46</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æˆ‘æ˜¯è¿™ä¹ˆéªŒè¯çš„ï¼Œ <br>session A:<br>begin;<br>delete from t1 where pubtime&gt;1 and pubtime&lt;20 and userid=&#39;hdc&#39; and comment is not null;<br><br>sessionB:<br>update t1 set  comment=&#39;a&#39; where  pubtime=20 and userid=&#39;bbb&#39;;<br>(blocked)<br><br>ä½ çš„éªŒè¯æ–¹æ³•è´´ä¸€ä¸‹<br><br></p>
                                <p class="reply-time">2019-01-10 19:14</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJibUzUHAI2Fe5aq2JZ1UiceYv54icGMt9uQsbViadOibPllsQOyoRcto4TXicNbVvUZYfAhrbicVb6GlSWw/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ç† è¾°</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œä½ å¥½ï¼Œéº»çƒ¦é—®ä¸‹å¯¹äºè§„åˆ™å½“ä¸­ï¼Œä¼˜åŒ–1ä¸­é’ˆå¯¹çš„å”¯ä¸€ç´¢å¼•åŠ é”ï¼Œè¿™å—ï¼Œå¯¹äºä¸»é”®ç´¢å¼•æ˜¯å¦ä¹Ÿå¯ä»¥ç†è§£ä¸ºå”¯ä¸€ç´¢å¼•çš„åŠ é”è§„åˆ™ï¼Œå¯¹äºæ¡ˆä¾‹2æœ€åselect idæ›´æ”¹ä¸ºselect dæµ‹è¯•ï¼Œupdateä¼šè¢«é˜»å¡ï¼Œå¦‚æœæŒ‰ç…§ä¼˜åŒ–1çš„è§„åˆ™çœ‹çš„è¯ï¼Œæ˜¯å› ä¸ºå­˜åœ¨çš„è¡Œé”å¯¼è‡´çš„é˜»å¡ï¼Œä¸çŸ¥é“æ˜¯å¦ç†è§£çš„æ­£ç¡®ï¼Œå¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ï¼ï¼ï¼ <br></div>
                            <span class="time">2019-01-08 11:30</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¯¹ï¼Œä¸»é”®ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•çš„ä¸€ç§ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªè§„åˆ™é‡Œé¢æ˜¯ä¸€æ ·çš„</p>
                                <p class="reply-time">2019-01-10 19:04</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">undifined</span>
                            </div>
                            <div class="bd">é‡åˆ°ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œåœ¨è€å¸ˆçš„è§£ç­”ä¸‹ç»ˆäºå¼„æ˜ç™½äº†ï¼š<br><br>CREATE TABLE z (<br>  id INT PRIMARY KEY AUTO_INCREMENT,<br>  b  INT,<br>  KEY b(b)<br>)<br>  ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8;<br><br>INSERT INTO z (id, b)<br>VALUES (1, 2),<br>  (3, 4),<br>  (5, 6),<br>  (7, 8),<br>  (9, 10);<br><br>session A<br><br>BEGIN;<br>SELECT *<br>FROM z<br>WHERE b = 6 FOR UPDATE;<br><br>session B <br>INSERT INTO z VALUES (0, 4);<br>è¿™é‡Œä¸ºä»€ä¹ˆä¼šè¢«é”ä½<br><br>ç­”æ¡ˆæ¯”è¾ƒé•¿ï¼Œå†™åœ¨æˆ‘è‡ªå·±çš„ç¬”è®°é‡Œäº†ï¼Œåœ°å€æ˜¯ https:&#47;&#47;helloworlde.github.io&#47;blog&#47;blog&#47;MySQL&#47;MySQL-%E4%B8%AD%E5%85%B3%E4%BA%8Egap-lock-next-key-lock-%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98.html<br><br>å¤§å®¶å¯ä»¥çœ‹çœ‹ <br></div>
                            <span class="time">2019-01-07 22:11</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œè´¨é‡å¾ˆé«˜çš„ç¬”è®°</p>
                                <p class="reply-time">2019-01-10 18:53</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¿¡ä¿¡</span>
                            </div>
                            <div class="bd">æ¥ä¸Šä¸€ä¸ªæé—®ï¼Œè€å¸ˆå›ç­”ï¼šç¬¬äºŒä¸ªè¯­å¥æŠŠç¬¬ä¸€ä¸ªgapå˜æˆ(1,10]äº†ã€‚<br>å¯¹æ­¤éå¸¸æƒŠè®¶ï¼Œç›¸å½“äºå½“å‰çº¿ç¨‹çš„é”çš„èŒƒå›´å¯ä»¥è¢«åŠ¨å—åˆ«çš„çº¿ç¨‹å½±å“ï¼Œæ„Ÿè§‰æ‰“å¼€äº†æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>å¦å¤–è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæ‰§è¡Œ explain select c from t where c!=1;<br>å‘ç°possible_keyså’Œkeyéƒ½æ˜¯c,ä½†å…¶å®çœ‹ç€å¹¶æ²¡æœ‰ç”¨åˆ°æ ‘æœç´¢åŠŸèƒ½ï¼Œåªæ˜¯éå†äº†ç´¢å¼•ã€‚<br>ç½‘ä¸ŠåŸºæœ¬éƒ½è¯´!=ç”¨ä¸äº†ç´¢å¼•ï¼Œæ‰€ä»¥è¿™ç§è¯´æ³•æ˜¯ä¸ä¸¥è°¨çš„ï¼Ÿ <br></div>
                            <span class="time">2019-01-07 17:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„ï¼Œä¸ä¸¥è°¨<br><br>ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨åˆ°ç´¢å¼•çš„å¿«é€Ÿå®šä½èƒ½åŠ›</p>
                                <p class="reply-time">2019-01-07 17:50</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¿¡ä¿¡</span>
                            </div>
                            <div class="bd">è€å¸ˆæ‚¨å¥½ï¼Œè‡ªå·±åŸºäºæ–‡ä¸­å¼€å¤´çš„è¡¨åšäº†ä¸€ä¸ªå®éªŒï¼Œ<br>session1ï¼š<br>mysql&gt; begin;<br>mysql&gt; explain select c from t where c &gt;5 lock in share mode;<br>åˆ†æï¼š(5,10],(10,15],(15,20],(20,25],(25,æ­£æ— ç©·)æœ‰é”ã€‚<br>session2:<br>mysql&gt; update t set c = 5 where c = 1;#(æ‰§è¡ŒæˆåŠŸ)<br>mysql&gt; update t set c = 1 where c = 5;#(æ‰§è¡ŒæˆåŠŸ)<br>mysql&gt; update t set c = 5 where c = 1;#(é˜»å¡)<br>æœ€åä¸€æ¡é˜»å¡ï¼Œæ— æ³•ç”¨åŸç†åˆ†æï¼Œè‚¯è¯·è€å¸ˆè§£ç­”ã€‚ <br></div>
                            <span class="time">2019-01-07 12:13</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç¬¬äºŒä¸ªè¯­å¥æŠŠç¬¬ä¸€ä¸ªgapå˜æˆ(1,10]äº†<br><br>ç¬¬ä¸‰ä¸ªupdateçš„é€»è¾‘é‡Œé¢ï¼ŒåŒ…å«äº†â€œè¦æ’å…¥ä¸€ä¸ªc=5çš„è¡Œâ€<br><br>å¥½é—®é¢˜</p>
                                <p class="reply-time">2019-01-07 15:01</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¿›é˜¶çš„ç å†œ</span>
                            </div>
                            <div class="bd">--<br>LATEST DETECTED DEADLOCK<br>--<br>2018-12-18 21:03:25 0x7f33248e0700<br>*** (1) TRANSACTION:<br>TRANSACTION 404074133, ACTIVE 1 sec starting index read<br>mysql tables in use 1, locked 1<br>LOCK WAIT 3 lock struct(s), heap size 1136, 2 row lock(s)<br>MySQL thread id 176, OS thread handle 139857630418688, query id 36851897 127.0.0.1 user001 Sending data<br>select<br>        bikeId, lat, lng, update_time, state, accuracy<br>        from mbk_location_rawdata<br>        where state = 0<br>         and update_time&lt;&#39;2018-12-18 20:57:25&#39; <br>        LIMIT 500<br>        for update&#47;*user001*&#47;<br>*** (1) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 29488 page no 269 n bits 344 index PRIMARY of table `mbk_bike`.`mbk_location_rawdata` trx id 404074133 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 23 PHYSICAL RECORD: n_fields 9; compact format; info bits 32<br>*** (2) TRANSACTION:<br>TRANSACTION 404074140, ACTIVE 0 sec updating or deleting<br>mysql tables in use 1, locked 1<br>4 lock struct(s), heap size 1136, 3 row lock(s), undo log entries 1<br>MySQL thread id 165, OS thread handle 139857633347328, query id 36851918 127.0.0.1 user001 updating<br>delete from mbk_location_rawdata<br>        where bikeId = &#39;aMho6x8BtC&#39;&#47;*user001*&#47;<br>*** (2) HOLDS THE LOCK(S):<br>RECORD LOCKS space id 29488 page no 269 n bits 344 index PRIMARY of table `mbk_bike`.`mbk_location_rawdata` trx id 404074140 lock_mode X locks rec but not gap<br>Record lock, heap no 23 PHYSICAL RECORD: n_fields 9; compact format; info bits 32<br> *** (2) WAITING FOR THIS LOCK TO BE GRANTED:<br>RECORD LOCKS space id 29488 page no 201 n bits 1000 index idx_time of table `mbk_bike`.`mbk_location_rawdata` trx id 404074140 lock_mode X locks rec but not gap waiting<br>Record lock, heap no 105 PHYSICAL RECORD: n_fields 2; compact format; info bits 0<br>*** WE ROLL BACK TRANSACTION (1)<br>------------<br>TRANSACTIONS<br>é—®é¢˜ï¼š<br>1.å‘ç”Ÿæ­»é”çš„åŸå› ï¼Ÿ<br>2.æ­»é”æ—¥å¿—transaction2é‡Œdeleteè¯­å¥çš„æ¡ä»¶æ˜¯bikeIdï¼Œå°±ç®—è·å–é”ä¹Ÿæ˜¯è·å–bikeIdçš„ç´¢å¼•ï¼Œä¸ºä»€ä¹ˆæ­»é”æ—¥å¿—é‡Œé¡¹[WAITING FOR THIS LOCK TO BE GRANTED] æ˜¯indx_time,è¿™æ˜¯æˆ‘æœ€ç–‘æƒ‘çš„åœ°æ–¹<br>å¸Œæœ›è€å¸ˆæ‹¯æ•‘æˆ‘ï¼Œä¸€ç›´æ²¡æƒ³é€šï¼Œç½‘ä¸Šä¹Ÿæ²¡æœ‰æœåˆ°ç±»ä¼¼çš„é—®é¢˜ <br></div>
                            <span class="time">2019-01-05 19:27</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™ä¸ªå°±æ˜¯å…¸å‹çš„lock ... for updateä¼šå‡ºç°çš„é—®é¢˜ã€‚è¿™ä¸¤ä¸ªäº‹åŠ¡çš„åŠ é”é¡ºåºæ²¡æœ‰ä¿æŒä¸€è‡´ã€‚<br><br>å…ˆå›ç­”ä½ ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸€ä¸ªdeleteè¯­å¥ï¼Œå¯ä¸åªæ˜¯ä¼šé”bikeid è¿™ä¸ªç´¢å¼•å“¦ï¼Œå‡è®¾è¦åˆ é™¤çš„è¡Œçš„æ—¶é—´å­—æ®µå€¼æ˜¯Tï¼Œä¹Ÿä¼šå»idx_timeçš„Tä¸ŠåŠ è¡Œé”çš„ã€‚<br><br>å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç§æ–¹æ³•æ˜¯æ”¹å˜é”é¡ºåºã€‚åªè€ƒè™‘è¿™ä¸¤ä¸ªè¯­å¥çš„è¯ï¼Œtransaction 2æŸ¥å‡ºbikeidå¯¹åº”çš„Tå€¼ï¼Œå…ˆå»æ‰§è¡Œä¸€ä¸ªwhere update_time=T for update.<br><br>ä¸è¿‡ä¸€èˆ¬å¦‚æœæ­»é”ä¸ä¸¥é‡ï¼Œé—®é¢˜ä¸å¤§ï¼Œé‡è¯•äº‹åŠ¡å°±å¯ä»¥äº†ã€‚<br><br></p>
                                <p class="reply-time">2019-01-05 21:40</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¿›é˜¶çš„ç å†œ</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½é—®ä¸€ä¸ªæœ€è¿‘é¡¹ç›®ä¸­é‡åˆ°çš„æ­»é”ï¼Œå›°æ‰°äº†æˆ‘å¥½ä¹…ï¼Œä¸€ç›´ä¸çŸ¥é“åŸå› ï¼Œä¸‹é¢ç»™å‡ºéš”ç¦»çº§åˆ«ã€è¡¨ç»“æ„ã€ä¸šåŠ¡é€»è¾‘ã€æ­»é”log<br>1.éš”ç¦»çº§åˆ« <br>rc<br>2.è¡¨ç»“æ„<br>CREATE TABLE `mbk_location_rawdata` (<br>  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ä¸»é”®ID&#39;,<br>  `bikeId` varchar(15) NOT NULL,<br>  `lat` decimal(11,8) NOT NULL DEFAULT &#39;0.00000000&#39; ,<br>  `lng` decimal(11,8) NOT NULL DEFAULT &#39;0.00000000&#39;,<br>  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP &#39;,<br>  `state` int(8) NOT NULL DEFAULT &#39;0&#39; ,<br>  `accuracy` smallint(6) NOT NULL DEFAULT &#39;0&#39; ,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uniq_bikeid` (`bikeId`),<br>  KEY `idx_time` (`update_time`) USING BTREE,<br>  KEY `idx_state` (`state`)<br>) ENGINE=InnoDB AUTO_INCREMENT=8897633 DEFAULT CHARSET=utf8 <br>3.ä¸šåŠ¡é€»è¾‘<br>@Transaction <br>processData(timeParam){<br>&#47;&#47;å¯¹åº”sql  select * from test_rawdata where state=0 and update_time&lt;timeParam for update limit 500;<br>bikeIds = findForUpdate();<br>&#47;&#47;å–å‡ºæ•°æ®ï¼Œç„¶åå…ˆçŠ¶æ€æ”¹æˆ2<br>&#47;&#47;å¯¹åº”sql update test_rawdata set state = 2 where bikeId in(bikeIds);<br>updateData(bikeIds);<br>}<br>@Transaction<br>deleteData(bikeIdParam){<br>&#47;&#47;sql     delete from mbk_location_rawdata<br>        where bikeId = bikeIdParam<br>}<br>ç•™è¨€å¤ªé•¿ï¼Œä¸‹è¾¹ä¸€æ¡è·Ÿç€æ­»é”æ—¥å¿— <br></div>
                            <span class="time">2019-01-05 19:27</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼š<br>åœ¨è¯»æäº¤æ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬åœºæ™¯æ˜¯æ²¡æœ‰é—´éš™é”çš„ï¼Œå› æ­¤å°†binlogè®¾ç½®ä¸ºrowæ ¼å¼ï¼Œå¯ä»¥è§£å†³binlogæ—¥å¿—é¡ºåºå’Œè¯­å¥å®é™…æ‰§è¡Œé¡ºåºä¸ä¸€è‡´çš„é—®é¢˜ï¼ˆå¹»è¯»é‚£ä¸€ç¯‡æåˆ°çš„é—®é¢˜ï¼Œå› ä¸ºrowæ ¼å¼æ˜¯ç›´æ¥è®°å½•æ•°æ®çš„ç»“æœæ”¹å˜ï¼‰<br>é‚£ä¹ˆï¼Œå¦‚æœä½¿ç”¨RRæ¨¡å¼ï¼ŒæŠŠé—´éš™é”å…³é—­ï¼Œå°†binlogè®¾ç½®ä¸ºrowæ ¼å¼ã€‚è¿™æ ·æ—¢å¯ä»¥å®ç°é‡å¤è¯»ï¼Œåˆå¯ä»¥å‡å°é”çš„ç²’åº¦ã€‚è™½ç„¶è¿™æ ·çš„è¯ï¼Œå¹»è¯»çš„æƒ…å†µæ— æ³•è§£å†³ï¼Œä½†æ˜¯å¹»è¯»ä¸€èˆ¬æ¥è¯´å½±å“å¹¶ä¸å¤§ã€‚<br>ç»¼ä¸Šï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰äººåœ¨RRæ¨¡å¼ä¸‹ï¼Œå…³é—­é—´éš™é”ï¼Œå¼€å¯rowæ ¼å¼çš„binlogå‘¢ï¼Ÿï¼Ÿ <br></div>
                            <span class="time">2019-01-05 11:28</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æˆ‘è§‰å¾—å¯èƒ½ä¸€æ–¹é¢æ˜¯å¾ˆå¤šäººå¹¶ä¸çŸ¥é“è¿™ä¸ªå‚æ•°ğŸ˜„<br><br>ä¸è¿‡å¹»è¯»å¦‚æœç¡®è®¤ä¸éœ€è¦ï¼Œä¸€èˆ¬è¡¨ç¤ºå¯é‡å¤è¯»ä¹Ÿä¸éœ€è¦ï¼Œä¸å¦‚ç›´æ¥æ”¹RC+rowæ ¼å¼çš„binlogğŸ˜„<br><br>æˆ‘è¿˜æ²¡æœ‰ç¢°åˆ°è¿‡ä½ è¯´çš„è¿™ç§éœ€æ±‚åœºæ™¯</p>
                                <p class="reply-time">2019-01-05 21:09</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>