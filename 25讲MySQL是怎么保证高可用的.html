<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                25è®²MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/70/25/709a17b02b35211e1293f7f122538625.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="25è®²MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="25è®²MySQLæ˜¯æ€ä¹ˆä¿è¯é«˜å¯ç”¨çš„.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†binlogçš„åŸºæœ¬å†…å®¹ï¼Œåœ¨ä¸€ä¸ªä¸»å¤‡å…³ç³»ä¸­ï¼Œæ¯ä¸ªå¤‡åº“æ¥æ”¶ä¸»åº“çš„binlogå¹¶æ‰§è¡Œã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ä¸»åº“æ‰§è¡Œæ›´æ–°ç”Ÿæˆçš„æ‰€æœ‰binlogï¼Œéƒ½å¯ä»¥ä¼ åˆ°å¤‡åº“å¹¶è¢«æ­£ç¡®åœ°æ‰§è¡Œï¼Œå¤‡åº“å°±èƒ½è¾¾åˆ°è·Ÿä¸»åº“ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>ä½†æ˜¯ï¼ŒMySQLè¦æä¾›é«˜å¯ç”¨èƒ½åŠ›ï¼Œåªæœ‰æœ€ç»ˆä¸€è‡´æ€§æ˜¯ä¸å¤Ÿçš„ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿä»Šå¤©æˆ‘å°±ç€é‡å’Œä½ åˆ†æä¸€ä¸‹ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å†æ”¾ä¸€æ¬¡ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²åˆ°çš„åŒMç»“æ„çš„ä¸»å¤‡åˆ‡æ¢æµç¨‹å›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/89/cc/89290bbcf454ff9a3dc5de42a85a69cc.png" alt=""></p><center><span class="reference">å›¾ 1 MySQLä¸»å¤‡åˆ‡æ¢æµç¨‹--åŒMç»“æ„</span></center><h1>ä¸»å¤‡å»¶è¿Ÿ</h1><p>ä¸»å¤‡åˆ‡æ¢å¯èƒ½æ˜¯ä¸€ä¸ªä¸»åŠ¨è¿ç»´åŠ¨ä½œï¼Œæ¯”å¦‚è½¯ä»¶å‡çº§ã€ä¸»åº“æ‰€åœ¨æœºå™¨æŒ‰è®¡åˆ’ä¸‹çº¿ç­‰ï¼Œä¹Ÿå¯èƒ½æ˜¯è¢«åŠ¨æ“ä½œï¼Œæ¯”å¦‚ä¸»åº“æ‰€åœ¨æœºå™¨æ‰ç”µã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆä¸€èµ·çœ‹çœ‹ä¸»åŠ¨åˆ‡æ¢çš„åœºæ™¯ã€‚</p><p>åœ¨ä»‹ç»ä¸»åŠ¨åˆ‡æ¢æµç¨‹çš„è¯¦ç»†æ­¥éª¤ä¹‹å‰ï¼Œæˆ‘è¦å…ˆè·Ÿä½ è¯´æ˜ä¸€ä¸ªæ¦‚å¿µï¼Œå³â€œåŒæ­¥å»¶è¿Ÿâ€ã€‚ä¸æ•°æ®åŒæ­¥æœ‰å…³çš„æ—¶é—´ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªï¼š</p><ol>
<li>
<p>ä¸»åº“Aæ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥binlogï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸ºT1;</p>
</li>
<li>
<p>ä¹‹åä¼ ç»™å¤‡åº“Bï¼Œæˆ‘ä»¬æŠŠå¤‡åº“Bæ¥æ”¶å®Œè¿™ä¸ªbinlogçš„æ—¶åˆ»è®°ä¸ºT2;</p>
</li>
<li>
<p>å¤‡åº“Bæ‰§è¡Œå®Œæˆè¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶åˆ»è®°ä¸ºT3ã€‚</p>
</li>
</ol><p>æ‰€è°“ä¸»å¤‡å»¶è¿Ÿï¼Œå°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´å’Œä¸»åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´ä¹‹é—´çš„å·®å€¼ï¼Œä¹Ÿå°±æ˜¯T3-T1ã€‚</p><p>ä½ å¯ä»¥åœ¨å¤‡åº“ä¸Šæ‰§è¡Œshow slave statuså‘½ä»¤ï¼Œå®ƒçš„è¿”å›ç»“æœé‡Œé¢ä¼šæ˜¾ç¤ºseconds_behind_masterï¼Œç”¨äºè¡¨ç¤ºå½“å‰å¤‡åº“å»¶è¿Ÿäº†å¤šå°‘ç§’ã€‚</p><!-- [[[read_end]]] --><p>seconds_behind_masterçš„è®¡ç®—æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>æ¯ä¸ªäº‹åŠ¡çš„binlog é‡Œé¢éƒ½æœ‰ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œç”¨äºè®°å½•ä¸»åº“ä¸Šå†™å…¥çš„æ—¶é—´ï¼›</p>
</li>
<li>
<p>å¤‡åº“å–å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ—¶é—´å­—æ®µçš„å€¼ï¼Œè®¡ç®—å®ƒä¸å½“å‰ç³»ç»Ÿæ—¶é—´çš„å·®å€¼ï¼Œå¾—åˆ°seconds_behind_masterã€‚</p>
</li>
</ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®seconds_behind_masterè¿™ä¸ªå‚æ•°è®¡ç®—çš„å°±æ˜¯T3-T1ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨seconds_behind_masteræ¥ä½œä¸ºä¸»å¤‡å»¶è¿Ÿçš„å€¼ï¼Œè¿™ä¸ªå€¼çš„æ—¶é—´ç²¾åº¦æ˜¯ç§’ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œå¦‚æœä¸»å¤‡åº“æœºå™¨çš„ç³»ç»Ÿæ—¶é—´è®¾ç½®ä¸ä¸€è‡´ï¼Œä¼šä¸ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„å€¼ä¸å‡†ï¼Ÿ</p><p>å…¶å®ä¸ä¼šçš„ã€‚å› ä¸ºï¼Œå¤‡åº“è¿æ¥åˆ°ä¸»åº“çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ‰§è¡ŒSELECT UNIX_TIMESTAMP()å‡½æ•°æ¥è·å¾—å½“å‰ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ã€‚å¦‚æœè¿™æ—¶å€™å‘ç°ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ä¸è‡ªå·±ä¸ä¸€è‡´ï¼Œå¤‡åº“åœ¨æ‰§è¡Œseconds_behind_masterè®¡ç®—çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰£æ‰è¿™ä¸ªå·®å€¼ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨ç½‘ç»œæ­£å¸¸çš„æ—¶å€™ï¼Œæ—¥å¿—ä»ä¸»åº“ä¼ ç»™å¤‡åº“æ‰€éœ€çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œå³T2-T1çš„å€¼æ˜¯éå¸¸å°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç½‘ç»œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸»å¤‡å»¶è¿Ÿçš„ä¸»è¦æ¥æºæ˜¯å¤‡åº“æ¥æ”¶å®Œbinlogå’Œæ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ä¹‹é—´çš„æ—¶é—´å·®ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œä¸»å¤‡å»¶è¿Ÿæœ€ç›´æ¥çš„è¡¨ç°æ˜¯ï¼Œå¤‡åº“æ¶ˆè´¹ä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰çš„é€Ÿåº¦ï¼Œæ¯”ä¸»åº“ç”Ÿäº§binlogçš„é€Ÿåº¦è¦æ…¢ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ ä¸€èµ·åˆ†æä¸‹ï¼Œè¿™å¯èƒ½æ˜¯ç”±å“ªäº›åŸå› å¯¼è‡´çš„ã€‚</p><h1>ä¸»å¤‡å»¶è¿Ÿçš„æ¥æº</h1><p><strong>é¦–å…ˆï¼Œæœ‰äº›éƒ¨ç½²æ¡ä»¶ä¸‹ï¼Œå¤‡åº“æ‰€åœ¨æœºå™¨çš„æ€§èƒ½è¦æ¯”ä¸»åº“æ‰€åœ¨çš„æœºå™¨æ€§èƒ½å·®ã€‚</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰äººè¿™ä¹ˆéƒ¨ç½²æ—¶çš„æƒ³æ³•æ˜¯ï¼Œåæ­£å¤‡åº“æ²¡æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å·®ä¸€ç‚¹å„¿çš„æœºå™¨ã€‚æˆ–è€…ï¼Œä»–ä»¬ä¼šæŠŠ20ä¸ªä¸»åº“æ”¾åœ¨4å°æœºå™¨ä¸Šï¼Œè€ŒæŠŠå¤‡åº“é›†ä¸­åœ¨ä¸€å°æœºå™¨ä¸Šã€‚</p><p>å…¶å®æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ›´æ–°è¯·æ±‚å¯¹IOPSçš„å‹åŠ›ï¼Œåœ¨ä¸»åº“å’Œå¤‡åº“ä¸Šæ˜¯æ— å·®åˆ«çš„ã€‚æ‰€ä»¥ï¼Œåšè¿™ç§éƒ¨ç½²æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šå°†å¤‡åº“è®¾ç½®ä¸ºâ€œéåŒ1â€çš„æ¨¡å¼ã€‚</p><p>ä½†å®é™…ä¸Šï¼Œæ›´æ–°è¿‡ç¨‹ä¸­ä¹Ÿä¼šè§¦å‘å¤§é‡çš„è¯»æ“ä½œã€‚æ‰€ä»¥ï¼Œå½“å¤‡åº“ä¸»æœºä¸Šçš„å¤šä¸ªå¤‡åº“éƒ½åœ¨äº‰æŠ¢èµ„æºçš„æ—¶å€™ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿäº†ã€‚</p><p>å½“ç„¶ï¼Œè¿™ç§éƒ¨ç½²ç°åœ¨æ¯”è¾ƒå°‘äº†ã€‚å› ä¸ºä¸»å¤‡å¯èƒ½å‘ç”Ÿåˆ‡æ¢ï¼Œå¤‡åº“éšæ—¶å¯èƒ½å˜æˆä¸»åº“ï¼Œæ‰€ä»¥ä¸»å¤‡åº“é€‰ç”¨ç›¸åŒè§„æ ¼çš„æœºå™¨ï¼Œå¹¶ä¸”åšå¯¹ç§°éƒ¨ç½²ï¼Œæ˜¯ç°åœ¨æ¯”è¾ƒå¸¸è§çš„æƒ…å†µã€‚</p><p>è¿½é—®1ï¼šä½†æ˜¯ï¼Œåšäº†å¯¹ç§°éƒ¨ç½²ä»¥åï¼Œè¿˜å¯èƒ½ä¼šæœ‰å»¶è¿Ÿã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯<strong>ç¬¬äºŒç§å¸¸è§çš„å¯èƒ½äº†ï¼Œå³å¤‡åº“çš„å‹åŠ›å¤§</strong>ã€‚ä¸€èˆ¬çš„æƒ³æ³•æ˜¯ï¼Œä¸»åº“æ—¢ç„¶æä¾›äº†å†™èƒ½åŠ›ï¼Œé‚£ä¹ˆå¤‡åº“å¯ä»¥æä¾›ä¸€äº›è¯»èƒ½åŠ›ã€‚æˆ–è€…ä¸€äº›è¿è¥åå°éœ€è¦çš„åˆ†æè¯­å¥ï¼Œä¸èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡ï¼Œæ‰€ä»¥åªèƒ½åœ¨å¤‡åº“ä¸Šè·‘ã€‚</p><p>æˆ‘çœŸå°±è§è¿‡ä¸å°‘è¿™æ ·çš„æƒ…å†µã€‚ç”±äºä¸»åº“ç›´æ¥å½±å“ä¸šåŠ¡ï¼Œå¤§å®¶ä½¿ç”¨èµ·æ¥ä¼šæ¯”è¾ƒå…‹åˆ¶ï¼Œåè€Œå¿½è§†äº†å¤‡åº“çš„å‹åŠ›æ§åˆ¶ã€‚ç»“æœå°±æ˜¯ï¼Œå¤‡åº“ä¸Šçš„æŸ¥è¯¢è€—è´¹äº†å¤§é‡çš„CPUèµ„æºï¼Œå½±å“äº†åŒæ­¥é€Ÿåº¦ï¼Œé€ æˆä¸»å¤‡å»¶è¿Ÿã€‚</p><p>è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥è¿™ä¹ˆå¤„ç†ï¼š</p><ol>
<li>
<p>ä¸€ä¸»å¤šä»ã€‚é™¤äº†å¤‡åº“å¤–ï¼Œå¯ä»¥å¤šæ¥å‡ ä¸ªä»åº“ï¼Œè®©è¿™äº›ä»åº“æ¥åˆ†æ‹…è¯»çš„å‹åŠ›ã€‚</p>
</li>
<li>
<p>é€šè¿‡binlogè¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚Hadoopè¿™ç±»ç³»ç»Ÿï¼Œè®©å¤–éƒ¨ç³»ç»Ÿæä¾›ç»Ÿè®¡ç±»æŸ¥è¯¢çš„èƒ½åŠ›ã€‚</p>
</li>
</ol><p>å…¶ä¸­ï¼Œä¸€ä¸»å¤šä»çš„æ–¹å¼å¤§éƒ½ä¼šè¢«é‡‡ç”¨ã€‚å› ä¸ºä½œä¸ºæ•°æ®åº“ç³»ç»Ÿï¼Œè¿˜å¿…é¡»ä¿è¯æœ‰å®šæœŸå…¨é‡å¤‡ä»½çš„èƒ½åŠ›ã€‚è€Œä»åº“ï¼Œå°±å¾ˆé€‚åˆç”¨æ¥åšå¤‡ä»½ã€‚</p><blockquote>
<p>å¤‡æ³¨ï¼šè¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œä»åº“å’Œå¤‡åº“åœ¨æ¦‚å¿µä¸Šå…¶å®å·®ä¸å¤šã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¸“æ é‡Œï¼Œä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘æŠŠä¼šåœ¨HAè¿‡ç¨‹ä¸­è¢«é€‰æˆæ–°ä¸»åº“çš„ï¼Œç§°ä¸ºå¤‡åº“ï¼Œå…¶ä»–çš„ç§°ä¸ºä»åº“ã€‚</p>
</blockquote><p>è¿½é—®2ï¼šé‡‡ç”¨äº†ä¸€ä¸»å¤šä»ï¼Œä¿è¯å¤‡åº“çš„å‹åŠ›ä¸ä¼šè¶…è¿‡ä¸»åº“ï¼Œè¿˜æœ‰ä»€ä¹ˆæƒ…å†µå¯èƒ½å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿå—ï¼Ÿ</p><p><strong>è¿™å°±æ˜¯ç¬¬ä¸‰ç§å¯èƒ½äº†ï¼Œå³å¤§äº‹åŠ¡ã€‚</strong></p><p>å¤§äº‹åŠ¡è¿™ç§æƒ…å†µå¾ˆå¥½ç†è§£ã€‚å› ä¸ºä¸»åº“ä¸Šå¿…é¡»ç­‰äº‹åŠ¡æ‰§è¡Œå®Œæˆæ‰ä¼šå†™å…¥binlogï¼Œå†ä¼ ç»™å¤‡åº“ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªä¸»åº“ä¸Šçš„è¯­å¥æ‰§è¡Œ10åˆ†é’Ÿï¼Œé‚£è¿™ä¸ªäº‹åŠ¡å¾ˆå¯èƒ½å°±ä¼šå¯¼è‡´ä»åº“å»¶è¿Ÿ10åˆ†é’Ÿã€‚</p><p>ä¸çŸ¥é“ä½ æ‰€åœ¨å…¬å¸çš„DBAæœ‰æ²¡æœ‰è·Ÿä½ è¿™ä¹ˆè¯´è¿‡ï¼šä¸è¦<strong>ä¸€æ¬¡æ€§åœ°ç”¨deleteè¯­å¥åˆ é™¤å¤ªå¤šæ•°æ®</strong>ã€‚å…¶å®ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¤§äº‹åŠ¡åœºæ™¯ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€äº›å½’æ¡£ç±»çš„æ•°æ®ï¼Œå¹³æ—¶æ²¡æœ‰æ³¨æ„åˆ é™¤å†å²æ•°æ®ï¼Œç­‰åˆ°ç©ºé—´å¿«æ»¡äº†ï¼Œä¸šåŠ¡å¼€å‘äººå‘˜è¦ä¸€æ¬¡æ€§åœ°åˆ æ‰å¤§é‡å†å²æ•°æ®ã€‚åŒæ—¶ï¼Œåˆå› ä¸ºè¦é¿å…åœ¨é«˜å³°æœŸæ“ä½œä¼šå½±å“ä¸šåŠ¡ï¼ˆè‡³å°‘æœ‰è¿™ä¸ªæ„è¯†è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼‰ï¼Œæ‰€ä»¥ä¼šåœ¨æ™šä¸Šæ‰§è¡Œè¿™äº›å¤§é‡æ•°æ®çš„åˆ é™¤æ“ä½œã€‚</p><p>ç»“æœï¼Œè´Ÿè´£çš„DBAåŒå­¦åŠå¤œå°±ä¼šæ”¶åˆ°å»¶è¿ŸæŠ¥è­¦ã€‚ç„¶åï¼ŒDBAå›¢é˜Ÿå°±è¦æ±‚ä½ åç»­å†åˆ é™¤æ•°æ®çš„æ—¶å€™ï¼Œè¦æ§åˆ¶æ¯ä¸ªäº‹åŠ¡åˆ é™¤çš„æ•°æ®é‡ï¼Œåˆ†æˆå¤šæ¬¡åˆ é™¤ã€‚</p><p><strong>å¦ä¸€ç§å…¸å‹çš„å¤§äº‹åŠ¡åœºæ™¯ï¼Œå°±æ˜¯å¤§è¡¨DDLã€‚</strong>è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘åœ¨å‰é¢çš„æ–‡ç« ä¸­ä»‹ç»è¿‡ã€‚å¤„ç†æ–¹æ¡ˆå°±æ˜¯ï¼Œè®¡åˆ’å†…çš„DDLï¼Œå»ºè®®ä½¿ç”¨gh-ostæ–¹æ¡ˆï¼ˆè¿™é‡Œï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹ç¬¬13ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/72388">ã€Šä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜ï¼Ÿã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ã€‚</p><p>è¿½é—®3ï¼šå¦‚æœä¸»åº“ä¸Šä¹Ÿä¸åšå¤§äº‹åŠ¡äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿå—ï¼Ÿ</p><p>é€ æˆä¸»å¤‡å»¶è¿Ÿè¿˜æœ‰ä¸€ä¸ªå¤§æ–¹å‘çš„åŸå› ï¼Œå°±æ˜¯<strong>å¤‡åº“çš„å¹¶è¡Œå¤åˆ¶èƒ½åŠ›</strong>ã€‚è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘ä¼šç•™åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å†å’Œä½ è¯¦ç»†ä»‹ç»ã€‚</p><p>å…¶å®è¿˜æ˜¯æœ‰ä¸å°‘å…¶ä»–æƒ…å†µä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿï¼Œå¦‚æœä½ è¿˜ç¢°åˆ°è¿‡å…¶ä»–åœºæ™¯ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€ï¼Œæˆ‘æ¥å’Œä½ ä¸€èµ·åˆ†æã€è®¨è®ºã€‚</p><p>ç”±äºä¸»å¤‡å»¶è¿Ÿçš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™ï¼Œå°±ç›¸åº”çš„æœ‰ä¸åŒçš„ç­–ç•¥ã€‚</p><h1>å¯é æ€§ä¼˜å…ˆç­–ç•¥</h1><p>åœ¨å›¾1çš„åŒMç»“æ„ä¸‹ï¼Œä»çŠ¶æ€1åˆ°çŠ¶æ€2åˆ‡æ¢çš„è¯¦ç»†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>åˆ¤æ–­å¤‡åº“Bç°åœ¨çš„seconds_behind_masterï¼Œå¦‚æœå°äºæŸä¸ªå€¼ï¼ˆæ¯”å¦‚5ç§’ï¼‰ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™æŒç»­é‡è¯•è¿™ä¸€æ­¥ï¼›</p>
</li>
<li>
<p>æŠŠä¸»åº“Aæ”¹æˆåªè¯»çŠ¶æ€ï¼Œå³æŠŠreadonlyè®¾ç½®ä¸ºtrueï¼›</p>
</li>
<li>
<p>åˆ¤æ–­å¤‡åº“Bçš„seconds_behind_masterçš„å€¼ï¼Œç›´åˆ°è¿™ä¸ªå€¼å˜æˆ0ä¸ºæ­¢ï¼›</p>
</li>
<li>
<p>æŠŠå¤‡åº“Bæ”¹æˆå¯è¯»å†™çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æŠŠreadonly è®¾ç½®ä¸ºfalseï¼›</p>
</li>
<li>
<p>æŠŠä¸šåŠ¡è¯·æ±‚åˆ‡åˆ°å¤‡åº“Bã€‚</p>
</li>
</ol><p>è¿™ä¸ªåˆ‡æ¢æµç¨‹ï¼Œä¸€èˆ¬æ˜¯ç”±ä¸“é—¨çš„HAç³»ç»Ÿæ¥å®Œæˆçš„ï¼Œæˆ‘ä»¬æš‚æ—¶ç§°ä¹‹ä¸ºå¯é æ€§ä¼˜å…ˆæµç¨‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/54/4a/54f4c7c31e6f0f807c2ab77f78c8844a.png" alt=""></p><center><span class="reference">å›¾2 MySQLå¯é æ€§ä¼˜å…ˆä¸»å¤‡åˆ‡æ¢æµç¨‹</span></center><p>å¤‡æ³¨ï¼šå›¾ä¸­çš„SBMï¼Œæ˜¯seconds_behind_masterå‚æ•°çš„ç®€å†™ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªåˆ‡æ¢æµç¨‹ä¸­æ˜¯æœ‰ä¸å¯ç”¨æ—¶é—´çš„ã€‚å› ä¸ºåœ¨æ­¥éª¤2ä¹‹åï¼Œä¸»åº“Aå’Œå¤‡åº“Béƒ½å¤„äºreadonlyçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ—¶ç³»ç»Ÿå¤„äºä¸å¯å†™çŠ¶æ€ï¼Œç›´åˆ°æ­¥éª¤5å®Œæˆåæ‰èƒ½æ¢å¤ã€‚</p><p>åœ¨è¿™ä¸ªä¸å¯ç”¨çŠ¶æ€ä¸­ï¼Œæ¯”è¾ƒè€—è´¹æ—¶é—´çš„æ˜¯æ­¥éª¤3ï¼Œå¯èƒ½éœ€è¦è€—è´¹å¥½å‡ ç§’çš„æ—¶é—´ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆéœ€è¦åœ¨æ­¥éª¤1å…ˆåšåˆ¤æ–­ï¼Œç¡®ä¿seconds_behind_masterçš„å€¼è¶³å¤Ÿå°ã€‚</p><p>è¯•æƒ³å¦‚æœä¸€å¼€å§‹ä¸»å¤‡å»¶è¿Ÿå°±é•¿è¾¾30åˆ†é’Ÿï¼Œè€Œä¸å…ˆåšåˆ¤æ–­ç›´æ¥åˆ‡æ¢çš„è¯ï¼Œç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´å°±ä¼šé•¿è¾¾30åˆ†é’Ÿï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬ä¸šåŠ¡éƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p>å½“ç„¶ï¼Œç³»ç»Ÿçš„ä¸å¯ç”¨æ—¶é—´ï¼Œæ˜¯ç”±è¿™ä¸ªæ•°æ®å¯é æ€§ä¼˜å…ˆçš„ç­–ç•¥å†³å®šçš„ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¯ç”¨æ€§ä¼˜å…ˆçš„ç­–ç•¥ï¼Œæ¥æŠŠè¿™ä¸ªä¸å¯ç”¨æ—¶é—´å‡ ä¹é™ä¸º0ã€‚</p><h1>å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥</h1><p>å¦‚æœæˆ‘å¼ºè¡ŒæŠŠæ­¥éª¤4ã€5è°ƒæ•´åˆ°æœ€å¼€å§‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç­‰ä¸»å¤‡æ•°æ®åŒæ­¥ï¼Œç›´æ¥æŠŠè¿æ¥åˆ‡åˆ°å¤‡åº“Bï¼Œå¹¶ä¸”è®©å¤‡åº“Bå¯ä»¥è¯»å†™ï¼Œé‚£ä¹ˆç³»ç»Ÿå‡ ä¹å°±æ²¡æœ‰ä¸å¯ç”¨æ—¶é—´äº†ã€‚</p><p>æˆ‘ä»¬æŠŠè¿™ä¸ªåˆ‡æ¢æµç¨‹ï¼Œæš‚æ—¶ç§°ä½œå¯ç”¨æ€§ä¼˜å…ˆæµç¨‹ã€‚è¿™ä¸ªåˆ‡æ¢æµç¨‹çš„ä»£ä»·ï¼Œå°±æ˜¯å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±å’Œä½ åˆ†äº«ä¸€ä¸ªå¯ç”¨æ€§ä¼˜å…ˆæµç¨‹äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„ä¾‹å­ã€‚å‡è®¾æœ‰ä¸€ä¸ªè¡¨ tï¼š</p><pre><code>mysql&gt; CREATE TABLE `t` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `c` int(11) unsigned DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

insert into t(c) values(1),(2),(3);
</code></pre><p>è¿™ä¸ªè¡¨å®šä¹‰äº†ä¸€ä¸ªè‡ªå¢ä¸»é”®idï¼Œåˆå§‹åŒ–æ•°æ®åï¼Œä¸»åº“å’Œå¤‡åº“ä¸Šéƒ½æ˜¯3è¡Œæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œä¸šåŠ¡äººå‘˜è¦ç»§ç»­åœ¨è¡¨tä¸Šæ‰§è¡Œä¸¤æ¡æ’å…¥è¯­å¥çš„å‘½ä»¤ï¼Œä¾æ¬¡æ˜¯ï¼š</p><pre><code>insert into t(c) values(4);
insert into t(c) values(5);
</code></pre><p>å‡è®¾ï¼Œç°åœ¨ä¸»åº“ä¸Šå…¶ä»–çš„æ•°æ®è¡¨æœ‰å¤§é‡çš„æ›´æ–°ï¼Œå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿè¾¾åˆ°5ç§’ã€‚åœ¨æ’å…¥ä¸€æ¡c=4çš„è¯­å¥åï¼Œå‘èµ·äº†ä¸»å¤‡åˆ‡æ¢ã€‚</p><p>å›¾3æ˜¯<strong>å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸”binlog_format=mixed</strong>æ—¶çš„åˆ‡æ¢æµç¨‹å’Œæ•°æ®ç»“æœã€‚</p><p><img src="https://static001.geekbang.org/resource/image/37/3a/3786bd6ad37faa34aca25bf1a1d8af3a.png" alt=""></p><center><span class="reference">å›¾3 å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸”binlog_format=mixed</span></center><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·åˆ†æä¸‹è¿™ä¸ªåˆ‡æ¢æµç¨‹ï¼š</p><ol>
<li>
<p>æ­¥éª¤2ä¸­ï¼Œä¸»åº“Aæ‰§è¡Œå®Œinsertè¯­å¥ï¼Œæ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼ˆ4,4ï¼‰ï¼Œä¹‹åå¼€å§‹è¿›è¡Œä¸»å¤‡åˆ‡æ¢ã€‚</p>
</li>
<li>
<p>æ­¥éª¤3ä¸­ï¼Œç”±äºä¸»å¤‡ä¹‹é—´æœ‰5ç§’çš„å»¶è¿Ÿï¼Œæ‰€ä»¥å¤‡åº“Bè¿˜æ²¡æ¥å¾—åŠåº”ç”¨â€œæ’å…¥c=4â€è¿™ä¸ªä¸­è½¬æ—¥å¿—ï¼Œå°±å¼€å§‹æ¥æ”¶å®¢æˆ·ç«¯â€œæ’å…¥ c=5â€çš„å‘½ä»¤ã€‚</p>
</li>
<li>
<p>æ­¥éª¤4ä¸­ï¼Œå¤‡åº“Bæ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼ˆ4,5ï¼‰ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªbinlogå‘ç»™ä¸»åº“Aã€‚</p>
</li>
<li>
<p>æ­¥éª¤5ä¸­ï¼Œå¤‡åº“Bæ‰§è¡Œâ€œæ’å…¥c=4â€è¿™ä¸ªä¸­è½¬æ—¥å¿—ï¼Œæ’å…¥äº†ä¸€è¡Œæ•°æ®ï¼ˆ5,4ï¼‰ã€‚è€Œç›´æ¥åœ¨å¤‡åº“Bæ‰§è¡Œçš„â€œæ’å…¥c=5â€è¿™ä¸ªè¯­å¥ï¼Œä¼ åˆ°ä¸»åº“Aï¼Œå°±æ’å…¥äº†ä¸€è¡Œæ–°æ•°æ®ï¼ˆ5,5ï¼‰ã€‚</p>
</li>
</ol><p>æœ€åçš„ç»“æœå°±æ˜¯ï¼Œä¸»åº“Aå’Œå¤‡åº“Bä¸Šå‡ºç°äº†ä¸¤è¡Œä¸ä¸€è‡´çš„æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ•°æ®ä¸ä¸€è‡´ï¼Œæ˜¯ç”±å¯ç”¨æ€§ä¼˜å…ˆæµç¨‹å¯¼è‡´çš„ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘è¿˜æ˜¯ç”¨<strong>å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä½†è®¾ç½®binlog_format=row</strong>ï¼Œæƒ…å†µåˆä¼šæ€æ ·å‘¢ï¼Ÿ</p><p>å› ä¸ºrowæ ¼å¼åœ¨è®°å½•binlogçš„æ—¶å€™ï¼Œä¼šè®°å½•æ–°æ’å…¥çš„è¡Œçš„æ‰€æœ‰å­—æ®µå€¼ï¼Œæ‰€ä»¥æœ€ååªä¼šæœ‰ä¸€è¡Œä¸ä¸€è‡´ã€‚è€Œä¸”ï¼Œä¸¤è¾¹çš„ä¸»å¤‡åŒæ­¥çš„åº”ç”¨çº¿ç¨‹ä¼šæŠ¥é”™duplicate key errorå¹¶åœæ­¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¤‡åº“Bçš„(5,4)å’Œä¸»åº“Açš„(5,5)è¿™ä¸¤è¡Œæ•°æ®ï¼Œéƒ½ä¸ä¼šè¢«å¯¹æ–¹æ‰§è¡Œã€‚</p><p>å›¾4ä¸­æˆ‘ç”»å‡ºäº†è¯¦ç»†è¿‡ç¨‹ï¼Œä½ å¯ä»¥è‡ªå·±å†åˆ†æä¸€ä¸‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/b8/43/b8d2229b2b40dd087fd3b111d1bdda43.png" alt=""></p><center><span class="reference">å›¾4 å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸”binlog_format=row</span></center><p>ä»ä¸Šé¢çš„åˆ†æä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€äº›ç»“è®ºï¼š</p><ol>
<li>
<p>ä½¿ç”¨rowæ ¼å¼çš„binlogæ—¶ï¼Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜æ›´å®¹æ˜“è¢«å‘ç°ã€‚è€Œä½¿ç”¨mixedæˆ–è€…statementæ ¼å¼çš„binlogæ—¶ï¼Œæ•°æ®å¾ˆå¯èƒ½æ‚„æ‚„åœ°å°±ä¸ä¸€è‡´äº†ã€‚å¦‚æœä½ è¿‡äº†å¾ˆä¹…æ‰å‘ç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½è¿™æ—¶çš„æ•°æ®ä¸ä¸€è‡´å·²ç»ä¸å¯æŸ¥ï¼Œæˆ–è€…è¿å¸¦é€ æˆäº†æ›´å¤šçš„æ•°æ®é€»è¾‘ä¸ä¸€è‡´ã€‚</p>
</li>
<li>
<p>ä¸»å¤‡åˆ‡æ¢çš„å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘éƒ½å»ºè®®ä½ ä½¿ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥ã€‚æ¯•ç«Ÿå¯¹æ•°æ®æœåŠ¡æ¥è¯´çš„è¯ï¼Œæ•°æ®çš„å¯é æ€§ä¸€èˆ¬è¿˜æ˜¯è¦ä¼˜äºå¯ç”¨æ€§çš„ã€‚</p>
</li>
</ol><p>ä½†äº‹æ— ç»å¯¹ï¼Œ<strong>æœ‰æ²¡æœ‰å“ªç§æƒ…å†µæ•°æ®çš„å¯ç”¨æ€§ä¼˜å…ˆçº§æ›´é«˜å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆæ˜¯ï¼Œæœ‰çš„ã€‚</p><p>æˆ‘æ›¾ç»ç¢°åˆ°è¿‡è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼š</p><ul>
<li>æœ‰ä¸€ä¸ªåº“çš„ä½œç”¨æ˜¯è®°å½•æ“ä½œæ—¥å¿—ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœæ•°æ®ä¸ä¸€è‡´å¯ä»¥é€šè¿‡binlogæ¥ä¿®è¡¥ï¼Œè€Œè¿™ä¸ªçŸ­æš‚çš„ä¸ä¸€è‡´ä¹Ÿä¸ä¼šå¼•å‘ä¸šåŠ¡é—®é¢˜ã€‚</li>
<li>åŒæ—¶ï¼Œä¸šåŠ¡ç³»ç»Ÿä¾èµ–äºè¿™ä¸ªæ—¥å¿—å†™å…¥é€»è¾‘ï¼Œå¦‚æœè¿™ä¸ªåº“ä¸å¯å†™ï¼Œä¼šå¯¼è‡´çº¿ä¸Šçš„ä¸šåŠ¡æ“ä½œæ— æ³•æ‰§è¡Œã€‚</li>
</ul><p>è¿™æ—¶å€™ï¼Œä½ å¯èƒ½å°±éœ€è¦é€‰æ‹©å…ˆå¼ºè¡Œåˆ‡æ¢ï¼Œäº‹åå†è¡¥æ•°æ®çš„ç­–ç•¥ã€‚</p><p>å½“ç„¶ï¼Œäº‹åå¤ç›˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ°äº†ä¸€ä¸ªæ”¹è¿›æªæ–½å°±æ˜¯ï¼Œè®©ä¸šåŠ¡é€»è¾‘ä¸è¦ä¾èµ–äºè¿™ç±»æ—¥å¿—çš„å†™å…¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ—¥å¿—å†™å…¥è¿™ä¸ªé€»è¾‘æ¨¡å—åº”è¯¥å¯ä»¥é™çº§ï¼Œæ¯”å¦‚å†™åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œæˆ–è€…å†™åˆ°å¦å¤–ä¸€ä¸ªä¸´æ—¶åº“é‡Œé¢ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œè¿™ç§åœºæ™¯å°±åˆå¯ä»¥ä½¿ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹çœ‹ï¼Œ<strong>æŒ‰ç…§å¯é æ€§ä¼˜å…ˆçš„æ€è·¯ï¼Œå¼‚å¸¸åˆ‡æ¢ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ</strong></p><p>å‡è®¾ï¼Œä¸»åº“Aå’Œå¤‡åº“Bé—´çš„ä¸»å¤‡å»¶è¿Ÿæ˜¯30åˆ†é’Ÿï¼Œè¿™æ—¶å€™ä¸»åº“Aæ‰ç”µäº†ï¼ŒHAç³»ç»Ÿè¦åˆ‡æ¢Bä½œä¸ºä¸»åº“ã€‚æˆ‘ä»¬åœ¨ä¸»åŠ¨åˆ‡æ¢çš„æ—¶å€™ï¼Œå¯ä»¥ç­‰åˆ°ä¸»å¤‡å»¶è¿Ÿå°äº5ç§’çš„æ—¶å€™å†å¯åŠ¨åˆ‡æ¢ï¼Œä½†è¿™æ—¶å€™å·²ç»åˆ«æ— é€‰æ‹©äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/55/8b/553b7fc2d0dce3ec78bb595e1806eb8b.png" alt=""></p><center><span class="reference">å›¾5 å¯é æ€§ä¼˜å…ˆç­–ç•¥ï¼Œä¸»åº“ä¸å¯ç”¨</span></center><p>é‡‡ç”¨å¯é æ€§ä¼˜å…ˆç­–ç•¥çš„è¯ï¼Œä½ å°±å¿…é¡»å¾—ç­‰åˆ°å¤‡åº“Bçš„seconds_behind_master=0ä¹‹åï¼Œæ‰èƒ½åˆ‡æ¢ã€‚ä½†ç°åœ¨çš„æƒ…å†µæ¯”åˆšåˆšæ›´ä¸¥é‡ï¼Œå¹¶ä¸æ˜¯ç³»ç»Ÿåªè¯»ã€ä¸å¯å†™çš„é—®é¢˜äº†ï¼Œè€Œæ˜¯ç³»ç»Ÿå¤„äºå®Œå…¨ä¸å¯ç”¨çš„çŠ¶æ€ã€‚å› ä¸ºï¼Œä¸»åº“Aæ‰ç”µåï¼Œæˆ‘ä»¬çš„è¿æ¥è¿˜æ²¡æœ‰åˆ‡åˆ°å¤‡åº“Bã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œé‚£èƒ½ä¸èƒ½ç›´æ¥åˆ‡æ¢åˆ°å¤‡åº“Bï¼Œä½†æ˜¯ä¿æŒBåªè¯»å‘¢ï¼Ÿ</p><p>è¿™æ ·ä¹Ÿä¸è¡Œã€‚</p><p>å› ä¸ºï¼Œè¿™æ®µæ—¶é—´å†…ï¼Œä¸­è½¬æ—¥å¿—è¿˜æ²¡æœ‰åº”ç”¨å®Œæˆï¼Œå¦‚æœç›´æ¥å‘èµ·ä¸»å¤‡åˆ‡æ¢ï¼Œå®¢æˆ·ç«¯æŸ¥è¯¢çœ‹ä¸åˆ°ä¹‹å‰æ‰§è¡Œå®Œæˆçš„äº‹åŠ¡ï¼Œä¼šè®¤ä¸ºæœ‰â€œæ•°æ®ä¸¢å¤±â€ã€‚</p><p>è™½ç„¶éšç€ä¸­è½¬æ—¥å¿—çš„ç»§ç»­åº”ç”¨ï¼Œè¿™äº›æ•°æ®ä¼šæ¢å¤å›æ¥ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ä¸šåŠ¡æ¥è¯´ï¼ŒæŸ¥è¯¢åˆ°â€œæš‚æ—¶ä¸¢å¤±æ•°æ®çš„çŠ¶æ€â€ä¹Ÿæ˜¯ä¸èƒ½è¢«æ¥å—çš„ã€‚</p><p>èŠåˆ°è¿™é‡Œä½ å°±çŸ¥é“äº†ï¼Œåœ¨æ»¡è¶³æ•°æ®å¯é æ€§çš„å‰æä¸‹ï¼ŒMySQLé«˜å¯ç”¨ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ˜¯ä¾èµ–äºä¸»å¤‡å»¶è¿Ÿçš„ã€‚å»¶è¿Ÿçš„æ—¶é—´è¶Šå°ï¼Œåœ¨ä¸»åº“æ•…éšœçš„æ—¶å€™ï¼ŒæœåŠ¡æ¢å¤éœ€è¦çš„æ—¶é—´å°±è¶ŠçŸ­ï¼Œå¯ç”¨æ€§å°±è¶Šé«˜ã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å…ˆå’Œä½ ä»‹ç»äº†MySQLé«˜å¯ç”¨ç³»ç»Ÿçš„åŸºç¡€ï¼Œå°±æ˜¯ä¸»å¤‡åˆ‡æ¢é€»è¾‘ã€‚ç´§æ¥ç€ï¼Œæˆ‘åˆå’Œä½ è®¨è®ºäº†å‡ ç§ä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„æƒ…å†µï¼Œä»¥åŠç›¸åº”çš„æ”¹è¿›æ–¹å‘ã€‚</p><p>ç„¶åï¼Œç”±äºä¸»å¤‡å»¶è¿Ÿçš„å­˜åœ¨ï¼Œåˆ‡æ¢ç­–ç•¥å°±æœ‰ä¸åŒçš„é€‰æ‹©ã€‚æ‰€ä»¥ï¼Œæˆ‘åˆå’Œä½ ä¸€èµ·åˆ†æäº†å¯é æ€§ä¼˜å…ˆå’Œå¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥çš„åŒºåˆ«ã€‚</p><p>åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œæˆ‘æ›´å»ºè®®ä½¿ç”¨å¯é æ€§ä¼˜å…ˆçš„ç­–ç•¥ã€‚æ¯•ç«Ÿä¿è¯æ•°æ®å‡†ç¡®ï¼Œåº”è¯¥æ˜¯æ•°æ®åº“æœåŠ¡çš„åº•çº¿ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œé€šè¿‡å‡å°‘ä¸»å¤‡å»¶è¿Ÿï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>ä¸€èˆ¬ç°åœ¨çš„æ•°æ®åº“è¿ç»´ç³»ç»Ÿéƒ½æœ‰å¤‡åº“å»¶è¿Ÿç›‘æ§ï¼Œå…¶å®å°±æ˜¯åœ¨å¤‡åº“ä¸Šæ‰§è¡Œ show slave statusï¼Œé‡‡é›†seconds_behind_masterçš„å€¼ã€‚</p><p>å‡è®¾ï¼Œç°åœ¨ä½ çœ‹åˆ°ä½ ç»´æŠ¤çš„ä¸€ä¸ªå¤‡åº“ï¼Œå®ƒçš„å»¶è¿Ÿç›‘æ§çš„å›¾åƒç±»ä¼¼å›¾6ï¼Œæ˜¯ä¸€ä¸ª45Â°æ–œå‘ä¸Šçš„çº¿æ®µï¼Œä½ è§‰å¾—å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´å‘¢ï¼Ÿä½ åˆä¼šæ€ä¹ˆå»ç¡®è®¤è¿™ä¸ªåŸå› å‘¢ï¼Ÿ</p><p><img src="https://static001.geekbang.org/resource/image/cf/71/cf5ea52aa3b26ef56c567125197fa171.png" alt=""></p><center><span class="reference">å›¾6 å¤‡åº“å»¶è¿Ÿ</span></center><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸæˆ‘ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œä»€ä¹ˆæƒ…å†µä¸‹åŒMç»“æ„ä¼šå‡ºç°å¾ªç¯å¤åˆ¶ã€‚</p><p>ä¸€ç§åœºæ™¯æ˜¯ï¼Œåœ¨ä¸€ä¸ªä¸»åº“æ›´æ–°äº‹åŠ¡åï¼Œç”¨å‘½ä»¤set global server_id=xä¿®æ”¹äº†server_idã€‚ç­‰æ—¥å¿—å†ä¼ å›æ¥çš„æ—¶å€™ï¼Œå‘ç°server_idè·Ÿè‡ªå·±çš„server_idä¸åŒï¼Œå°±åªèƒ½æ‰§è¡Œäº†ã€‚</p><p>å¦ä¸€ç§åœºæ™¯æ˜¯ï¼Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚å›¾7æ‰€ç¤ºï¼Œtrx1æ˜¯åœ¨èŠ‚ç‚¹ Bæ‰§è¡Œçš„ï¼Œå› æ­¤binlogä¸Šçš„server_idå°±æ˜¯Bï¼Œbinlogä¼ ç»™èŠ‚ç‚¹ Aï¼Œç„¶åAå’ŒAâ€™æ­å»ºäº†åŒMç»“æ„ï¼Œå°±ä¼šå‡ºç°å¾ªç¯å¤åˆ¶ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/f9/71/f968192ce2f436c939dd702b8f409771.png" alt=""></p><center><span class="reference">å›¾7 ä¸‰èŠ‚ç‚¹å¾ªç¯å¤åˆ¶</span></center><p>è¿™ç§ä¸‰èŠ‚ç‚¹å¤åˆ¶çš„åœºæ™¯ï¼Œåšæ•°æ®åº“è¿ç§»çš„æ—¶å€™ä¼šå‡ºç°ã€‚</p><p>å¦‚æœå‡ºç°äº†å¾ªç¯å¤åˆ¶ï¼Œå¯ä»¥åœ¨Aæˆ–è€…Aâ€™ä¸Šï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>stop slaveï¼›
CHANGE MASTER TO IGNORE_SERVER_IDS=(server_id_of_B);
start slave;
</code></pre><p>è¿™æ ·è¿™ä¸ªèŠ‚ç‚¹æ”¶åˆ°æ—¥å¿—åå°±ä¸ä¼šå†æ‰§è¡Œã€‚è¿‡ä¸€æ®µæ—¶é—´åï¼Œå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŠŠè¿™ä¸ªå€¼æ”¹å›æ¥ã€‚</p><pre><code>stop slaveï¼›
CHANGE MASTER TO IGNORE_SERVER_IDS=();
start slave;
</code></pre><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@ä¸€å¤§åªã€@HuaMax åŒå­¦æåˆ°äº†ç¬¬ä¸€ä¸ªå¤ç°æ–¹æ³•ï¼›</p>
</blockquote><blockquote>
<p>@JonhåŒå­¦æåˆ°äº†IGNORE_SERVER_IDSè¿™ä¸ªè§£å†³æ–¹æ³•ï¼›</p>
</blockquote><blockquote>
<p>@React æåˆ°ï¼Œå¦‚æœä¸»å¤‡è®¾ç½®ä¸åŒçš„æ­¥é•¿ï¼Œå¤‡åº“æ˜¯ä¸æ˜¯å¯ä»¥è®¾ç½®ä¸ºå¯è¯»å†™ã€‚æˆ‘çš„å»ºè®®æ˜¯ï¼Œåªè¦è¿™ä¸ªèŠ‚ç‚¹è®¾è®¡å†…å°±ä¸ä¼šæœ‰ä¸šåŠ¡ç›´æ¥åœ¨ä¸Šé¢æ‰§è¡Œæ›´æ–°ï¼Œå°±å»ºè®®è®¾ç½®ä¸ºreadonlyã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">é‡åˆ°è¿‡ä¸‹é¢å‡ ç§é€ æˆä¸»ä»å»¶è¿Ÿçš„æƒ…å†µ:<br>1.ä¸»åº“DMLè¯­å¥å¹¶å‘å¤§,ä»åº“qpsé«˜<br>2.ä»åº“æœåŠ¡å™¨é…ç½®å·®æˆ–è€…ä¸€å°æœåŠ¡å™¨ä¸Šå‡ å°ä»åº“(èµ„æºç«äº‰æ¿€çƒˆ,ç‰¹åˆ«æ˜¯io)<br>3.ä¸»åº“å’Œä»åº“çš„å‚æ•°é…ç½®ä¸ä¸€æ ·<br>4.å¤§äº‹åŠ¡(DDL,æˆ‘è§‰å¾—DDLä¹Ÿç›¸å½“äºä¸€ä¸ªå¤§äº‹åŠ¡)<br>5.ä»åº“ä¸Šåœ¨è¿›è¡Œå¤‡ä»½æ“ä½œ<br>6.è¡¨ä¸Šæ— ä¸»é”®çš„æƒ…å†µ(ä¸»åº“åˆ©ç”¨ç´¢å¼•æ›´æ”¹æ•°æ®,å¤‡åº“å›æ”¾åªèƒ½ç”¨å…¨è¡¨æ‰«æ,è¿™ç§æƒ…å†µå¯ä»¥è°ƒæ•´slave_rows_search_algorithmså‚æ•°é€‚å½“ä¼˜åŒ–ä¸‹)<br>7.è®¾ç½®çš„æ˜¯å»¶è¿Ÿå¤‡åº“<br>8.å¤‡åº“ç©ºé—´ä¸è¶³çš„æƒ…å†µä¸‹<br><br>è¿™æœŸçš„é—®é¢˜ï¼š<br>çœ‹è¿™æ›²çº¿,åº”è¯¥æ˜¯ä»åº“æ­£åœ¨åº”ç”¨ä¸€ä¸ªå¤§äº‹åŠ¡,æˆ–è€…ä¸€ä¸ªå¤§è¡¨ä¸Šæ— ä¸»é”®çš„æƒ…å†µ(æœ‰è¯¥è¡¨çš„æ›´æ–°)<br>åº”è¯¥æ˜¯T3éšç€æ—¶é—´çš„å¢é•¿åœ¨å¢é•¿,è€ŒT1è¿™ä¸ªæ—¶é—´ç‚¹æ˜¯æ²¡å˜çš„,é€ æˆçš„ç°è±¡å°±æ˜¯<br>éšç€æ—¶é—´çš„å¢é•¿,second_behind_masterä¹Ÿæ˜¯æœ‰è§„å¾‹çš„å¢é•¿ <br></div>
                            <span class="time">2019-01-10 21:46</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åˆ†æçš„ç‚¹å¾ˆå‡†ç¡®ğŸ‘</p>
                                <p class="reply-time">2019-01-11 01:18</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">undifined</span>
                            </div>
                            <div class="bd">é—®é¢˜ç­”æ¡ˆï¼š<br>1. å¤‡åº“åœ¨æ‰§è¡Œå¤æ‚æŸ¥è¯¢ï¼Œå¯¼è‡´èµ„æºè¢«å ç”¨<br>2. å¤‡åº“æ­£åœ¨æ‰§è¡Œä¸€ä¸ªå¤§äº‹åŠ¡<br>3. DML è¯­å¥æ‰§è¡Œ<br><br>è€å¸ˆæˆ‘çš„ç†è§£å¯¹å— <br></div>
                            <span class="time">2019-01-09 20:52</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1ä¸å¤ªå‡†ç¡®ï¼Œæ˜å¤©æˆ‘ä¼šæåˆ°å“ˆ<br><br>23å¯¹çš„</p>
                                <p class="reply-time">2019-01-09 22:05</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/1e/47/f01225df.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">7å·</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œç”Ÿäº§ç¯å¢ƒæœ‰ä¸€å¼ è¡¨éœ€è¦æ¸…ç†ï¼Œè¯¥è¡¨å¤§å°140Gã€‚è¦ä¿ç•™æœ€è¿‘ä¸€ä¸ªæœˆçš„æ•°æ®ï¼Œåˆä¸èƒ½æŒ‰æ—¶é—´ç›´æ¥ç”¨deteleåˆ ï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œæœ¬æ¥æƒ³é€šè¿‡æ¸…ç©ºåˆ†åŒºè¡¨åˆ ï¼Œä½†æ˜¯åˆ†åŒºè¡¨åˆæ˜¯å“ˆå¸Œçš„ã€‚ã€‚æœ‰æ²¡å¥½çš„åŠæ³•å‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-09 19:42</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¼°è®¡ä¸‹ä¸€ä¸ªæœˆå å¤šå°‘æ¯”ä¾‹ï¼Œå¦‚æœæ¯”è¾ƒå°å°±å»ºæ–°è¡¨ï¼ŒæŠŠæ•°æ®å¯¼è¿‡å»å§<br>å¦‚æœä¸€ä¸ªæœˆå æ¯”é«˜çš„è¯ï¼Œåªèƒ½ä¸€ç‚¹ç‚¹åˆ äº†ã€‚<br><br>æ—¶é—´å­—æ®µæœ‰ç´¢å¼•çš„è¯ï¼Œæ¯ä¸ªåˆ†åŒºæŒ‰æ—¶é—´è¿‡æ»¤å‡ºæ¥åˆ é™¤</p>
                                <p class="reply-time">2019-01-09 22:07</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ¢ä¸­å</span>
                            </div>
                            <div class="bd">æˆ‘æœ‰ä¸€ä¸ªæ¯”è¾ƒæç«¯ä¸€ç‚¹çš„HAé—®é¢˜ï¼Œå‡è®¾ä¸»åº“çš„binlogåˆšå†™æˆåŠŸè¿˜æœªæ¥å¾—åŠæŠŠbinlogåŒæ­¥åˆ°ä»åº“ï¼Œä¸»åº“å°±æ‰ç”µäº†ï¼Œè¿™æ—¶å€™ä»åº“çš„æ•°æ®ä¼šä¸å®Œæ•´å—ï¼Ÿ<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒåŸä¸»åº“é‡å¯åŠ å…¥é›†ç¾¤åï¼Œé‚£æ¡æ²¡æœ‰ä¼ å‡ºå»çš„binlogä¼šå¦‚ä½•å¤„ç†ï¼Ÿ <br></div>
                            <span class="time">2019-01-09 10:43</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1.å¯èƒ½ä¼šä¸¢<br>2. è¦çœ‹é‡å¯ä¹‹åçš„æ‹“æ‰‘ç»“æ„äº†ï¼Œå¦‚æœè¿˜æœ‰èŠ‚ç‚¹æ˜¯è¿™ä¸ªåº“çš„ä»åº“ï¼Œè¿˜æ˜¯ä¼šæ‹¿èµ°çš„</p>
                                <p class="reply-time">2019-01-09 12:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/16/97/9e342700.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username"> JJ</span>
                            </div>
                            <div class="bd">è¯·é—®è€å¸ˆï¼Œä¸»åº“æ–­ç”µäº†ï¼Œæ€ä¹ˆæŠŠbinlogä¼ ç»™ä»åº“åŒæ­¥æ•°æ®ï¼Œæ€ä¹ˆä½¿çš„SBMä¸º0ä¸»ä»åˆ‡æ¢å‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-09 09:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç­‰åº”ç”¨å®Œå°±è®¤ä¸ºæ˜¯SBM=0<br><br>å¦‚æœä¸èƒ½æ¥å—ä¸»åº“æœ‰æ¥ä¸åŠä¼ çš„ï¼Œå°±ä½¿ç”¨semi-sync</p>
                                <p class="reply-time">2019-01-09 10:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/87/60/fe8a31ea.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">via</span>
                            </div>
                            <div class="bd">é€šè¿‡ binlog è¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œæ¯”å¦‚ Hadoop è¿™ç±»...<br><br>æ–‡ä¸­è¿™ä¸ªå…·ä½“æ˜¯å¯é‡‡ç”¨ä»€ä¹ˆå·¥å…·å‘¢ï¼Ÿ<br>  <br></div>
                            <span class="time">2019-01-09 08:53</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">canal å¯ä»¥äº†è§£ä¸‹</p>
                                <p class="reply-time">2019-01-10 19:19</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Sinyo</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œåœ¨ binlog rowæ¨¡å¼ä¸‹ï¼Œinsert åˆ°è¡¨ä¸­ä¸€æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•ä¸­æŸä¸ªå­—æ®µä¸å¡«ï¼Œè¯¥å­—æ®µåœ¨è¡¨ä¸­æœ‰è®¾ç½®é»˜è®¤å€¼ï¼Œåˆ©ç”¨canalè§£æbinlogå‡ºæ¥ï¼Œè¿™ä¸ªä¸å¡«çš„å­—æ®µä¼šä¸å­˜åœ¨ï¼›éš¾é“ binlog åªè®°å½•æœ‰æ’å…¥çš„å­—æ®µæ•°æ®ï¼Œè¡¨å­—æ®µçš„é»˜è®¤æ•°æ®å°±ä¸ä¼šè®°å½•ä¹ˆï¼Ÿmysqlç‰ˆæœ¬5.7.22 canalç‰ˆæœ¬1.0.3 <br></div>
                            <span class="time">2019-01-09 00:37</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸ä¼šå•Š<br>insertè®°å½•çš„æ—¶å€™è‚¯å®šéƒ½è®°å½•çš„<br>ä½ çš„é»˜è®¤å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</p>
                                <p class="reply-time">2019-01-10 19:16</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJeibN69icI9iapx9h2MtUX3zb2iaggw32w4GAmbUDibPp3ia5MPSznxGZeiadXibBbx6Y13iacDbTDBwKyibA/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">qqæ‚Ÿç©º</span>
                            </div>
                            <div class="bd">è€å¸ˆæ–‡ç« æœ«å°¾æ€è€ƒé¢˜éƒ¨åˆ†ï¼Œæœ‰ç‚¹å›°æƒ‘æ±‚è§£ç­”ã€‚<br>å¾ªç¯å¤åˆ¶æˆ‘ä¹‹å‰ç†è§£æ˜¯B-&gt;A-&gt;A&#39;-&gt;Bè¿™æ ·çš„æ‹“æ‰‘ç»“æ„ã€‚<br>è€ŒåŒMç»“æ„ç†è§£æ˜¯A-&gt;A&#39;-&gt;Aï¼Œæ­¤æ—¶Aæ˜¯A&#39;çš„ä¸»åº“å’Œä»åº“ï¼ŒBåªèƒ½æ˜¯Açš„ä»åº“ã€‚é‚£ä¹ˆtrx1åœ¨ä»åº“Bä¸Šçš„æ›´æ–°å°±ä¸ä¼šä¼ ç»™Aã€‚<br>æ–‡ä¸­æ˜¯ä¸€ç§å‡è®¾å—ï¼Ÿè¿˜æ˜¯æˆ‘ç†è§£åå·®äº† ~<br><br>--------æ­£æ–‡--------<br>trx1 æ˜¯åœ¨èŠ‚ç‚¹ B æ‰§è¡Œçš„ï¼Œå› æ­¤ binlog ä¸Šçš„ server_id å°±æ˜¯ Bï¼Œbinlog ä¼ ç»™èŠ‚ç‚¹ Aï¼Œç„¶åA å’Œ Aâ€™æ­å»ºäº†åŒ M ç»“æ„ï¼Œå°±ä¼šå‡ºç°å¾ªç¯å¤åˆ¶ã€‚ <br></div>
                            <span class="time">2019-01-12 16:32</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™ä¸ªè¯´çš„æ˜¯è¿ç§»è¿‡ç¨‹ï¼Œ<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å¼€å§‹Aæ˜¯Bçš„ä»åº“ï¼Œåæ¥è¿ç§»è¿‡ç¨‹ä¸­ï¼Œåœæ­¢äº†Aå’ŒBçš„ä¸»å¤‡å…³ç³»ï¼Œè®©Aå’ŒA&#39;äº’ä¸ºä¸»å¤‡</p>
                                <p class="reply-time">2019-01-12 19:37</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/99/f4/a06982f7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å´”ä¼Ÿå</span>
                            </div>
                            <div class="bd">å‘ç”Ÿä¸»ä»åˆ‡æ¢çš„æ—¶å€™ï¼Œä¸»æœ‰çš„æœ€æ–°æ•°æ®æ²¡åŒæ­¥åˆ°ä»ï¼Œä¼šå‡ºç°è¿™ç§æƒ…å†µå—ï¼Œå‡ºç°äº†ä¼šæ€ä¹ˆæ · <br></div>
                            <span class="time">2019-01-11 14:25</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¼‚å¸¸åˆ‡æ¢æœ‰å¯èƒ½çš„<br><br>è¦æ ¹æ®ä½ çš„å¤„ç†ç­–ç•¥äº†ï¼Œå¦‚æœä¸èƒ½ä¸¢ï¼Œæœ‰å‡ ä¸ªå¯é€‰çš„<br>1.ä¸åˆ‡æ¢ï¼ˆç­‰è¿™ä¸ªåº“è‡ªå·±æ¢å¤èµ·æ¥ï¼‰<br>2. ä½¿ç”¨semi-syncç­–ç•¥<br>3. å¯åŠ¨åä¸šåŠ¡åšæ•°æ®å¯¹è´¦ï¼ˆè¿™ä¸ªä¸€èˆ¬ç”¨å¾—å°‘ï¼Œæˆæœ¬é«˜ï¼‰<br></p>
                                <p class="reply-time">2019-01-11 15:06</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä»»é¹æ–Œ</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½å‘ç°æˆ‘ä»¬ç³»ç»Ÿä¸­ä¸€æ¡sqlå†™æ³•æ¯”è¾ƒç‹¬ç‰¹<br>SELECT<br>    IF(ha.curricula_type = &#39;02&#39;<br>            AND ((cla.model_code IN (&#39;CM05004&#39; , &#39;CM05001&#39;)<br>            AND cla.is_vip_video = 1)<br>            OR cla.model_code = &#39;CM05008&#39;),<br>        &#39;1&#39;,<br>        &#39;0&#39;) AS &#39;isUK&#39;<br>FROM<br>    h_curricula ha,<br>    h_class cla<br>WHERE<br>    ha.`code` = &#39;2&#39; <br>	AND cla.`code` =&#39;2&#39; <br>ä½¿ç”¨æŸ¥è¯¢åˆ†æå™¨åæ‰€æœ‰åˆ—éƒ½æ— ä¿¡æ¯æ˜¾ç¤ºï¼Œåªåœ¨Extraåˆ—æ˜¾ç¤ºï¼Œ<br>Impossible WHERE noticed after reading const tablesï¼Œä¸çŸ¥é“å¦‚ä½•åˆ†æå…¶æ‰§è¡Œè®¡åˆ’ã€‚<br>å¦‚æœcodeåˆ—å‡ä¸ºä¸¤ä¸ªè¡¨çš„ä¸»é”®ç±»å‹æ˜¯varcharï¼Œæƒ³çŸ¥é“è¿™ç§æƒ…å†µä¸‹æ˜¯å¦ä¼šäº§ç”Ÿç¬›å¡å°”ç§¯ï¼Ÿ <br></div>
                            <span class="time">2019-01-11 09:24</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">Impossible WHERE noticed after reading const tables<br><br>è¿™ä¸ªè¯­å¥æ˜¯ä¸æ˜¯æ‰§è¡Œç»“æœæ˜¯ç©ºï¼Ÿ</p>
                                <p class="reply-time">2019-01-11 11:47</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/2b/d3/7c42e06c.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åº·ç£Š</span>
                            </div>
                            <div class="bd">è€å¸ˆä½ å¥½ï¼Œç°åœ¨ä¸€èˆ¬é‡‡ç”¨è¯»å†™åˆ†ç¦»ï¼Œè¯»çš„æ˜¯ä»åº“ï¼Œé‚£ä¹ˆä¸»ä»å¦‚æœå‡ºç°å»¶è¿Ÿçš„è¯ï¼Œè¯»åº“å°±è¯»çš„ä¸æ˜¯æœ€æ–°æ•°æ®ï¼Œå¯¹è¿™ç§é—®é¢˜æœ‰ä»€ä¹ˆå¥½å»ºè®®å—ï¼Ÿ <br></div>
                            <span class="time">2019-01-11 09:00</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç¬¬28ç¯‡ä¸“é—¨è®²è¿™ä¸ªé—®é¢˜ï¼Œæ•¬è¯·æœŸå¾…ğŸ¤</p>
                                <p class="reply-time">2019-01-11 11:11</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/8a/a8/cf86fe53.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">cyberty</span>
                            </div>
                            <div class="bd">è¯·é—®è€å¸ˆï¼Œå¦‚æœå¤‡åº“è¿æ¥ä¸»åº“ä¹‹åï¼Œä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ä¿®æ”¹äº†ï¼Œå¤‡åº“åŒæ­¥çš„æ—¶å€™æ˜¯å¦ä¼šè‡ªåŠ¨ä¿®æ­£ï¼Ÿ <br></div>
                            <span class="time">2019-01-10 13:19</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œä¸ä¼š</p>
                                <p class="reply-time">2019-01-10 23:33</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/19/cb/70a2b47e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é£è§é›¨ç‘Ÿ</span>
                            </div>
                            <div class="bd">è€å¸ˆé—®ä¸€ä¸‹é›†ç¾¤åœ¨å¼€å¯å¹¶è¡Œå¤åˆ¶çš„æƒ…å†µä¸‹ï¼š<br>ä¸»åº“å‚æ•°ï¼šbinlog_group_commit_sync_delay=1000ï¼›binlog_group_commit_sync_no_delay_count=10<br>ä»åº“ï¼šslave_parallel_type=LOGICAL_CLOCKï¼›slave_parallel_workers=8<br>MySQLï¼šç¤¾åŒºç‰ˆ5.7.20<br>åœ¨ä»åº“ä¸ŠæŸ¥çœ‹slave statusçš„æ—¶Seconds_Behind_Masteræ€»æ˜¯æ˜¾ç¤ºè½å10-15ï¼Œåœ¨æœ‰å¤§é‡æ›´æ–°çš„æƒ…å†µä¸‹æ•°æ®ä¼šä¸€ç›´å¢å¤§ï¼Œé€šè¿‡binlogæ¥çœ‹çš„è¯Read_Master_Log_Pos å’ŒExec_Master_Log_Posç›¸å·®æ€»æ˜¯åœ¨1000+ï¼Œç”šè‡³å˜å¤§çš„æ›´å¤§ã€‚ä½†å°†slave_parallel_typeæ›´æ”¹å›é»˜è®¤å€¼DATABASEæ—¶ï¼ŒRead_Master_Log_Pos å’ŒExec_Master_Log_Posç›¸å·®å¾ˆå°ï¼Œç”šè‡³å¯ä»¥ç›¸åŒã€‚<br>åœ¨ä¸åŒçš„é›†ç¾¤ä¸Šå¼€å¯å¹¶è¡Œå¤åˆ¶éƒ½ä¼šå‡ºç°ç›¸åŒçš„æƒ…å†µï¼Œä½†å°†slave_parallel_typeæ›´æ”¹å›é»˜è®¤å€¼DATABASEæ—¶éƒ½è¦æ¯”LOGICAL_CLOCKå»¶è¿Ÿæƒ…å†µè¦å¥½ã€‚<br>æ›´æ¢5.7.24ç‰ˆæœ¬çš„æƒ…å†µä¸‹æœ‰åŒæ ·çš„é—®é¢˜ã€‚<br>å¦‚æœæœ‰ä¸¤å°ä»åº“ï¼Œæœºå™¨é…ç½®ç›¸åŒå…¶å®ƒå‚æ•°ä¸€æ ·ã€‚ä¸€å°è®¾ç½®æˆslave_parallel_type=DATABASEã€‚è€Œå¦ä¸€å°è®¾ç½®æˆLOGICAL_CLOCKï¼Œä¸ç®¡æ˜¯çº¿ä¸Šçš„è¡¨ç°è¿˜æ˜¯é€šè¿‡sysbenchå‹æµ‹æ¥çœ‹ï¼Œè®¾ç½®æˆLOGICAL_CLOCKçš„ä»åº“å»¶è¿Ÿç¡®å®è¦æ¯”DATABASEå¤§ä¸€äº›ã€‚<br>è¿™ä¸ªæƒ…å†µä»å“ªé‡Œæ’æŸ¥ä¸€ä¸‹ï¼Ÿè°¢è°¢ã€‚<br> <br></div>
                            <span class="time">2019-01-10 11:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å…ˆçœ‹çœ‹26ç¯‡ï¼Œç„¶åå†ä¸‹é¢ç•™ä¸‹ä½ çš„ç†è§£å’Œæ–°çš„ç–‘é—®å“ˆğŸ˜†</p>
                                <p class="reply-time">2019-01-10 23:32</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">xm</span>
                            </div>
                            <div class="bd">ä¸€èˆ¬ä¸»ä»å»¶æ—¶å¤šå°‘ç®—æ˜¯åˆç†çš„ï¼Ÿæ˜¯ç§’çº§åˆ«å—ï¼Ÿ <br></div>
                            <span class="time">2019-01-10 11:09</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸€èˆ¬å¤§äº1å°±ä¸å¥½ ^_^</p>
                                <p class="reply-time">2019-01-10 23:30</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f4/61/cfdd9e55.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Chris</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œå’¨è¯¢ä¸ªé—®é¢˜ï¼Œç°åœ¨é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œmysqlæ•°æ®åº“æ€»æ˜¯crashï¼Œé‡æ–°å¯åŠ¨æœåŠ¡åˆæ­£å¸¸ï¼Œç„¶åè¿è¡Œä¸€æ®µæ—¶é—´åˆä¼šcrashï¼ŒæŠ¥é”™å¦‚ä¸‹InnoDB: Assertion failure in thread 6792 in file fil0fil.cc line 5805<br>InnoDB: Failing assertion: err == DB_SUCCESS<br>InnoDB: We intentionally generate a memory trap.<br>InnoDB: Submit a detailed bug report to http:&#47;&#47;bugs.mysql.com.<br>InnoDB: If you get repeated assertion failures or crashes, even<br>InnoDB: immediately after the mysqld startup, there may be<br>InnoDB: corruption in the InnoDB tablespace. Please refer to<br>InnoDB: http:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;5.7&#47;en&#47;forcing-innodb-recovery.html<br>InnoDB: about forcing recovery.<br>08:52:33 UTC - mysqld got exception 0x80000003 ;<br>This could be because you hit a bug. It is also possible that this binary<br>or one of the libraries it was linked against is corrupt, improperly built,<br>or misconfigured. This error can also be caused by malfunctioning hardware.<br>Attempting to collect some information that could help diagnose the problem.<br>As this is a crash and something is definitely wrong, the information<br>collection process might fail.<br><br>key_buffer_size=8388608<br>read_buffer_size=131072<br>max_used_connections=60<br>max_threads=151<br>thread_count=45<br>connection_count=45<br>It is possible that mysqld could use up to <br>key_buffer_size + (read_buffer_size + sort_buffer_size)*max_threads = 68010 K  bytes of memory<br>Hope that&#39;s ok; if not, decrease some variables in the equation.<br><br>Thread pointer: 0x0<br>Attempting backtrace. You can use the following information to find out<br>where mysqld died. If you see no messages after this, something went<br>terribly wrong...<br>13f9b9812    mysqld.exe!my_sigabrt_handler()[my_thr_init.c:449]<br>13fd5e349    mysqld.exe!raise()[winsig.c:587]<br>13fd5d240    mysqld.exe!abort()[abort.c:82]<br>13fab9b08    mysqld.exe!ut_dbg_assertion_failed()[ut0dbg.cc:67]<br>13fae06da    mysqld.exe!fil_aio_wait()[fil0fil.cc:5807]<br>13fa7eb84    mysqld.exe!io_handler_thread()<br>The manual page at http:&#47;&#47;dev.mysql.com&#47;doc&#47;mysql&#47;en&#47;crashing. <br></div>
                            <span class="time">2019-01-10 11:08</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">çœ‹ç€å¥½åƒæ˜¯ç£ç›˜é—®é¢˜äº†ï¼Œä½ è¿™ä¸ªæ˜¯5.7çš„å“ªä¸ªå°ç‰ˆæœ¬ï¼Ÿ<br>è¿˜æœ‰ï¼Œå°½é‡ä¸è¦ç”¨windowsç³»ç»Ÿå“¦ğŸ˜†</p>
                                <p class="reply-time">2019-01-11 01:18</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">xm</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œå¦‚æœæ˜¯ä¸»åº“çš„qpsä¸Šæ¥äº†ï¼Œä¸»åº“å†™è¯·æ±‚å¤ªå¤šè¿™ç§é€ æˆçš„å»¶è¿Ÿçš„è¯æ˜¯ä¸æ˜¯ä»ä¸»åº“ä¸Šä¸‹æ‰‹å¥½ç‚¹ï¼Ÿè¿™ç§æ˜¯åšçƒ­æ•°æ®éš”ç¦»ä¸»åº“æ‹†åˆ†ï¼Ÿ <br></div>
                            <span class="time">2019-01-10 11:06</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å°±æ˜¯è¦çœ‹è¿˜æœ‰æ²¡æœ‰æ•‘ï¼Œå¦‚æœå„ç§æ–¹æ³•éƒ½æ²¡æ•‘äº†ï¼Œå°±åªèƒ½ä¸»åº“åˆ†åº“äº†<br><br></p>
                                <p class="reply-time">2019-01-11 01:15</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è€ƒæ‹‰å‡ºå±±</span>
                            </div>
                            <div class="bd">ä½ å¥½ï¼Œæƒ³é—®å‡ ä¸ªä¸æ˜äº†çš„ä¸å¹³æ—¶é‡åˆ°çš„é—®é¢˜ï¼š<br>CREATE TABLE `t_my_user` (<br>  `id` bigint(20) NOT NULL,<br>  `type` int(11) NOT NULL,<br>  `groupType` int(11) NOT NULL,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `unique-type` (`type`) USING BTREE<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8;<br>INSERT INTO t_my_user(`id`, `type`, `groupType`) VALUES (1, 1, 1),(2, 2, 2),(3, 3, 3);<br><br>RCäº‹åŠ¡éš”ç¦»çº§åˆ«<br>(session-A)begin;<br>(session-B)begin;<br>(session-A)update t_my_user set type = 4 where type =2;<br>(session-B) delete from t_my_user where groupType = 6;<br>ç»“æœæ˜¯session-B å¤„äºfetching rows  LOCK WAIT ç­‰å¾…session-A;<br>é—®é¢˜1ï¼šmysql deleteæ˜¯ä¼šæ‰«æè®°å½•åŠ é”ç„¶åè¿‡æ»¤é€‚é…è®°å½•å†é‡Šæ”¾Xé”å—ï¼Ÿæ˜¯ä¸€æ¬¡æ€§å…¨è¡¨å…ˆåŠ Xé”ï¼Œè¿˜æ˜¯ä¸€è¾¹é€è¡Œæ‰«æåŠ é”ï¼Œç„¶åè¿‡æ»¤ï¼Œé‡Šæ”¾ï¼Ÿä¸ºä»€ä¹ˆæ‰«æè¿‡æ»¤ä¸å…ˆåŠ Sé”ï¼Œå‘ç°æ»¡è¶³æ¡ä»¶å†å˜ä¸ºXé”å‘¢ã€‚<br>é—®é¢˜2ï¼šsession-Bæ¢æˆ(delete from t_my_user where groupType = 6;) åˆ™ä¸ä¼šé˜»å¡ï¼Œé™¤éå‘½ä¸­è®°å½•ï¼Œupdateä¸éœ€è¦åŠ é”è¿‡æ»¤ï¼Ÿ<br><br>(session-A)begin;<br>select * from t_my_user where type = 2 lock in SHARE mode;<br>update t_my_user set type = 4 where type =2;<br>ç»“æœæ˜¯é¡ºåˆ©æ‰§è¡Œï¼›<br>é—®é¢˜3ï¼šç¬¬ä¸€æ­¥è·å–äº†Sé”ï¼Œç¬¬äºŒéƒ¨è·å–äº†Xé”ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ Sé”å‡çº§ä¸ºXé”ï¼Ÿè¿˜æ˜¯å…ˆé‡Šæ”¾Sé”ï¼Œå†è·å–Xé”ï¼Œéš¾é“ä¸ç”¨æäº¤äº‹åŠ¡ä¹Ÿå¯ä»¥é‡Šæ”¾é”å—ï¼Ÿ<br><br>(session-A)begin;<br>(session-B)begin;<br>(session-C)begin;<br>(session-A)INSERT INTO t_my_user(`id`, `type`, `groupType`) VALUES (4, 4, 4);<br>(session-B)INSERT INTO t_my_user(`id`, `type`, `groupType`) VALUES (5, 4, 4);<br>(session-C)INSERT INTO t_my_user(`id`, `type`, `groupType`) VALUES (6, 4, 4);<br>ç»“æœæ˜¯ï¼šsession-A æ‰§è¡Œ  session-B&#47;session-C Lock Mode S  Lock Wait X ,ç­‰å¾…session-Aï¼›<br>å®˜æ–¹æ–‡æ¡£æœ‰å¦‚ä¸‹è§£é‡Šâ€œIf a duplicate-key error occurs, a shared lock on the duplicate index record is set.â€ï¼›<br>ä¸ºä»€ä¹ˆè¦æ·»åŠ Sé”å‘¢ï¼Ÿæ²¡æœ‰æ‰¾åˆ°ç›¸å…³è§£é‡Šã€‚ç½‘ä¸Šæœ‰è§£é‡Šè¯´æ˜¯æ’å…¥è¯­å¥ä¼šå…ˆåœ¨å”¯ä¸€ç´¢å¼•ä¸Šæ·»åŠ Sé”è¿›è¡Œå”¯ä¸€æ€§æ£€æŸ¥ï¼Œå†å˜ä¸ºXé”ï¼Ÿ è¿˜æ˜¯åªæœ‰åœ¨â€œduplicate-key error occursâ€æ‰ä¼šå°è¯•æ·»åŠ Sé”<br> <br></div>
                            <span class="time">2019-01-10 10:44</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. å› ä¸ºgroupTypeæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥å…¨è¡¨æ‰«æï¼Œå¹¶åœ¨primary keyä¸ŠåŠ ä¸Šæ‰€æœ‰next-key lockï¼Œæ‰€ä»¥ä¼šåœ¨é”id=2è¿™ä¸€è¡Œï¼Œè¢«é”ä½ï¼›<br>2. æ˜¯ä¸æ˜¯æ‰“é”™äº†ï¼Ÿdelete from t_my_user where type = 6; èƒ½é€šè¿‡ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªè¯­å¥é”çš„æ˜¯ typeè¿™ä¸ªç´¢å¼•ä¸Š(2, suprenum)ï¼Œè¿™ä¸ªæ²¡æœ‰é”å†²çª<br>3. è¿™æ ·çš„æƒ…å†µä¸‹ä¸¤ä¸ªé”éƒ½è¿˜åœ¨ï¼Œéƒ½åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™é‡Šæ”¾ã€‚æ˜¯åœ¨â€œduplicate-key error occursâ€æ‰ä¼šå°è¯•æ·»åŠ Sé”ã€‚</p>
                                <p class="reply-time">2019-01-10 23:30</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å…‰</span>
                            </div>
                            <div class="bd">è€å¸ˆè¯·æ•™ä¸ªé—®é¢˜æˆ‘ä»¬å…¬å¸ç°åœ¨ç”¨å¾—é˜¿é‡Œäº‘mysql  ï¼Œæ˜¨å¤©ä¸‹åˆå¼€å§‹äº†å»¶è¿Ÿï¼Œæ’æŸ¥å‘ç°æœ‰å¤§äº‹åŠ¡æ›´æ–°æ“ä½œã€‚<br>ç°åœ¨æ€ä¹ˆè§£å†³è¿™ä¸ªå¤§äº‹åŠ¡å‘¢ã€‚<br>1ã€å¦‚æœæˆ‘ä¸»åº“ä¸Šåˆ é™¤è¿™ä¸ªè¡¨æˆ–è€…ä»åº“ä¸Šåˆ é™¤è¿™ä¸ªè¡¨ä¼šæœ‰ä»€ä¹ˆç»“æœã€‚<br>2ã€æ¯”å¦‚æˆ‘ä¸»åº“ä¸Šä¸‰ä¸ªè¡¨1ã€2ã€3ï¼ŒåªåŒæ­¥äº†1ï¼Œæ²¡åŒæ­¥å®Œæ—¶å€™åˆ é™¤äº†2ã€3è¡¨ï¼Œè¿™æ—¶å€™ä¼šæœ‰ä»€ä¹ˆé”™è¯¯ã€‚<br>3ã€Waiting for Slave Workers to free pending events è¿™ä¸ªæ˜¯ä»£è¡¨ä»€ä¹ˆæ„æ€<br>4ã€mysql tables in use 1, locked 1<br>     6045 lock struct(s), heap size 549072, 159972 row lock(s), undo log entries 159972<br>      MySQL thread id 3, OS thread handle 47532738873088, query id 165269 Executing event<br>è¿™ä¸ªæ˜¯é”è¡¨äº†æŠŠã€‚èƒ½ç®€å•è§£é‡Šä¸‹å‘¢ã€‚æˆ‘æŸ¥èµ„æ–™ä¸æ˜¯å¾ˆæ˜ç™½ã€‚<br>5ã€è¿™ä¸ªäº‹åŠ¡æ˜¯ä¸æ˜¯åªèƒ½ç­‰ã€‚æˆ–è€…æ˜¯é‡å»ºä¸»ä»ã€‚<br> <br></div>
                            <span class="time">2019-01-10 10:28</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. ä¸»åº“ä¸Šåˆ é™¤ï¼Œå¯¹å»¶è¿Ÿæ²¡æœ‰ä»»ä½•å½±å“çš„ï¼Œè¿˜æ˜¯å¾—ç­‰ä»åº“åŒæ­¥å®Œæˆä¹‹åï¼Œå†æ‰§è¡Œâ€œåˆ è¡¨â€è¿™ä¸ªåŠ¨ä½œï¼›<br>   å¤‡åº“çš„è¯ï¼Œå¦‚æœè¿™ä¸ªè¯­å¥å·²ç»åœ¨æ‰§è¡Œäº†ï¼Œä½ æ‰§è¡Œçš„drop tableæ˜¯ä¼šè¢«å µä½çš„ï¼Œæ‰€ä»¥å¯¹å»¶è¿Ÿä¹Ÿæ— ç›Šï¼›<br>2. è¯´çš„æ˜¯ä¸»åº“åˆ é™¤è¿˜æ˜¯å¤‡åº“åˆ é™¤ï¼Ÿ<br>3. è¡¨ç¤ºä»åº“ä¸Šçš„å·¥ä½œçº¿ç¨‹çš„ç­‰å¾…é˜Ÿåˆ—å¤ªå¤šäº†<br>4. ä¸æ˜¯é”è¡¨ï¼Œå°±æ˜¯é”äº†å¤ªå¤šè¡Œäº†ï¼›<br>5. å¦‚æœä½ çœŸçš„å¯ä»¥é‡å»ºè¡¨çš„è¯ï¼Œæ“ä½œä¸Šå¯ä»¥è¿™æ ·ã€‚ <br>    a) å¤‡åº“ä¸Šstop slave<br>    b) å¤‡åº“ä¸Š set sql_log_bin=off; truncate table t;<br>    cï¼‰å¤‡åº“ä¸Šè·³è¿‡è¿™ä¸ªäº‹åŠ¡ï¼ˆæ–¹æ³•åé¢æ–‡ç« ä¼šè¯´ï¼‰<br></p>
                                <p class="reply-time">2019-01-10 19:58</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/f2/63/1f495e51.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">nero</span>
                            </div>
                            <div class="bd">è€å¸ˆè¯·æ•™ä¸‹ï¼šå¤‡åº“è¿æ¥åˆ°ä¸»åº“çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ‰§è¡Œ SELECT UNIX_TIMESTAMP() å‡½æ•°æ¥è·å¾—å½“å‰ä¸»åº“çš„ç³»ç»Ÿæ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´ä¹Ÿä¸æ˜¯å¾ˆå‡†ç¡®å§ï¼Œæ²¡æœ‰ç½‘ç»œå»¶æ—¶å—<br> <br></div>
                            <span class="time">2019-01-10 10:22</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å•ä½æ˜¯ç§’ï¼Œåº”è¯¥è¿˜å¥½å•¦^_^</p>
                                <p class="reply-time">2019-01-10 19:51</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/79/b7/989824f7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ˜¥å›°ç§‹ä¹å¤æ‰“ç›¹</span>
                            </div>
                            <div class="bd">(Master_Log_file, Read_Master_Log_Pos): Coordinates in the master binary log indicating how far the slave I&#47;O thread has read events from that log.	<br>(Relay_Master_Log_File, Exec_Master_Log_Pos): Coordinates in the master binary log indicating how far the slave SQL thread has executed events received from that log.<br>(Relay_Log_File, Relay_Log_Pos): Coordinates in the slave relay log indicating how far the slave SQL thread has executed the relay log. These correspond to the preceding coordinates, but are<br>expressed in slave relay log coordinates rather than master binary log coordinates.	<br>æ¸…æ¥šäº† <br></div>
                            <span class="time">2019-01-10 09:49</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>