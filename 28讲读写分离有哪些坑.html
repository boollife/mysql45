<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                28è®²è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/37/21/374bd30a786307fe6f7eeae387503b21.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="28è®²è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="28è®²è¯»å†™åˆ†ç¦»æœ‰å“ªäº›å‘.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†ä¸€ä¸»å¤šä»çš„ç»“æ„ä»¥åŠåˆ‡æ¢æµç¨‹ã€‚ä»Šå¤©æˆ‘ä»¬å°±ç»§ç»­èŠèŠä¸€ä¸»å¤šä»æ¶æ„çš„åº”ç”¨åœºæ™¯ï¼šè¯»å†™åˆ†ç¦»ï¼Œä»¥åŠæ€ä¹ˆå¤„ç†ä¸»å¤‡å»¶è¿Ÿå¯¼è‡´çš„è¯»å†™åˆ†ç¦»é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æåˆ°çš„ä¸€ä¸»å¤šä»çš„ç»“æ„ï¼Œå…¶å®å°±æ˜¯è¯»å†™åˆ†ç¦»çš„åŸºæœ¬ç»“æ„äº†ã€‚è¿™é‡Œï¼Œæˆ‘å†æŠŠè¿™å¼ å›¾è´´è¿‡æ¥ï¼Œæ–¹ä¾¿ä½ ç†è§£ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/13/aa/1334b9c08b8fd837832fdb2d82e6b0aa.png" alt=""></p><center><span class="reference">å›¾1 è¯»å†™åˆ†ç¦»åŸºæœ¬ç»“æ„</span></center><p>è¯»å†™åˆ†ç¦»çš„ä¸»è¦ç›®æ ‡å°±æ˜¯åˆ†æ‘Šä¸»åº“çš„å‹åŠ›ã€‚å›¾1ä¸­çš„ç»“æ„æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰ä¸»åŠ¨åšè´Ÿè½½å‡è¡¡ï¼Œè¿™ç§æ¨¡å¼ä¸‹ä¸€èˆ¬ä¼šæŠŠæ•°æ®åº“çš„è¿æ¥ä¿¡æ¯æ”¾åœ¨å®¢æˆ·ç«¯çš„è¿æ¥å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±å®¢æˆ·ç«¯æ¥é€‰æ‹©åç«¯æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ¶æ„æ˜¯ï¼Œåœ¨MySQLå’Œå®¢æˆ·ç«¯ä¹‹é—´æœ‰ä¸€ä¸ªä¸­é—´ä»£ç†å±‚proxyï¼Œå®¢æˆ·ç«¯åªè¿æ¥proxyï¼Œ ç”±proxyæ ¹æ®è¯·æ±‚ç±»å‹å’Œä¸Šä¸‹æ–‡å†³å®šè¯·æ±‚çš„åˆ†å‘è·¯ç”±ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/06/18/065ef246c59019effc8384967d774318.png" alt=""></p><center><span class="reference">å›¾2 å¸¦proxyçš„è¯»å†™åˆ†ç¦»æ¶æ„</span></center><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯ç›´è¿å’Œå¸¦proxyçš„è¯»å†™åˆ†ç¦»æ¶æ„ï¼Œå„æœ‰å“ªäº›ç‰¹ç‚¹ã€‚</p><ol>
<li>
<p>å®¢æˆ·ç«¯ç›´è¿æ–¹æ¡ˆï¼Œå› ä¸ºå°‘äº†ä¸€å±‚proxyè½¬å‘ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ç¨å¾®å¥½ä¸€ç‚¹å„¿ï¼Œå¹¶ä¸”æ•´ä½“æ¶æ„ç®€å•ï¼Œæ’æŸ¥é—®é¢˜æ›´æ–¹ä¾¿ã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆï¼Œç”±äºè¦äº†è§£åç«¯éƒ¨ç½²ç»†èŠ‚ï¼Œæ‰€ä»¥åœ¨å‡ºç°ä¸»å¤‡åˆ‡æ¢ã€åº“è¿ç§»ç­‰æ“ä½œçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šæ„ŸçŸ¥åˆ°ï¼Œå¹¶ä¸”éœ€è¦è°ƒæ•´æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚<br>
ä½ å¯èƒ½ä¼šè§‰å¾—è¿™æ ·å®¢æˆ·ç«¯ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œä¿¡æ¯å¤§é‡å†—ä½™ï¼Œæ¶æ„å¾ˆä¸‘ã€‚å…¶å®ä¹Ÿæœªå¿…ï¼Œä¸€èˆ¬é‡‡ç”¨è¿™æ ·çš„æ¶æ„ï¼Œä¸€å®šä¼šä¼´éšä¸€ä¸ªè´Ÿè´£ç®¡ç†åç«¯çš„ç»„ä»¶ï¼Œæ¯”å¦‚Zookeeperï¼Œå°½é‡è®©ä¸šåŠ¡ç«¯åªä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å¼€å‘ã€‚</p>
</li>
<li>
<p>å¸¦proxyçš„æ¶æ„ï¼Œå¯¹å®¢æˆ·ç«¯æ¯”è¾ƒå‹å¥½ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨åç«¯ç»†èŠ‚ï¼Œè¿æ¥ç»´æŠ¤ã€åç«¯ä¿¡æ¯ç»´æŠ¤ç­‰å·¥ä½œï¼Œéƒ½æ˜¯ç”±proxyå®Œæˆçš„ã€‚ä½†è¿™æ ·çš„è¯ï¼Œå¯¹åç«¯ç»´æŠ¤å›¢é˜Ÿçš„è¦æ±‚ä¼šæ›´é«˜ã€‚è€Œä¸”ï¼Œproxyä¹Ÿéœ€è¦æœ‰é«˜å¯ç”¨æ¶æ„ã€‚å› æ­¤ï¼Œå¸¦proxyæ¶æ„çš„æ•´ä½“å°±ç›¸å¯¹æ¯”è¾ƒå¤æ‚ã€‚</p>
</li>
</ol><!-- [[[read_end]]] --><p>ç†è§£äº†è¿™ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œå…·ä½“é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆå°±å–å†³äºæ•°æ®åº“å›¢é˜Ÿæä¾›çš„èƒ½åŠ›äº†ã€‚ä½†ç›®å‰çœ‹ï¼Œè¶‹åŠ¿æ˜¯å¾€å¸¦proxyçš„æ¶æ„æ–¹å‘å‘å±•çš„ã€‚</p><p>ä½†æ˜¯ï¼Œä¸è®ºä½¿ç”¨å“ªç§æ¶æ„ï¼Œä½ éƒ½ä¼šç¢°åˆ°æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„é—®é¢˜ï¼šç”±äºä¸»ä»å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼Œå®¢æˆ·ç«¯æ‰§è¡Œå®Œä¸€ä¸ªæ›´æ–°äº‹åŠ¡åé©¬ä¸Šå‘èµ·æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥è¯¢é€‰æ‹©çš„æ˜¯ä»åº“çš„è¯ï¼Œå°±æœ‰å¯èƒ½è¯»åˆ°åˆšåˆšçš„äº‹åŠ¡æ›´æ–°ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p><strong>è¿™ç§â€œåœ¨ä»åº“ä¸Šä¼šè¯»åˆ°ç³»ç»Ÿçš„ä¸€ä¸ªè¿‡æœŸçŠ¶æ€â€çš„ç°è±¡ï¼Œåœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬æš‚ä¸”ç§°ä¹‹ä¸ºâ€œè¿‡æœŸè¯»â€ã€‚</strong></p><p>å‰é¢æˆ‘ä»¬è¯´è¿‡äº†å‡ ç§å¯èƒ½å¯¼è‡´ä¸»å¤‡å»¶è¿Ÿçš„åŸå› ï¼Œä»¥åŠå¯¹åº”çš„ä¼˜åŒ–ç­–ç•¥ï¼Œä½†æ˜¯ä¸»ä»å»¶è¿Ÿè¿˜æ˜¯ä¸èƒ½100%é¿å…çš„ã€‚</p><p>ä¸è®ºå“ªç§ç»“æ„ï¼Œå®¢æˆ·ç«¯éƒ½å¸Œæœ›æŸ¥è¯¢ä»åº“çš„æ•°æ®ç»“æœï¼Œè·ŸæŸ¥ä¸»åº“çš„æ•°æ®ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥è®¨è®ºæ€ä¹ˆå¤„ç†è¿‡æœŸè¯»é—®é¢˜ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘å…ˆæŠŠæ–‡ç« ä¸­æ¶‰åŠåˆ°çš„å¤„ç†è¿‡æœŸè¯»çš„æ–¹æ¡ˆæ±‡æ€»åœ¨è¿™é‡Œï¼Œä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’ŒæŒæ¡å…¨æ–‡çš„çŸ¥è¯†è„‰ç»œã€‚è¿™äº›æ–¹æ¡ˆåŒ…æ‹¬ï¼š</p><ul>
<li>å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆï¼›</li>
<li>sleepæ–¹æ¡ˆï¼›</li>
<li>åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆï¼›</li>
<li>é…åˆsemi-syncæ–¹æ¡ˆï¼›</li>
<li>ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼›</li>
<li>ç­‰GTIDæ–¹æ¡ˆã€‚</li>
</ul><h1>å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ</h1><p>å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆå…¶å®å°±æ˜¯ï¼Œå°†æŸ¥è¯¢è¯·æ±‚åšåˆ†ç±»ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸ¥è¯¢è¯·æ±‚åˆ†ä¸ºè¿™ä¹ˆä¸¤ç±»ï¼š</p><ol>
<li>
<p>å¯¹äºå¿…é¡»è¦æ‹¿åˆ°æœ€æ–°ç»“æœçš„è¯·æ±‚ï¼Œå¼ºåˆ¶å°†å…¶å‘åˆ°ä¸»åº“ä¸Šã€‚æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªäº¤æ˜“å¹³å°ä¸Šï¼Œå–å®¶å‘å¸ƒå•†å“ä»¥åï¼Œé©¬ä¸Šè¦è¿”å›ä¸»é¡µé¢ï¼Œçœ‹å•†å“æ˜¯å¦å‘å¸ƒæˆåŠŸã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªè¯·æ±‚éœ€è¦æ‹¿åˆ°æœ€æ–°çš„ç»“æœï¼Œå°±å¿…é¡»èµ°ä¸»åº“ã€‚</p>
</li>
<li>
<p>å¯¹äºå¯ä»¥è¯»åˆ°æ—§æ•°æ®çš„è¯·æ±‚ï¼Œæ‰å°†å…¶å‘åˆ°ä»åº“ä¸Šã€‚åœ¨è¿™ä¸ªäº¤æ˜“å¹³å°ä¸Šï¼Œä¹°å®¶æ¥é€›å•†é“ºé¡µé¢ï¼Œå°±ç®—æ™šå‡ ç§’çœ‹åˆ°æœ€æ–°å‘å¸ƒçš„å•†å“ï¼Œä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚é‚£ä¹ˆï¼Œè¿™ç±»è¯·æ±‚å°±å¯ä»¥èµ°ä»åº“ã€‚</p>
</li>
</ol><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯ä¸æ˜¯æœ‰ç‚¹ç•éš¾å’Œå–å·§çš„æ„æ€ï¼Œä½†å…¶å®è¿™ä¸ªæ–¹æ¡ˆæ˜¯ç”¨å¾—æœ€å¤šçš„ã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ€å¤§çš„é—®é¢˜åœ¨äºï¼Œæœ‰æ—¶å€™ä½ ä¼šç¢°åˆ°â€œæ‰€æœ‰æŸ¥è¯¢éƒ½ä¸èƒ½æ˜¯è¿‡æœŸè¯»â€çš„éœ€æ±‚ï¼Œæ¯”å¦‚ä¸€äº›é‡‘èç±»çš„ä¸šåŠ¡ã€‚è¿™æ ·çš„è¯ï¼Œä½ å°±è¦æ”¾å¼ƒè¯»å†™åˆ†ç¦»ï¼Œæ‰€æœ‰è¯»å†™å‹åŠ›éƒ½åœ¨ä¸»åº“ï¼Œç­‰åŒäºæ”¾å¼ƒäº†æ‰©å±•æ€§ã€‚</p><p>å› æ­¤æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è®¨è®ºçš„è¯é¢˜æ˜¯ï¼šå¯ä»¥æ”¯æŒè¯»å†™åˆ†ç¦»çš„åœºæ™¯ä¸‹ï¼Œæœ‰å“ªäº›è§£å†³è¿‡æœŸè¯»çš„æ–¹æ¡ˆï¼Œå¹¶åˆ†æå„ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€‚</p><h1>Sleep æ–¹æ¡ˆ</h1><p>ä¸»åº“æ›´æ–°åï¼Œè¯»ä»åº“ä¹‹å‰å…ˆsleepä¸€ä¸‹ã€‚å…·ä½“çš„æ–¹æ¡ˆå°±æ˜¯ï¼Œç±»ä¼¼äºæ‰§è¡Œä¸€æ¡select sleep(1)å‘½ä»¤ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆçš„å‡è®¾æ˜¯ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸»å¤‡å»¶è¿Ÿåœ¨1ç§’ä¹‹å†…ï¼Œåšä¸€ä¸ªsleepå¯ä»¥æœ‰å¾ˆå¤§æ¦‚ç‡æ‹¿åˆ°æœ€æ–°çš„æ•°æ®ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆç»™ä½ çš„ç¬¬ä¸€æ„Ÿè§‰ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸é è°±å„¿ï¼Œåº”è¯¥ä¸ä¼šæœ‰äººç”¨å§ï¼Ÿå¹¶ä¸”ï¼Œä½ è¿˜å¯èƒ½ä¼šè¯´ï¼Œç›´æ¥åœ¨å‘èµ·æŸ¥è¯¢æ—¶å…ˆæ‰§è¡Œä¸€æ¡sleepè¯­å¥ï¼Œç”¨æˆ·ä½“éªŒå¾ˆä¸å‹å¥½å•Šã€‚</p><p>ä½†ï¼Œè¿™ä¸ªæ€è·¯ç¡®å®å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³é—®é¢˜ã€‚ä¸ºäº†çœ‹èµ·æ¥æ›´é è°±å„¿ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ–¹å¼ã€‚</p><p>ä»¥å–å®¶å‘å¸ƒå•†å“ä¸ºä¾‹ï¼Œå•†å“å‘å¸ƒåï¼Œç”¨Ajaxï¼ˆAsynchronous JavaScript + XMLï¼Œå¼‚æ­¥JavaScriptå’ŒXMLï¼‰ç›´æ¥æŠŠå®¢æˆ·ç«¯è¾“å…¥çš„å†…å®¹ä½œä¸ºâ€œæ–°çš„å•†å“â€æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œè€Œä¸æ˜¯çœŸæ­£åœ°å»æ•°æ®åº“åšæŸ¥è¯¢ã€‚</p><p>è¿™æ ·ï¼Œå–å®¶å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ˜¾ç¤ºï¼Œæ¥ç¡®è®¤äº§å“å·²ç»å‘å¸ƒæˆåŠŸäº†ã€‚ç­‰åˆ°å–å®¶å†åˆ·æ–°é¡µé¢ï¼Œå»æŸ¥çœ‹å•†å“çš„æ—¶å€™ï¼Œå…¶å®å·²ç»è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±è¾¾åˆ°äº†sleepçš„ç›®çš„ï¼Œè¿›è€Œä¹Ÿå°±è§£å†³äº†è¿‡æœŸè¯»çš„é—®é¢˜ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªsleepæ–¹æ¡ˆç¡®å®è§£å†³äº†ç±»ä¼¼åœºæ™¯ä¸‹çš„è¿‡æœŸè¯»é—®é¢˜ã€‚ä½†ï¼Œä»ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨çš„é—®é¢˜å°±æ˜¯ä¸ç²¾ç¡®ã€‚è¿™ä¸ªä¸ç²¾ç¡®åŒ…å«äº†ä¸¤å±‚æ„æ€ï¼š</p><ol>
<li>
<p>å¦‚æœè¿™ä¸ªæŸ¥è¯¢è¯·æ±‚æœ¬æ¥0.5ç§’å°±å¯ä»¥åœ¨ä»åº“ä¸Šæ‹¿åˆ°æ­£ç¡®ç»“æœï¼Œä¹Ÿä¼šç­‰1ç§’ï¼›</p>
</li>
<li>
<p>å¦‚æœå»¶è¿Ÿè¶…è¿‡1ç§’ï¼Œè¿˜æ˜¯ä¼šå‡ºç°è¿‡æœŸè¯»ã€‚</p>
</li>
</ol><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ä¸€ç§â€œä½ æ˜¯ä¸æ˜¯åœ¨é€—æˆ‘â€çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªæ”¹è¿›æ–¹æ¡ˆè™½ç„¶å¯ä»¥è§£å†³ç±»ä¼¼Ajaxåœºæ™¯ä¸‹çš„è¿‡æœŸè¯»é—®é¢˜ï¼Œä½†è¿˜æ˜¯æ€ä¹ˆçœ‹éƒ½ä¸é è°±å„¿ã€‚åˆ«ç€æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘å°±å’Œä½ ä»‹ç»ä¸€äº›æ›´å‡†ç¡®çš„æ–¹æ¡ˆã€‚</p><h1>åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆ</h1><p>è¦ç¡®ä¿å¤‡åº“æ— å»¶è¿Ÿï¼Œé€šå¸¸æœ‰ä¸‰ç§åšæ³•ã€‚</p><p>é€šè¿‡å‰é¢çš„<a href="https://time.geekbang.org/column/article/76795">ç¬¬25ç¯‡</a>æ–‡ç« ï¼Œæˆ‘ä»¬çŸ¥é“show slave statusç»“æœé‡Œçš„seconds_behind_masterå‚æ•°çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥è¡¡é‡ä¸»å¤‡å»¶è¿Ÿæ—¶é—´çš„é•¿çŸ­ã€‚</p><p>æ‰€ä»¥<strong>ç¬¬ä¸€ç§ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ³•æ˜¯ï¼Œ</strong>æ¯æ¬¡ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚å‰ï¼Œå…ˆåˆ¤æ–­seconds_behind_masteræ˜¯å¦å·²ç»ç­‰äº0ã€‚å¦‚æœè¿˜ä¸ç­‰äº0 ï¼Œé‚£å°±å¿…é¡»ç­‰åˆ°è¿™ä¸ªå‚æ•°å˜ä¸º0æ‰èƒ½æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ã€‚</p><p>seconds_behind_masterçš„å•ä½æ˜¯ç§’ï¼Œå¦‚æœä½ è§‰å¾—ç²¾åº¦ä¸å¤Ÿçš„è¯ï¼Œè¿˜å¯ä»¥é‡‡ç”¨å¯¹æ¯”ä½ç‚¹å’ŒGTIDçš„æ–¹æ³•æ¥ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯´çš„ç¬¬äºŒå’Œç¬¬ä¸‰ç§æ–¹æ³•ã€‚</p><p>å¦‚å›¾3æ‰€ç¤ºï¼Œæ˜¯ä¸€ä¸ªshow slave statusç»“æœçš„éƒ¨åˆ†æˆªå›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/00/c1/00110923007513e865d7f43a124887c1.png" alt=""></p><center><span class="reference">å›¾3 show slave statusç»“æœ</span></center><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±é€šè¿‡è¿™ä¸ªç»“æœï¼Œæ¥çœ‹çœ‹å…·ä½“å¦‚ä½•é€šè¿‡å¯¹æ¯”ä½ç‚¹å’ŒGTIDæ¥ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿã€‚</p><p><strong>ç¬¬äºŒç§æ–¹æ³•ï¼Œ</strong>å¯¹æ¯”ä½ç‚¹ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿï¼š</p><ul>
<li>Master_Log_Fileå’ŒRead_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯è¯»åˆ°çš„ä¸»åº“çš„æœ€æ–°ä½ç‚¹ï¼›</li>
<li>Relay_Master_Log_Fileå’ŒExec_Master_Log_Posï¼Œè¡¨ç¤ºçš„æ˜¯å¤‡åº“æ‰§è¡Œçš„æœ€æ–°ä½ç‚¹ã€‚</li>
</ul><p>å¦‚æœMaster_Log_Fileå’ŒRelay_Master_Log_Fileã€Read_Master_Log_Poså’ŒExec_Master_Log_Posè¿™ä¸¤ç»„å€¼å®Œå…¨ç›¸åŒï¼Œå°±è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ—¥å¿—å·²ç»åŒæ­¥å®Œæˆã€‚</p><p><strong>ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œ</strong>å¯¹æ¯”GTIDé›†åˆç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿï¼š</p><ul>
<li>Auto_Position=1 ï¼Œè¡¨ç¤ºè¿™å¯¹ä¸»å¤‡å…³ç³»ä½¿ç”¨äº†GTIDåè®®ã€‚</li>
<li>Retrieved_Gtid_Setï¼Œæ˜¯å¤‡åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„GTIDé›†åˆï¼›</li>
<li>Executed_Gtid_Setï¼Œæ˜¯å¤‡åº“æ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆçš„GTIDé›†åˆã€‚</li>
</ul><p>å¦‚æœè¿™ä¸¤ä¸ªé›†åˆç›¸åŒï¼Œä¹Ÿè¡¨ç¤ºå¤‡åº“æ¥æ”¶åˆ°çš„æ—¥å¿—éƒ½å·²ç»åŒæ­¥å®Œæˆã€‚</p><p>å¯è§ï¼Œå¯¹æ¯”ä½ç‚¹å’Œå¯¹æ¯”GTIDè¿™ä¸¤ç§æ–¹æ³•ï¼Œéƒ½è¦æ¯”åˆ¤æ–­seconds_behind_masteræ˜¯å¦ä¸º0æ›´å‡†ç¡®ã€‚</p><p>åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­ä»åº“æ˜¯å¦åŒæ­¥å®Œæˆçš„æ–¹æ³•ï¼Œç›¸æ¯”äºsleepæ–¹æ¡ˆï¼Œå‡†ç¡®åº¦ç¡®å®æå‡äº†ä¸å°‘ï¼Œä½†è¿˜æ˜¯æ²¡æœ‰è¾¾åˆ°â€œç²¾ç¡®â€çš„ç¨‹åº¦ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç°åœ¨ä¸€èµ·æ¥å›é¡¾ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡çš„binlogåœ¨ä¸»å¤‡åº“ä¹‹é—´çš„çŠ¶æ€ï¼š</p><ol>
<li>
<p>ä¸»åº“æ‰§è¡Œå®Œæˆï¼Œå†™å…¥binlogï¼Œå¹¶åé¦ˆç»™å®¢æˆ·ç«¯ï¼›</p>
</li>
<li>
<p>binlogè¢«ä»ä¸»åº“å‘é€ç»™å¤‡åº“ï¼Œå¤‡åº“æ”¶åˆ°ï¼›</p>
</li>
<li>
<p>åœ¨å¤‡åº“æ‰§è¡Œbinlogå®Œæˆã€‚</p>
</li>
</ol><p>æˆ‘ä»¬ä¸Šé¢åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿçš„é€»è¾‘ï¼Œæ˜¯â€œå¤‡åº“æ”¶åˆ°çš„æ—¥å¿—éƒ½æ‰§è¡Œå®Œæˆäº†â€ã€‚ä½†æ˜¯ï¼Œä»binlogåœ¨ä¸»å¤‡ä¹‹é—´çŠ¶æ€çš„åˆ†æä¸­ï¼Œä¸éš¾çœ‹å‡ºè¿˜æœ‰ä¸€éƒ¨åˆ†æ—¥å¿—ï¼Œå¤„äºå®¢æˆ·ç«¯å·²ç»æ”¶åˆ°æäº¤ç¡®è®¤ï¼Œè€Œå¤‡åº“è¿˜æ²¡æ”¶åˆ°æ—¥å¿—çš„çŠ¶æ€ã€‚</p><p>å¦‚å›¾4æ‰€ç¤ºå°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªçŠ¶æ€ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/55/9e/557445207b57d6c0f2747509d7d6619e.png" alt=""></p><center><span class="reference">å›¾4 å¤‡åº“è¿˜æ²¡æ”¶åˆ°trx3</span></center><p>è¿™æ—¶ï¼Œä¸»åº“ä¸Šæ‰§è¡Œå®Œæˆäº†ä¸‰ä¸ªäº‹åŠ¡trx1ã€trx2å’Œtrx3ï¼Œå…¶ä¸­ï¼š</p><ol>
<li>
<p>trx1å’Œtrx2å·²ç»ä¼ åˆ°ä»åº“ï¼Œå¹¶ä¸”å·²ç»æ‰§è¡Œå®Œæˆäº†ï¼›</p>
</li>
<li>
<p>trx3åœ¨ä¸»åº“æ‰§è¡Œå®Œæˆï¼Œå¹¶ä¸”å·²ç»å›å¤ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ä¼ åˆ°ä»åº“ä¸­ã€‚</p>
</li>
</ol><p>å¦‚æœè¿™æ—¶å€™ä½ åœ¨ä»åº“Bä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„é€»è¾‘ï¼Œä»åº“è®¤ä¸ºå·²ç»æ²¡æœ‰åŒæ­¥å»¶è¿Ÿï¼Œä½†è¿˜æ˜¯æŸ¥ä¸åˆ°trx3çš„ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œå°±æ˜¯å‡ºç°äº†è¿‡æœŸè¯»ã€‚</p><p>é‚£ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜æœ‰æ²¡æœ‰åŠæ³•è§£å†³å‘¢ï¼Ÿ</p><h1>é…åˆsemi-sync</h1><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦å¼•å…¥åŠåŒæ­¥å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯semi-sync replicationã€‚</p><p>semi-syncåšäº†è¿™æ ·çš„è®¾è®¡ï¼š</p><ol>
<li>
<p>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¸»åº“æŠŠbinlogå‘ç»™ä»åº“ï¼›</p>
</li>
<li>
<p>ä»åº“æ”¶åˆ°binlogä»¥åï¼Œå‘å›ç»™ä¸»åº“ä¸€ä¸ªackï¼Œè¡¨ç¤ºæ”¶åˆ°äº†ï¼›</p>
</li>
<li>
<p>ä¸»åº“æ”¶åˆ°è¿™ä¸ªackä»¥åï¼Œæ‰èƒ½ç»™å®¢æˆ·ç«¯è¿”å›â€œäº‹åŠ¡å®Œæˆâ€çš„ç¡®è®¤ã€‚</p>
</li>
</ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå¯ç”¨äº†semi-syncï¼Œå°±è¡¨ç¤ºæ‰€æœ‰ç»™å®¢æˆ·ç«¯å‘é€è¿‡ç¡®è®¤çš„äº‹åŠ¡ï¼Œéƒ½ç¡®ä¿äº†å¤‡åº“å·²ç»æ”¶åˆ°äº†è¿™ä¸ªæ—¥å¿—ã€‚</p><p>åœ¨<a href="https://time.geekbang.org/column/article/76795">ç¬¬25ç¯‡æ–‡ç« </a>çš„è¯„è®ºåŒºï¼Œæœ‰åŒå­¦é—®åˆ°ï¼šå¦‚æœä¸»åº“æ‰ç”µçš„æ—¶å€™ï¼Œæœ‰äº›binlogè¿˜æ¥ä¸åŠå‘ç»™ä»åº“ï¼Œä¼šä¸ä¼šå¯¼è‡´ç³»ç»Ÿæ•°æ®ä¸¢å¤±ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æ™®é€šçš„å¼‚æ­¥å¤åˆ¶æ¨¡å¼ï¼Œå°±å¯èƒ½ä¼šä¸¢å¤±ï¼Œä½†semi-syncå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™æ ·ï¼Œsemi-syncé…åˆå‰é¢å…³äºä½ç‚¹çš„åˆ¤æ–­ï¼Œå°±èƒ½å¤Ÿç¡®å®šåœ¨ä»åº“ä¸Šæ‰§è¡Œçš„æŸ¥è¯¢è¯·æ±‚ï¼Œå¯ä»¥é¿å…è¿‡æœŸè¯»ã€‚</p><p>ä½†æ˜¯ï¼Œsemi-sync+ä½ç‚¹åˆ¤æ–­çš„æ–¹æ¡ˆï¼Œåªå¯¹ä¸€ä¸»ä¸€å¤‡çš„åœºæ™¯æ˜¯æˆç«‹çš„ã€‚åœ¨ä¸€ä¸»å¤šä»åœºæ™¯ä¸­ï¼Œä¸»åº“åªè¦ç­‰åˆ°ä¸€ä¸ªä»åº“çš„ackï¼Œå°±å¼€å§‹ç»™å®¢æˆ·ç«¯è¿”å›ç¡®è®¤ã€‚è¿™æ—¶ï¼Œåœ¨ä»åº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œå°±æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol>
<li>
<p>å¦‚æœæŸ¥è¯¢æ˜¯è½åœ¨è¿™ä¸ªå“åº”äº†ackçš„ä»åº“ä¸Šï¼Œæ˜¯èƒ½å¤Ÿç¡®ä¿è¯»åˆ°æœ€æ–°æ•°æ®ï¼›</p>
</li>
<li>
<p>ä½†å¦‚æœæ˜¯æŸ¥è¯¢è½åˆ°å…¶ä»–ä»åº“ä¸Šï¼Œå®ƒä»¬å¯èƒ½è¿˜æ²¡æœ‰æ”¶åˆ°æœ€æ–°çš„æ—¥å¿—ï¼Œå°±ä¼šäº§ç”Ÿè¿‡æœŸè¯»çš„é—®é¢˜ã€‚</p>
</li>
</ol><p>å…¶å®ï¼Œåˆ¤æ–­åŒæ­¥ä½ç‚¹çš„æ–¹æ¡ˆè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼Œå³ï¼šå¦‚æœåœ¨ä¸šåŠ¡æ›´æ–°çš„é«˜å³°æœŸï¼Œä¸»åº“çš„ä½ç‚¹æˆ–è€…GTIDé›†åˆæ›´æ–°å¾ˆå¿«ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä¸¤ä¸ªä½ç‚¹ç­‰å€¼åˆ¤æ–­å°±ä¼šä¸€ç›´ä¸æˆç«‹ï¼Œå¾ˆå¯èƒ½å‡ºç°ä»åº“ä¸Šè¿Ÿè¿Ÿæ— æ³•å“åº”æŸ¥è¯¢è¯·æ±‚çš„æƒ…å†µã€‚</p><p>å®é™…ä¸Šï¼Œå›åˆ°æˆ‘ä»¬æœ€åˆçš„ä¸šåŠ¡é€»è¾‘é‡Œï¼Œå½“å‘èµ·ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ä»¥åï¼Œæˆ‘ä»¬è¦å¾—åˆ°å‡†ç¡®çš„ç»“æœï¼Œå…¶å®å¹¶ä¸éœ€è¦ç­‰åˆ°â€œä¸»å¤‡å®Œå…¨åŒæ­¥â€ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ—¶åºå›¾ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/9c/09/9cf54f3e91dc8f7b8947d7d8e384aa09.png" alt=""></p><center><span class="reference">å›¾5 ä¸»å¤‡æŒç»­å»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡</span></center><p>å›¾5æ‰€ç¤ºï¼Œå°±æ˜¯ç­‰å¾…ä½ç‚¹æ–¹æ¡ˆçš„ä¸€ä¸ªbad caseã€‚å›¾ä¸­å¤‡åº“Bä¸‹çš„è™šçº¿æ¡†ï¼Œåˆ†åˆ«è¡¨ç¤ºrelaylogå’Œbinlogä¸­çš„äº‹åŠ¡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå›¾5ä¸­ä»çŠ¶æ€1 åˆ°çŠ¶æ€4ï¼Œä¸€ç›´å¤„äºå»¶è¿Ÿä¸€ä¸ªäº‹åŠ¡çš„çŠ¶æ€ã€‚</p><p>å¤‡åº“Bä¸€ç›´åˆ°çŠ¶æ€4éƒ½å’Œä¸»åº“Aå­˜åœ¨å»¶è¿Ÿï¼Œå¦‚æœç”¨ä¸Šé¢å¿…é¡»ç­‰åˆ°æ— å»¶è¿Ÿæ‰èƒ½æŸ¥è¯¢çš„æ–¹æ¡ˆï¼Œselectè¯­å¥ç›´åˆ°çŠ¶æ€4éƒ½ä¸èƒ½è¢«æ‰§è¡Œã€‚</p><p>ä½†æ˜¯ï¼Œå…¶å®å®¢æˆ·ç«¯æ˜¯åœ¨å‘å®Œtrx1æ›´æ–°åå‘èµ·çš„selectè¯­å¥ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿trx1å·²ç»æ‰§è¡Œå®Œæˆå°±å¯ä»¥æ‰§è¡Œselectè¯­å¥äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨çŠ¶æ€3æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œå¾—åˆ°çš„å°±æ˜¯é¢„æœŸç»“æœäº†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°ç»“ä¸€ä¸‹ï¼Œsemi-syncé…åˆåˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ¡ˆï¼Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol>
<li>
<p>ä¸€ä¸»å¤šä»çš„æ—¶å€™ï¼Œåœ¨æŸäº›ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ä¼šå­˜åœ¨è¿‡æœŸè¯»çš„ç°è±¡ï¼›</p>
</li>
<li>
<p>åœ¨æŒç»­å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ºç°è¿‡åº¦ç­‰å¾…çš„é—®é¢˜ã€‚</p>
</li>
</ol><p>æ¥ä¸‹æ¥ï¼Œæˆ‘è¦å’Œä½ ä»‹ç»çš„ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><h1>ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆ</h1><p>è¦ç†è§£ç­‰ä¸»åº“ä½ç‚¹æ–¹æ¡ˆï¼Œæˆ‘éœ€è¦å…ˆå’Œä½ ä»‹ç»ä¸€æ¡å‘½ä»¤ï¼š</p><pre><code>select master_pos_wait(file, pos[, timeout]);
</code></pre><p>è¿™æ¡å‘½ä»¤çš„é€»è¾‘å¦‚ä¸‹ï¼š</p><ol>
<li>
<p>å®ƒæ˜¯åœ¨ä»åº“æ‰§è¡Œçš„ï¼›</p>
</li>
<li>
<p>å‚æ•°fileå’ŒposæŒ‡çš„æ˜¯ä¸»åº“ä¸Šçš„æ–‡ä»¶åå’Œä½ç½®ï¼›</p>
</li>
<li>
<p>timeoutå¯é€‰ï¼Œè®¾ç½®ä¸ºæ­£æ•´æ•°Nè¡¨ç¤ºè¿™ä¸ªå‡½æ•°æœ€å¤šç­‰å¾…Nç§’ã€‚</p>
</li>
</ol><p>è¿™ä¸ªå‘½ä»¤æ­£å¸¸è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ­£æ•´æ•°Mï¼Œè¡¨ç¤ºä»å‘½ä»¤å¼€å§‹æ‰§è¡Œï¼Œåˆ°åº”ç”¨å®Œfileå’Œposè¡¨ç¤ºçš„binlogä½ç½®ï¼Œæ‰§è¡Œäº†å¤šå°‘äº‹åŠ¡ã€‚</p><p>å½“ç„¶ï¼Œé™¤äº†æ­£å¸¸è¿”å›ä¸€ä¸ªæ­£æ•´æ•°Må¤–ï¼Œè¿™æ¡å‘½ä»¤è¿˜ä¼šè¿”å›ä¸€äº›å…¶ä»–ç»“æœï¼ŒåŒ…æ‹¬ï¼š</p><ol>
<li>
<p>å¦‚æœæ‰§è¡ŒæœŸé—´ï¼Œå¤‡åº“åŒæ­¥çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è¿”å›NULLï¼›</p>
</li>
<li>
<p>å¦‚æœç­‰å¾…è¶…è¿‡Nç§’ï¼Œå°±è¿”å›-1ï¼›</p>
</li>
<li>
<p>å¦‚æœåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å‘ç°å·²ç»æ‰§è¡Œè¿‡è¿™ä¸ªä½ç½®äº†ï¼Œåˆ™è¿”å›0ã€‚</p>
</li>
</ol><p>å¯¹äºå›¾5ä¸­å…ˆæ‰§è¡Œtrx1ï¼Œå†æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚çš„é€»è¾‘ï¼Œè¦ä¿è¯èƒ½å¤ŸæŸ¥åˆ°æ­£ç¡®çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€»è¾‘ï¼š</p><ol>
<li>
<p>trx1äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œé©¬ä¸Šæ‰§è¡Œshow master statuså¾—åˆ°å½“å‰ä¸»åº“æ‰§è¡Œåˆ°çš„Fileå’ŒPositionï¼›</p>
</li>
<li>
<p>é€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</p>
</li>
<li>
<p>åœ¨ä»åº“ä¸Šæ‰§è¡Œselect master_pos_wait(File, Position, 1)ï¼›</p>
</li>
<li>
<p>å¦‚æœè¿”å›å€¼æ˜¯&gt;=0çš„æ­£æ•´æ•°ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</p>
</li>
<li>
<p>å¦åˆ™ï¼Œåˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ã€‚</p>
</li>
</ol><p>æˆ‘æŠŠä¸Šé¢è¿™ä¸ªæµç¨‹ç”»å‡ºæ¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/b2/57/b20ae91ea46803df1b63ed683e1de357.png" alt=""></p><center><span class="reference">å›¾6 master_pos_waitæ–¹æ¡ˆ</span></center><p>è¿™é‡Œæˆ‘ä»¬å‡è®¾ï¼Œè¿™æ¡selectæŸ¥è¯¢æœ€å¤šåœ¨ä»åº“ä¸Šç­‰å¾…1ç§’ã€‚é‚£ä¹ˆï¼Œå¦‚æœ1ç§’å†…master_pos_waitè¿”å›ä¸€ä¸ªå¤§äºç­‰äº0çš„æ•´æ•°ï¼Œå°±ç¡®ä¿äº†ä»åº“ä¸Šæ‰§è¡Œçš„è¿™ä¸ªæŸ¥è¯¢ç»“æœä¸€å®šåŒ…å«äº†trx1çš„æ•°æ®ã€‚</p><p>æ­¥éª¤5åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œæ˜¯è¿™ç±»æ–¹æ¡ˆå¸¸ç”¨çš„é€€åŒ–æœºåˆ¶ã€‚å› ä¸ºä»åº“çš„å»¶è¿Ÿæ—¶é—´ä¸å¯æ§ï¼Œä¸èƒ½æ— é™ç­‰å¾…ï¼Œæ‰€ä»¥å¦‚æœç­‰å¾…è¶…æ—¶ï¼Œå°±åº”è¯¥æ”¾å¼ƒï¼Œç„¶ååˆ°ä¸»åº“å»æŸ¥ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå¦‚æœæ‰€æœ‰çš„ä»åº“éƒ½å»¶è¿Ÿè¶…è¿‡1ç§’äº†ï¼Œé‚£æŸ¥è¯¢å‹åŠ›ä¸å°±éƒ½è·‘åˆ°ä¸»åº“ä¸Šäº†å—ï¼Ÿç¡®å®æ˜¯è¿™æ ·ã€‚</p><p>ä½†æ˜¯ï¼ŒæŒ‰ç…§æˆ‘ä»¬è®¾å®šä¸å…è®¸è¿‡æœŸè¯»çš„è¦æ±‚ï¼Œå°±åªæœ‰ä¸¤ç§é€‰æ‹©ï¼Œä¸€ç§æ˜¯è¶…æ—¶æ”¾å¼ƒï¼Œä¸€ç§æ˜¯è½¬åˆ°ä¸»åº“æŸ¥è¯¢ã€‚å…·ä½“æ€ä¹ˆé€‰æ‹©ï¼Œå°±éœ€è¦ä¸šåŠ¡å¼€å‘åŒå­¦åšå¥½é™æµç­–ç•¥äº†ã€‚</p><h1>GTIDæ–¹æ¡ˆ</h1><p>å¦‚æœä½ çš„æ•°æ®åº“å¼€å¯äº†GTIDæ¨¡å¼ï¼Œå¯¹åº”çš„ä¹Ÿæœ‰ç­‰å¾…GTIDçš„æ–¹æ¡ˆã€‚</p><p>MySQLä¸­åŒæ ·æä¾›äº†ä¸€ä¸ªç±»ä¼¼çš„å‘½ä»¤ï¼š</p><pre><code> select wait_for_executed_gtid_set(gtid_set, 1);
</code></pre><p>è¿™æ¡å‘½ä»¤çš„é€»è¾‘æ˜¯ï¼š</p><ol>
<li>
<p>ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸ªåº“æ‰§è¡Œçš„äº‹åŠ¡ä¸­åŒ…å«ä¼ å…¥çš„gtid_setï¼Œè¿”å›0ï¼›</p>
</li>
<li>
<p>è¶…æ—¶è¿”å›1ã€‚</p>
</li>
</ol><p>åœ¨å‰é¢ç­‰ä½ç‚¹çš„æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œå®Œäº‹åŠ¡åï¼Œè¿˜è¦ä¸»åŠ¨å»ä¸»åº“æ‰§è¡Œshow master statusã€‚è€ŒMySQL 5.7.6ç‰ˆæœ¬å¼€å§‹ï¼Œå…è®¸åœ¨æ‰§è¡Œå®Œæ›´æ–°ç±»äº‹åŠ¡åï¼ŒæŠŠè¿™ä¸ªäº‹åŠ¡çš„GTIDè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·ç­‰GTIDçš„æ–¹æ¡ˆå°±å¯ä»¥å‡å°‘ä¸€æ¬¡æŸ¥è¯¢ã€‚</p><p>è¿™æ—¶ï¼Œç­‰GTIDçš„æ‰§è¡Œæµç¨‹å°±å˜æˆäº†ï¼š</p><ol>
<li>
<p>trx1äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œä»è¿”å›åŒ…ç›´æ¥è·å–è¿™ä¸ªäº‹åŠ¡çš„GTIDï¼Œè®°ä¸ºgtid1ï¼›</p>
</li>
<li>
<p>é€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</p>
</li>
<li>
<p>åœ¨ä»åº“ä¸Šæ‰§è¡Œ select wait_for_executed_gtid_set(gtid1, 1)ï¼›</p>
</li>
<li>
<p>å¦‚æœè¿”å›å€¼æ˜¯0ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼›</p>
</li>
<li>
<p>å¦åˆ™ï¼Œåˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ã€‚</p>
</li>
</ol><p>è·Ÿç­‰ä¸»åº“ä½ç‚¹çš„æ–¹æ¡ˆä¸€æ ·ï¼Œç­‰å¾…è¶…æ—¶åæ˜¯å¦ç›´æ¥åˆ°ä¸»åº“æŸ¥è¯¢ï¼Œéœ€è¦ä¸šåŠ¡å¼€å‘åŒå­¦æ¥åšé™æµè€ƒè™‘ã€‚</p><p>æˆ‘æŠŠè¿™ä¸ªæµç¨‹å›¾ç”»å‡ºæ¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/d5/39/d521de8017297aff59db2f68170ee739.png" alt=""></p><center><span class="reference">å›¾7 wait_for_executed_gtid_setæ–¹æ¡ˆ</span></center><p>åœ¨ä¸Šé¢çš„ç¬¬ä¸€æ­¥ä¸­ï¼Œtrx1äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œä»è¿”å›åŒ…ç›´æ¥è·å–è¿™ä¸ªäº‹åŠ¡çš„GTIDã€‚é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆèƒ½å¤Ÿè®©MySQLåœ¨æ‰§è¡Œäº‹åŠ¡åï¼Œè¿”å›åŒ…ä¸­å¸¦ä¸ŠGTIDå‘¢ï¼Ÿ</p><p>ä½ åªéœ€è¦å°†å‚æ•°session_track_gtidsè®¾ç½®ä¸ºOWN_GTIDï¼Œç„¶åé€šè¿‡APIæ¥å£mysql_session_track_get_firstä»è¿”å›åŒ…è§£æå‡ºGTIDçš„å€¼å³å¯ã€‚</p><p>åœ¨ä¸“æ çš„<a href="https://time.geekbang.org/column/article/68319">ç¬¬ä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»‹ç»mysql_reset_connectionçš„æ—¶å€™ï¼Œè¯„è®ºåŒºæœ‰åŒå­¦ç•™è¨€é—®è¿™ç±»æ¥å£åº”è¯¥æ€ä¹ˆä½¿ç”¨ã€‚</p><p>è¿™é‡Œæˆ‘å†å›ç­”ä¸€ä¸‹ã€‚å…¶å®ï¼ŒMySQLå¹¶æ²¡æœ‰æä¾›è¿™ç±»æ¥å£çš„SQLç”¨æ³•ï¼Œæ˜¯æä¾›ç»™ç¨‹åºçš„API(<a href="https://dev.mysql.com/doc/refman/5.7/en/c-api-functions.html">https://dev.mysql.com/doc/refman/5.7/en/c-api-functions.html</a>)ã€‚</p><p>æ¯”å¦‚ï¼Œä¸ºäº†è®©å®¢æˆ·ç«¯åœ¨äº‹åŠ¡æäº¤åï¼Œè¿”å›çš„GITDèƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºå‡ºæ¥ï¼Œæˆ‘å¯¹MySQLå®¢æˆ·ç«¯ä»£ç åšäº†ç‚¹ä¿®æ”¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/97/63/973bdd8741f830acebe005cbf37a7663.png" alt=""></p><center><span class="reference">å›¾8 æ˜¾ç¤ºæ›´æ–°äº‹åŠ¡çš„GTID--ä»£ç </span></center><p>è¿™æ ·ï¼Œå°±å¯ä»¥çœ‹åˆ°è¯­å¥æ‰§è¡Œå®Œæˆï¼Œæ˜¾ç¤ºå‡ºGITDçš„å€¼ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/25/fe/253106d31d9d97aaa2846b2015f593fe.png" alt=""></p><center><span class="reference">å›¾9 æ˜¾ç¤ºæ›´æ–°äº‹åŠ¡çš„GTID--æ•ˆæœ</span></center><p>å½“ç„¶äº†ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚ä½ è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆçš„æ—¶å€™ï¼Œè¿˜æ˜¯åº”è¯¥åœ¨ä½ çš„å®¢æˆ·ç«¯ä»£ç ä¸­è°ƒç”¨mysql_session_track_get_firstè¿™ä¸ªå‡½æ•°ã€‚</p><h1>å°ç»“</h1><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è·Ÿä½ ä»‹ç»äº†ä¸€ä¸»å¤šä»åšè¯»å†™åˆ†ç¦»æ—¶ï¼Œå¯èƒ½ç¢°åˆ°è¿‡æœŸè¯»çš„åŸå› ï¼Œä»¥åŠå‡ ç§åº”å¯¹çš„æ–¹æ¡ˆã€‚</p><p>è¿™å‡ ç§æ–¹æ¡ˆä¸­ï¼Œæœ‰çš„æ–¹æ¡ˆçœ‹ä¸Šå»æ˜¯åšäº†å¦¥åï¼Œæœ‰çš„æ–¹æ¡ˆçœ‹ä¸Šå»ä¸é‚£ä¹ˆé è°±å„¿ï¼Œä½†éƒ½æ˜¯æœ‰å®é™…åº”ç”¨åœºæ™¯çš„ï¼Œä½ éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©ã€‚</p><p>å³ä½¿æ˜¯æœ€åç­‰å¾…ä½ç‚¹å’Œç­‰å¾…GTIDè¿™ä¸¤ä¸ªæ–¹æ¡ˆï¼Œè™½ç„¶çœ‹ä¸Šå»æ¯”è¾ƒé è°±å„¿ï¼Œä½†ä»ç„¶å­˜åœ¨éœ€è¦æƒè¡¡çš„æƒ…å†µã€‚å¦‚æœæ‰€æœ‰çš„ä»åº“éƒ½å»¶è¿Ÿï¼Œé‚£ä¹ˆè¯·æ±‚å°±ä¼šå…¨éƒ¨è½åˆ°ä¸»åº“ä¸Šï¼Œè¿™æ—¶å€™ä¼šä¸ä¼šç”±äºå‹åŠ›çªç„¶å¢å¤§ï¼ŒæŠŠä¸»åº“æ‰“æŒ‚äº†å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™å‡ ä¸ªæ–¹æ¡ˆæ˜¯å¯ä»¥æ··åˆä½¿ç”¨çš„ã€‚</p><p>æ¯”å¦‚ï¼Œå…ˆåœ¨å®¢æˆ·ç«¯å¯¹è¯·æ±‚åšåˆ†ç±»ï¼ŒåŒºåˆ†å“ªäº›è¯·æ±‚å¯ä»¥æ¥å—è¿‡æœŸè¯»ï¼Œè€Œå“ªäº›è¯·æ±‚å®Œå…¨ä¸èƒ½æ¥å—è¿‡æœŸè¯»ï¼›ç„¶åï¼Œå¯¹äºä¸èƒ½æ¥å—è¿‡æœŸè¯»çš„è¯­å¥ï¼Œå†ä½¿ç”¨ç­‰GTIDæˆ–ç­‰ä½ç‚¹çš„æ–¹æ¡ˆã€‚</p><p>ä½†è¯è¯´å›æ¥ï¼Œè¿‡æœŸè¯»åœ¨æœ¬è´¨ä¸Šæ˜¯ç”±ä¸€å†™å¤šè¯»å¯¼è‡´çš„ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šæœ‰åˆ«çš„ä¸éœ€è¦ç­‰å¾…å°±å¯ä»¥æ°´å¹³æ‰©å±•çš„æ•°æ®åº“æ–¹æ¡ˆï¼Œä½†è¿™å¾€å¾€æ˜¯ç”¨ç‰ºç‰²å†™æ€§èƒ½æ¢æ¥çš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦åœ¨è¯»æ€§èƒ½å’Œå†™æ€§èƒ½ä¸­å–æƒè¡¡ã€‚</p><p>æœ€å ï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>å‡è®¾ä½ çš„ç³»ç»Ÿé‡‡ç”¨äº†æˆ‘ä»¬æ–‡ä¸­ä»‹ç»çš„æœ€åä¸€ä¸ªæ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯ç­‰GTIDçš„æ–¹æ¡ˆï¼Œç°åœ¨ä½ è¦å¯¹ä¸»åº“çš„ä¸€å¼ å¤§è¡¨åšDDLï¼Œå¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„åˆ†æå’Œæ–¹æ¡ˆè®¾è®¡å†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸç»™ä½ ç•™çš„é—®é¢˜æ˜¯ï¼Œåœ¨GTIDæ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªæ–°çš„ä»åº“æ¥ä¸Šä¸»åº“ï¼Œä½†æ˜¯éœ€è¦çš„binlogå·²ç»æ²¡äº†ï¼Œè¦æ€ä¹ˆåšï¼Ÿ</p><p>@æŸã€äººåŒå­¦ç»™äº†å¾ˆè¯¦ç»†çš„åˆ†æï¼Œæˆ‘æŠŠä»–çš„å›ç­”ç•¥åšä¿®æ”¹è´´è¿‡æ¥ã€‚</p><ol>
<li>
<p>å¦‚æœä¸šåŠ¡å…è®¸ä¸»ä»ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä¸»åº“ä¸Šå…ˆæ‰§è¡Œshow global variables like â€˜gtid_purgedâ€™ï¼Œå¾—åˆ°ä¸»åº“å·²ç»åˆ é™¤çš„GTIDé›†åˆï¼Œå‡è®¾æ˜¯gtid_purged1ï¼›ç„¶åå…ˆåœ¨ä»åº“ä¸Šæ‰§è¡Œreset masterï¼Œå†æ‰§è¡Œset global gtid_purged =â€˜gtid_purged1â€™ï¼›æœ€åæ‰§è¡Œstart slaveï¼Œå°±ä¼šä»ä¸»åº“ç°å­˜çš„binlogå¼€å§‹åŒæ­¥ã€‚binlogç¼ºå¤±çš„é‚£ä¸€éƒ¨åˆ†ï¼Œæ•°æ®åœ¨ä»åº“ä¸Šå°±å¯èƒ½ä¼šæœ‰ä¸¢å¤±ï¼Œé€ æˆä¸»ä»ä¸ä¸€è‡´ã€‚</p>
</li>
<li>
<p>å¦‚æœéœ€è¦ä¸»ä»æ•°æ®ä¸€è‡´çš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯é€šè¿‡é‡æ–°æ­å»ºä»åº“æ¥åšã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰å…¶ä»–çš„ä»åº“ä¿ç•™æœ‰å…¨é‡çš„binlogçš„è¯ï¼Œå¯ä»¥æŠŠæ–°çš„ä»åº“å…ˆæ¥åˆ°è¿™ä¸ªä¿ç•™äº†å…¨é‡binlogçš„ä»åº“ï¼Œè¿½ä¸Šæ—¥å¿—ä»¥åï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œå†æ¥å›ä¸»åº“ã€‚</p>
</li>
<li>
<p>å¦‚æœbinlogæœ‰å¤‡ä»½çš„æƒ…å†µï¼Œå¯ä»¥å…ˆåœ¨ä»åº“ä¸Šåº”ç”¨ç¼ºå¤±çš„binlogï¼Œç„¶åå†æ‰§è¡Œstart slaveã€‚</p>
</li>
</ol><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@æ‚Ÿç©º åŒå­¦çº§è”å®éªŒï¼ŒéªŒè¯äº†seconds_behind_masterçš„è®¡ç®—é€»è¾‘ã€‚</p>
</blockquote><blockquote>
<p>@_CountingStars é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼šMySQLæ˜¯æ€ä¹ˆå¿«é€Ÿå®šä½binlogé‡Œé¢çš„æŸä¸€ä¸ªGTIDä½ç½®çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œåœ¨binlogæ–‡ä»¶å¤´éƒ¨çš„Previous_gtidså¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
</blockquote><blockquote>
<p>@ç‹æœ‹é£ åŒå­¦é—®äº†ä¸€ä¸ªå¥½é—®é¢˜ï¼Œsql_slave_skip_counterè·³è¿‡çš„æ˜¯ä¸€ä¸ªeventï¼Œç”±äºMySQLæ€»ä¸èƒ½æ‰§è¡Œä¸€åŠçš„äº‹åŠ¡ï¼Œæ‰€ä»¥æ—¢ç„¶è·³è¿‡äº†ä¸€ä¸ªeventï¼Œå°±ä¼šè·³åˆ°è¿™ä¸ªäº‹åŠ¡çš„æœ«å°¾ï¼Œå› æ­¤set global sql_slave_skip_counter=1;start slaveæ˜¯å¯ä»¥è·³è¿‡æ•´ä¸ªäº‹åŠ¡çš„ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/09/77/09c1073f99cf71d2fb162a716b5fa577.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æœ‰é“­</span>
                            </div>
                            <div class="bd">è¿™ä¸“æ çœŸçš„æ˜¯å¹²è´§æ»¡æ»¡ï¼Œæ¯çœ‹ä¸€ç¯‡æˆ‘éƒ½æœ‰â€œæˆ‘å‘ç°æˆ‘çœŸçš„ä¸ä¼šä½¿ç”¨MySQLâ€å’Œâ€œæˆ‘åŸæ¥æŠŠMySQLç”¨é”™äº†â€çš„æŒ«è´¥æ„Ÿ <br></div>
                            <span class="time">2019-01-16 14:23</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">è¿™æ ·æˆ‘è§‰å¾—ä½ å’Œæˆ‘çš„æ—¶é—´éƒ½å€¼äº†ğŸ˜†<br><br>æŠŠä½ æ›´æ–°äº†è®¤è¯†çš„ç‚¹å‘åˆ°è¯„è®ºåŒºï¼Œè¿™æ ·ä¼šå°è±¡æ›´æ·±å“ˆğŸ¤<br></p>
                                <p class="reply-time">2019-01-16 15:04</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">è€å¸ˆæˆ‘å…ˆè¯·æ•™ä¸¤ä¸ªé—®é¢˜(ä¼°è®¡å¤§å¤šæ•°åŒå­¦éƒ½æœ‰è¿™ä¸ªç–‘æƒ‘)ğŸ˜„:<br>1.ç°åœ¨çš„ä¸­é—´ä»¶å¯ä»¥è¯´æ˜¯ä¹±èŠ±æ¸æ¬²è¿·äººçœ¼,è¯·é—®è€å¸ˆå“ªä¸€æ¬¾ä¸­é—´ä»¶é€‚åˆå¤§å¤šæ•°ä¸åˆ†åº“åˆ†è¡¨,åªæ˜¯åšè¯»å†™åˆ†ç¦»ä¸šåŠ¡çš„proxy,èƒ½æ¨èä¸€æ¬¾å˜›?æ¯•ç«Ÿå¤§å¤šæ•°å…¬å¸éƒ½æ²¡æœ‰ä¸“é—¨åšä¸­é—´ä»¶å¼€å‘çš„å›¢é˜Ÿ<br>2.å¦‚æœæ˜¯ä¸šåŠ¡ä¸Šè¿›è¡Œäº†åˆ†åº“åˆ†è¡¨,è€å¸ˆèƒ½æ¨èä¸€æ¬¾åˆ†åº“åˆ†è¡¨çš„proxyå˜›ï¼Ÿæˆ‘ç›®å‰äº†è§£åˆ°çš„é’ˆå¯¹åˆ†åº“åˆ†è¡¨çš„proxyéƒ½æˆ–å¤šæˆ–å°‘æœ‰äº›é—®é¢˜ã€‚ä¸è¿‡åˆ†å¸ƒå¼æ•°æ®åº“æ˜¯ä¸€ä¸ªè¶‹åŠ¿ä¹Ÿæ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚ <br></div>
                            <span class="time">2019-01-16 23:12</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é¢ï¼Œè¿™ä¸ªæœ€éš¾å›ç­”äº†<br><br>è¯´å®è¯å› ä¸ºæˆ‘åŸæ¥å›¢é˜Ÿæ˜¯å›¢é˜Ÿè‡ªå·±åšçš„proxyï¼ˆæ²¡æœ‰å¼€æºï¼‰ï¼Œæ‰€ä»¥æˆ‘å¯¹å…¶ä»–proxyç”¨å¾—å¹¶ä¸å¤šï¼Œå®åœ¨ä¸æ•¢éšä¾¿æŒ‡ä¸€ä¸ªã€‚<br><br>å¦‚æœæˆ‘è¯´ä¸ªæ¯”è¾ƒç†Ÿæ‚‰çš„è¯ï¼Œå¯èƒ½MariaDB MaxScaleè¿˜ä¸é”™</p>
                                <p class="reply-time">2019-01-17 01:18</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e9/5a/a6f2ec4b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ›¾å‰‘</span>
                            </div>
                            <div class="bd">è€å¸ˆå†™çš„æ¯ä¸€ç¯‡æ–‡ç« éƒ½èƒ½è®©æˆ‘è·ç›Šè‰¯å¤šã€‚æ¯ä¸€ç¯‡éƒ½å€¼å¾—çœ‹å¥½å‡ éã€‚<br>ä»Šå¤©çš„é—®é¢˜ï¼Œå¤§è¡¨åšDDLçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°ä¸»ä»å»¶è¿Ÿï¼Œå¯¼è‡´ç­‰ GTID çš„æ–¹æ¡ˆå¯èƒ½ä¼šå¯¼è‡´è¿™éƒ¨åˆ†æµé‡å…¨æ‰“åˆ°ä¸»åº“ï¼Œæˆ–è€…å…¨éƒ¨è¶…æ—¶ã€‚<br>å¦‚æœè¿™éƒ¨åˆ†æµé‡å¤ªå¤§çš„è¯ï¼Œæˆ‘ä¼šé€‰æ‹©ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ä¸¤ç§æ–¹æ³•ï¼š<br>1.åœ¨å„ä¸ªä»åº“å…ˆSET sql_log_bin = OFFï¼Œç„¶ååšDDLï¼Œæ‰€æœ‰ä»åº“åŠå¤‡ä¸»å…¨åšå®Œä¹‹åï¼Œåšä¸»ä»åˆ‡æ¢ï¼Œæœ€ååœ¨åŸæ¥çš„ä¸»åº“ç”¨åŒæ ·çš„æ–¹å¼åšDDLã€‚<br>2.ä»åº“ä¸Šæ‰§è¡ŒDDLï¼›å°†ä»åº“ä¸Šæ‰§è¡ŒDDLäº§ç”Ÿçš„GTIDåœ¨ä¸»åº“ä¸Šåˆ©ç”¨ç”Ÿæˆä¸€ä¸ªç©ºäº‹åŠ¡GTIDçš„æ–¹å¼å°†è¿™ä¸ªGTIDåœ¨ä¸»åº“ä¸Šç”Ÿæˆå‡ºæ¥ã€‚<br>å„ä¸ªä»åº“åšå®Œä¹‹åå†ä¸»ä»åˆ‡æ¢ï¼Œç„¶åå†åœ¨åŸæ¥çš„ä¸»åº“ä¸ŠåŒæ ·åšä¸€æ¬¡ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæœ‰MMæ¶æ„çš„æƒ…å†µä¸‹ï¼Œæ‰¿æ‹…å†™èŒè´£çš„ä¸»åº“ä¸Šçš„slaveéœ€è¦å…ˆåœæ‰ã€‚ <br></div>
                            <span class="time">2019-01-16 10:08</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ è¡¨ç¤ºè¿™ä¸¤ç¯‡æ–‡ç« ä½ éƒ½getåˆ°äº†</p>
                                <p class="reply-time">2019-01-16 11:50</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">äºŒé©¬</span>
                            </div>
                            <div class="bd">æœ€è¿‘åšæ€§èƒ½æµ‹è¯•æ—¶å‘ç°å½“å¹¶å‘ç”¨æˆ·è¾¾åˆ°ä¸€å®šé‡(æ¯”å¦‚500)ï¼Œéƒ¨åˆ†ç”¨æˆ·è¿æ¥ä¸ä¸Šï¼Œèƒ½å¦ä»‹ç»ä¸‹MySQLè¿æ¥ç›¸å…³é—®é¢˜ï¼Œè°¢è°¢ï¼ <br></div>
                            <span class="time">2019-01-16 07:31</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¿®æ”¹max_connectionså‚æ•°</p>
                                <p class="reply-time">2019-01-16 10:17</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLkhgYnYZBdhdwKnXQibey04cy9N9ria3DadH7iagoKukaWK1FJwjfCoh0He4p7b2icSYVzHH71l8ZXiaQ/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">çŒªå“¥å“¥</span>
                            </div>
                            <div class="bd">è€å¸ˆ, ä½ çœŸæ£’, æˆ‘å…¬å¸çš„ç”Ÿäº§ç¯å¢ƒè§£å†³è¿‡æœŸè¯»ä½¿ç”¨çš„å°±æ˜¯å¼ºåˆ¶èµ°ä¸»åº“æ–¹æ¡ˆ, çœ‹äº†è¿™ç¯‡æ–‡ç« , å›°æƒ‘äº†å¾ˆä¹…çš„é—®é¢˜è¿åˆƒè€Œè§£ï¼å¾ˆæ„Ÿè°¢! <br></div>
                            <span class="time">2019-01-17 11:08</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e7/dd/e68f9cf5.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ˜“ç¿”</span>
                            </div>
                            <div class="bd">ä¸ºè€å¸ˆä¸€å¥ä½ çš„æ—¶é—´å’Œæˆ‘çš„æ—¶é—´éƒ½å€¼äº†ã€‚ç‚¹èµ <br></div>
                            <span class="time">2019-01-16 21:53</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Mr.Strive.Z.H.L</span>
                            </div>
                            <div class="bd">è€å¸ˆæ‚¨å¥½ï¼š<br>å…³äºä¸»åº“å¤§è¡¨çš„DDLæ“ä½œï¼Œæˆ‘çœ‹äº†é—®é¢˜ç­”æ¡ˆï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆã€‚ç¬¬ä¸€ç§æ˜¯è¯»å†™è¯·æ±‚è½¬åˆ°ä¸»åº“ï¼Œåœ¨ä¸»åº“ä¸ŠåšDDLã€‚ç¬¬äºŒç§æ˜¯ä»åº“ä¸ŠåšDDLï¼Œå®Œæˆåè¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚<br><br>å…³äºç¬¬äºŒç§ï¼Œæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼š<br>ä»åº“ä¸ŠåšDDLï¼Œè¯»å†™è¯·æ±‚èµ°ä¸»åº“ï¼Œç­‰åˆ°ä»åº“å®Œæˆåï¼Œä»åº“å¿…é¡»è¦åŒæ­¥DDLæœŸé—´ï¼Œä¸»åº“å®Œæˆçš„äº‹åŠ¡åæ‰èƒ½è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚è€Œå¦‚æœDDLæ“ä½œæ˜¯åˆ é™¤ä¸€åˆ—ï¼Œé‚£ä¹ˆåœ¨åŒæ­¥è¿‡ç¨‹ä¸­ä¼šå‡ºé”™å‘€ï¼Ÿï¼ˆæ¯”å¦‚æŠ›å‡ºè¿™ä¸€åˆ—ä¸å­˜åœ¨çš„é”™è¯¯ï¼‰ã€‚ <br></div>
                            <span class="time">2019-01-21 11:25</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">black_mirror</span>
                            </div>
                            <div class="bd">æ—è€å¸ˆ æ‚¨å¥½<br>1.mysql_session_track_get_fitstè¿™ä¸ªå‡½æ•°ï¼Œä»githubä¸‹è½½mysqlæºç åæ€ä¹ˆå°è¯•ç®€å•ç¼–è¯‘ï¼Œå¦‚å›¾8ï¼Ÿ<br>2. mysql_session_track_get_fitstè¿™ä¸ªå‡½æ•°è²Œä¼¼ä¸æ”¯æŒpythonè¯­è¨€ï¼Œæˆ‘æƒ³æ¨¡æ‹Ÿæ–‡ä¸­ç­‰gtidæ–¹æ³•ï¼Œä¸ä¼šjavaæ€ä¹ˆåŠï¼Ÿ <br></div>
                            <span class="time">2019-01-21 10:03</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">black_mirror</span>
                            </div>
                            <div class="bd">æ—è€å¸ˆ æ‚¨å¥½<br>è¯·é—®mysql_session_track_get_fitstè¿™ä¸ªå‡½æ•°æŸ¥è¯¢äº†å®˜æ–¹èµ„æ–™éƒ½éœ€è¦å¯ä»¥ä¿®æ”¹æºç <br>1.åœ¨ä¸æ‡‚c++æƒ…å†µä¸‹ï¼Œgithubä¸Šä¸‹è½½æºç åæ€ä¹ˆå°è¯•ç®€å•ç¼–è¯‘ä½¿ç”¨ï¼Œå¦‚å›¾8ä»£ç <br>2. mysql_session_track_get_fitstå‡½æ•°è²Œä¼¼æ²¡æœ‰pythonè¯­è¨€apiï¼Œä¸ä¼šjavaï¼Œæƒ³åœ¨ä»£ç å±‚é¢æ¨¡æ‹Ÿæ•´ä¸ªè¿‡ç¨‹ï¼Œè¿˜æœ‰æœ¨æœ‰è§£å†³æ–¹æ³•ï¼Ÿ <br></div>
                            <span class="time">2019-01-21 09:59</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸çŸ¥é“pythonæ˜¯ä¸æ˜¯æœ‰æ–¹æ³•å¯ä»¥æŠŠcä»£ç ä½œä¸ºæ‰©å±•æ¨¡å—ğŸ˜…</p>
                                <p class="reply-time">2019-01-21 10:25</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/14/4c/c8/bed1e08a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è¾£æ¤’</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œmysql_session_track_get_firstæ˜¯cçš„ï¼Œæœ‰æ²¡æœ‰javaçš„ï¼Ÿ <br></div>
                            <span class="time">2019-01-18 16:58</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é¢ï¼Œè¿™ä¸ªæˆ‘è¿˜çœŸä¸çŸ¥é“ğŸ˜…ï¼ŒæŠ±æ­‰å“ˆã€‚</p>
                                <p class="reply-time">2019-01-18 17:20</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¿¡ä¿¡</span>
                            </div>
                            <div class="bd">è€å¸ˆæ‚¨å¥½ï¼Œæ–‡ä¸­åˆ¤æ–­ä¸»å¤‡æ— å»¶è¿Ÿæ–¹æ¡ˆçš„ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ–¹æ³•ï¼Œéƒ½æ˜¯å¯¹æ¯”äº†ä¸»ä»æ‰§è¡Œå®Œçš„æ—¥å¿—æ˜¯å¦ç›¸åŒã€‚å› ä¸ºä¸ä¼šå‡ºç°å›¾4ä¸‹æ–¹è¯´çš„ï¼šâ€œä»åº“è®¤ä¸ºå·²ç»æ²¡æœ‰åŒæ­¥å»¶è¿Ÿï¼Œä½†è¿˜æ˜¯æŸ¥ä¸åˆ° trx3 çš„ã€‚â€å› ä¸ºå¦‚æœä»åº“æœªæ‰§è¡Œtrx3çš„è¯ï¼Œç¬¬äºŒï¼Œç¬¬ä¸‰ç§æ–¹æ³•éƒ½æ˜¯ä¸é€šè¿‡çš„ã€‚ <br></div>
                            <span class="time">2019-01-18 11:33</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸ä¼šå“¦<br>å¦‚æœtrx3è¿˜æ²¡ä¼ åˆ°å¤‡åº“ï¼Œå¤‡åº“æ˜¯ä¼šè®¤ä¸ºå·²ç»åŒæ­¥å®Œæˆäº†</p>
                                <p class="reply-time">2019-01-18 12:24</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/df/94/84296110.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Max</span>
                            </div>
                            <div class="bd">æˆ‘ä¸€èˆ¬æ˜¯å…ˆæ˜¯åœ¨ä»åº“ä¸Šè®¾ç½® set_log_bin=offï¼Œç„¶åæ‰§è¡Œddl,è¯­å¥ã€‚<br>ç„¶åå®Œæˆä»¥åï¼Œä¸»ä»åšä¸€ä¸‹åˆ‡æ¢ã€‚ç„¶ååœ¨ä¸»åº“ä¸Šåœ¨æ‰§è¡Œä¸€ä¸‹set_log_bin=off,æ‰§è¡Œddlè¯­å¥ã€‚<br>ç„¶ååœ¨åšä¸€ä¸‹ä¸»ä»åˆ‡æ¢ã€‚<br>ä¸ªäººå¯¹pt-online-scheman-changeä¸æ˜¯å¾ˆæ¨èä½¿ç”¨ï¼Œå®ƒçš„åŸç†åŸºæœ¬æ˜¯åˆ›å»ºè§¦å‘å™¨ï¼Œç„¶ååˆ›å»ºå’Œæ—§è¡¨ä¸€æ ·ç»“æ„çš„æ•°æ®è¡¨ï¼Œ<br>æŠŠæ—§è¡¨çš„æ•°æ®å¤åˆ¶è¿‡å»ã€‚æœ€ååˆ é™¤æ—§è¡¨ã€‚ä»¥å‰åšä¸ªä¸€ä¸ªæµ‹è¯•ï¼Œå¦‚æœæ—§è¡¨ä¸€ç›´åœ¨è¢«select,åˆ é™¤è¿‡ç¨‹ä¼šä¸€ç›´ä¼šç­‰å¾…ã€‚<br>æ‰€ä»¥ä¸ªäººä¸æ˜¯å¾ˆå»ºè®®ã€‚ä¸‡ä¸€ä¸å°å¿ƒå˜æˆä»åˆ åº“åˆ°è·¯æ­¥ï¼Œé‚£å°±å¾—ä¸å¿å¤±äº†ã€‚<br><br>è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼Œä¸€ä¸»å¤šä»å¯ä»¥å¤šåˆ°ä»€ä¹ˆåœ°æ­¥ï¼Œä»¥å‰æˆ‘ä»¬CTOè§£å†³çš„æ–¹æ¡ˆå°±æ˜¯åŠ æœºå™¨ï¼Œä¸€ä¸»åä¸‰ä»ã€‚<br>å½“æ—¶æˆ‘æ˜¯åå¯¹çš„ï¼Œå…¶å®ä¸ªäººå»ºè®®è¿˜æ˜¯ä»SQLï¼Œä¸šåŠ¡ä¸Šé¢å»ä¼˜åŒ–ã€‚è€Œä¸æ˜¯ä¸€å‘³çš„åŠ æœºå™¨ã€‚å¦‚æœåŠ æœºå™¨è§£å†³çš„è¯ï¼Œè¿˜è¦DBAåšä»€ä¹ˆå‘¢ï¼Ÿ <br></div>
                            <span class="time">2019-01-17 16:17</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å‰é¢çš„åˆ†æå¾ˆå¥½å“ˆ<br><br><br>ç„¶åä¸€ä¸»13ä»æœ‰ç‚¹å¤šäº†ï¼Œå¦åˆ™ä¸»åº“ç”Ÿæˆbinlogå¤ªå¿«çš„è¯ï¼Œä¸»åº“çš„ç½‘å¡ä¼šè¢«æ‰“çˆ†ã€‚è¦è¿™ä¹ˆå¤šçš„è¯ï¼Œå¾—åšçº§è”ã€‚<br><br>DBAè§£å†³ä¸èƒ½é åŠ æœºå™¨è§£å†³çš„äº‹æƒ…^_^ è€Œä¸”å¦‚æœé€šè¿‡ä¼˜åŒ–ï¼Œå¯ä»¥æŠŠ13å˜æˆ3ï¼Œé‚£ä¹Ÿæ˜¯DBAçš„ä»·å€¼</p>
                                <p class="reply-time">2019-01-17 17:29</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/ca/15/e3f9fb4e.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">coderfocus</span>
                            </div>
                            <div class="bd">ä¸€æ­¥ä¸€æ­¥ å¾ªåºæ¸æ¸ è®²çš„å¤ªæ£’äº† æ„Ÿè°¢è€å¸ˆ <br></div>
                            <span class="time">2019-01-17 13:47</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/11/60/abb7bfe3.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ThinkingQuest</span>
                            </div>
                            <div class="bd">æ¥¼ä¸Šæœ‰äººæåˆ°8å°æ—¶è‡ªåŠ¨æ–­å¼€è¿æ¥çš„é—®é¢˜ã€‚ <br>mysqlä¸­æœ‰wait_timeoutå’Œinteractive_timeoutä¸¤ä¸ªå‚æ•°ã€‚ <br><br>è¿™ä¿©å‚æ•°æŒºå®¹æ˜“æ··æ·†çš„ï¼Œå¾€ä¸Šåšå®¢æ–‡ç« è¯´çš„å¾ˆå¤šï¼Œä½†æ˜¯ä¸æ•¢ç›¸ä¿¡ä»–ä»¬ã€‚<br>å®˜æ–¹çš„è§£é‡Šåœ¨è¿™é‡Œï¼š<br>https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;server-system-variables.html#sysvar_interactive_timeout<br>https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;server-system-variables.html#sysvar_wait_timeout<br><br>åªè¯´ç”¨è¿™ä¸¤ä¸ªå‚æ•°ä¸­çš„å“ªä¸ªï¼Œå–å†³äºå®¢æˆ·ç«¯è°ƒç”¨mysql_real_connect()çš„æ—¶å€™ä¼ é€’çš„optionsä¸­æ˜¯å¦ä½¿ç”¨äº†CLIENT_INTERACTIVEé€‰é¡¹ã€‚<br><br>ä½†æ˜¯å¾ˆå¤šåšjavaå¼€å‘çš„åŒå­¦ï¼Œæƒ³å¿…å¹¶ä¸çŸ¥é“JDBCçš„connectorç”¨çš„æ˜¯å“ªä¸€ä¸ªã€‚ <br>æˆ‘å€¾å‘äºè®¤ä¸ºæ˜¯interactive_timeoutã€‚ mysql client cliå¤§æ¦‚æ˜¯wait_timeoutå§ã€‚<br>å…¶å®åšä¸€ä¸ªå®éªŒå°±å¯ä»¥çŸ¥é“ç»“æœã€‚ ä½†æ˜¯ä¸é˜…è¯»mysqlä»£ç ï¼Œå¤§æ¦‚ä¸èƒ½ç†è§£mysqlä¸ºä»€ä¹ˆè®¾è®¡è¿™ä¹ˆä¸¤ä¸ªtimeoutï¼Œæ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘çš„ã€‚ <br></div>
                            <span class="time">2019-01-17 09:39</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">JDBCçš„connectoræˆ‘ä¹Ÿæ²¡ç ”ç©¶è¿‡ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºåº”è¯¥æ˜¯éinteractiveæ¨¡å¼ã€‚<br><br>éœ€è¦è¿™ä¸¤ä¸ªçš„åŸå› ï¼Œè¿˜æ˜¯å› ä¸ºæœ‰ä¸åŒçš„ä½¿ç”¨æ¨¡å¼ï¼Œç»™MySQLå®¢æˆ·ç«¯å’Œä¸€äº›å…¶ä»–çš„å¯è§†åŒ–å·¥å…·å®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p>
                                <p class="reply-time">2019-01-17 17:31</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/1b/13/b7e5a662.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¸åœ</span>
                            </div>
                            <div class="bd">é«˜æ‰‹ï¼Œä½ è¿™ç°åœ¨åœ¨å“ªé‡Œä¸Šç­äº†ï¼Œæœ‰å…´è¶£æ¥æˆ‘ä»¬å…¬å¸è€è€ä¹ˆï¼Ÿ <br></div>
                            <span class="time">2019-01-16 17:33</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f9/a4/f0b92135.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¸‡å‹‡</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œè¯·æ•™ä¸‹ã€‚<br>1.å¯¹å¤§è¡¨åšddlï¼Œæ˜¯å¯ä»¥é‡‡ç”¨å…ˆåœ¨å¤‡åº“ä¸Šset global log_bin=offï¼Œå…ˆåšå®Œddlï¼Œç„¶ååˆ‡æ¢ä¸»å¤‡åº“ã€‚ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨åˆ‡ä¸»å¤‡çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¼šæœ‰ä¸ªä¸å¯ç”¨çš„æ—¶é—´æ®µï¼Œå¯¹ä¸šåŠ¡ä¼šé€ æˆå½±å“ã€‚ç°åœ¨çš„æ¶æ„æ–¹å¼ï¼Œä¸­é—´å±‚è¿˜æœ‰proxyï¼Œæ„å‘³ç€proxyä¹Ÿéœ€è¦ä¿®æ”¹ä¸»å¤‡é…ç½®ï¼Œåšreloadã€‚è¿™æ ·åšçš„è¯ï¼Œæ„Ÿè§‰æˆæœ¬å¤ªé«˜ï¼Œåœ¨çœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ç§æ–¹æ³•é€‚ç”¨å—ï¼Ÿ<br>2.ç›®å‰æˆ‘ä»¬å¸¸é‡‡ç”¨çš„æ˜¯å¯¹å‡ ç™¾ä¸‡ä»¥ä¸Šçš„è¡¨ç”¨pt-online-schema-changeï¼Œè¿™ç§æ–¹å¼ä¼šäº§ç”Ÿå¤§é‡çš„binlogï¼Œä¸šåŠ¡é«˜å³°æœŸä¸èƒ½åšï¼Œä¼šå¼•èµ·ä¸»å¤‡å»¶è¿Ÿã€‚åœ¨ç”Ÿäº§ä¸šåŠ¡ä¸­ï¼Œæˆ‘è§‰å¾—ç­‰ä¸»åº“èŠ‚ç‚¹æˆ–è€…ç­‰gtidè¿™ç§æ–¹æ¡ˆæŒºä¸é”™ï¼Œè‡³å°‘èƒ½ä¿è¯ä¸šåŠ¡ï¼Œä½†ä¹Ÿä¼šå¢åŠ ä¸»åº“çš„å‹åŠ›ã€‚<br>3.5.7ç‰ˆæœ¬å‡ºçš„group_replicationå¤šå†™æ¨¡å¼æ€§èƒ½ä¸çŸ¥é“å¦‚ä½•ï¼Ÿæ¶æ„å˜åŠ¨å¤ªå¤§ï¼Œè¿˜ä¸æ•¢ä¸Šã€‚<br> <br></div>
                            <span class="time">2019-01-16 17:22</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬è¯´çš„æ˜¯ï¼Œå¦‚æœéç´§æ€¥æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å°½é‡ç”¨gh-ostï¼Œåœ¨â€œç´§æ€¥â€çš„æƒ…å†µä¸‹ï¼Œæ‰è¿™ä¹ˆåšï¼›ç¡®å®æ˜¯è¦ç»•è¿‡proxyçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº‹å„¿æ˜¯è¦è´Ÿè´£è¿ç»´çš„åŒå­¦åšï¼›<br>2. ptå·¥å…·æ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¯•ä¸€ä¸‹gh-ostå“ˆï¼›group_replicationå¤šå†™æ¨¡å¼å›½å†…æˆ‘è¿˜æ²¡æœ‰å¬åˆ°å›½å†…æœ‰å…¬å¸åœ¨ç”Ÿäº§ä¸Šå¤§è§„æ¨¡ç”¨çš„ï¼Œå¦‚æœä½ æœ‰ä½¿ç”¨ç»éªŒï¼Œåˆ†äº«ä¸€ä¸‹å“ˆ</p>
                                <p class="reply-time">2019-01-16 18:43</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ°¸æ’è®°å¿†</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œæœ‰å‡ ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹ï¼Œ<br>1.å¦‚æœä¸æƒ³æœ‰è¿‡æœŸè¯»ï¼Œç”¨ç­‰GTIDçš„æ–¹æ¡ˆï¼Œé‚£ä¹ˆæ¯æ¬¡æŸ¥è¯¢éƒ½è¦æœ‰ç­‰GTIDçš„ç›¸å…³æ“ä½œï¼Œå¢åŠ çš„è¿™éƒ¨åˆ†å¯¹æ€§èƒ½æœ‰å¤šå°‘å½±å“ï¼›<br>2.æˆ‘ä»¬ç”¨çš„è¯»å†™åˆ†ç¦»proxyä¸æ”¯æŒç­‰GTIDï¼Œé‚£æ˜¯ä¸æ˜¯è‡ªå·±è¦åœ¨å®¢æˆ·ç«¯å®ç°è¿™éƒ¨åˆ†é€»è¾‘ï¼Œç­‰äºè¯»å†™åˆ†ç¦»çš„æ¶æ„æ—¢ç”¨äº†proxyï¼Œåˆåœ¨å®¢æˆ·ç«¯åšäº†ç›¸å…³ç­–ç•¥ï¼Œæ„Ÿè§‰è¿™æ–¹æ¡ˆæ›´é€‚åˆæœ‰èƒ½åŠ›è‡ªç ”proxyçš„å…¬å¸å•Šï¼›<br>3.æ„Ÿè§‰ç›®å‰å¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯ç”¨çš„è¯»ä¸»åº“è¿™ç§æ–¹å¼é¿å…è¿‡æœŸè¯»ï¼Œå¦‚æœåªèƒ½ç”¨è¿™ç§æ–¹æ¡ˆçš„è¯è¯¥æ€ä¹ˆæ‰©å±•mysqlæ¶æ„æ¥é¿å…ä¸»åº“å‹åŠ›å¤ªå¤§å‘¢ã€‚<br>æˆ‘ä»¬æ˜¯é¡¹ç›®ä¸Šçº¿å¾ˆä¹…ç„¶ååŠ çš„è¯»å†™åˆ†ç¦»ï¼Œå¥½å¤šserviceå±‚ä»£ç å†™çš„ä¸å¥½ï¼Œå¯ä»¥è¯»ä»åº“çš„sqlè¢«å†™åˆ°äº†äº‹åŠ¡ä¸­ï¼Œè¿™æ ·ä¼šè¢«proxyè½¬åˆ°ä¸»åº“ä¸Šè¯»ï¼Œæ‰€ä»¥å¯¼è‡´ä¸»åº“è´Ÿæ‹…äº†å¥½å¤šè¯»çš„sqlï¼Œæ„Ÿè§‰è¯»å†™åˆ†ç¦»ä¸ä»…å¯¹mysqlè¿™å—è¦æŒæ¡ï¼Œæ•´ä½“çš„ä»£ç ç»“æ„ä¸Šä¹Ÿè¦æœ‰æ‰€è°ƒæ•´å§ã€‚ <br></div>
                            <span class="time">2019-01-16 14:14</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. è¿™ä¸ªç­‰å¾…æ—¶é—´å…¶å®å°±åŸºæœ¬ä¸Šæ˜¯ä¸»å¤‡å»¶è¿Ÿçš„æ—¶é—´<br>2. ç”¨äº†proxyè¿™äº‹æƒ…å°±å¾—proxyåšäº†ï¼Œå°±ä¸è¦å®¢æˆ·ç«¯åšäº†ã€‚æ²¡æœ‰gtidï¼Œå¯ä»¥ç”¨å€’æ•°ç¬¬äºŒç§æ–¹æ³•å‘€ï¼šï¼‰<br>3. æ˜¯çš„ï¼Œå…¶å®â€œèµ°ä¸»åº“â€è¿™ç§åšæ³•è¿˜æŒºå¤šçš„ã€‚æˆ‘ä¹‹å‰çœ‹åˆ°æœ‰çš„å…¬å¸çš„åšæ³•ï¼Œå°±æ˜¯ç›´æ¥æ‹†åº“äº†ã€‚ç­‰äºä¸€å¥—â€œä¸€ä¸»å¤šä»â€æ‹†æˆå¤šå¥—ã€‚</p>
                                <p class="reply-time">2019-01-16 15:02</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">HuaMax</span>
                            </div>
                            <div class="bd">è¯¾åé¢˜ã€‚å¯¹å¤§è¡¨åšddlæ˜¯ä¸€ä¸ªå¤§äº‹åŠ¡ï¼Œç­‰å¾…ä»åº“æ‰§è¡Œï¼ŒåŸºæœ¬å°±ä¼šè¶…æ—¶ï¼Œæœ€åéƒ½è¿”å›åˆ°ä¸»åº“æ‰§è¡Œï¼Œè¿™æ ·çš„è¯ä¸å¦‚è·³è¿‡ç­‰å¾…ä»åº“è¿™ä¸€æ­¥ï¼Œä½†æ˜¯åƒè€å¸ˆæ–‡ä¸­æåˆ°éœ€è¦åšå¥½é™æµã€‚ä»å¦ä¸€ä¸ªè§’åº¦ï¼Œå¯¹äºä¸»åº“çš„ddlæ“ä½œï¼Œä»ä¸šåŠ¡åœºæ™¯å»è€ƒè™‘ï¼Œä¸€èˆ¬éšååˆ°æ¥çš„æŸ¥è¯¢ä¸ä¼šè¢«è¿™ä¸ªddlå½±å“ï¼Œè€Œæ˜¯å¯¹æ–°çš„ä¸šåŠ¡å˜æ›´æœ‰å½±å“ï¼Œè¿™æ ·çš„è¯ï¼Œä¹Ÿå¯ä»¥è·³è¿‡ç­‰å¾…ä»åº“è¿™ä¸€æ­¥ï¼Œç›´æ¥è®©ä»åº“æ‰§è¡Œå³å¯ã€‚ä¸çŸ¥é“ç†è§£æ˜¯å¦æ­£ç¡®ï¼Ÿ <br></div>
                            <span class="time">2019-01-16 11:23</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ ¸å¿ƒæ˜¯è¦å¤„ç†å»¶è¿Ÿé—®é¢˜ï¼Œæ¯”å¦‚æ€ä¹ˆæ“ä½œå¯ä»¥ä¸ä¼šäº§ç”Ÿå»¶è¿Ÿ<br><br></p>
                                <p class="reply-time">2019-01-16 14:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f2/a5/bc63dee1.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">* æ™“ *</span>
                            </div>
                            <div class="bd">è€å¸ˆå¥½ï¼Œå¦‚æœç”¨MGRæˆ–InnoDB clusteræ–¹æ¡ˆåšè¯»å†™åˆ†ç¦»çš„è¯å¯ä»¥æ›¿ä»£æ–‡ä¸­æåˆ°çš„æ–¹æ¡ˆå—ï¼Ÿè¿™ä¸¤ä¸ªæ–¹æ¡ˆå»ºè®®åœ¨ç”Ÿäº§ä¸­å¤§é‡ä½¿ç”¨å—ï¼Ÿ <br></div>
                            <span class="time">2019-01-16 09:00</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">MGRå¼€å§‹æœ‰å›½å†…å…¬å¸åœ¨ä½¿ç”¨äº†<br><br>InnoDB clusterä¹Ÿå¯ä»¥çš„ï¼Œä½†æ˜¯ä¸€èˆ¬å°±æ˜¯å¹³æ—¶ä¸€å†™å¤šè¯»ï¼Œåªåœ¨ä¸»å¤‡åˆ‡æ¢çš„æ—¶å€™ï¼ŒçŸ­æš‚å…è®¸å¤šå†™</p>
                                <p class="reply-time">2019-01-16 10:26</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/cf/b5/d1ec6a7d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Stalary</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜å•Šï¼Œæµ‹è¯•æœç”¨hakriè¿æ¥æ± è¿æ¥mysqlï¼Œä½†æ˜¯æ¯æ¬¡è¶…è¿‡å…«å°æ—¶ä¸ä½¿ç”¨ï¼Œæ•°æ®åº“è¿æ¥å°±ä¼šè¢«è‡ªåŠ¨å›æ”¶äº†ï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆå¥½çš„è§£å†³åŠæ³•å˜›ï¼Ÿ <br></div>
                            <span class="time">2019-01-16 08:48</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">åº”è¯¥å°±æ˜¯æˆ‘ç›´æ’­æ—¶è¯´çš„è¿™ä¸ªæƒ…å†µå§ã€‚ https:&#47;&#47;time.geekbang.org&#47;column&#47;article&#47;73370<br><br>wait_timeout è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯8å°æ—¶ï¼Œæ”¹ä¸ªæ›´å¤§çš„å€¼è¯•è¯•</p>
                                <p class="reply-time">2019-01-16 10:25</p>
                            </div>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>