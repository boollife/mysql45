<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  
  
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                13è®²ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/7e/11/7e411ea05dde5a1bf3a4106fb8e5ae11.jpg">

                <div>
                    <audio controls="controls" height="100" width="100">
                        <source src="13è®²ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜.mp3" type="audio/mp3" />
                        <embed height="100" width="100" src="13è®²ä¸ºä»€ä¹ˆè¡¨æ•°æ®åˆ æ‰ä¸€åŠï¼Œè¡¨æ–‡ä»¶å¤§å°ä¸å˜.mp3" />
                    </audio>
                </div>
                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>ç»å¸¸ä¼šæœ‰åŒå­¦æ¥é—®æˆ‘ï¼Œæˆ‘çš„æ•°æ®åº“å ç”¨ç©ºé—´å¤ªå¤§ï¼Œæˆ‘æŠŠä¸€ä¸ªæœ€å¤§çš„è¡¨åˆ æ‰äº†ä¸€åŠçš„æ•°æ®ï¼Œæ€ä¹ˆè¡¨æ–‡ä»¶çš„å¤§å°è¿˜æ˜¯æ²¡å˜ï¼Ÿ</p><p>é‚£ä¹ˆä»Šå¤©ï¼Œæˆ‘å°±å’Œä½ èŠèŠæ•°æ®åº“è¡¨çš„ç©ºé—´å›æ”¶ï¼Œçœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜æ˜¯é’ˆå¯¹MySQLä¸­åº”ç”¨æœ€å¹¿æ³›çš„InnoDBå¼•æ“å±•å¼€è®¨è®ºã€‚ä¸€ä¸ªInnoDBè¡¨åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå³ï¼šè¡¨ç»“æ„å®šä¹‰å’Œæ•°æ®ã€‚åœ¨MySQL 8.0ç‰ˆæœ¬ä»¥å‰ï¼Œè¡¨ç»“æ„æ˜¯å­˜åœ¨ä»¥.frmä¸ºåç¼€çš„æ–‡ä»¶é‡Œã€‚è€ŒMySQL 8.0ç‰ˆæœ¬ï¼Œåˆ™å·²ç»å…è®¸æŠŠè¡¨ç»“æ„å®šä¹‰æ”¾åœ¨ç³»ç»Ÿæ•°æ®è¡¨ä¸­äº†ã€‚å› ä¸ºè¡¨ç»“æ„å®šä¹‰å ç”¨çš„ç©ºé—´å¾ˆå°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»Šå¤©ä¸»è¦è®¨è®ºçš„æ˜¯è¡¨æ•°æ®ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå…ˆå’Œä½ è¯´æ˜ä¸ºä»€ä¹ˆç®€å•åœ°åˆ é™¤è¡¨æ•°æ®è¾¾ä¸åˆ°è¡¨ç©ºé—´å›æ”¶çš„æ•ˆæœï¼Œç„¶åå†å’Œä½ ä»‹ç»æ­£ç¡®å›æ”¶ç©ºé—´çš„æ–¹æ³•ã€‚</p><h1>å‚æ•°innodb_file_per_table</h1><p>è¡¨æ•°æ®æ—¢å¯ä»¥å­˜åœ¨å…±äº«è¡¨ç©ºé—´é‡Œï¼Œä¹Ÿå¯ä»¥æ˜¯å•ç‹¬çš„æ–‡ä»¶ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯ç”±å‚æ•°innodb_file_per_tableæ§åˆ¶çš„ï¼š</p><ol>
<li>
<p>è¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºOFFè¡¨ç¤ºçš„æ˜¯ï¼Œè¡¨çš„æ•°æ®æ”¾åœ¨ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è·Ÿæ•°æ®å­—å…¸æ”¾åœ¨ä¸€èµ·ï¼›</p>
</li>
<li>
<p>è¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºONè¡¨ç¤ºçš„æ˜¯ï¼Œæ¯ä¸ªInnoDBè¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä»¥ .ibdä¸ºåç¼€çš„æ–‡ä»¶ä¸­ã€‚</p>
</li>
</ol><p>ä»MySQL 5.6.6ç‰ˆæœ¬å¼€å§‹ï¼Œå®ƒçš„é»˜è®¤å€¼å°±æ˜¯ONäº†ã€‚</p><p>æˆ‘å»ºè®®ä½ ä¸è®ºä½¿ç”¨MySQLçš„å“ªä¸ªç‰ˆæœ¬ï¼Œéƒ½å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºONã€‚å› ä¸ºï¼Œä¸€ä¸ªè¡¨å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†ï¼Œè€Œä¸”åœ¨ä½ ä¸éœ€è¦è¿™ä¸ªè¡¨çš„æ—¶å€™ï¼Œé€šè¿‡drop tableå‘½ä»¤ï¼Œç³»ç»Ÿå°±ä¼šç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ã€‚è€Œå¦‚æœæ˜¯æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ï¼Œå³ä½¿è¡¨åˆ æ‰äº†ï¼Œç©ºé—´ä¹Ÿæ˜¯ä¸ä¼šå›æ”¶çš„ã€‚</p><!-- [[[read_end]]] --><p>æ‰€ä»¥ï¼Œ<strong>å°†innodb_file_per_tableè®¾ç½®ä¸ºONï¼Œæ˜¯æ¨èåšæ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„è®¨è®ºéƒ½æ˜¯åŸºäºè¿™ä¸ªè®¾ç½®å±•å¼€çš„ã€‚</strong></p><p>æˆ‘ä»¬åœ¨åˆ é™¤æ•´ä¸ªè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨drop tableå‘½ä»¤å›æ”¶è¡¨ç©ºé—´ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é‡åˆ°çš„æ›´å¤šçš„åˆ é™¤æ•°æ®çš„åœºæ™¯æ˜¯åˆ é™¤æŸäº›è¡Œï¼Œè¿™æ—¶å°±é‡åˆ°äº†æˆ‘ä»¬æ–‡ç« å¼€å¤´çš„é—®é¢˜ï¼šè¡¨ä¸­çš„æ•°æ®è¢«åˆ é™¤äº†ï¼Œä½†æ˜¯è¡¨ç©ºé—´å´æ²¡æœ‰è¢«å›æ”¶ã€‚</p><p>æˆ‘ä»¬è¦å½»åº•ææ˜ç™½è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œå°±è¦ä»æ•°æ®åˆ é™¤æµç¨‹è¯´èµ·äº†ã€‚</p><h1>æ•°æ®åˆ é™¤æµç¨‹</h1><p>æˆ‘ä»¬å…ˆå†æ¥çœ‹ä¸€ä¸‹InnoDBä¸­ä¸€ä¸ªç´¢å¼•çš„ç¤ºæ„å›¾ã€‚åœ¨å‰é¢<a href="https://time.geekbang.org/column/article/69236">ç¬¬4</a>å’Œ<a href="https://time.geekbang.org/column/article/69636">ç¬¬5</a>ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»ç´¢å¼•æ—¶æ›¾ç»æåˆ°è¿‡ï¼ŒInnoDBé‡Œçš„æ•°æ®éƒ½æ˜¯ç”¨B+æ ‘çš„ç»“æ„ç»„ç»‡çš„ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/f0/c8/f0b1e4ac610bcb5c5922d0b18563f3c8.png" alt=""></p><center><span class="reference">å›¾1 B+æ ‘ç´¢å¼•ç¤ºæ„å›¾</span></center><p>å‡è®¾ï¼Œæˆ‘ä»¬è¦åˆ æ‰R4è¿™ä¸ªè®°å½•ï¼ŒInnoDBå¼•æ“åªä¼šæŠŠR4è¿™ä¸ªè®°å½•æ ‡è®°ä¸ºåˆ é™¤ã€‚å¦‚æœä¹‹åè¦å†æ’å…¥ä¸€ä¸ªIDåœ¨300å’Œ600ä¹‹é—´çš„è®°å½•æ—¶ï¼Œå¯èƒ½ä¼šå¤ç”¨è¿™ä¸ªä½ç½®ã€‚ä½†æ˜¯ï¼Œç£ç›˜æ–‡ä»¶çš„å¤§å°å¹¶ä¸ä¼šç¼©å°ã€‚</p><p>ç°åœ¨ï¼Œä½ å·²ç»çŸ¥é“äº†InnoDBçš„æ•°æ®æ˜¯æŒ‰é¡µå­˜å‚¨çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬åˆ æ‰äº†ä¸€ä¸ªæ•°æ®é¡µä¸Šçš„æ‰€æœ‰è®°å½•ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œæ•´ä¸ªæ•°æ®é¡µå°±å¯ä»¥è¢«å¤ç”¨äº†ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>æ•°æ®é¡µçš„å¤ç”¨è·Ÿè®°å½•çš„å¤ç”¨æ˜¯ä¸åŒçš„ã€‚</strong></p><p>è®°å½•çš„å¤ç”¨ï¼Œåªé™äºç¬¦åˆèŒƒå›´æ¡ä»¶çš„æ•°æ®ã€‚æ¯”å¦‚ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ï¼ŒR4è¿™æ¡è®°å½•è¢«åˆ é™¤åï¼Œå¦‚æœæ’å…¥ä¸€ä¸ªIDæ˜¯400çš„è¡Œï¼Œå¯ä»¥ç›´æ¥å¤ç”¨è¿™ä¸ªç©ºé—´ã€‚ä½†å¦‚æœæ’å…¥çš„æ˜¯ä¸€ä¸ªIDæ˜¯800çš„è¡Œï¼Œå°±ä¸èƒ½å¤ç”¨è¿™ä¸ªä½ç½®äº†ã€‚</p><p>è€Œå½“æ•´ä¸ªé¡µä»B+æ ‘é‡Œé¢æ‘˜æ‰ä»¥åï¼Œå¯ä»¥å¤ç”¨åˆ°ä»»ä½•ä½ç½®ã€‚ä»¥å›¾1ä¸ºä¾‹ï¼Œå¦‚æœå°†æ•°æ®é¡µpage Aä¸Šçš„æ‰€æœ‰è®°å½•åˆ é™¤ä»¥åï¼Œpage Aä¼šè¢«æ ‡è®°ä¸ºå¯å¤ç”¨ã€‚è¿™æ—¶å€™å¦‚æœè¦æ’å…¥ä¸€æ¡ID=50çš„è®°å½•éœ€è¦ä½¿ç”¨æ–°é¡µçš„æ—¶å€™ï¼Œpage Aæ˜¯å¯ä»¥è¢«å¤ç”¨çš„ã€‚</p><p>å¦‚æœç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨ç‡éƒ½å¾ˆå°ï¼Œç³»ç»Ÿå°±ä¼šæŠŠè¿™ä¸¤ä¸ªé¡µä¸Šçš„æ•°æ®åˆåˆ°å…¶ä¸­ä¸€ä¸ªé¡µä¸Šï¼Œå¦å¤–ä¸€ä¸ªæ•°æ®é¡µå°±è¢«æ ‡è®°ä¸ºå¯å¤ç”¨ã€‚</p><p>è¿›ä¸€æ­¥åœ°ï¼Œå¦‚æœæˆ‘ä»¬ç”¨deleteå‘½ä»¤æŠŠæ•´ä¸ªè¡¨çš„æ•°æ®åˆ é™¤å‘¢ï¼Ÿç»“æœå°±æ˜¯ï¼Œæ‰€æœ‰çš„æ•°æ®é¡µéƒ½ä¼šè¢«æ ‡è®°ä¸ºå¯å¤ç”¨ã€‚ä½†æ˜¯ç£ç›˜ä¸Šï¼Œæ–‡ä»¶ä¸ä¼šå˜å°ã€‚</p><p>ä½ ç°åœ¨çŸ¥é“äº†ï¼Œdeleteå‘½ä»¤å…¶å®åªæ˜¯æŠŠè®°å½•çš„ä½ç½®ï¼Œæˆ–è€…æ•°æ®é¡µæ ‡è®°ä¸ºäº†â€œå¯å¤ç”¨â€ï¼Œä½†ç£ç›˜æ–‡ä»¶çš„å¤§å°æ˜¯ä¸ä¼šå˜çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡deleteå‘½ä»¤æ˜¯ä¸èƒ½å›æ”¶è¡¨ç©ºé—´çš„ã€‚è¿™äº›å¯ä»¥å¤ç”¨ï¼Œè€Œæ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºé—´ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯â€œç©ºæ´â€ã€‚</p><p>å®é™…ä¸Šï¼Œ<strong>ä¸æ­¢æ˜¯åˆ é™¤æ•°æ®ä¼šé€ æˆç©ºæ´ï¼Œæ’å…¥æ•°æ®ä¹Ÿä¼šã€‚</strong></p><p>å¦‚æœæ•°æ®æ˜¯æŒ‰ç…§ç´¢å¼•é€’å¢é¡ºåºæ’å…¥çš„ï¼Œé‚£ä¹ˆç´¢å¼•æ˜¯ç´§å‡‘çš„ã€‚ä½†å¦‚æœæ•°æ®æ˜¯éšæœºæ’å…¥çš„ï¼Œå°±å¯èƒ½é€ æˆç´¢å¼•çš„æ•°æ®é¡µåˆ†è£‚ã€‚</p><p>å‡è®¾å›¾1ä¸­page Aå·²ç»æ»¡äº†ï¼Œè¿™æ—¶æˆ‘è¦å†æ’å…¥ä¸€è¡Œæ•°æ®ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿ</p><p><img src="https://static001.geekbang.org/resource/image/80/ea/8083f05a4a4c0372833a6e01d5a8e6ea.png" alt=""></p><center><span class="reference">å›¾2 æ’å…¥æ•°æ®å¯¼è‡´é¡µåˆ†è£‚</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºpage Aæ»¡äº†ï¼Œå†æ’å…¥ä¸€ä¸ªIDæ˜¯550çš„æ•°æ®æ—¶ï¼Œå°±ä¸å¾—ä¸å†ç”³è¯·ä¸€ä¸ªæ–°çš„é¡µé¢page Bæ¥ä¿å­˜æ•°æ®äº†ã€‚é¡µåˆ†è£‚å®Œæˆåï¼Œpage Açš„æœ«å°¾å°±ç•™ä¸‹äº†ç©ºæ´ï¼ˆæ³¨æ„ï¼šå®é™…ä¸Šï¼Œå¯èƒ½ä¸æ­¢1ä¸ªè®°å½•çš„ä½ç½®æ˜¯ç©ºæ´ï¼‰ã€‚</p><p>å¦å¤–ï¼Œæ›´æ–°ç´¢å¼•ä¸Šçš„å€¼ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ é™¤ä¸€ä¸ªæ—§çš„å€¼ï¼Œå†æ’å…¥ä¸€ä¸ªæ–°å€¼ã€‚ä¸éš¾ç†è§£ï¼Œè¿™ä¹Ÿæ˜¯ä¼šé€ æˆç©ºæ´çš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç»è¿‡å¤§é‡å¢åˆ æ”¹çš„è¡¨ï¼Œéƒ½æ˜¯å¯èƒ½æ˜¯å­˜åœ¨ç©ºæ´çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœèƒ½å¤ŸæŠŠè¿™äº›ç©ºæ´å»æ‰ï¼Œå°±èƒ½è¾¾åˆ°æ”¶ç¼©è¡¨ç©ºé—´çš„ç›®çš„ã€‚</p><p>è€Œé‡å»ºè¡¨ï¼Œå°±å¯ä»¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„ã€‚</p><h1>é‡å»ºè¡¨</h1><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ ç°åœ¨æœ‰ä¸€ä¸ªè¡¨Aï¼Œéœ€è¦åšç©ºé—´æ”¶ç¼©ï¼Œä¸ºäº†æŠŠè¡¨ä¸­å­˜åœ¨çš„ç©ºæ´å»æ‰ï¼Œä½ å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æ–°å»ºä¸€ä¸ªä¸è¡¨Aç»“æ„ç›¸åŒçš„è¡¨Bï¼Œç„¶åæŒ‰ç…§ä¸»é”®IDé€’å¢çš„é¡ºåºï¼ŒæŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»è¡¨Aé‡Œè¯»å‡ºæ¥å†æ’å…¥åˆ°è¡¨Bä¸­ã€‚</p><p>ç”±äºè¡¨Bæ˜¯æ–°å»ºçš„è¡¨ï¼Œæ‰€ä»¥è¡¨Aä¸»é”®ç´¢å¼•ä¸Šçš„ç©ºæ´ï¼Œåœ¨è¡¨Bä¸­å°±éƒ½ä¸å­˜åœ¨äº†ã€‚æ˜¾ç„¶åœ°ï¼Œè¡¨Bçš„ä¸»é”®ç´¢å¼•æ›´ç´§å‡‘ï¼Œæ•°æ®é¡µçš„åˆ©ç”¨ç‡ä¹Ÿæ›´é«˜ã€‚å¦‚æœæˆ‘ä»¬æŠŠè¡¨Bä½œä¸ºä¸´æ—¶è¡¨ï¼Œæ•°æ®ä»è¡¨Aå¯¼å…¥è¡¨Bçš„æ“ä½œå®Œæˆåï¼Œç”¨è¡¨Bæ›¿æ¢Aï¼Œä»æ•ˆæœä¸Šçœ‹ï¼Œå°±èµ·åˆ°äº†æ”¶ç¼©è¡¨Aç©ºé—´çš„ä½œç”¨ã€‚</p><p>è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨alter table A engine=InnoDBå‘½ä»¤æ¥é‡å»ºè¡¨ã€‚åœ¨MySQL 5.5ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿™ä¸ªå‘½ä»¤çš„æ‰§è¡Œæµç¨‹è·Ÿæˆ‘ä»¬å‰é¢æè¿°çš„å·®ä¸å¤šï¼ŒåŒºåˆ«åªæ˜¯è¿™ä¸ªä¸´æ—¶è¡¨Bä¸éœ€è¦ä½ è‡ªå·±åˆ›å»ºï¼ŒMySQLä¼šè‡ªåŠ¨å®Œæˆè½¬å­˜æ•°æ®ã€äº¤æ¢è¡¨åã€åˆ é™¤æ—§è¡¨çš„æ“ä½œã€‚</p><p><img src="https://static001.geekbang.org/resource/image/02/cd/02e083adaec6e1191f54992f7bc13dcd.png" alt=""></p><center><span class="reference">å›¾3 æ”¹é”è¡¨DDL</span></center><p>æ˜¾ç„¶ï¼ŒèŠ±æ—¶é—´æœ€å¤šçš„æ­¥éª¤æ˜¯å¾€ä¸´æ—¶è¡¨æ’å…¥æ•°æ®çš„è¿‡ç¨‹ï¼Œå¦‚æœåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰æ–°çš„æ•°æ®è¦å†™å…¥åˆ°è¡¨Açš„è¯ï¼Œå°±ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚å› æ­¤ï¼Œåœ¨æ•´ä¸ªDDLè¿‡ç¨‹ä¸­ï¼Œè¡¨Aä¸­ä¸èƒ½æœ‰æ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªDDLä¸æ˜¯Onlineçš„ã€‚</p><p>è€Œåœ¨<strong>MySQL 5.6ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„Online DDLï¼Œå¯¹è¿™ä¸ªæ“ä½œæµç¨‹åšäº†ä¼˜åŒ–ã€‚</strong></p><p>æˆ‘ç»™ä½ ç®€å•æè¿°ä¸€ä¸‹å¼•å…¥äº†Online DDLä¹‹åï¼Œé‡å»ºè¡¨çš„æµç¨‹ï¼š</p><ol>
<li>
<p>å»ºç«‹ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæ‰«æè¡¨Aä¸»é”®çš„æ‰€æœ‰æ•°æ®é¡µï¼›</p>
</li>
<li>
<p>ç”¨æ•°æ®é¡µä¸­è¡¨Açš„è®°å½•ç”ŸæˆB+æ ‘ï¼Œå­˜å‚¨åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼›</p>
</li>
<li>
<p>ç”Ÿæˆä¸´æ—¶æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ‰€æœ‰å¯¹Açš„æ“ä½œè®°å½•åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆrow logï¼‰ä¸­ï¼Œå¯¹åº”çš„æ˜¯å›¾ä¸­state2çš„çŠ¶æ€ï¼›</p>
</li>
<li>
<p>ä¸´æ—¶æ–‡ä»¶ç”Ÿæˆåï¼Œå°†æ—¥å¿—æ–‡ä»¶ä¸­çš„æ“ä½œåº”ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªé€»è¾‘æ•°æ®ä¸Šä¸è¡¨Aç›¸åŒçš„æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„å°±æ˜¯å›¾ä¸­state3çš„çŠ¶æ€ï¼›</p>
</li>
<li>
<p>ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è¡¨Açš„æ•°æ®æ–‡ä»¶ã€‚</p>
</li>
</ol><p><img src="https://static001.geekbang.org/resource/image/2d/f0/2d1cfbbeb013b851a56390d38b5321f0.png" alt=""></p><center><span class="reference">å›¾4 Online DDL</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸å›¾3è¿‡ç¨‹çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œç”±äºæ—¥å¿—æ–‡ä»¶è®°å½•å’Œé‡æ”¾æ“ä½œè¿™ä¸ªåŠŸèƒ½çš„å­˜åœ¨ï¼Œè¿™ä¸ªæ–¹æ¡ˆåœ¨é‡å»ºè¡¨çš„è¿‡ç¨‹ä¸­ï¼Œå…è®¸å¯¹è¡¨Aåšå¢åˆ æ”¹æ“ä½œã€‚è¿™ä¹Ÿå°±æ˜¯Online DDLåå­—çš„æ¥æºã€‚</p><p>æˆ‘è®°å¾—æœ‰åŒå­¦åœ¨ç¬¬6ç¯‡è®²è¡¨é”çš„æ–‡ç« <a href="https://time.geekbang.org/column/article/69862">ã€Šå…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆç´¢è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿã€‹</a>çš„è¯„è®ºåŒºç•™è¨€è¯´ï¼ŒDDLä¹‹å‰æ˜¯è¦æ‹¿MDLå†™é”çš„ï¼Œè¿™æ ·è¿˜èƒ½å«Online DDLå—ï¼Ÿ</p><p>ç¡®å®ï¼Œå›¾4çš„æµç¨‹ä¸­ï¼Œalterè¯­å¥åœ¨å¯åŠ¨çš„æ—¶å€™éœ€è¦è·å–MDLå†™é”ï¼Œä½†æ˜¯è¿™ä¸ªå†™é”åœ¨çœŸæ­£æ‹·è´æ•°æ®ä¹‹å‰å°±é€€åŒ–æˆè¯»é”äº†ã€‚</p><p>ä¸ºä»€ä¹ˆè¦é€€åŒ–å‘¢ï¼Ÿä¸ºäº†å®ç°Onlineï¼ŒMDLè¯»é”ä¸ä¼šé˜»å¡å¢åˆ æ”¹æ“ä½œã€‚</p><p>é‚£ä¸ºä»€ä¹ˆä¸å¹²è„†ç›´æ¥è§£é”å‘¢ï¼Ÿä¸ºäº†ä¿æŠ¤è‡ªå·±ï¼Œç¦æ­¢å…¶ä»–çº¿ç¨‹å¯¹è¿™ä¸ªè¡¨åŒæ—¶åšDDLã€‚</p><p>è€Œå¯¹äºä¸€ä¸ªå¤§è¡¨æ¥è¯´ï¼ŒOnline DDLæœ€è€—æ—¶çš„è¿‡ç¨‹å°±æ˜¯æ‹·è´æ•°æ®åˆ°ä¸´æ—¶è¡¨çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ­¥éª¤çš„æ‰§è¡ŒæœŸé—´å¯ä»¥æ¥å—å¢åˆ æ”¹æ“ä½œã€‚æ‰€ä»¥ï¼Œç›¸å¯¹äºæ•´ä¸ªDDLè¿‡ç¨‹æ¥è¯´ï¼Œé”çš„æ—¶é—´éå¸¸çŸ­ã€‚å¯¹ä¸šåŠ¡æ¥è¯´ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯Onlineçš„ã€‚</p><p>éœ€è¦è¡¥å……è¯´æ˜çš„æ˜¯ï¼Œä¸Šè¿°çš„è¿™äº›é‡å»ºæ–¹æ³•éƒ½ä¼šæ‰«æåŸè¡¨æ•°æ®å’Œæ„å»ºä¸´æ—¶æ–‡ä»¶ã€‚å¯¹äºå¾ˆå¤§çš„è¡¨æ¥è¯´ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å¾ˆæ¶ˆè€—IOå’ŒCPUèµ„æºçš„ã€‚å› æ­¤ï¼Œå¦‚æœæ˜¯çº¿ä¸ŠæœåŠ¡ï¼Œä½ è¦å¾ˆå°å¿ƒåœ°æ§åˆ¶æ“ä½œæ—¶é—´ã€‚å¦‚æœæƒ³è¦æ¯”è¾ƒå®‰å…¨çš„æ“ä½œçš„è¯ï¼Œæˆ‘æ¨èä½ ä½¿ç”¨GitHubå¼€æºçš„gh-ostæ¥åšã€‚</p><h1>Online å’Œ inplace</h1><p>è¯´åˆ°Onlineï¼Œæˆ‘è¿˜è¦å†å’Œä½ æ¾„æ¸…ä¸€ä¸‹å®ƒå’Œå¦ä¸€ä¸ªè·ŸDDLæœ‰å…³çš„ã€å®¹æ˜“æ··æ·†çš„æ¦‚å¿µinplaceçš„åŒºåˆ«ã€‚</p><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œåœ¨å›¾3ä¸­ï¼Œæˆ‘ä»¬æŠŠè¡¨Aä¸­çš„æ•°æ®å¯¼å‡ºæ¥çš„å­˜æ”¾ä½ç½®å«ä½œtmp_tableã€‚è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œæ˜¯åœ¨serverå±‚åˆ›å»ºçš„ã€‚</p><p>åœ¨å›¾4ä¸­ï¼Œæ ¹æ®è¡¨Aé‡å»ºå‡ºæ¥çš„æ•°æ®æ˜¯æ”¾åœ¨â€œtmp_fileâ€é‡Œçš„ï¼Œè¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ˜¯InnoDBåœ¨å†…éƒ¨åˆ›å»ºå‡ºæ¥çš„ã€‚æ•´ä¸ªDDLè¿‡ç¨‹éƒ½åœ¨InnoDBå†…éƒ¨å®Œæˆã€‚å¯¹äºserverå±‚æ¥è¯´ï¼Œæ²¡æœ‰æŠŠæ•°æ®æŒªåŠ¨åˆ°ä¸´æ—¶è¡¨ï¼Œæ˜¯ä¸€ä¸ªâ€œåŸåœ°â€æ“ä½œï¼Œè¿™å°±æ˜¯â€œinplaceâ€åç§°çš„æ¥æºã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ç°åœ¨é—®ä½ ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª1TBçš„è¡¨ï¼Œç°åœ¨ç£ç›˜é—´æ˜¯1.2TBï¼Œèƒ½ä¸èƒ½åšä¸€ä¸ªinplaceçš„DDLå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸èƒ½ã€‚å› ä¸ºï¼Œtmp_fileä¹Ÿæ˜¯è¦å ç”¨ä¸´æ—¶ç©ºé—´çš„ã€‚</p><p>æˆ‘ä»¬é‡å»ºè¡¨çš„è¿™ä¸ªè¯­å¥alter table t engine=InnoDBï¼Œå…¶å®éšå«çš„æ„æ€æ˜¯ï¼š</p><pre><code>alter table t engine=innodb,ALGORITHM=inplace;
</code></pre><p>è·Ÿinplaceå¯¹åº”çš„å°±æ˜¯æ‹·è´è¡¨çš„æ–¹å¼äº†ï¼Œç”¨æ³•æ˜¯ï¼š</p><pre><code>alter table t engine=innodb,ALGORITHM=copy;
</code></pre><p>å½“ä½ ä½¿ç”¨ALGORITHM=copyçš„æ—¶å€™ï¼Œè¡¨ç¤ºçš„æ˜¯å¼ºåˆ¶æ‹·è´è¡¨ï¼Œå¯¹åº”çš„æµç¨‹å°±æ˜¯å›¾3çš„æ“ä½œè¿‡ç¨‹ã€‚</p><p>ä½†æˆ‘è¿™æ ·è¯´ä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œinplaceè·ŸOnlineæ˜¯ä¸æ˜¯å°±æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ</p><p>å…¶å®ä¸æ˜¯çš„ï¼Œåªæ˜¯åœ¨é‡å»ºè¡¨è¿™ä¸ªé€»è¾‘ä¸­åˆšå¥½æ˜¯è¿™æ ·è€Œå·²ã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœæˆ‘è¦ç»™InnoDBè¡¨çš„ä¸€ä¸ªå­—æ®µåŠ å…¨æ–‡ç´¢å¼•ï¼Œå†™æ³•æ˜¯ï¼š</p><pre><code>alter table t add FULLTEXT(field_name);
</code></pre><p>è¿™ä¸ªè¿‡ç¨‹æ˜¯inplaceçš„ï¼Œä½†ä¼šé˜»å¡å¢åˆ æ”¹æ“ä½œï¼Œæ˜¯éOnlineçš„ã€‚</p><p>å¦‚æœè¯´è¿™ä¸¤ä¸ªé€»è¾‘ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆçš„è¯ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºï¼š</p><ol>
<li>
<p>DDLè¿‡ç¨‹å¦‚æœæ˜¯Onlineçš„ï¼Œå°±ä¸€å®šæ˜¯inplaceçš„ï¼›</p>
</li>
<li>
<p>åè¿‡æ¥æœªå¿…ï¼Œä¹Ÿå°±æ˜¯è¯´inplaceçš„DDLï¼Œæœ‰å¯èƒ½ä¸æ˜¯Onlineçš„ã€‚æˆªæ­¢åˆ°MySQL 8.0ï¼Œæ·»åŠ å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXT indexï¼‰å’Œç©ºé—´ç´¢å¼•(SPATIAL index)å°±å±äºè¿™ç§æƒ…å†µã€‚</p>
</li>
</ol><p>æœ€åï¼Œæˆ‘ä»¬å†å»¶ä¼¸ä¸€ä¸‹ã€‚</p><p>åœ¨ç¬¬10ç¯‡æ–‡ç« <a href="https://time.geekbang.org/column/article/71173">ã€ŠMySQLä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šé€‰é”™ç´¢å¼•ã€‹</a>çš„è¯„è®ºåŒºä¸­ï¼Œæœ‰åŒå­¦é—®åˆ°ä½¿ç”¨optimize tableã€analyze tableå’Œalter tableè¿™ä¸‰ç§æ–¹å¼é‡å»ºè¡¨çš„åŒºåˆ«ã€‚è¿™é‡Œï¼Œæˆ‘é¡ºä¾¿å†ç®€å•å’Œä½ è§£é‡Šä¸€ä¸‹ã€‚</p><ul>
<li>ä»MySQL 5.6ç‰ˆæœ¬å¼€å§‹ï¼Œalter table t engine = InnoDBï¼ˆä¹Ÿå°±æ˜¯recreateï¼‰é»˜è®¤çš„å°±æ˜¯ä¸Šé¢å›¾4çš„æµç¨‹äº†ï¼›</li>
<li>analyze table t å…¶å®ä¸æ˜¯é‡å»ºè¡¨ï¼Œåªæ˜¯å¯¹è¡¨çš„ç´¢å¼•ä¿¡æ¯åšé‡æ–°ç»Ÿè®¡ï¼Œæ²¡æœ‰ä¿®æ”¹æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åŠ äº†MDLè¯»é”ï¼›</li>
<li>optimize table t ç­‰äºrecreate+analyzeã€‚</li>
</ul><h1>å°ç»“</h1><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å’Œä½ è®¨è®ºäº†æ•°æ®åº“ä¸­æ”¶ç¼©è¡¨ç©ºé—´çš„æ–¹æ³•ã€‚</p><p>ç°åœ¨ä½ å·²ç»çŸ¥é“äº†ï¼Œå¦‚æœè¦æ”¶ç¼©ä¸€ä¸ªè¡¨ï¼Œåªæ˜¯deleteæ‰è¡¨é‡Œé¢ä¸ç”¨çš„æ•°æ®çš„è¯ï¼Œè¡¨æ–‡ä»¶çš„å¤§å°æ˜¯ä¸ä¼šå˜çš„ï¼Œä½ è¿˜è¦é€šè¿‡alter tableå‘½ä»¤é‡å»ºè¡¨ï¼Œæ‰èƒ½è¾¾åˆ°è¡¨æ–‡ä»¶å˜å°çš„ç›®çš„ã€‚æˆ‘è·Ÿä½ ä»‹ç»äº†é‡å»ºè¡¨çš„ä¸¤ç§å®ç°æ–¹å¼ï¼ŒOnline DDLçš„æ–¹å¼æ˜¯å¯ä»¥è€ƒè™‘åœ¨ä¸šåŠ¡ä½å³°æœŸä½¿ç”¨çš„ï¼Œè€ŒMySQL 5.5åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªå‘½ä»¤æ˜¯ä¼šé˜»å¡DMLçš„ï¼Œè¿™ä¸ªä½ éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚</p><p>æœ€åï¼Œåˆåˆ°äº†æˆ‘ä»¬çš„è¯¾åé—®é¢˜æ—¶é—´ã€‚</p><p>å‡è®¾ç°åœ¨æœ‰äººç¢°åˆ°äº†ä¸€ä¸ªâ€œæƒ³è¦æ”¶ç¼©è¡¨ç©ºé—´ï¼Œç»“æœé€‚å¾—å…¶åâ€çš„æƒ…å†µï¼Œçœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p><ol>
<li>
<p>ä¸€ä¸ªè¡¨tæ–‡ä»¶å¤§å°ä¸º1TBï¼›</p>
</li>
<li>
<p>å¯¹è¿™ä¸ªè¡¨æ‰§è¡Œ alter table t engine=InnoDBï¼›</p>
</li>
<li>
<p>å‘ç°æ‰§è¡Œå®Œæˆåï¼Œç©ºé—´ä¸ä»…æ²¡å˜å°ï¼Œè¿˜ç¨å¾®å¤§äº†ä¸€ç‚¹å„¿ï¼Œæ¯”å¦‚å˜æˆäº†1.01TBã€‚</p>
</li>
</ol><p>ä½ è§‰å¾—å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› å‘¢ ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ è§‰å¾—å¯èƒ½çš„åŸå› å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾æŠŠå¤§å®¶æè¿°çš„åˆç†çš„åŸå› éƒ½åˆ—å‡ºæ¥ï¼Œä»¥åå…¶ä»–åŒå­¦å°±ä¸ç”¨æ‰åˆ°è¿™æ ·çš„å‘é‡Œäº†ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>åœ¨ä¸ŠæœŸæ–‡ç« æœ€åï¼Œæˆ‘ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœä¸€ä¸ªé«˜é…çš„æœºå™¨ï¼Œredo logè®¾ç½®å¤ªå°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚</p><p>æ¯æ¬¡äº‹åŠ¡æäº¤éƒ½è¦å†™redo logï¼Œå¦‚æœè®¾ç½®å¤ªå°ï¼Œå¾ˆå¿«å°±ä¼šè¢«å†™æ»¡ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªå›¾çš„çŠ¶æ€ï¼Œè¿™ä¸ªâ€œç¯â€å°†å¾ˆå¿«è¢«å†™æ»¡ï¼Œwrite posä¸€ç›´è¿½ç€CPã€‚</p><p><img src="https://static001.geekbang.org/resource/image/a2/e5/a25bdbbfc2cfc5d5e20690547fe7f2e5.jpg" alt=""></p><p>è¿™æ—¶å€™ç³»ç»Ÿä¸å¾—ä¸åœæ­¢æ‰€æœ‰æ›´æ–°ï¼Œå»æ¨è¿›checkpointã€‚</p><p>è¿™æ—¶ï¼Œä½ çœ‹åˆ°çš„ç°è±¡å°±æ˜¯<strong>ç£ç›˜å‹åŠ›å¾ˆå°ï¼Œä½†æ˜¯æ•°æ®åº“å‡ºç°é—´æ­‡æ€§çš„æ€§èƒ½ä¸‹è·Œã€‚</strong></p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>
<p>@æŸã€äºº ç»™äº†ä¸€ä¸ªå½¢è±¡çš„æè¿°ï¼Œè€Œä¸”æåˆ°äº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿change bufferçš„ä¼˜åŒ–ä¹Ÿå¤±æ•ˆäº†ã€‚å› ä¸ºcheckpointä¸€ç›´è¦å¾€å‰æ¨ï¼Œè¿™ä¸ªæ“ä½œå°±ä¼šè§¦å‘mergeæ“ä½œï¼Œç„¶ååˆè¿›ä¸€æ­¥åœ°è§¦å‘åˆ·è„é¡µæ“ä½œï¼›<br>
æœ‰å‡ ä¸ªåŒå­¦æåˆ°äº†å†…å­˜æ·˜æ±°è„é¡µï¼Œå¯¹åº”çš„redo logçš„æ“ä½œï¼Œè¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­å±•å¼€ï¼Œå¤§å®¶å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ @melon åŒå­¦çš„æè¿°äº†è§£ä¸€ä¸‹ï¼›<br>
@ç®—ä¸å‡ºæµæº æåˆ°äº†â€œåŠ¨æ€å¹³è¡¡â€ï¼Œå…¶å®åªè¦å‡ºç°äº†è¿™ç§â€œå¹³è¡¡â€ï¼Œæ„å‘³ç€æœ¬åº”è¯¥åå°çš„æ“ä½œï¼Œå°±å·²ç»å½±å“äº†ä¸šåŠ¡åº”ç”¨ï¼Œå±äºæœ‰æŸå¤±çš„å¹³è¡¡ã€‚</p>
</blockquote><p><img src="https://static001.geekbang.org/resource/image/ce/d9/ce7f4e35916ed1aa49206a53a0547bd9.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">undifined</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œæœ‰å‡ ä¸ªé—®é¢˜ï¼š<br>1.Truncate ä¼šé‡Šæ”¾è¡¨ç©ºé—´å—<br>2.é‡å»ºè¡¨çš„æ—¶å€™å¦‚æœæ²¡æœ‰æ•°æ®æ›´æ–°ï¼Œæœ‰æ²¡æœ‰å¯èƒ½äº§ç”Ÿé¡µåˆ†è£‚å’Œç©ºæ´<br>3.é¡µåˆ†è£‚æ˜¯å‘ç”Ÿåœ¨ç´¢å¼•è¿˜æ˜¯æ•°æ®ä¸Š<br>4.åº”ç”¨ row log çš„è¿‡ç¨‹ä¼šä¸ä¼šå†æ¬¡äº§ç”Ÿé¡µåˆ†è£‚å’Œç©ºæ´<br>5.ä¸å½±å“å¢åˆ æ”¹ï¼Œå°±æ˜¯ Onlineï¼›ç›¸å¯¹ Serverå±‚æ²¡æœ‰æ–°å»ºä¸´æ—¶è¡¨ï¼Œå°±æ˜¯ inplaceï¼Œè¿™é‡Œæ€ä¹ˆåˆ¤æ–­æ˜¯ä¸æ˜¯ç›¸å¯¹ Server å±‚æ²¡æœ‰æ–°å»ºä¸´æ—¶è¡¨<br>è¾›è‹¦è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼Œè°¢è°¢è€å¸ˆ <br></div>
                            <span class="time">2018-12-12 10:41</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. Truncate å¯ä»¥ç†è§£ä¸ºdrop+create<br>2.  Online å¯ä»¥è®¤ä¸ºæ²¡æœ‰<br>3. æ•°æ®ä¹Ÿæ˜¯ç´¢å¼•å“¦<br>4. å¯èƒ½ä¼š<br>5. å¥½é—®é¢˜ï¼Œæˆ‘æ”¾åˆ°æ˜å¤©ç­”ç–‘éƒ¨åˆ†</p>
                                <p class="reply-time">2018-12-12 11:16</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/63/70/0b7b5cda.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">éƒœ</span>
                            </div>
                            <div class="bd">éº»çƒ¦å’¨è¯¢ä¸ªé—®é¢˜ï¼Œâ€œåœ¨å›¾ 3 ä¸­ï¼Œæˆ‘ä»¬æŠŠè¡¨ A ä¸­çš„æ•°æ®å¯¼å‡ºæ¥çš„å­˜æ”¾ä½ç½®å«ä½œ tmp_tableã€‚è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œæ˜¯åœ¨ server å±‚åˆ›å»ºçš„ã€‚â€<br>åœ¨serverå±‚åˆ›å»ºçš„è¡¨ä¹Ÿæ˜¯å°†Aè¡¨æ•°æ®copyåˆ°äº†ä¸´æ—¶è¡¨ï¼Œä¸ºä»€ä¹ˆåœ¨ç©ºé—´ä¸å¤Ÿç”¨æ—¶å°±æ²¡æœ‰é—®é¢˜ï¼Œè€Œinplaceåœ¨InnoDBæ‰§è¡Œåˆ™ä¼šå†å ç”¨ä¸€ä»½å­˜å‚¨ï¼Ÿ<br> <br></div>
                            <span class="time">2018-12-13 11:07</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é¢ï¼Œ<br><br>Copyçš„æ—¶å€™è‚¯å®šæ›´è¦çš„â€¦<br><br>è¿™é‡Œç‰¹åˆ«æŒ‡å‡ºæ¥ï¼Œæ˜¯å› ä¸ºå¤§å¤šæ•°äººå¾ˆå®¹æ˜“ç†è§£copyéœ€è¦ä¸´æ—¶ç©ºé—´ï¼Œä½†æ˜¯è¯¯ä»¥ä¸ºinplaceä¸éœ€è¦<br><br><br>Anyway,å¥½é—®é¢˜ ğŸ˜„</p>
                                <p class="reply-time">2018-12-13 18:13</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/9b/a4/a52a637d.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é™ˆé£</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œè¯·é—®ä¸‹åˆ†å¸ƒå¼IDï¼ˆé›ªèŠ±ç®—æ³•ç”Ÿæˆçš„IDï¼‰ç”Ÿæˆçš„ç´¢å¼•ä¼šæ¯”è‡ªå¢é•¿çš„IDæ€§èƒ½ä½å—ï¼Ÿ<br><br>é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„IDæ˜¯è¶Šæ¥è¶Šå¤§çš„ï¼Œä½†ä¸æ˜¯é€æ¸é€’å¢ï¼Œé•¿åº¦ç”¨çš„çš„bitintï¼Œéº»çƒ¦è§£ç­”ä¸‹ï¼Œéå¸¸æ„Ÿè°¢ã€‚ <br></div>
                            <span class="time">2018-12-13 13:57</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ã€‚<br><br><br>æ€§èƒ½ä¸€æ ·çš„ï¼Œæ²¡æœ‰ä¸€å®šè¦â€œè¿ç»­â€ï¼Œåªè¦æ˜¯é€’å¢</p>
                                <p class="reply-time">2018-12-13 18:11</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å‘æ¡æ©™å­ ã€‚</span>
                            </div>
                            <div class="bd">è€å¸ˆ ï¼Œ æˆ‘çš„ç¡®å®æ˜¯ 5.7 ç‰ˆæœ¬ã€‚æˆ‘ä»Šå¤©çœ‹äº†äº›å…³äº online ddlçš„æ–‡ç«  ï¼Œå†ç»“åˆè¡¨é”é‚£ç« è¯„è®ºçš„å†…å®¹ï¼Œæœ‰å‡ ä¸ªç‚¹è¿˜æƒ³ç¡®è®¤ä¸€ä¸‹ ï¼Œå¸Œæœ›è€å¸ˆèƒ½è§£ç­”ä¸€ä¸‹ ã€‚<br><br>1. æ˜¯ä¸æ˜¯ 5.6 ä¹‹å æ‰€æœ‰çš„ alter æ“ä½œ(å¢åˆ å­—æ®µã€å¢åˆ ç´¢å¼•ç­‰)éƒ½æ˜¯æ”¯æŒ online ddl <br><br>2. å¦‚æœ alter éƒ½æ˜¯ online ddl é‚£ä¹ˆæ˜¯ä¸æ˜¯å¦‚æœ alteræ“ä½œ è·å–åˆ°mdlå†™é” æ—¶ï¼Œ åé¢çš„ æŸ¥è¯¢éœ€è¦mdlè¯»é”ä¼šæš‚æ—¶é˜»å¡ï¼Œ ä½†æ˜¯mdlä¼šé©¬ä¸Šé™ä¸ºè¯»é” ï¼Œåé¢çš„æ“ä½œä¼šç»§ç»­è¿›è¡Œä¸ä¼šå µå¡ ã€‚ç­‰å†å‡åˆ°å†™é” ï¼Œåé¢æ“ä½œåˆä¼šæš‚æ—¶é˜»å¡ã€‚ <br><br>3. å½“ alter é™åˆ°mdl è¯»é”æ—¶ ï¼Œ è¿™æ—¶å€™å¯ä»¥æ–°å¢æ•°æ®ä¹ˆ ï¼Œ mdlè¡¨çº§è¯»é” ä¸ä¼šå½±å“åˆ° insert æˆ–è€… updateçš„è¡Œé”ä¹ˆ <br><br>4. å¦‚æœå°† alter æ“ä½œæ˜¾å¼çš„æ”¾åˆ°äº‹åŠ¡é‡Œ ï¼Œäº‹åŠ¡ä¸æäº¤ ï¼Œ å¦ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢çš„æ—¶å€™ä¼šæŸ¥è¯¢åˆ°alter æ“ä½œåçš„è¡¨ç»“æ„ ï¼Œ æ¯”å¦‚æ–°å¢äº†ä¸€ä¸ªå­—æ®µã€‚è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå›  ï¼Œæ˜¯å¦æ‰“ç ´äº† mvcc çš„å®šä¹‰å‘¢ <br></div>
                            <span class="time">2018-12-13 23:49</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. ä¸æ˜¯å“¦ï¼Œæˆ‘æ–‡ç« é‡Œè¯´çš„åŠ å…¨æ–‡ç´¢å¼•å°±ä¸online<br><br>2. å¯¹ï¼Œè¿™ä¸¤ä¸ªæš‚æ—¶ï¼Œéƒ½æ˜¯æ—¶é—´å¾ˆçŸ­çš„<br><br>3. æ˜¯ï¼ŒDMLè¯­å¥åŠ çš„æ˜¯MDLè¯»é”ï¼Œè¯»è¯»ä¸å†²çª<br><br>4. å¥½é—®é¢˜ ï¼Œ ä¸è¿‡alter table è¯­å¥ä¼šé»˜è®¤æäº¤å‰é¢çš„äº‹åŠ¡ï¼Œç„¶åè‡ªå·±ç‹¬ç«‹æ‰§è¡ŒğŸ˜„</p>
                                <p class="reply-time">2018-12-14 00:36</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/mcibngvIYnyDbzWPrWu0hD6WvZzjuiawXTSeLQibMJxa7gMtL7RrmT5Qia0esMJSlSLAKC5TC5JpHquKgBNgE8Uhrg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é£ç¿”</span>
                            </div>
                            <div class="bd">æˆ‘æƒ³åˆ°çš„å…¶ä¸­ä¸€ç§å¯èƒ½ï¼š<br>æœ¬æ¥å°±å¾ˆç´§å‡‘ï¼Œæ²¡èƒ½æ•´å‡ºå¤šå°‘å‰©ä½™ç©ºé—´ã€‚<br>é‡æ–°æ”¶ç¼©çš„è¿‡ç¨‹ä¸­ï¼Œé¡µä¼šæŒ‰90%æ»¡çš„æ¯”ä¾‹æ¥é‡æ–°æ•´ç†é¡µæ•°æ®ï¼ˆ10%ç•™ç»™UPDATEä½¿ç”¨ï¼‰ï¼Œ<br>æœªæ•´ç†ä¹‹å‰é¡µå·²ç»å ç”¨90%ä»¥ä¸Šï¼Œæ”¶ç¼©ä¹‹åï¼Œæ–‡ä»¶å°±åè€Œå˜å¤§äº†ã€‚ <br></div>
                            <span class="time">2018-12-12 11:16</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä¸€ä¸ªæ¼‚äº®çš„ç­”æ¡ˆ</p>
                                <p class="reply-time">2018-12-12 11:43</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†</span>
                            </div>
                            <div class="bd">@undifinedæ€ä¹ˆåˆ¤æ–­æ˜¯ä¸æ˜¯ç›¸å¯¹ Server å±‚æ²¡æœ‰æ–°å»ºä¸´æ—¶è¡¨ã€‚ä¸€ä¸ªæœ€ç›´è§‚çš„åˆ¤æ–­æ–¹æ³•æ˜¯çœ‹å‘½ä»¤æ‰§è¡Œåå½±å“çš„è¡Œæ•°ï¼Œæ²¡æœ‰æ–°å»ºä¸´æ—¶è¡¨çš„è¯æ–°å»ºçš„è¡Œæ•°æ˜¯0ã€‚ <br></div>
                            <span class="time">2018-12-12 14:41</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿ï¼Œä¸‹ä¸€ç¯‡ç­”ç–‘ç›´æ¥è´´ä½ ç­”æ¡ˆğŸ˜„</p>
                                <p class="reply-time">2018-12-12 17:56</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æŸã€äºº</span>
                            </div>
                            <div class="bd">é€šè¿‡ç¬¬10æœŸçš„è¯¾åæ€è€ƒé¢˜å­¦ä¹ åˆ°å¦‚æœdeleteçš„æ•°æ®è¿˜ä¼šè¢«ç”¨äºMVCC,é‚£ä¹ˆè¯¥æ•°æ®é¡µ(äºŒçº§ç´¢å¼•å’Œèšç°‡ç´¢å¼•)ä¸Šçš„è®°å½•ä¸ä¼šè¢«ç‰©ç†åˆ é™¤,æ˜¯è¢«æ ‡è®°åˆ é™¤ã€‚åªæœ‰å½“è¯¥äº‹åŠ¡ä¸ä¼šç”¨äºmvccäº†,æ‰å¯ä»¥è¢«purgeçº¿ç¨‹æŠŠä¹‹å‰æ ‡è®°åˆ é™¤çš„æ•°æ®çœŸæ­£åˆ é™¤æ‰.ä½†æ˜¯å³ä¾¿æ•°æ®ç‰©ç†åˆ é™¤äº†,ç£ç›˜ç©ºé—´ä¹Ÿä¸ä¼šè¿”å›ç»™æ“ä½œç³»ç»Ÿ.å¯ä»¥é€šè¿‡show table status like &#39;t&#39;;è§‚å¯Ÿdata_freeæ¥é¢„ä¼°è¯¥è¡¨çš„ç¢ç‰‡ã€‚å¦‚æœè¿‡å¤§,å¯ä»¥ç”¨alter table t engine=innodbæ¥æ¸…é™¤<br>æˆ‘æœ‰å‡ ä¸ªé—®é¢˜è¯·æ•™ä¸‹è€å¸ˆ:<br>1.inplaceç›¸å¯¹äºå…¶ä»–åœ¨çº¿æ”¹è¡¨è½¯ä»¶,å¤šäº†MDL Xé”.æ—¢ç„¶éƒ½æ˜¯é€šè¿‡ä¸´æ—¶è¡¨&#47;æ–‡ä»¶æ¥åš,ä¸ºä»€ä¹ˆä¸€å¼€å§‹è¦ä¸ŠMDL Xé”ï¼Ÿ<br>2.gh-ostä½¿ç”¨binlogæ¥åšåŒæ­¥,å‡è®¾ä»position 1å¼€å§‹,å…ˆlock Så‰é¢1000æ¡æ•°æ®åšcp,è¿™æ—¶æœ‰äº‹åŠ¡å¯¹åé¢1000æ¡æ•°æ®åšäº†ä¿®æ”¹æˆ–è€…æ’å…¥ã€‚ç­‰cpåé¢è¿™ä¸ª1000æ¡æ—¶,ä¼šæŠŠä¿®æ”¹å¥½çš„æ•°æ®cpåˆ°ä¸´æ—¶è¡¨.æœ€ååˆåº”ç”¨binlog,é‚£ä¹ˆè¿™ç›¸å½“äºåšäº†ä¸¤æ¬¡æ“ä½œ,è¯·é—®è¿™éƒ¨åˆ†æ•°æ®æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ<br>3.onlineä¼šæŠŠè¿‡ç¨‹ä¸­å¯¹è¡¨çš„æ“ä½œè®°å½•åœ¨ä¸€ä¸ª(row log)ä¸­,é‚£ä¹ˆä¸­é€”è¿™äº›DMLäº‹åŠ¡,æ˜¯æ€ä¹ˆåˆ¤å®šçš„commit?æˆ‘åšæµ‹è¯•,ä¸­é€”è¿™äº›äº‹åŠ¡éƒ½æ˜¯æˆåŠŸçš„ã€‚ä½†æ˜¯æœ‰åœ¨åšonline DDLå¿«å®Œäº†,commité‚£ä¸ªé˜¶æ®µ,DDLæŠ¥å”¯ä¸€é”®å†²çª,è¿™åˆæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„å•Šï¼Ÿæˆ‘æ²¡æœ‰æ¨¡æ‹Ÿå‡ºæ¥è¿™ä¸ªä¾‹å­ <br></div>
                            <span class="time">2018-12-13 20:26</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">1. ç¡®ä¿æ²¡æœ‰å¯å‘è¯·æ±‚åœ¨ç”¨è¿™ä¸ªè¡¨<br><br>2. Binlogè®¾ç½®ä¸ºrowæ ¼å¼ï¼Œå¹‚ç­‰çš„<br><br>3. è¿™ä¸ªæˆ‘è§‰å¾—å…¶å®æ˜¯bug,å°±æ²¡æã€‚ä½ åœ¨DDLæœŸé—´ï¼Œå¾€åŸè¡¨æ’å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨ç›¸åŒä¸»é”®çš„ä¸€è¡Œè¯•è¯•</p>
                                <p class="reply-time">2018-12-13 21:51</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å°˜å°</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œå’Œæœ¬æ–‡æ— å…³ï¼Œæ—¢ç„¶mysqlæ”¯æŒäº†æ‰“åŒ…æ•°æ®æ’åºæ¨¡å¼ï¼Œèƒ½å¤Ÿæ›´ç´§å‡‘çš„åˆ†é…å†…å­˜è¿›è¡Œæ’åºï¼Œé‚£å®šä¹‰è¡¨ç»“æ„çš„æ—¶å€™ï¼Œvarchar(10)å­˜å‚¨helloå’Œvarchar(100)å­˜å‚¨helloçš„ä¼˜åŠ¿åœ¨å“ªé‡Œå‘¢ï¼Ÿè°¢è°¢ <br></div>
                            <span class="time">2018-12-12 07:32</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ è¿™ä¸ªé—®é¢˜æ”¾åœ¨ç¬¬16ç¯‡é—®å°±åˆšåˆšå¥½äº†ã€‚<br><br>ä»¥å‰ä¸æ”¯æŒç´§å‡‘æ’åºçš„æ—¶å€™æœ‰ï¼Œç°åœ¨æ²¡å•¥äº†å·®åˆ«äº†ï¼Œå°äº256éƒ½å·®ä¸å¤š</p>
                                <p class="reply-time">2018-12-12 10:47</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/11/a2/97c0de02.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Vã€‚</span>
                            </div>
                            <div class="bd">å¯èƒ½æ€§æœ‰ä¸¤ä¸ªã€‚<br>1. ç”Ÿæˆä¸´æ—¶è¡¨è¿‡ç¨‹ä¸­ï¼Œrow logä¸­æ–°å¢çš„æ•°æ®è¾ƒå¤šï¼Œå¯¼è‡´è¡¨çš„è¡Œæ•°å˜å¤šã€‚<br>2. ç”Ÿæˆä¸´æ—¶è¡¨è¿‡ç¨‹ä¸­ï¼Œrow logä¸­æœ‰éƒ¨åˆ†æ’å…¥å’Œåˆ é™¤æ“ä½œä¼šäº§ç”Ÿâ€œç©ºæ´â€ã€‚<br>ä¸ªäººæ„Ÿè§‰ï¼Œç¬¬ä¸€ç§æƒ…å†µï¼Œçªç„¶å¤šäº†é«˜äº1ï¼…çš„æ•°æ®ï¼Œæ¯”è¾ƒå°‘è§ï¼›ä½†ç¬¬äºŒç§æƒ…å†µï¼Œåœ¨æŸäº›ä¸šåŠ¡ä¸­ï¼Œç»å¸¸å‡ºç°ã€‚ <br></div>
                            <span class="time">2018-12-12 09:46</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åº“æ·˜æ·˜</span>
                            </div>
                            <div class="bd">alter table A engine=InnoDB ä¸­ç”±å†™é”é™ä¸ºè¯»é”ã€‚æœ‰ä¸ªç–‘é—® ä¸ºä½•ä¸ç›´æ¥å°±åŠ ä¸ªMDLè¯»é” ,è¿™æ ·DDL ä¹Ÿæ‰§è¡Œä¸äº†,åº”ç”¨redo æ›¿æ¢æ–‡ä»¶åé‡Šæ”¾è¯»é”å³å¯ <br></div>
                            <span class="time">2018-12-13 16:04</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¦‚æœæœ‰åˆ«çš„çº¿ç¨‹æ­£åœ¨è¯»è¿™ä¸ªè¡¨çš„æ•°æ®ï¼Œå¾—ç­‰ä¸‹</p>
                                <p class="reply-time">2018-12-13 18:07</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/df/e7/e3c450c2.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">lionetes</span>
                            </div>
                            <div class="bd">åœ¨alter table engine =innodb  æœªå®Œæˆå‰,åšäº†DML æ“ä½œ, å¹¶ä¸”æ˜¯åœ¨å·²ç»é‡æ„å®Œçš„æ•°æ®å¼•èµ·çš„DMLæ“ä½œï¼Œäº§ç”Ÿäº†ç©ºæ´. å¯¼è‡´å˜å¤§ é‡æ„æœªå¤„ç†çš„æ•°æ® å³ä½¿äº§ç”Ÿäº† ç©ºæ´ï¼Œåˆ°100% åä¹Ÿèƒ½æ¸…ç†ç¢ç‰‡ç©ºé—´.<br><br>truncate table  é‡Œé¢çš„ æ•°æ® ä¸äº§ç”Ÿ binlog,æ— æ³•æ¢å¤ï¼Œ å¦‚æœé€Ÿåº¦ä¸Šé¢æ¥è®² è¿˜æ˜¯drop table æ›´å¿«.  ä½†å¯¹äº è¶…å¤§çš„table åšdropï¼Œ truncate æ—¶å€™ä¹Ÿæ˜¯å¾ˆå±é™©äº†ï¼Œå®¹æ˜“æ•´ä¸ªæ•°æ®åº“ hang ä½ï¼Œå› ä¸ºè¦å¯¹ buffer pool ä¸­å¯¹åº”çš„é¡µé¢æ¸…é™¤, å¯ä»¥å¯¹ibd æ–‡ä»¶åš ln æ“ä½œç”Ÿæˆ ibd.hdlk  ç„¶å rm -f  ibd æœ€å drop table ä¼šå¾ˆå¿«<br><br>å¯¹ç»å¸¸delete æ•°æ®çš„è¡¨ ç”¨ä»¥å‰è®²çš„ å¾ªç¯åˆ é™¤ æ–¹æ³•ï¼Œæ¥åˆ é™¤ ä¹Ÿæ˜¯ ä¸é”™çš„. å½“ç„¶è¦æ ¹æ®æƒ…å†µåš ç¢ç‰‡æ•´ç† <br></div>
                            <span class="time">2018-12-12 22:34</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†</span>
                            </div>
                            <div class="bd">æ‰§è¡Œå®Œæˆåï¼Œç©ºé—´ä¸ä»…æ²¡å˜å°ï¼Œè¿˜ç¨å¾®å¤§äº†ä¸€ç‚¹å„¿ã€‚æ¯”è¾ƒå¸¸è§çš„æƒ…å†µæ˜¯è¡¨ä¸Šåªæœ‰insertï¼Œæ²¡æœ‰updateçš„æƒ…å†µï¼Œå¦‚ä¸€äº›å­˜æ”¾å†å²æ“ä½œè®°å½•çš„è¡¨ã€‚ <br></div>
                            <span class="time">2018-12-12 14:42</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/41/f7/277f14bb.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">wang chen wen</span>
                            </div>
                            <div class="bd">optimize table t ç­‰äº recreate+analyze<br>è€å¸ˆè¯·æ•™ä¸ªé—®é¢˜recreateå‡ºæ¥åº”è¯¥æ˜¯å‡ ä¹å…¨æ–°çš„ï¼Œanalyzeçš„å¿…è¦æ€§ï¼Ÿ <br></div>
                            <span class="time">2018-12-12 09:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">å¥½é—®é¢˜ï¼Œè¿™ä¸ªå¾—æ˜¯æ¯”è¾ƒæç«¯çš„æƒ…å†µä¸‹æ‰æœ‰å¿…è¦ï¼Œæ‰€ä»¥æˆ‘æ¯”è¾ƒå–œæ¬¢ç›´æ¥ç”¨alter </p>
                                <p class="reply-time">2018-12-12 10:30</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¤©ç‹</span>
                            </div>
                            <div class="bd"> deleteåˆ é™¤è¡¨æ•°æ®ï¼Œåªæ˜¯æ‰“ä¸Šä¸€ä¸ªå¯å¤ç”¨æ ‡è®°ï¼Œå¦‚æœæ˜¯æ•°æ®é¡µä¸Šä¸€éƒ¨åˆ†æ•°æ®æ‰“ä¸Šæ ‡è®°ï¼Œå¦‚æœæŒ‰ç…§è‡ªå¢ä¸»é”®insertæ•°æ®ï¼Œé‚£è¡¨ç©ºé—´çš„æ•°æ®ä¸ä¼šå¤ç”¨ï¼Œå¦‚æœæ˜¯æ•´ä¸ªæ•°æ®é¡µçš„æ‰€æœ‰æ•°æ®æ‰“ä¸Šæ ‡è®°ï¼Œé‚£ä¹ˆå¯ä»¥å¤ç”¨ã€‚2ä¸ª3ç›¸ä¸´çš„æ•°æ®é¡µï¼Œå¦‚æœç©ºæ´å¤ªå¤šï¼Œåˆå¹¶æˆä¸€ä¸ªé¡µï¼Œå¦å¤–ä¸€ä¸ªå¯ä»¥æ ‡è®°å¤ç”¨ã€‚é‡å»ºè¡¨å¯ä»¥å‡å°‘ç©ºæ´ï¼Œæ–‡ä»¶å¤§å°å¯ä»¥å‡å°ï¼Œæœ¬è´¨ä¸Šæ˜¯é€šè¿‡ï¼Œåˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œå°†æ•°æ®åœ¨ä¸´æ—¶æ–‡ä»¶ä¸Šï¼Œé‡å»ºä¸€ä»½ï¼Œé‡å»ºè¿‡ç¨‹ï¼ŒæŒ‰ç…§é¡ºåºæ’å…¥ï¼Œæå¤§å‡å°‘äº†é»‘æ´ï¼Œæ•°æ®éƒ½æ‹·è´åˆ°ä¸´æ—¶æ–‡ä»¶ä»¥åï¼Œä¼šæœ‰åˆ é™¤åŸæ¥æ–‡ä»¶ï¼Œåˆ‡æ¢åˆ°æ–°æ–‡ä»¶ã€‚æ–‡ä»¶ä¼šå‡å°äº†ã€‚<br><br><br> <br></div>
                            <span class="time">2018-12-12 09:14</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ğŸ‘ğŸ¿<br></p>
                                <p class="reply-time">2018-12-12 10:32</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ°ä¹‹7</span>
                            </div>
                            <div class="bd">é€šè¿‡è¿™ä¸€èŠ‚çš„é˜…è¯»å­¦ä¹ ï¼Œäº†è§£äº†åˆ é™¤è¡¨ä¸­çš„æ•°æ®ä»¥åï¼Œè¡¨çš„å¤§å°å¹¶æ²¡æœ‰å‡å°‘ï¼Œè¿™ç§ç°è±¡æˆ‘ä»¬å«åšç©ºæ´ï¼Œå¯¹äºå¢åˆ æ”¹éƒ½ä¼šäº§ç”Ÿè¿™ç§ç°è±¡ã€‚ä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·ï¼Œæˆ‘æƒ³æ˜¯è®¡ç®—æœºç³»ç»Ÿæˆ–è®¸å†…å­˜æ–¹é¢çš„å†…å®¹ã€‚<br><br>å¯¹äºè¿™ç§ç°è±¡ï¼Œè€å¸ˆç»™äºˆçš„è§£å†³æ–¹æ³•æ˜¯é‡å»ºè¡¨ï¼Œå°±æ˜¯å°†åŸè¡¨æ•°æ®é‡æ–°å»ºç«‹åœ¨ä¸€å¼ è¡¨ã€‚åŒæ—¶åœ¨é«˜ç‰ˆæœ¬Mysqlçš„Innodbæ”¯æŒonlineæ“ä½œï¼ŒåŒæ—¶ï¼Œè€å¸ˆè§£é‡Šäº†onplaceå’Œinplaceçš„åŒºåˆ«ã€‚<br><br>ä¸­é€”æœ‰ä¸¤ä¸ªç¤¼æ‹œæ²¡æœ‰è·Ÿä¸Šè¿›åº¦å­¦ä¹ ï¼Œå¾ˆæƒ­æ„§ï¼Œæ¥ä¸‹æ¥ä¸€æœˆä¼šå°½å¿«è·Ÿä¸Šè€å¸ˆçš„æ­¥ä¼ã€‚ <br></div>
                            <span class="time">2019-01-10 13:21</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é‡‘é¾Ÿ</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œåœ¨innodbä¸­æ˜¯ä¸æ˜¯b+æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€é¡µï¼Œæ¯”å¦‚æœ€ä¸Šå±‚çš„æ ¹èŠ‚ç‚¹å°±æ˜¯ä¸€é¡µã€‚ä¸‹å±‚æœ‰5ä¸ªèŠ‚ç‚¹å°±æ˜¯5é¡µã€‚ <br></div>
                            <span class="time">2018-12-30 11:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ˜¯çš„</p>
                                <p class="reply-time">2018-12-30 19:31</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e3/4b/5046906a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æµ·æ›™äº‘å´–</span>
                            </div>
                            <div class="bd">æ€ä¹ˆåˆ¤æ–­online DDL çš„é˜¶æ®µæ˜¯åœ¨MDLè¿˜æ˜¯è¯»é”é˜¶æ®µå‘¢ <br></div>
                            <span class="time">2018-12-26 15:10</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">Show processlistå¯ä»¥çœ‹åˆ°<br><br>ä¸è¿‡MDLé”é˜¶æ®µå¾ˆçŸ­</p>
                                <p class="reply-time">2018-12-26 17:06</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ä¸‰æœ¨ç¦¾</span>
                            </div>
                            <div class="bd">æ•°æ®é¡µAæ»¡äº†ï¼Œéšæœºæ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¸å¾—ä¸ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°æ®é¡µï¼Œè¿™æ—¶å€™æ•°æ®é¡µAä¼šç•™ä¸‹ç©ºæ´ï¼Œæˆ‘çš„é—®é¢˜æ˜¯ï¼Œæ—¢ç„¶æ»¡äº†ï¼Œä¸ºä»€ä¹ˆè¿˜æœ‰ç©ºæ´å‘¢ï¼Ÿ <br></div>
                            <span class="time">2018-12-24 15:18</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ç”³è¯·æ–°é¡µBï¼ŒæŠŠä¸€éƒ¨åˆ†æ•°æ®ä»AæŒªåˆ°Bï¼ŒAå°±ç©ºå‡ºä¸€äº›</p>
                                <p class="reply-time">2018-12-24 16:20</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/e0/25/d87b1c9b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">zzkkll99</span>
                            </div>
                            <div class="bd">è€å¸ˆæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå¯¹è¡¨ç»“æ„è¿›è¡Œä¿®æ”¹è¦è¯»åŸæ•°æ®ã€‚ä¸å¯ä»¥ç›´æ¥ä¿®æ”¹å— <br></div>
                            <span class="time">2018-12-20 17:28</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">ä½ è¯´çš„åŸæ•°æ®æ˜¯è¯´è¡¨é‡Œçš„æ•°æ®å—ï¼Ÿ<br><br>MySQL å®˜æ–¹ç‰ˆæœ¬è¿˜ä¸æ”¯æŒåªæ”¹è¡¨ç»“æ„ğŸ˜“</p>
                                <p class="reply-time">2018-12-20 18:07</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVIjh4T1akib7wAQXiaMmTRVe89bT3tBAeSdFflCQSWjDZQOs5jeBEWLC1GyFshHjvhsIZKArO6ichw/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å£¹å£å°˜åŸƒ</span>
                            </div>
                            <div class="bd">ç½‘ä¸Šæ‰¾åˆ°ä¸€ä¸ªInplaceå’ŒOnlineçš„åŒºåˆ«ï¼Œå†™çš„æŒºå¥½çš„ï¼Œè´´å‡ºæ¥æ–¹ä¾¿å¤§å®¶ç†è§£ï¼š<br>MySQLå„ç‰ˆæœ¬ï¼Œå¯¹äºadd Indexçš„å¤„ç†æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œä¸»è¦æœ‰ä¸‰ç§ï¼š<br><br>ï¼ˆ1ï¼‰Copy Tableæ–¹å¼<br>è¿™æ˜¯InnoDBæœ€æ—©æ”¯æŒçš„åˆ›å»ºç´¢å¼•çš„æ–¹å¼ã€‚é¡¾åæ€ä¹‰ï¼Œåˆ›å»ºç´¢å¼•æ˜¯é€šè¿‡ä¸´æ—¶è¡¨æ‹·è´çš„æ–¹å¼å®ç°çš„ã€‚<br><br>æ–°å»ºä¸€ä¸ªå¸¦æœ‰æ–°ç´¢å¼•çš„ä¸´æ—¶è¡¨ï¼Œå°†åŸè¡¨æ•°æ®å…¨éƒ¨æ‹·è´åˆ°ä¸´æ—¶è¡¨ï¼Œç„¶åRenameï¼Œå®Œæˆåˆ›å»ºç´¢å¼•çš„æ“ä½œã€‚<br><br>è¿™ä¸ªæ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œåˆ›å»ºè¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨æ˜¯å¯è¯»çš„ã€‚ä½†æ˜¯ä¼šæ¶ˆè€—ä¸€å€çš„å­˜å‚¨ç©ºé—´ã€‚<br><br>ï¼ˆ2ï¼‰Inplaceæ–¹å¼<br>è¿™æ˜¯åŸç”ŸMySQL 5.5ï¼Œä»¥åŠinnodb_pluginä¸­æä¾›çš„åˆ›å»ºç´¢å¼•çš„æ–¹å¼ã€‚æ‰€è°“Inplaceï¼Œä¹Ÿå°±æ˜¯ç´¢å¼•åˆ›å»ºåœ¨åŸè¡¨ä¸Šç›´æ¥è¿›è¡Œï¼Œä¸ä¼šæ‹·è´ä¸´æ—¶è¡¨ã€‚ç›¸å¯¹äºCopy Tableæ–¹å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿›æ­¥ã€‚<br><br>Inplaceæ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œåˆ›å»ºè¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨åŒæ ·å¯è¯»çš„ï¼Œä½†æ˜¯ä¸å¯å†™ã€‚<br><br>ï¼ˆ3ï¼‰Onlineæ–¹å¼<br>è¿™æ˜¯MySQL 5.6.7ä¸­æä¾›çš„åˆ›å»ºç´¢å¼•çš„æ–¹å¼ã€‚æ— è®ºæ˜¯Copy Tableæ–¹å¼ï¼Œè¿˜æ˜¯Inplaceæ–¹å¼ï¼Œåˆ›å»ºç´¢å¼•çš„è¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨åªèƒ½å…è®¸è¯»å–ï¼Œä¸å¯å†™ã€‚å¯¹åº”ç”¨æœ‰è¾ƒå¤§çš„é™åˆ¶ï¼Œå› æ­¤MySQLæœ€æ–°ç‰ˆæœ¬ä¸­ï¼ŒInnoDBæ”¯æŒäº†æ‰€è°“çš„Onlineæ–¹å¼åˆ›å»ºç´¢å¼•ã€‚<br><br>InnoDBçš„Online Add Indexï¼Œé¦–å…ˆæ˜¯Inplaceæ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œæ— éœ€ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚åœ¨éå†èšç°‡ç´¢å¼•ï¼Œæ”¶é›†è®°å½•å¹¶æ’å…¥åˆ°æ–°ç´¢å¼•çš„è¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨è®°å½•å¯ä¿®æ”¹ã€‚è€Œä¿®æ”¹çš„è®°å½•ä¿å­˜åœ¨Row Logä¸­ã€‚å½“èšç°‡ç´¢å¼•éå†å®Œæ¯•ï¼Œå¹¶å…¨éƒ¨æ’å…¥åˆ°æ–°ç´¢å¼•ä¹‹åï¼Œé‡æ”¾Row Logä¸­çš„è®°å½•ä¿®æ”¹ï¼Œä½¿å¾—æ–°ç´¢å¼•ä¸èšç°‡ç´¢å¼•è®°å½•è¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚<br><br>ä¸Copy Tableæ–¹å¼ç›¸æ¯”ï¼ŒOnline Add Indexé‡‡ç”¨çš„æ˜¯Inplaceæ–¹å¼ï¼Œæ— éœ€Copy Tableï¼Œå‡å°‘äº†ç©ºé—´å¼€é”€ï¼›ä¸æ­¤åŒæ—¶ï¼ŒOnline Add Indexåªæœ‰åœ¨é‡æ”¾Row Logæœ€åä¸€ä¸ªBlockæ—¶é”è¡¨ï¼Œå‡å°‘äº†é”è¡¨çš„æ—¶é—´ã€‚<br><br>ä¸Inplaceæ–¹å¼ç›¸æ¯”ï¼ŒOnline Add Indexå¸æ”¶äº†Inplaceæ–¹å¼çš„ä¼˜åŠ¿ï¼Œå´å‡å°‘äº†é”è¡¨çš„æ—¶é—´ã€‚ <br></div>
                            <span class="time">2018-12-19 14:40</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>